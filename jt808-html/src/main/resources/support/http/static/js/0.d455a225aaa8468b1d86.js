webpackJsonp([0],{"+MLA":function(t,e,i){var n=i("EqjI"),r=i("06OY").onFreeze;i("uqUo")("freeze",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},"/bhr":function(t,e,i){"use strict";e.a={HashMap:function(t){var e=this;e.array=[],e.put=function(t,i){for(var n=!1,r=0;r<e.array.length;r++)t==e.array[r].key&&(n=!0,e.array[r].value=i);n||e.array.push({key:t,value:i})},e.get=function(t){for(var i=0;i<e.array.length;i++)if(t==e.array[i].key)return e.array[i].value;return null},e.containsKey=function(t){for(var i=0;i<e.array.length;i++)if(t==e.array[i].key)return!0;return!1},e.remove=function(t){for(var i=[],n=0;n<e.array.length;n++)t==e.array[n].key||i.push(e.array[n]);return e.array=i,i},e.keySet=function(){for(var t=[],i=0;i<e.array.length;i++)t.push(e.array[i].key);return t}}}},"29oq":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("mtSL"),r=i.n(n),o={name:"GB28181Video",props:{callId0:{type:String,default:""},name:{type:String,default:""},mltype:{type:Number,default:1},isToolbar:{type:Boolean,default:!0},isDblclickFullScreen:{type:Boolean,default:!1}},data:function(){return{callId:"",deviceId:"",deviceName:"",channelStr:"",networkSpeed:"",playerStateTips:"",loading:!1,resolvingPower:{width:0,height:0},isPlaying:!1,isMute:!0,isFullScreen:!1,channel:1}},methods:{onLoading:function(){this.loading=!0},onDbClick:function(t){t.stopPropagation(),t.preventDefault(),this.isDblclickFullScreen&&this.handleFullScreen()},switchVideoPlayState:function(){this.isPlaying?this.stop():this.start()},handlePlayerMute:function(){this.isMute=!this.isMute},flv_photograph:function(){if(this.isPlaying){var t=document.createElement("a"),e=Date.now(),i=this.deviceName+"-"+this.channel+"-"+e;t.setAttribute("href",this.htmlToImage()),t.setAttribute("download",i),t.click()}else this.lgxInfo2("操作失败，未播放视频。")},htmlToImage:function(){var t=document.createElement("canvas");return t.width=this.resolvingPower.width,t.height=this.resolvingPower.height,t.getContext?(t.getContext("2d").drawImage(this.$refs.player,0,0,this.resolvingPower.width,this.resolvingPower.height),t.toDataURL("image/png")):(this.lgxInfo2("不支持canvas"),!1)},handleFullScreen:function(){var t=this.$refs.player;t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullScreen?t.msRequestFullScreen():t.RequestFullScreen&&t.RequestFullScreen()},play:function(t){null==this.player?(this.deviceId=t.carid,this.deviceName=t.carno,this.channel=t.tdh,this.channelStr=t.tdhStr,this.start()):(this.stop(),this.deviceId=t.carid,this.deviceName=t.carno,this.channel=t.tdh,this.channelStr=t.tdhStr,setTimeout(this.start,100))},start:function(){var t=this;this.deviceId?(this.loading=!0,this.callApi({apicode:1142,deviceId:this.deviceId,channel:this.channel,mltype:this.mltype},function(e){if(-1!=e.code){t.callId=e.callId;var i=e.pull_address;t.pullVideo(i),e.pull_address_audio&&(console.log(e.pull_address_audio),s.start(e.pull_address_audio))}else t.lgxInfo2(e.message)})):this.lgxInfo2("操作失败，未设置参数。")},stop:function(){null!=this.player&&(this.player.pause(),this.player.unload(),this.player.detachMediaElement(),this.player.destroy(),this.player=null,this.loading=!1,this.isPlaying=!1,this.networkSpeed=""),this.deviceId&&this.callApi({apicode:1143,deviceId:this.deviceId,callId:this.callId||this.callId0,mltype:this.mltype,stop:1},function(t){})},pullVideo:function(t,e){e&&(this.deviceId=e.tid,this.channel=e.tdh);var i=this;if(r.a.getFeatureList().mseLivePlayback){var n=this.$refs.player;this.player=r.a.createPlayer({type:"mse",isLive:!0,hasAudio:!1,hasVideo:!0,url:this.addParams(t),config:{autoCleanupSourceBuffer:!0}},{enableStashBuffer:!1,fixAudioTimestampGap:!1,autoCleanupSourceBuffer:!0,liveBufferLatencyChasing:!1}),this.player.attachMediaElement(n),this.player.load(),setTimeout(function(){i.player.play()},100),this.player.on(r.a.Events.STATISTICS_INFO,function(t){i.networkSpeed=t.speed.toFixed(0)+"KB/S"}),this.player.on(r.a.Events.ERROR,function(t){i.stop()})}},addEventListenerToPlayer:function(){var t=this.$refs.player,e=this;t.addEventListener("loadedmetadata",function(t){e.resolvingPower={width:t.target.videoWidth,height:t.target.videoHeight},e.loading=!1}),t.addEventListener("timeupdate",function(){var i;i=Math.floor(t.currentTime),e.$emit("timeupdate",i)},!1),t.addEventListener("error",function(){console.log("element video error event.")}),t.addEventListener("play",function(){e.isPlaying=!0}),t.addEventListener("playing",function(){}),t.addEventListener("pause",function(){console.log("element video pause event.")}),t.addEventListener("waiting",function(){})},addParams:function(t){return t}},mounted:function(){this.addEventListenerToPlayer()}},s=new function(){document.getElementById("audio_info");var t,e=document.createElement("audio"),i=document.createElement("audio"),n=null,r=[],o=!0;this.start=function(a){if(document.getElementById("audio_info")&&(document.getElementById("audio_info").innerHTML="正在连接对讲服务器..."),(t=new WebSocket(a)).onopen=function(){console.log("音频对讲websoket已连接"),document.getElementById("audio_info")&&(document.getElementById("audio_info").innerHTML="音频对讲websoket已连接")},t.onmessage=function(t){var n=t.data;if(n instanceof Blob&&(r.push(n),25==r.length)){console.log("已收到一秒音频："+(new Date).getTime());var a=new Blob(r),h=new FileReader;h.readAsArrayBuffer(a),h.onload=function(t){var n=h.result,r=new DataView(n);o?(e.src=window.URL.createObjectURL(s(r)),e.play()):(i.src=window.URL.createObjectURL(s(r)),i.play()),o=!o},r=[]}},t.onclose=function(){n&&n.disconnect(),console.log("音频对讲websoket已关闭"),document.getElementById("audio_info")&&(document.getElementById("audio_info").innerHTML="对讲服务器已断开连接。")},!navigator.getUserMedia)return alert("抱歉, 您的设备无法语音对讲"),!1;[],0},this.stop=function(){t.close()};function s(t){var e=t.byteLength,i=new ArrayBuffer(44+e),n=new DataView(i),r=0,o=function(t){for(var e=0;e<t.length;e++)n.setUint8(r+e,t.charCodeAt(e))};o("RIFF"),r+=4,n.setUint32(r,36+e,!0),r+=4,o("WAVE"),r+=4,o("fmt "),r+=4,n.setUint32(r,16,!0),r+=4,n.setUint16(r,6,!0),r+=2,n.setUint16(r,1,!0),r+=2,n.setUint32(r,8e3,!0),r+=4,n.setUint32(r,16e3,!0),r+=4,n.setUint16(r,2,!0),r+=2,n.setUint16(r,16,!0),r+=2,o("data"),r+=4,n.setUint32(r,e,!0),r+=4;for(var s=0;s<e;s++)n.setInt8(r,t.getInt8(s),!0),r++;return new Blob([n],{type:"audio/wav"})}};var a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"my-video-wrapper",staticStyle:{padding:"0px",margin:"0px"}},[t.isToolbar?t._e():i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"player-wraper",staticStyle:{bottom:"0px"},attrs:{"element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{dblclick:t.onDbClick}},[i("video",{ref:"player"})]),t._v(" "),t.isToolbar?i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"player-wraper",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{dblclick:t.onDbClick}},[i("video",{ref:"player"})]):t._e(),t._v(" "),t.isToolbar?i("div",{staticClass:"my-video-control"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.name,expression:"name"}],staticClass:"device-states"},[i("span",{domProps:{textContent:t._s(t.name)}}),t._v(" "),i("span",{domProps:{textContent:t._s(t.deviceName)}}),t._v(" "),i("span",{domProps:{textContent:t._s(t.channelStr)}}),t._v(" "),i("span",{domProps:{textContent:t._s(t.networkSpeed)}}),t._v(" "),i("video",{ref:"audio1",staticStyle:{display:"none"}}),t._v(" "),i("video",{ref:"audio2",staticStyle:{display:"none"}})]),t._v(" "),i("div",{staticClass:"video-controls"},[i("span",{on:{click:t.switchVideoPlayState}},[i("i",{staticClass:"icon iconfont ",class:{"icon-play":!t.isPlaying,"icon-stop":t.isPlaying}})]),t._v(" "),i("span",{on:{click:t.handlePlayerMute}},[i("i",{staticClass:"icon iconfont",class:{"icon-Mute":!t.isMute,"icon-Volume":t.isMute}})]),t._v(" "),i("span",{on:{click:t.flv_photograph}},[i("i",{staticClass:"icon iconfont icon-camera-fill"})]),t._v(" "),i("span",{on:{click:t.handleFullScreen}},[i("i",{staticClass:"icon iconfont",class:{"icon-quanping":!t.isFullScreen,"icon-tuichuquanping":t.isFullScreen}})])])]):t._e()])},staticRenderFns:[]};var h=i("VU/8")(o,a,!1,function(t){i("adlI")},"data-v-b5df07b6",null);e.default=h.exports},"3t5t":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"CmdListDialog",data:function(){return{tid:"",title:"指令下发",dialogVisible1:!1,list:[]}},methods:{openDialog:function(t,e,i){var n=this;this.tid=t,this.dialogVisible1=!0,this.title=e;var r={apicode:1108,type:i};this.callApi(r,function(t){n.list=t.data})},sendCmd:function(t){this.$refs.cmdSendDialog.openDialog(this.tid,this.title,t)},closeDialog:function(){this.dialogVisible1=!1},ok:function(){}},mounted:function(){},components:{CmdSendDialog:i("nmoT").default}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.title,visible:t.dialogVisible1,width:"720px",height:"480px","show-close":"","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible1=e}}},[i("div",{staticStyle:{height:"380px",overflow:"auto"}},t._l(t.list,function(e,n){return i("el-col",{key:n,staticStyle:{"text-align":"center",height:"40px","line-height":"40px"},attrs:{span:6}},[i("el-button",{staticStyle:{width:"150px"},attrs:{type:"primary",size:"small",plain:""},on:{click:function(i){return t.sendCmd(e)}}},[t._v(t._s(n+1)+"."+t._s(e.name))])],1)}),1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"medium"},on:{click:t.closeDialog}},[t._v("关 闭")])],1)]),t._v(" "),i("CmdSendDialog",{ref:"cmdSendDialog"})],1)},staticRenderFns:[]};var o=i("VU/8")(n,r,!1,function(t){i("9UFZ")},"data-v-499fcb3c",null);e.default=o.exports},"4+z/":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAQdSURBVHja7JjfTxxVFMe/986PnaUsFciy2lqDhaTEWNMGwS1I7KbdkpZEwYTANv1hE3kxRtmi8UXRYE19IULji/+AJL7Q+ESlpFJaQBppI4K0Si3BTVl+LW1BZofde3wYdoDSJrsUkibuSeZl7jlzPvebe885GUZEeJqN4ym3JGASMAmYBPy/A8rxOjLGHvXawZhcwW3FhyTt4F5h9LsAA1x1B6P6xesifPUnokgrgAcPB8bdwYgorucR5lPS6oYc2fNUWrlAZT6dtKw20rJaqcynU2nlAjmy50lJqxsC4FtvXhbvTlYoyLmS16i52mu9Hqe13n5pFuVlz0BVgR9ag/B6XCvWpqEHDzSJxeE6ACIRBRMG5EreN87cX2uLCiUYhrkWiRA6L1/DQM/rSLEDOXuuoLi4AJrNjFFVoLsvism/8pvE4rB/0wAZ49X27WMtpQcyoetLh1gGLvdE4XIy3Oy1AwD2ehZwa0TAu1+2NqFpwIWOaSwEdhwlEi3x5k3kFqfJDv8ZryfTSso5IARg/Hsd336tWo7nzqqgxRuIREwfADAMwOvJhOzwnwGQtuFlhjG1PDWrIQcwoWLq9f8mwJSX4N0vWb4lbglMeQV9/VHIS3UiFpOa1bCTMbV8wwG5rfiIO1+yEsWShqb6cO6sY43/d412PJjtWePvzpfAbfuObAKge7eqrlbvz9sCXNmFd6rXllPf2zK48jL+uCVWqaiqALcV7d54QHm7K3bmYjZ65yY+/SgTkrTWX5KALz7JQOCfoVUKcm5+a1NbnSwDwUkCWAo+qFEe6/f+uwrAtuJukCwVN60Xi0ggaCnAgYHf7+B4dTa2pDw+xq4Bp469gMGh21acEOa3Nh4w3DtgGGaS2XsEigbw+cfL6o1PEGr8Bmr8BsYnlmvcZ3UKKBrATIjAuVluRLh7IG4J4+6JTD2RnjtPFSd1Snk+QG8d14mIaHRM0OEqsw/btw2SfdsgaVltdLhKp9ExQUS0FDNGFSd1Ss+dJ8bUE/HmlePfiHF+bqJ+RNe/yiExg2OVLhyq1NHV9QuY9BwKCt9ARrrZ2mZCO/Fz1yh2vXoXJSWv4b1TCtraZ6HrTsxN1I8QGefjrr+JtTq12ub8sQVMBuNOMMmFfYVbkbqFQQggElm+RJwDc/OEnr57oGgQJKYBMhCefPMokdGyacMC4+lN2rPdHx70vAjOTaiVpWfVAecmrBDAxUt/Qx8vaiYRqk1kWEi4zJAInQ5PVTV3dE5basUUexgsVlo6OqcRnqpqJhE6nWi+9cyDKwfWei2jIa+ogEPTmAUpBKDrhO5rAvpM/fDi/cYvAXy/non6SQABII0xtZzbiku5zb2HyztcZs0cC4pw7w0Rvnph6ULcX+/Iz5J/t5KAScAkYBIwCfhE9t8ACa5KVXy+I5AAAAAASUVORK5CYII="},"88jF":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAP4SURBVHja7JjPaxtXEMe/b7TafUKq4uC0OvQHoT60oZi6hYIiK6fIWyGK2B4CcSABg48hdRxf3RCcY0vthFzyB9QkhzSHHlJZPTikivHBKTi2WiXQito1AjtO44D11subHiRbVp2A5NgQqAb2sm/mzWe/vDczrGBmvM5GeM2tBdgCbAG2AP/vgEajjkKIF71+wxDiyziRfZzokxmtIy6AKFHpZ60f3NM64zH/AGDtv4ENdzBmbuh5gfUO+f3z66EQK9tmlUpxxrL4tmWxSqVY2Tavh0I85PfPA+jdbV7R6JdsU5COEH07YZoDb9r21vo/ExM44DiAaaJ04wYi29ZWMhkcd93RvNYXAOhmFGwa8AjRdzOHDg1QLAa4bmXR8zA9OYnuhw+BQAC/dHTgs+5uCCkr66YJncvh0+Xl0bzW5/cNkIQ4uWBZ4+3JJFAuV0+xAX33LhCJQBYKAADV1QVdKMDX01P7CCmxcucO3lHqlGYebzRvM7c4PGgYl9ttu5aUCNAaM0rBvHZty9F/9SoeaA14XsUHAFwX7baNQcO4DCC852XGFMIZCQY7AABa19SbmcFHRKCentqmx47hYyLo6WnAqBaKasxIMPi+KYSz54BxohRFozW4atLp1VWErlzZ4S+vX0dubW2HP0WjiBGl9hwwStQJ06xTjx89wgdE8PX17fD39faikwg6n69X0TQRI+rcc8C3hYhsnrlN+71YRPvwMODz7Qzw+XDw0iXMLy7WKQiiyl772uoMA1wqIQDAOHfu5W5nz+IAAF5aqqm4X714kbm0qQCIUJydxeHTp4Fg8OVBgQDe6+vDH3NzW3HQurLXXgNOaT0L1wWIwE+fYoEZxsWLtda1tISN/n5s9PdXFNtUcXgYi8zgJ08qgK6LnNazDUvYaE80hTiz3tbGynH4bylZpdPMzKyLRVbJJGcsi/NScl5KzlgWq2SSdbHIzMzKcXhBSlaOw+ttbWwKcabhGaCJYSE85Pc/Vskkz0nJ3s2brBIJnrQsLkjJ5XicVTrNKp3mcjzOBSl50rJYJRLs3brFc1KySiZ5yO9/DCC8L8OCKcTJH01z3AfgLSEQEQLho0chQqHKDfW8rUsEIvDz53h2/z5KzFhmxgaAL1z3lNtEq2t6WDgoxOiUZX11OJGonCnPqy/GdSecKrBa489sFlGlxlaZB5oZFpouM6vMgydcd2wlm62pVVVsB1i1tKxkszjhumOrzIPN5tvNPLh9YP16xLI+pFgMkLIGqTVQLkPnchhW6rdvNjZGAHy/m4n6VQABIGwK4cSJPo8Sdb1b7RB/MZemtP71ntY/ucy3ATzb7cgvWn+3WoAtwBZgC7AF+Er27wAbA4ZDuT7VUgAAAABJRU5ErkJggg=="},"9UFZ":function(t,e){},B5xV:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("mvHQ"),r=i.n(n),o=i("/bhr"),s=(i("TFOu"),i("ow4a"),i("d2xA")),a=i("88jF"),h=i.n(a),l=i("4+z/"),c=i.n(l),u=i("iTWp"),d=i.n(u),f=i("Pm2p"),_=i.n(f),p=i("Cf2s"),m=i.n(p),g=i("LHmc"),v=i.n(g),y={},x=(new o.a.HashMap,{name:"RealtimeSingle",data:function(){return{dialogVisible:!1,id:"",websocket0x0200URL:"",websocket:null,carImgArr:[v.a,h.a,c.a,d.a,_.a,m.a,v.a],polyLinePath:[],conheight:{height:""},center:{lng:116.396621,lat:39.916385},zoom:13,cars:[],lastTid:"",lastCar:{},showCarInfo:!0}},methods:{syncCenterAndZoom:function(t){var e=t.target.getCenter(),i=e.lng,n=e.lat;this.center.lng=i,this.center.lat=n,this.zoom=t.target.getZoom()},handler:function(t){t.BMap,t.map},openInfoWindow:function(t){this.showCarInfo=!0},getClickInfo:function(t){this.center.lng=t.point.lng,this.center.lat=t.point.lat},infoWindowClose:function(t){this.showCarInfo=!1},infoWindowOpen:function(t){this.showCarInfo=!0},open:function(t,e){var i=this;y[t]=e,this.id=t,this.dialogVisible=!0,this.callApi({apicode:1102},function(t){i.websocket0x0200URL=t.data.websocket0x0200URL;var e=t.data.centerLatlng.split(",");i.center={lat:e[0]-0,lng:e[1]-0},i.initWebsocket()})},handleClose:function(t){this.dialogVisible=!1,this.cars=[],this.websocket.close()},getHeight:function(){this.conheight.height=window.innerHeight-126+"px"},initWebsocket:function(){var t=this.websocket0x0200URL;this.websocket=new WebSocket(t),this.websocket.onmessage=this.websocketonmessage,this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onclose=this.websocketclose},addCar:function(t){if("0x0200"==t.type){t.carno=y[t.tid];for(var e=-1,i=0;i<this.cars.length;i++)t.tid==this.cars[i].tid&&(e=i);-1==e?(this.showCarInfo=!0,this.cars.push(t),this.center.lng=t.lng_baidu,this.center.lat=t.lat_baidu):this.$set(this.cars,e,t),this.polyLinePath.push({lat:t.lat_baidu,lng:t.lng_baidu}),this.lastCar=t}},websocketonopen:function(){console.log("连接成功");var t={cmd:1005,tid:this.id};this.websocketsend(t)},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function(t){var e=JSON.parse(t.data);this.addCar(e)},websocketsend:function(t){t.lingxtoken=this.$store.getters.getUser.token,this.websocket.send(r()(t))},websocketclose:function(t){console.log("断开连接",t)},formatOnline:function(t){return 1==t?"<span style='color:green'>在线</span>":"<span style='color:red'>离线</span>"},formatAcc:function(t){return!0&t?"<span style='color:green'>点火</span>":"<span style='color:red'>熄火</span>"},formatDatetime:function(t,e,i,n){return i?i.substring(0,4)+"-"+i.substring(4,6)+"-"+i.substring(6,8)+" "+i.substring(8,10)+":"+i.substring(10,12)+":"+i.substring(12,14):""},getRotation:function(t){return(360-t+360)%360},getWinInfo:function(t){return'<div style="width:400px;font-size:14px;line-height: 28px;margin:0px;padding:0px;"><table  width="100%" border="0" cellSpacing="0" cellPadding="0"><tr style="background-color: #f9f9f9;"><td style="color: #999999;width:64px;">车辆标识:</td><td >'+t.carno+'</td><td style="color: #999999;width:64px;">当前状态:</td><td>'+t.comment+'</td></tr><tr><td style="color: #999999;">定位时间:</td><td>'+this.formatDatetime(1,1,t.gpstime,1)+'</td><td style="color: #999999;">行驶速度:</td><td>'+t.speed+' KM/H</td></tr><tr style="background-color: #f9f9f9;"><td style="color: #999999;">车辆状态:</td><td colspan="3">'+t.status_str+'</td></tr><tr><td style="color: #999999;">当前告警:</td><td colspan="3">'+t.alarm_str+'</td></tr><tr style="background-color: #f9f9f9;"><td style="color: #999999;" valign="top">当前地址:</td><td colspan="3">'+(t.address||"无")+'</td></tr><tr><td colspan="4"> <a class="el-link el-link--success is-underline" onclick="m2(\''+t.tid+'\')">\x3c!----\x3e<span class="el-link--inner">行程记录</span>\x3c!----\x3e</a> | <a class="el-link el-link--warning is-underline" onclick="m3(\''+t.tid+'\')">\x3c!----\x3e<span class="el-link--inner">下发指令</span>\x3c!----\x3e</a> | <a class="el-link el-link--info is-underline" onclick="m5(\''+t.tid+'\')">\x3c!----\x3e<span class="el-link--inner">复制信息</span>\x3c!----\x3e</a></td></td></tr></table></div>'}},created:function(){window.addEventListener("resize",this.getHeight),this.getHeight()},mounted:function(){},components:{LingxMap:s.a}}),w={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.dialogVisible?i("el-dialog",{attrs:{title:"实时跟踪",visible:t.dialogVisible,fullscreen:!0,"show-close":"","append-to-body":"","before-close":t.handleClose}},[i("div",{style:t.conheight},[i("LingxMap",{ref:"lingxMap2",attrs:{zoom:t.zoom,center:t.center}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleClose}},[t._v("关 闭")])],1)]):t._e()],1)},staticRenderFns:[]};var b=i("VU/8")(x,w,!1,function(t){i("Ba9d")},null,null);e.default=b.exports},BYUQ:function(t,e){},Ba9d:function(t,e){},Cf2s:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAE/UlEQVR42mL8//8/w2AGAAHExDDIAUAADXoHAgTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQACxEKuQkZERmzAvEyNToAiHjJs4l4Lhmy/Pxf/9/8cgxiv98uW3B+ff/HiyC8hfD1T3GV0jsTUYQAAxEq0Q04GR6gJmtXrCjpoiHFIMTH9YGR7xH2X4y/iHQeGDLcN/ln8Mb348Zbj0dv/1mx9ONQPVLyfHgQABRI4DmfjYhHsdpCIKFHh1GGC67726yhA3wZaBmY2ZYU7mXgY1MT2G/0AtIF0PPl9hOPBsxYRPv94WA7n/SHEgQACxkJomQI7zkksvkOBSYPj19wfQgf8Z/v0Culr6E4ObtzMDKxsbw2KFzQzf3/1kYGFnZABBJT59Bi4W/oJtj2YyAB1ZSIp9AAFEUiYBWhZhDww5CS5Fhp9/v4Mdx8zIzPDy82MGuxB9BgFeYQZudl4Gp3AThpdfHgLlWMBqQGpBehykIguAZkSSYidAAJHiQD41AdMWBV5dYMh9hwv++8PA8FPwJUNItD9cLDDCl+Gf6DuGv3/+wcVAekBJAmQGyCxiLQUIIKIdyMTIHKAv7KDMAA6T/zAxhlcfnzLouMgyKMgpw9XKSskz6LjKMbz48ASsBpzmoBBohhLILGLtBQggoh0owiHtJQzMrX///UZE+T8mhvesDxmiUoMx1EcmBzN8ZHsEVgMDIL0gM0BmEWsvQACR4EAZXRYmdqTQY2J4++kVg5aLNIOBriGGej0tfQZdd1mGNx9fgtXCQhFkBsgsYu0FCCCiHcjJwiMOSvSI8omZ4S3DQ4bQJG8GSGGCCcKSfBneMj0Eq4UBkBkgs4i1FyCAyKrqQGXi568fGWTMeBgsLa1wqjM3t2CQt+Bj+PTlA66aiCAACCCiHfj9z5eXf///gYTCfxaG5z/uMfjGOwGjjBWnHlBo+cW5MLz4eResB5wOgWaAzCLWXoAAItqBwGrr8p9/P8Hp6duPbwxcyj8YXN2c4fLffn1hWL9+PRiD2DDg7OIIVPsTrAeUo0FmAOvoy8TaCxBAJDjwyba3P54xsDFxMDz7fI8hOM2NgZuDl+Hztw8MCxYsZIhyymSYkbUdjEFskBhIjouDhyE43YPh6ee7YL0gM4Ce3UasvQABRHRV9+//3w2X3h68K8KsoMyv+Y/B3MGIYe7seQxb5h1i+HaXnUGGF1idiXBDQvP5V4blZccYNs7cz+CTaMdg72XFsFXrCMPPZ78YQGaAzCLWXoAAIqmxAIzeCGvxkOXSJpwM/z9yMHy5xc4gyaPAwMHJAfTAH3gRBKp/mYDp78f3HwzPvzxg4FH7ycDI95Ph2dlvDEdero0COnA5sfYCBBDJrRl2Fs4JTpIx+SrcJgwMLH/Bif4/w39cdTc4ozD8YWa48/UMw77niyf+/POjgJTWDEAAkVzM/PzzvejYy40TH/28DHY0MzAXM4LLQUY0p0HlgGoe/bzCANIDdFwRqfYBBBClDdY6fWFHDWEOSXANASvIQaEKyq1vfzxnuPh2/w1og3UZOQ1WgACixIHgFg4wXQYAqy53YP1qwMnCKw4pMz+/BObUC8CcvxPY5AdliE/kNvkBAohxsI9uAQTQoO/VAQTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQAANegcCBBgAhQnE1vTY8Q0AAAAASUVORK5CYII="},Czqw:function(t,e){},ImHb:function(t,e){},Jw2W:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__);__webpack_exports__.a={name:"CmdSendDialog",data:function(){return{tid:"",title:"指令下发",dialogVisible1:!1,cmd:{},fields:[]}},methods:{openDialog:function openDialog(tid,title,cmd){var _this=this;this.tid=tid,this.dialogVisible1=!0,this.title=title,this.cmd=cmd,cmd.params?this.fields=eval("("+cmd.params+")"):this.fields=[]},closeDialog:function(){this.dialogVisible1=!1},ok:function(){if(this.fields.length>0)for(var t=0;t<this.fields.length;t++){if(null==this.fields[t].value)return void this.lgxInfo2(this.fields[t].name+"不可为空!");if(Array.isArray(this.fields[t].value)&&0==this.fields[t].value.length)return void this.lgxInfo2(this.fields[t].name+"不可为空!")}if(confirm("确定下发至该终端吗？")){var e=this.$loading({lock:!0,text:"正在下发终端指令，请稍候...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),i={apicode:1109,tid:this.tid,cmdId:this.cmd.id,cmdParams:__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(this.fields)};this.callApi(i,function(t){e.close(),alert(t.message)})}}},mounted:function(){},components:{}}},KSwa:function(t,e){},LHmc:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAEpklEQVR42mL8//8/w2AGAAHExDDIAUAADXoHAgTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQACxEKuQkZERmzAvExNDoLgog5u0JIPhq9cM4v/+MTBIiDO8fPqc4fzL1wy7gPz1QHWf0TUSW4MBBBAj0QoxHRipq8lQa2rEoCkmwsDADIyL63fVGf7+Y2TQVrnB8A9o7Ks3DAynzzFcv3ydoRmofjk5DgQIIHIcyCTAx9Dr4cJQoKoEsgkkycBw6w4DQ1DEcgZmFlaGFQtDGDTVEXJ37jEwbN/DMOHDJ4ZioMg/UhwIEEAspKYJkONC/RkKgFHK8PMXyCIgBlr5l0GewdXdl4GNlZVh5TIVhh8/7jAwM4M8xsCgrsLAwMPNULB6EwPDh48MhaTYBxBAJGUSoGURni4Qx/34CXEcyBHPXjAwWFinMAgKcDNwc7Mx2NinMzx7DpEDqQGpBenxdGYoAJoRSYqdAAFEigP5dDQYWlSUICEHA6BM8eW7MENQcCJcLCAwluHHbwmGf38R6kB6QHp1NBlaQGYRaylAABHtQGAmCABmCGVI+oFqBup+8ZKBQU0rlEFRURquVk5WnEFdOxQcskxMsEwBoU0NGZRAZhFrL0AAEe1AMVEGL1FhBoY/f5A0A9PX67dsDOERORjqwyOyGN68Z2dAzvwgvSAzQGYRay9AABHtQGBZp8vGihp6b94Co00jhMHQUBtDvZ6eBjAUwxhev0ENRZAZILOItRcggIh2IBcXgzgo0SOH3ovXzAyBIdk49QSF5ADLQma4A8FJhRliFrH2AgQQWVUdKNo+AesGMSkXBitLK5zqzM3NGCRk3Bk+fmRgwF4REQYAAUS0A799Y3j59y8iFJ48Y2Dw8sliYMFTkrIwQ9SA1LJAQx9kBsgsYu0FCCCiHQisVy//+g1JT0ALGJjYtRmcXdyRPPCbYf36DWAMYsOAk7MrAzO7DsPXbxC9IDNAZhFrL0AAEe1AYENg22tgpmBnA4beUwYG/8BSYO3ADozqHwwLFy5kiI+xZFgyNxCMQWyQGEiOm4uNwT+olOHRU4hekBkgs4i1FyCASKmL+XS1GM75ujMoP3mpy1BVv5Ph6OHNDDu3TWH48+syg4IMMPFzQ0PzKwPDgyfAaGXTZXDzymGwtfdjaG1wZ5ARvcSweRfD3cvXGIyA9n4ixl6AACKpsQCMoghXe5blIhL2DEwMrxh+/7jMICPFwMDBAUlbMKNAGQKUTn/8gKRVVg5dYAtBjOHNi4MMuw/+iQLWPsuJtRcggEhuzXCwM07wcfufr6UGaZYgF9xYMwowE4HS0bVbDMDQY5z48+f/AlJaMwABRHIx8+Pn/6J9Rxgm3nkACSlWFuxFCLIcSC1ID9BxRaTaBxBAlDZY64D1swao+gLVEMxIRQkot4IyBLDBegPaYF1GToMVIIAocSC4hQNMlwHAqssdiA24oTUEsEh5CSxKLgDxTmB62wAU+kRukx8ggBgH++gWQAAN+l4dQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQAANegcCBNCgdyBAgAEA2xdvknyX4AYAAAAASUVORK5CYII="},O4R0:function(t,e,i){i("+MLA"),t.exports=i("FeBl").Object.freeze},Pm2p:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAEQUlEQVR42mL8//8/w2AGAAHExDDIAUAADXoHAgTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQACxEKuQkZERmzAvUDxQUFDQTVhY2PDdu3fioJoJyH759u3b8+/fv98F5K8HqvuMrpHYGgwggBiJVojpwEgFBYVaVVVVTQEBAbDAhw8fwBaD+CD1IP7t27evP3jwoBkovZwcBwIEEDkOZOLm5u41MTEpkJKSAlsEknv48CFDXl4eAwsLC0NPTw+DoqIiXO7Zs2cMZ86cmfD169dioP5/pDgQIIBIdiDQcf22trYFwGhk+PXrF1jsz58/DF++fGFYvXo1AxsbG0NgYCADFxcX2LEgABIDRjnD4cOHQY4sJMWBAAFEUiYBOjICFHLIjmNiYgJb7uLiwsDPz8/AycnJ4OnpyfD69WuwHAiA1IL0gPQCzYgkxU6AACLFgXxycnItoGj9/fs3XPDfv3/g0A0PD4eLhYSEgEPt79+/cDGQHpBeeXn5FpBZxFoKEEBEOxAYGgHq6urKyNEDCiFQSAFDBmQxXK20tDRYDDkUYXrU1NSUQGYRay9AABHtQGDO9OLj40MJFRD4/v07Q2xsLIZ6kNiPHz9Q0hpIL8gMkFnE2gsQQKQ4UBeU6GEWgqIVWM4xGBsbM+jr62Oo19HRYTA1NWUAlo0ooQgyA2QWsfYCBBDRDuTg4BBnZmZGydWfP39miIzEneZBcqDcjRyKIDNAZhFrL0AAkVXVwRynoqLCYGlpiVOdhYUFAzDdgtXiqIkIAoAAItqBwPT0Epb+YEVLcHAwA3KoYslY4ByNHM0gM0BmEWsvQAAR7UBgtXUZVCCDQuLbt28MQkJCDG5ubiiZZf369WAMYsOAs7MzWC1ID0gvyAyQWcTaCxBApDhw26dPnxhYWVnBxQcofYEKZVAaW7hwIUNQUBBDZ2cnGIPYIDGQHEgNSO2rV6/AekFmgMwi1l6AACKlquMDNg7OAcs3ZVAogOrb/fv3M6xduxacm8XExEDVIFgtsDoDOwjYygEnAycnJ4aSkhJwcgDWyXeBjQcjoL2fiLEXIIBIqouB6SgCWKQsV1JSAtcMoHQoKioKypXgGgW5CAKlOVA5CAptUDUHqlnu3bvHcOHChSig2uXE2gsQQCQ3FoAWTQCWb/kyMjJgMfSCGx2AQg1kx5MnTxhOnz49EVgvF5DSWAAIIJKLGaAFRRcvXpz44sULsANBDsBWhCDLvXz5kgGkB6SXVPsAAojSBmsdsG7VAFVfoBoCVuSAQhWUTkEZ4tatWzegDdZl5DRYAQKIEgeCWzhA8QBgZnAHVl8G7Ozs4Bri58+fL4E59QIw8+wEmr8BKPSJ3CY/QAAxDvbRLYAAGvS9OoAAGvQOBAigQe9AgAAa9A4ECKBB70CAABr0DgQIoEHvQIAAGvQOBAigQe9AgAADANPjyziPyLpxAAAAAElFTkSuQmCC"},QLfZ:function(t,e,i){var n;!function(){"use strict";function r(t,e,i){var n=e.x,r=e.y,o=i.x-n,s=i.y-r;if(0!==o||0!==s){var a=((t.x-n)*o+(t.y-r)*s)/(o*o+s*s);a>1?(n=i.x,r=i.y):a>0&&(n+=o*a,r+=s*a)}return(o=t.x-n)*o+(s=t.y-r)*s}function o(t,e){var i=t.length-1,n=[t[0]];return function t(e,i,n,o,s){for(var a,h=o,l=i+1;l<n;l++){var c=r(e[l],e[i],e[n]);c>h&&(a=l,h=c)}h>o&&(a-i>1&&t(e,i,a,o,s),s.push(e[a]),n-a>1&&t(e,a,n,o,s))}(t,0,i,e,n),n.push(t[i]),n}function s(t,e,i){if(t.length<=2)return t;var n=void 0!==e?e*e:1;return t=o(t=i?t:function(t,e){for(var i,n,r,o,s,a=t[0],h=[a],l=1,c=t.length;l<c;l++)i=t[l],r=a,o=(n=i).x-r.x,s=n.y-r.y,o*o+s*s>e&&(h.push(i),a=i);return a!==i&&h.push(i),h}(t,n),n)}void 0===(n=function(){return s}.call(e,i,e,t))||(t.exports=n)}()},RfNU:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"GB28181Tree",props:{isReload:{type:Boolean,default:!1},isStatus:{type:Boolean,default:!1},isChecked:{type:Boolean,default:!0},isVideo:{type:Boolean,default:!1}},data:function(){return{searchText:"",rootKey:"",expandedKeys:[149],defaultProps:{children:"children",label:"text",isLeaf:"leaf"},time1:""}},methods:{renderContent:function(t,e){var i=e.node,n=e.data;e.store;return t("span",{style:"font-size:14px;"},[t("i",{class:n.iconCls}),t("span",[" ",i.label])])},loadNode:function(t,e){var i=this,n=0;n=0===t.level?0:t.data.id,this.callApi({apicode:1141,fid:n,isVideo:this.isVideo,isStatus:this.isStatus,searchText:this.searchText},function(t){if(0!=t.data.length){if(0==n&&(i.rootKey=t.data[0].id),t.expandedKeys.length>0)for(var r=0;r<t.expandedKeys.length;r++)i.expandedKeys.push(t.expandedKeys[r]);e(t.data)}else e(t.data)})},checkChange:function(t,e,i){this.$emit("lingxcheckchange",t,e,i)},nodeClick:function(t,e,i){var n=this;t.id!=this.treeClickId&&(this.treeClickCnt=0),this.treeClickId=t.id,this.treeClickCnt++,window.clearTimeout(this.treeClickTimeout),this.treeClickTimeout=window.setTimeout(function(){n.treeClickCnt=0},300),this.treeClickCnt>2||(1==this.treeClickCnt&&this.$emit("lingxnodeclick",t,e,i),2==this.treeClickCnt&&this.$emit("lingxnodedblclick",t,e,i))},handleNodeDblClick:function(t,e,i){},refreshNodeBy:function(t){var e=this.$refs.tree1.getNode(t);(e=e.parent).loaded=!1,e.expand()},searchTree:function(){this.expandedKeys=[],this.refreshNodeBy(this.rootKey)},contextmenuTree:function(){},updateTreeNode:function(t,e){if(null!=t&&null!=t.tid)if(e||(e=this.$refs.tree1.getNode(this.rootKey)),t.tid!=e.data.value)for(var i=0;i<e.childNodes.length;i++)this.updateTreeNode(t,e.childNodes[i]);else{e.data.iconCls=e.data.iconCls.substring(0,e.data.iconCls.length-1)+t.status_jt808;var n=e.data.text;n.indexOf(" ")>0?e.data.text=n.substring(0,n.indexOf(" "))+" - "+t.status_leftcar:e.data.text=n+" - "+t.status_leftcar}},updateTreeNode2:function(t,e){if(!e&&this.$refs.tree1&&(e=this.$refs.tree1.getNode(this.rootKey)),null!=e){if(t.value==e.data.value)return t.iconCls&&(e.data.iconCls=t.iconCls),void(e.data.text=t.text);for(var i=0;i<e.childNodes.length;i++)this.updateTreeNode2(t,e.childNodes[i])}},reload:function(t){var e=this;this.callApi({apicode:1141,fid:t,isVideo:this.isVideo,isStatus:this.isStatus,searchText:this.searchText},function(t){if(0!=t.data.length)for(var i=0;i<t.data.length;i++)e.updateTreeNode2(t.data[i]),t.data[i].leaf||e.reload(t.data[i].id)})}},mounted:function(){},destroyed:function(){}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"noselect",staticStyle:{padding:"0px"}},[i("div",{staticStyle:{padding:"5px","background-color":"#e8eaed","border-bottom":"#d6d6d6 1px solid"}},[i("el-input",{attrs:{size:"mini",placeholder:"可查询编号｜名称","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.searchTree.apply(null,arguments):null}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchTree},slot:"append"})],1)],1),t._v(" "),i("el-tree",{ref:"tree1",attrs:{props:t.defaultProps,load:t.loadNode,"render-content":t.renderContent,"node-key":"id","default-expanded-keys":t.expandedKeys,"show-checkbox":t.isChecked,"expand-on-click-node":!1,"auto-expand-parent":!1,lazy:""},on:{"check-change":t.checkChange,"node-click":t.nodeClick,"node-contextmenu":t.contextmenuTree},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,r=e.data;return i("div",{staticClass:"custom-tree-node",staticStyle:{"font-size":"14px",width:"100%"}},[i("div",{staticClass:"node",staticStyle:{"font-size":"14px",width:"100%"},on:{dblclick:function(e){return t.handleNodeDblClick(n,r)}}},[t._v(t._s(n.label))])])}}])})],1)},staticRenderFns:[]};var o=i("VU/8")(n,r,!1,function(t){i("m6LY")},null,null);e.default=o.exports},SpdK:function(t,e,i){var n;n=function(){"use strict";function t(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function e(t,e){return t<e?-1:t>e?1:0}return function(i,n,r,o,s){!function e(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,h=n-r+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1),d=Math.max(r,Math.floor(n-h*c/a+u)),f=Math.min(o,Math.floor(n+(a-h)*c/a+u));e(i,n,d,f,s)}var _=i[n],p=r,m=o;for(t(i,r,n),s(i[o],_)>0&&t(i,r,o);p<m;){for(t(i,p,m),p++,m--;s(i[p],_)<0;)p++;for(;s(i[m],_)>0;)m--}0===s(i[r],_)?t(i,r,m):t(i,++m,o),m<=n&&(r=m+1),n<=m&&(o=m-1)}}(i,n,r||0,o||i.length-1,s||e)}},t.exports=n()},TFOu:function(t,e){},XomU:function(t,e){},YwP3:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"XcjlGridDialog",data:function(){return{tid:"",ecode:"tgps_xcjl",title:"行程记录",dialogVisible1:!1,queryfilter:{car_id:""}}},methods:{openDialog:function(t,e){this.tid=t,this.title=e+"-行程记录",this.dialogVisible1=!0,this.$set(this.queryfilter,"car_id",t)},closeDialog:function(){this.dialogVisible1=!1},ok:function(){}},mounted:function(){},components:{LingxGrid:i("V74c").default}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.title,visible:t.dialogVisible1,width:"720px",height:"480px","show-close":"","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible1=e}}},[i("div",{staticStyle:{height:"380px",overflow:"auto"}},[i("LingxGrid",{ref:"lingxGrid",staticStyle:{"background-color":"#fff"},attrs:{nosearchcodes:",cx_carno,",bak_nogridcodes:",speed,",queryfilter:t.queryfilter,ecode:t.ecode},on:{dblclick:t.ok}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"medium"},on:{click:t.closeDialog}},[t._v("关 闭")])],1)])],1)},staticRenderFns:[]};var o=i("VU/8")(n,r,!1,function(t){i("Czqw")},"data-v-cf8df788",null);e.default=o.exports},Zwc7:function(t,e,i){"use strict";var n={name:"LingxCarTree",props:{isReload:{type:Boolean,default:!1},isStatus:{type:Boolean,default:!1},isChecked:{type:Boolean,default:!0},isVideo:{type:Boolean,default:!1}},data:function(){return{searchText:"",rootKey:"",expandedKeys:[149],defaultProps:{children:"children",label:"text",isLeaf:"leaf"},time1:""}},methods:{renderContent:function(t,e){var i=e.node,n=e.data;e.store;return t("span",{style:"font-size:14px;"},[t("i",{class:n.iconCls}),t("span",[" ",i.label])])},loadNode:function(t,e){var i=this,n=0;n=0===t.level?0:t.data.id,this.callApi({apicode:1101,fid:n,isVideo:this.isVideo,isStatus:this.isStatus,searchText:this.searchText},function(t){if(0!=t.data.length){if(0==n&&(i.rootKey=t.data[0].id),t.expandedKeys.length>0)for(var r=0;r<t.expandedKeys.length;r++)i.expandedKeys.push(t.expandedKeys[r]);e(t.data)}else e(t.data)})},checkChange:function(t,e,i){this.$emit("lingxcheckchange",t,e,i)},setCheckedKeys:function(t){this.$refs.tree1.setCheckedKeys(t)},nodeClick:function(t,e,i){var n=this;t.id!=this.treeClickId&&(this.treeClickCnt=0),this.treeClickId=t.id,this.treeClickCnt++,window.clearTimeout(this.treeClickTimeout),this.treeClickTimeout=window.setTimeout(function(){n.treeClickCnt=0},300),this.treeClickCnt>2||(1==this.treeClickCnt&&this.$emit("lingxnodeclick",t,e,i),2==this.treeClickCnt&&this.$emit("lingxnodedblclick",t,e,i))},handleNodeDblClick:function(t,e,i){},refreshNodeBy:function(t){var e=this.$refs.tree1.getNode(t);(e=e.parent).loaded=!1,e.expand()},searchTree:function(){this.expandedKeys=[],this.refreshNodeBy(this.rootKey)},contextmenuTree:function(){},updateTreeNode:function(t,e){if(null!=t&&null!=t.tid)if(e||(e=this.$refs.tree1.getNode(this.rootKey)),t.tid!=e.data.value)for(var i=0;i<e.childNodes.length;i++)this.updateTreeNode(t,e.childNodes[i]);else{e.data.iconCls=e.data.iconCls.substring(0,e.data.iconCls.length-1)+t.status_jt808;var n=e.data.text;n.indexOf(" ")>0?e.data.text=n.substring(0,n.indexOf(" "))+" - "+t.status_leftcar:e.data.text=n+" - "+t.status_leftcar}},updateTreeNode2:function(t,e){if(!e&&this.$refs.tree1&&(e=this.$refs.tree1.getNode(this.rootKey)),null!=e){if(t.value==e.data.value)return t.iconCls&&(e.data.iconCls=t.iconCls),void(e.data.text=t.text);for(var i=0;i<e.childNodes.length;i++)this.updateTreeNode2(t,e.childNodes[i])}},reload:function(t){var e=this;this.callApi({apicode:1101,fid:t,isVideo:this.isVideo,isStatus:this.isStatus,searchText:this.searchText},function(t){if(0!=t.data.length)for(var i=0;i<t.data.length;i++)e.updateTreeNode2(t.data[i]),t.data[i].leaf||e.reload(t.data[i].id)})}},mounted:function(){var t=this;this.isReload&&(this.time1=setInterval(function(){t.reload(0)},3e4))},destroyed:function(){clearInterval(this.time1)}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"noselect",staticStyle:{padding:"0px",display:"flex","flex-direction":"column",height:"100%"}},[i("div",{staticStyle:{padding:"5px","background-color":"#e8eaed","border-bottom":"#d6d6d6 1px solid"}},[i("el-input",{attrs:{size:"mini",placeholder:"可查询车牌｜终端｜车队","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.searchTree.apply(null,arguments):null}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchTree},slot:"append"})],1)],1),t._v(" "),i("div",{staticStyle:{flex:"1","flex-grow":"1",overflow:"auto"}},[i("el-tree",{ref:"tree1",attrs:{props:t.defaultProps,load:t.loadNode,"render-content":t.renderContent,"node-key":"id","default-expanded-keys":t.expandedKeys,"show-checkbox":t.isChecked,"expand-on-click-node":!0,"auto-expand-parent":!1,lazy:""},on:{"check-change":t.checkChange,"node-click":t.nodeClick,"node-contextmenu":t.contextmenuTree},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,r=e.data;return i("div",{staticClass:"custom-tree-node",staticStyle:{"font-size":"14px",width:"100%"}},[i("div",{staticClass:"node",staticStyle:{"font-size":"14px",width:"100%"},on:{dblclick:function(e){return t.handleNodeDblClick(n,r)}}},[t._v(t._s(n.label))])])}}])})],1)])},staticRenderFns:[]};var o=i("VU/8")(n,r,!1,function(t){i("XomU")},null,null);e.a=o.exports},adlI:function(t,e){},algf:function(t,e){},cDwS:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"LingxBorder",props:{border:{type:String,default:"#0074D9 1px dashed"}},data:function(){return{dispaly:"none"}},methods:{show:function(t){this.dispaly="block";var e=$(t),i=e.offset().top,n=e.offset().left,r=e.width(),o=e.height(),s=$(this.$refs.tb);s.offset({top:i,left:n}),s.width(r),(s=$(this.$refs.bb)).offset({top:i+o,left:n}),s.width(r),(s=$(this.$refs.lb)).offset({top:i,left:n}),s.height(o),(s=$(this.$refs.rb)).offset({top:i,left:n+r}),s.height(o)},hide:function(){this.dispaly="none";var t=$(this.$refs.tb);t.width(0),t.height(0),t.offset({top:0,left:0}),(t=$(this.$refs.bb)).width(0),t.height(0),t.offset({top:0,left:0}),(t=$(this.$refs.lb)).width(0),t.height(0),t.offset({top:0,left:0}),(t=$(this.$refs.rb)).width(0),t.height(0),t.offset({top:0,left:0})}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{style:{display:t.dispaly}},[i("div",{ref:"tb",staticClass:"cls1",style:{"border-top":t.border}}),t._v(" "),i("div",{ref:"bb",staticClass:"cls1",style:{"border-bottom":t.border}}),t._v(" "),i("div",{ref:"lb",staticClass:"cls1",style:{"border-left":t.border}}),t._v(" "),i("div",{ref:"rb",staticClass:"cls1",style:{"border-right":t.border}})])},staticRenderFns:[]};var o=i("VU/8")(n,r,!1,function(t){i("KSwa")},"data-v-5a6f2f24",null);e.default=o.exports},d2xA:function(t,e,i){"use strict";var n=i("kvDK"),r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"100%",height:"100%",position:"relative"}},[i("div",{staticClass:"container",attrs:{id:t.mapid}}),t._v(" "),t.ispls?i("div",{staticClass:"pane"},[t.isyy?i("el-checkbox",{model:{value:t.checked5,callback:function(e){t.checked5=e},expression:"checked5"}},[t._v("鹰眼")]):t._e(),t._v(" "),t.isinfowin?i("el-checkbox",{model:{value:t.checked4,callback:function(e){t.checked4=e},expression:"checked4"}},[t._v("信息窗口")]):t._e(),t._v(" "),i("el-checkbox",{model:{value:t.checked3,callback:function(e){t.checked3=e},expression:"checked3"}},[t._v("点")]),t._v(" "),i("el-checkbox",{model:{value:t.checked2,callback:function(e){t.checked2=e},expression:"checked2"}},[t._v("线")]),t._v(" "),i("el-checkbox",{model:{value:t.checked1,callback:function(e){t.checked1=e},expression:"checked1"}},[t._v("面")])],1):t._e(),t._v(" "),t.issearch?i("div",{staticStyle:{position:"absolute",width:"80px",top:"20px",right:"80px"}},[i("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:"城市名称"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchCity.apply(null,arguments)}},model:{value:t.city,callback:function(e){t.city=e},expression:"city"}})],1):t._e(),t._v(" "),t.iscl?i("div",{staticStyle:{position:"absolute",width:"80px",top:"0px",left:"10px"}},[i("el-link",{staticStyle:{"background-color":"#fff","font-size":"12px",padding:"0px 5px"},attrs:{type:"primary"},on:{click:t.cj}},[t._v(" 测距 ")]),t._v(" "),i("el-link",{staticStyle:{"background-color":"#fff","font-size":"12px",padding:"0px 5px"},attrs:{type:"primary"},on:{click:t.cm}},[t._v(" 测面 ")])],1):t._e(),t._v(" "),t.isLeftBottmButton1?i("div",{staticStyle:{position:"absolute",left:"0px",bottom:"0px"}},[i("i",{class:t.clazz1,staticStyle:{"font-size":"24px",cursor:"move",color:"#333"},on:{click_bak:t.onLeftBottmButton1,mousemove111:t.move1,mousedown:t.start1,mouseup1111:t.end1,mouseout1111:t.end1}})]):t._e(),t._v(" "),t.isRightBottmButton1?i("div",{staticStyle:{position:"absolute",right:"0px",bottom:"0px"}},[i("i",{class:t.clazz2,staticStyle:{"font-size":"24px",cursor:"pointer",color:"#333"},on:{click:t.onRightBottmButton1}})]):t._e()])},staticRenderFns:[]};var o=function(t){i("eG5v")},s=i("VU/8")(n.a,r,!1,o,"data-v-fc452ffa",null);e.a=s.exports},dEjA:function(t,e,i){"use strict";e.a=function(t,e,i){s(t);for(var r=0;r<6;r++)if(!i||"0"!==i.charAt(r)){var a=n[r];if(o[0]=a[0]>0?e[1][0]:e[0][0],o[1]=a[1]>0?e[1][1]:e[0][1],o[2]=a[2]>0?e[1][2]:e[0][2],l(a,o)<0)return!1}return!0};for(
/*!
* Contains code from THREE.js
* MIT License
* https://github.com/mrdoob/three.js
*/
var n=[],r=0;r<6;r++)n[r]=[];var o=[];function s(t){var e=t,i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=e[9],_=e[10],p=e[11],m=e[12],g=e[13],v=e[14],y=e[15];h(n[0],s-i,u-a,p-d,y-m),h(n[1],s+i,u+a,p+d,y+m),h(n[2],s+r,u+l,p+f,y+g),h(n[3],s-r,u-l,p-f,y-g),h(n[4],s-o,u-c,p-_,y-v),h(n[5],s+o,u+c,p+_,y+v)}var a=1/6;function h(t,e,i,n,r){return t[0]=e*a,t[1]=i*a,t[2]=n*a,t[3]=r*a,t}function l(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}},eEqi:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAP3UlEQVR4Xu1da5QcVbX+dvUAAQlJVw/4WkGTdPUQRcUnCIJ6VUCW18XjipAVDChm0tWTqKhB8YUiXnkIgaSrE1EJ4RFI1kWB60W9RlB8snxCwsp0dTCKoJLpqgFUSGa6tutMJmG6u6rnVFc/qtJVa2XlR++9z97f/uZU1dnn7CLEV08jQD0dfRw8YgL0OAliAsQE6HEEejz8eAaICdDjCPR4+PEMEBOgxxHo8fDjGSAmQI8j0OPhxzNATIAeR6DHw49ngJgAPY5Aj4cfzwAxAXocgR4PP54BYgL0OAI9Hn48A8QE6HEEejz8npoB1OvNw5Cg4xk8j4B5AM0DnIOgKE+CsZOIHx5X8POnBrXtvcKL/Z4AasE8BY7zZiblrQS8TTKxW5jorkRlbP3I0IKipE4kxfZbAsxeXTxJUWgIwPuazgzjWSK6iaCsHNHnDTdtJ8SK+yUBVMO8AcCFLcR9hJmvsnOZK1toMxSm9jsCqEbpZwAf3yZ0v2/p2qltst0Vs/sVAVSj9ATAL24vkvQnS0+/vL1jdM76fkMA1TB3AujvEHRPWLr20g6N1dZh9gsCqIXS18H84bYiVWuccK2V1S7q6JhtGCzyBFCN0mUAf7YN2ExrkpiWlXPp1dMKhlgg0gToN0qvd8C/7iK+j4HpBCuXfiyoD7PzxWNGc5nfB7XjVz/SBFCN4lqAlvgNupXyTFhtZ7VlQWymCuZ/M+MsR+ELR5dmfhLEll/dyBIgBH/9z2Ot4JXWUu0Rv+AL+aRRvJ5Aewk0ylAW2fr87zZjqxmdyBIgZZhfZeDiZoJutQ4zDDun5fzaVfPmN0H4YLUe327pmXP92mpWPrIEUA1TrNFrzQbeaj1L16SxTF9vHmT10TqAz6nyg3CDldU6ekuTdrrVgAWxN3uV+TYlgfuC2Gih7lOWrs2WtXfYNx5TD9j93DoG/rNG5xpL1z4ua6dVcpEkQDJf/DIRfaZVIDRvx9+qoJovzQHxOgD/UTPmlyxd+0LzfjSvGVECmHki6M2H3QpNfsjSM6+RtZRaNXwUJ5QbARxXpcP0SSuXvlrWTqvlIkkANV+8DUQde1CqB50fsPTMSbLJ6F9rvs4ZxzoQXjVVh4mW2tn0Wlk77ZCLKAHMe0HoSlWOgHvKuvZe2WQkjeETFVJuZMb8quQzFtk57VZZO+2SiyQBkoZ5n4/dPS3DjoBbyrp2nqxBNV86FcRi2n/RXh0CdsHB+8tD2l2ydtopFxNAEl0G8rauiR1GUlcqv/1MJkc88M2cojBCjnNOeWhgs5SRDgjFBJAAmYkut7Np6YJTqmCex0w3Apx43jzvIAfnlIcyv5IYsmMiMQGmgZrBK2w9c5VsRpJGcSmBClXyhIdRwbnWkLZV1k6n5GICNESaBy0983XZZKiGKfYHfK1G/ueOM7ZwdOgVf5K100m5mABeaBPeb2W1jbLJUPPFz4HoSzXyPxhzxhc+M7SgLGun03IxAVwQZ9Bptp6+VzYZk+XcT1XL853WOC3Ecm2XrJ1uyMUEqEGdWTnRzs3/qWwyasq5E2rMWG/ntMWyNropFxNgCvqO4hwzunTgD7IJcSvnNlsalh2z1XIxASYRrYDnP6VnHpUC+NL7+tQj5txcW84l5ivLuUwo9ihIxQFE83sBrV4J3D2OI/6xXBPbyqe9kmu3z1Iqzs215VwG7rd17e3TGgiZQG/PAITdh83om7XjgrnPyeSlf9W2lziJxM0u5VzEBJBBsEUyrZgBCNhZ1rUjZF06fM12reI46+vKuZMGYgLIItkCuaAEYKBk65r0djKxZVsBra8t504NJSZACxIrayIQAYh+bWXTb5Qeq1A6QQHfVFvOrdWPCSCLaAvkmiYA8WYrm3mnrAtq3jwZhJumlnO9dGMCyKLqITdz7XB/YrdydOVAZ8szgwMjjcw1RwC+09IzZ8m6mSqUzmBmkfyp5VxP9ZgAssi6yKmGKdbc93XyYOaLGzVj8E0AonVWNn2BrIspw1zEmNi2PaWc21hbhgCpQukKh/lNCtGDlXG+d3SZdr+sT+2S6/proGqYopOH6OhRfTl8sjWU+X+3wP0QgEGrbD29XBbAZKE0SMxrZOX3yk1HANUwudYmwTmjrA98x+9YrZQPAwG2AHilS1DftHTNtc2LLAEY+Iqta9Lbxz3KuVJ4NyKAmjevAeFjdYYIv7CyWru6mUj5HQYC1P1lCM8bASpDACZ82s5qX5VCAYBHOVdWvWl//ZwoknbGh+B+SQAChsq6lpfFwb2cK6u9R65ZwsYEcLk3BgGUmBaXc2mxYid1uZVzpRRrhGICNIOamHpbSAAiOrOcTX9b1hX307my2tVyMQGaww2qUfoXwAfXqjPjt3ZOe72bWTVfuhPEZ0z9jaC8q6zP/6GsG6pR2lB3OldW2U2O8T0rp73b7adGzyzxLcAwHwfwkjrgGH+3ctq+AxVTf1fz5tUg7DtJSw4fJ7vd+oXr//aC8X88s8HldG6Q9IttQBusXGahK2ENU3QZzdT/5u9waTAH3bXD8BDo9RoIqz/dh7OpUuu6mi9+AkR7tmr76M7xwkLpiDHmDW7l3KDgNtoJpBrm0+4riv7OGAb10U0/BAQoPQDwW1xn1YTyMntw/p/rCGAULwDoW2A6UrZB06wbdsxNjI3d5lXODQouM19u5zJ1h0f6r9g205mZEASou/weNQvqYygJkDJMg4Gsa3AKjreWar+o/W22Yb4XB/f9ZPSCuaMyoCQLpaPJ4dsalXNl7DSS8boN9a/ennEUx7XRtN+FqqA+hpMA+eL5TOIYVf3leSpnIyfcbg1uNlJr/3gsnPFbpyvnBgR3i6VrVUe/99pr3M2EBi09LX3wJKCPrupdvwWk8sUFTOTeYYt5s5WTL9/WRphaPfwOVpRbZMq5gcBl54tWbuBSNxu1D6xVMoRTraz2/UBjB1TuOgGE/436/Db7miRuEwogki9Vzg2Co1KpvHFk2VGuDStVzzcA4JDnZhzyl4vmPBtk7KC64SCAa7u0PaH5ecXbC0YyXzyXSBHbtqXLuc0C2ehBLrW6eCwr9EsP29+zdPd1g2Z9aUYvFARIGsWFBHLvltFgenWdcr3Ky82gI6FD4HeV9YzrApSaH74UpLg2f/Jbr5BwpSmRcBBg7fYjqeLUnZ5l0ApbT0sfzVbzxY+AaGVTSDSjxPRtK5c+01V1IyeSO0sPEuF1br9zZfzV9rIFDzczbCt1QkEAEVAyb95EhA/sC45oiZVN128U8Yg+ZZiXMHB5K8GZxtafxw+c8dqnL5xjucmlCsXlzHSd228E/K6sa67E6KD/e26xnR7Qa7yq1yXGKVZO+4Gsb0nDvJyAS2TlWyLXYAVSnB6iCv8K4AGPsVZaula/QaQljvkzEhoCTMwChnlXAokVfr7QpRZKK8H8EX9hB5Mmco4tZwce9LKSMoYvYShes9GzjMpxtn7UQ8G8aI12qAjw8hv/OEP2mJYI3+PrYKINi9sWs+CIEW9OOAcs2pmb+zcvY/3GtgEHCdEEyvWTMmE7QBoqAvjJkFoo3Qbm2maRW6HgbHJ4GYOW+rEnIfuNww7uWzYdQdW8+WMQvJpIPj45e4gKaCiuyBFAdNq2+7CRgdpmjRPJ39u3X/ToY+JBAk4PiPQmx+HVo0PTf8hBzZt3gHC213hMdLGdTYfq24ORIoDotN03tmsjmN9RA3JV8qf+ljQePZFQEd06xGaN+n0H7tl6nMD3OFDulm0Vo+bNj4FwjTfZ6KFDnjvouG6v/NX6FxkCJFduOZIOPOgOl3KuZ/Jrg00Vht/EjnICFMxhRj8RpeCwArDNIFv8rxDu91rY8UpusrD9PcTOPY1mGiZlkZ2d3/XWsJEkwETBCCSm19qKm3TyA94GPNVThdJyZnZ939+nxHSZlUt/vl0+BLEb+hmgf9W2N3Bf4nbPci7z/ynOjA+PLDvyiSBA+NU9PL/1UIcOuGr6h026w9LT1V8G8TtYG+VDTYDZhvlWBbhdopw7DiLdz8phEEyTa7afRo4jThxNd6rn95auvTbIWO3WDS0BkquHTyNFEcn3Uc7l7zIpt9jZtNBr+TV7TfEkpUK5Rk/6zw9K/7L09Ata7kSLDYaSAKphvg8gsW27qXKuWGtn4Ja+3Ylbn/zovL8HxUzsKuLx8SX1X/jysEzYZmW1BUHH7YR+6AiQKpTOZ57osV99MW8golHP/YNuaDFGQfQjZt48VsEm2U5gwtREbaKPTp985TxaNhmCeLaPbwrI2m2XXKgIkDLMHAP13+JlfMvKaR8SIExW2URP3ll+QRGndwCIHbpPgyf/JzAYM0mhQ8Esbjfi3zEApBtITZn2r7L09Aq/fnVTPjQESBZKK4j5iro/fJcPNUzcix0SstUfYOoakmSDK9d77QvsmlsSA4eCAKphfhGAy3syXW3p6U+6xXF4/slDK7A/AVLEZ+NlV/gkIPEnQkCBULluRD/Kdeu3P2udl+46AdRC6Wow138wkegyKzv94kn/2h0vdsZ3DXaBCP/DcK6z9YEHOp+21o3YVQKo+eIaEA3WhkNwPlPWB77iJ8wJIjhjS8D4LwDSD21+xmCGaCe7iR1sCkN/Hz++e8l2jQBJw7yZgEX1T/u4yMpp1wYJLmWUTgf4LAZEV7C6k8d+bU88PDI2+X2T8DtON+Q7TwDRafvwl24EUdXxbhE8g7O2nvHdoMkLuFmrts1NJBJvYGAegecByjxM/A/xz+36J8CPgJStzM4jUBJbmXc/MppdsKMbyenEmB0lwJ69co5oCXdy/bRP55f1tOjL1/armaYUbXeqSwN0jACTnbZF8k+YGisDu8RuYD/f5wmKVUyA5xHsCAEmO22L5IsFlqnXqAMsHtW1u4Mm1Y9+TIAOE0BdY74CDgQBpmzWpL9CcRZbS92bQfpJqFi29SOvJHCfm7x42OMKxJqE1HWAQn/ZmUuXpIRDKtSRGUDEXkOCR5mVxX4+zuSG32QzZ7EsfGy38GXgbhBdaWfTP+uWD0HG7RgBppJAAS0e0dO/CeL4norhxKwSiquZQ6xhcLyjBNhLgr07d4MAoBqmZ2+hIHYD6Hq2tg1gs+2qHSdAqyJSDdMWVdtW2Qtqh0HfsfV03dpGULvt1o8yAapazLcbqGnt+zzGPq29DglElgACn6RhrifgvA5h5T3MlP0KXffFpwORJsDEM4VRWsKoOyLmE4bmxMWXx5iU9XZ2/v82Z6H7WpEnQPchjLYHMQGinb/A3scECAxhtA3EBIh2/gJ7HxMgMITRNhATINr5C+x9TIDAEEbbQEyAaOcvsPcxAQJDGG0DMQGinb/A3scECAxhtA3EBIh2/gJ7HxMgMITRNhATINr5C+x9TIDAEEbbQEyAaOcvsPcxAQJDGG0DMQGinb/A3scECAxhtA3EBIh2/gJ7HxMgMITRNvBvAUqtzIK+B7EAAAAASUVORK5CYII="},eG5v:function(t,e){},eW9y:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"AuthDataGroup",props:{parentIndex:{type:Number,default:0},value:{type:Array,default:function(){return[]}},left:{type:Array,default:function(){return[]}},op:{type:Array,default:function(){return[]}},right:{type:Array,default:function(){return[]}}},data:function(){return{list:this.value}},methods:{addGroup:function(){this.list.push({type:"group",group:[{type:"op",op:"and"}]})},addCondi:function(){this.list.push({type:"condi",left:"",op:"=",right:""})},delGroup:function(){this.$emit("delgroup",this.parentIndex)},delCondi:function(t){this.list.splice(t,1)},delGroupSub:function(t){this.list.splice(t,1)}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{border:"#AAAAAA 1px solid"}},[i("el-button",{staticStyle:{"margin-left":"0px"},attrs:{size:"mini",plain:"",type:"success"},on:{click:t.addGroup}},[t._v("添加分组")]),t._v(" "),i("el-button",{staticStyle:{"margin-left":"0px"},attrs:{size:"mini",plain:"",type:"primary"},on:{click:t.addCondi}},[t._v("添加条件")]),t._v(" "),i("el-button",{staticStyle:{"margin-left":"0px"},attrs:{size:"mini",plain:"",type:"danger"},on:{click:t.delGroup}},[t._v("删除分组")]),t._v(" "),t._l(t.list,function(e,n){return i("ul",{staticStyle:{margin:"0px","padding-left":"20px"}},["op"==e.type?i("li",{staticStyle:{"list-style-type":"none"}},[i("el-radio",{attrs:{label:"and"},model:{value:e.op,callback:function(i){t.$set(e,"op",i)},expression:"item.op"}},[t._v("and")]),t._v(" "),i("el-radio",{attrs:{label:"or"},model:{value:e.op,callback:function(i){t.$set(e,"op",i)},expression:"item.op"}},[t._v("or")])],1):t._e(),t._v(" "),"group"==e.type?i("li",{staticStyle:{"list-style-type":"none"}},[i("AuthDataGroup",{attrs:{parentIndex:n,left:t.left,op:t.op,right:t.right},on:{delgroup:t.delGroupSub},model:{value:e.group,callback:function(i){t.$set(e,"group",i)},expression:"item.group"}})],1):t._e(),t._v(" "),"condi"==e.type?i("li",{staticStyle:{"list-style-type":"none"}},[i("select",{directives:[{name:"model",rawName:"v-model",value:e.left,expression:"item.left"}],on:{change:function(i){var n=Array.prototype.filter.call(i.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"left",i.target.multiple?n:n[0])}}},[i("option",{attrs:{value:""}},[t._v("请选择")]),t._v(" "),t._l(t.left,function(e,n){return i("option",{domProps:{value:e.value}},[t._v(t._s(e.text))])})],2),t._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:e.op,expression:"item.op"}],on:{change:function(i){var n=Array.prototype.filter.call(i.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"op",i.target.multiple?n:n[0])}}},t._l(t.op,function(e,n){return i("option",{domProps:{value:e.value}},[t._v(t._s(e.text))])}),0),t._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:e.right,expression:"item.right"}],on:{change:function(i){var n=Array.prototype.filter.call(i.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"right",i.target.multiple?n:n[0])}}},[i("option",{attrs:{value:""}},[t._v("请选择")]),t._v(" "),t._l(t.right,function(e,n){return i("option",{domProps:{value:e.value}},[t._v(t._s(e.text))])})],2),t._v(" "),i("el-button",{staticStyle:{"margin-left":"0px"},attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(e){return t.delCondi(n)}}},[t._v("删")])],1):t._e()])})],2)},staticRenderFns:[]};var o=i("VU/8")(n,r,!1,function(t){i("ImHb")},null,null);e.default=o.exports},emf4:function(t,e,i){"use strict";t.exports=r,t.exports.default=r;var n=i("SpdK");function r(t,e){if(!(this instanceof r))return new r(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function s(t,e){a(t,0,t.children.length,e,t)}function a(t,e,i,n,r){r||(r=p(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o,s=e;s<i;s++)o=t.children[s],h(r,t.leaf?n(o):o);return r}function h(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function _(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,e,i,r,o){for(var s,a=[e,i];a.length;)(i=a.pop())-(e=a.pop())<=r||(s=e+Math.ceil((i-e)/r/2)*r,n(t,s,e,i,o),a.push(e,s,s,i))}r.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!_(t,e))return i;for(var r,o,s,a,h=[];e;){for(r=0,o=e.children.length;r<o;r++)s=e.children[r],_(t,a=e.leaf?n(s):s)&&(e.leaf?i.push(s):f(t,a)?this._all(s,i):h.push(s));e=h.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!_(t,e))return!1;for(var n,r,o,s,a=[];e;){for(n=0,r=e.children.length;n<r;n++)if(o=e.children[n],_(t,s=e.leaf?i(o):o)){if(e.leaf||f(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=p([]),this},remove:function(t,e){if(!t)return this;for(var i,n,r,s,a=this.data,h=this.toBBox(t),l=[],c=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],i=c.pop(),s=!0),a.leaf&&-1!==(r=o(t,a.children,e)))return a.children.splice(r,1),l.push(a),this._condense(l),this;s||a.leaf||!f(a,h)?n?(i++,a=n.children[i],s=!1):a=null:(l.push(a),c.push(i),i=0,n=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,n){var r,o=i-e+1,a=this._maxEntries;if(o<=a)return s(r=p(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(r=p([])).leaf=!1,r.height=n;var h,l,c,u,d=Math.ceil(o/a),f=d*Math.ceil(Math.sqrt(a));for(m(t,e,i,f,this.compareMinX),h=e;h<=i;h+=f)for(m(t,h,c=Math.min(h+f-1,i),d,this.compareMinY),l=h;l<=c;l+=d)u=Math.min(l+d-1,c),r.children.push(this._build(t,l,u,n-1));return s(r,this.toBBox),r},_chooseSubtree:function(t,e,i,n){for(var r,o,s,a,h,l,c,d,f,_;n.push(e),!e.leaf&&n.length-1!==i;){for(c=d=1/0,r=0,o=e.children.length;r<o;r++)h=u(s=e.children[r]),f=t,_=s,(l=(Math.max(_.maxX,f.maxX)-Math.min(_.minX,f.minX))*(Math.max(_.maxY,f.maxY)-Math.min(_.minY,f.minY))-h)<d?(d=l,c=h<c?h:c,a=s):l===d&&h<c&&(c=h,a=s);e=a||e.children[0]}return e},_insert:function(t,e,i){var n=this.toBBox,r=i?t:n(t),o=[],s=this._chooseSubtree(r,this.data,e,o);for(s.children.push(t),h(s,r);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)},_split:function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,r,o,s,h,l,c,d,f,_,p,m,g,v;for(l=c=1/0,n=e;n<=i-e;n++)r=a(t,0,n,this.toBBox),o=a(t,n,i,this.toBBox),f=r,_=o,void 0,void 0,void 0,void 0,p=Math.max(f.minX,_.minX),m=Math.max(f.minY,_.minY),g=Math.min(f.maxX,_.maxX),v=Math.min(f.maxY,_.maxY),s=Math.max(0,g-p)*Math.max(0,v-m),h=u(r)+u(o),s<l?(l=s,d=n,c=h<c?h:c):s===l&&h<c&&(c=h,d=n);return d},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:l,r=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var r,o,s=this.toBBox,l=a(t,0,e,s),c=a(t,i-e,i,s),u=d(l)+d(c);for(r=e;r<i-e;r++)o=t.children[r],h(l,t.leaf?s(o):o),u+=d(l);for(r=i-e-1;r>=e;r--)o=t.children[r],h(c,t.leaf?s(o):o),u+=d(c);return u},_adjustParentBBoxes:function(t,e,i){for(var n=i;n>=0;n--)h(e[n],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():s(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},iTWp:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAE3ElEQVR42mL8//8/w2AGAAHExDDIAUAADXoHAgTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQACxEKuQkZERmzAvAwtjILMBlxuLGa/hzzufxRn+/Gdg1+R/+efkp/N/L3zbBeSvB6r7jK6R2BoMIIDAConBWEAka5zoNe7Tev/5fln85/xv9l+n0fq/bqU1kG0KFgPJgdSA1JJrL0AAMRLrE6QQZGJSZO/lmKlcwOIqyMDIADQIKPjp+AuG5U/bGFgZWRhCRUoZeO0lGUA6/gPJv7vfM3xPvzvh3/2fxUChf6SEIEAAkRyCTErs/TyX9f/z/7f5z/fP4j/fX4v/7H+N/6v1WPz/8vzT/59vvv/X6rL5z/7bCCwHUgNSC9LDpMTRT6q9AAFEWiZhYozgmKlUwKzDy/D/7x9IWDAxMvy8/pEhjtOfgVuCl4FNmIMhiS+I4eeVj2A5kBqQWpAejllKBUCxSFKsBAggUhzIxxoj0sLqIsjw/99faLwzMPxm+MsgfZCHId4xCq4w2imcQe6IAMMvhj9gNeAQ+/eHgdVZkAFkBsgsYi0FCCDiHcjKGMBWIKkMjR9YiDJ8v/+ewf+zPYOMphxcqYSqFEPAVweGH3feQ0IRrAdCAM1QAplFrLUAAUS0A5kNuL2YdblQ0uNfoIW8exkZMu2TMNRnOiUy8O1hAqtBTncgM0BmEWsvQAAR70B9Ll1GFmaU0Pv26iOD/zs7Bh0TPQz1GkbaDIGfHBm+vfiAFIrAPA00A2QWsfYCBBDRDmQUYxUHJyio+/4x/mfgOPiHIdMknoEBW3EP9EumWQID54G/YLWIaGaEmkUcAAgg8qo6UOh9+crgdN+AwdLKCqcyc0tzBpdHxgzfPn1BhCKJACCAiHbg/1e/X4KDABSIILsOfWFIU41mYOTAYwQ7I0OaejRQ7TeIHkZIMELMIg4ABBDRDvx78dvl/3/+gkPix8/vDPpn5Bjc7d3h8r/f/2RYv349GIPYMOBi6wJUKwvWA9ILMgNkFrH2AgQQ8Q688HXb38vfgIHAzPD79EeGfJUkBnYhDoYfr78xLFi0gMGy350hlK0EjEFskBhIDqSmQD2Z4c/JD2C9IDNAZhFrL0AAkVLV8bHGi95h/2f633iyy/8nJ+//n7lw1n+9Ntv/DDvl/7N8N/jP+98SjEFskBhIDqTm2emH/00mu/5n/2fynzVe7A7ILGLtBQgg0hoLrIwR7FPkl9vf0WN4LfeF4bzRAwZWM34GThZOSPHzD1EEATUwfP/zneH3qY8MhucUGEQf8TAcVLnE8DPnYRTD7//LibUXIIBIbs0w87JOYF2imP/fT5CBHVSW/PvHwIDLCEZw24fhJ7DKY9z0geF3zP2Jfz//LiClNQMQQCQXM0ALin6WPprIsuczpEwDOoCBmRFe58IdxgyVA3JY9nxhAOkB6SXVPoAAIqc9iNxgrWPPldRg0uNiYGRjQvLvP4b/v/4x/Lv0jeHn5Oc3fi963QwUXEZOixoggChxIDjjgCp+YN3qDqy+DGA1BKicAxYlF4C5dScwvW0AtWfJbfIDBBDjYB/dAgigQd+rAwigQe9AgAAa9A4ECKBB70CAABr0DgQIoEHvQIAAGvQOBAigQe9AgAAa9A4ECDAAOQ9z/zVcMP0AAAAASUVORK5CYII="},kvDK:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_maptalks_dist_maptalks_css__=__webpack_require__("TFOu"),__WEBPACK_IMPORTED_MODULE_0_maptalks_dist_maptalks_css___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_maptalks_dist_maptalks_css__),__WEBPACK_IMPORTED_MODULE_1_maptalks__=__webpack_require__("ow4a"),symbol={polygonFill:"#dfe8f6",polygonOpacity:.5,lineColor:"#3c537e",lineWidth:3},symbol2={markerType:"pin",markerFill:"#3c537e",markerFillOpacity:.8,markerLineColor:"#3c537e",markerLineWidth:3,markerLineOpacity:1,markerLineDasharray:[],markerWidth:40,markerHeight:40,markerDx:0,markerDy:0,markerOpacity:1},symbolGreen={polygonFill:"#67c23a",polygonOpacity:.5,lineColor:"#67c23a",lineWidth:3},symbolRed={polygonFill:"#f56c6c",polygonOpacity:.5,lineColor:"#f56c6c",lineWidth:3},symbolYellow={polygonFill:"#e6a23c",polygonOpacity:.5,lineColor:"#e6a23c",lineWidth:3},markerGreen={markerType:"pin",markerFill:"#67c23a",markerFillOpacity:.5,markerLineColor:"#67c23a",markerLineWidth:3,markerLineOpacity:1,markerLineDasharray:[],markerWidth:20,markerHeight:20,markerDx:0,markerDy:0,markerOpacity:1},markerRed={markerType:"pin",markerFill:"#f56c6c",markerFillOpacity:.5,markerLineColor:"#f56c6c",markerLineWidth:3,markerLineOpacity:1,markerLineDasharray:[],markerWidth:20,markerHeight:20,markerDx:0,markerDy:0,markerOpacity:1};__webpack_exports__.a={name:"LingxMap",props:{isLeftBottmButton1:{type:Boolean,default:!1},isRightBottmButton1:{type:Boolean,default:!1},isyy:{type:Boolean,default:!1},iscl:{type:Boolean,default:!0},isinfowin:{type:Boolean,default:!0},ispls:{type:Boolean,default:!0},issearch:{type:Boolean,default:!0},zoom:{type:Number,default:13},center:{type:Object,default:{lng:116.396621,lat:39.916385}},mapid:{type:String,default:"map"}},data:function(){return{city:"",checked1:!0,checked2:!0,checked3:!0,checked4:!0,checked5:!1,clazz1:"el-icon-rank",clazz2:"el-icon-bottom",mapType:"baidu",mapURL:"",isMove:!1,startXY:{x:0,y:0}}},methods:{start1:function(t){this.isMove=!0,this.startXY={x:t.clientX,y:t.clientY}},end1:function(t){this.isMove=!1},move1:function(t){this.isMove&&(this.$emit("move",this.startXY,{x:t.clientX,y:t.clientY}),this.startXY={x:t.clientX,y:t.clientY})},setIsShowInfoWindow:function(t){this.checked4=t},onLeftBottmButton1:function(){"el-icon-bottom-left"==this.clazz1?(this.clazz1="el-icon-top-right",this.$emit("lbbclick",!1)):(this.clazz1="el-icon-bottom-left",this.$emit("lbbclick",!0))},onRightBottmButton1:function(){"el-icon-bottom"==this.clazz2?(this.clazz2="el-icon-top",this.$emit("rbbclick",!1)):(this.clazz2="el-icon-bottom",this.$emit("rbbclick",!0))},cj:function(){this.lgxInfo("单击开始测量距离/双击结束"),this.distanceTool.enable()},cm:function(){this.lgxInfo("单击开始测量面积/双击结束"),this.areaTool.enable()},searchCity:function searchCity(){var _this=this;this.city&&this.callApi({apicode:1115,text:this.city},function(json){if(1==json.code){var cp=json.data.cp;if(cp){var arr1=eval("("+cp+")");_this.lingxMap.setCenter(arr1)}else{var arr1=eval("("+json.data.latlngs+")");_this.lingxMap.setCenter(arr1[0])}}else alert(json.message)})},setOldBaiduLayer:function(){var t=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{urlTemplate:"http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1",subdomains:[0,1,2,3]});this.lingxMap.setBaseLayer(t),this.lingxMap.setSpatialReference({projection:"baidu"})},setNewBaiduLayer:function(){var t=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{urlTemplate:"https://maponline{s}.bdimg.com/tile/?qt=vtile&x={x}&y={y}&z={z}&styles=pl&scaler=1&udt=20220626&from=jsapi2_0",subdomains:[1,2,3]});this.lingxMap.setBaseLayer(t),this.lingxMap.setSpatialReference({projection:"baidu"})},setNewBaiduWxLayer:function(){var t=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{urlTemplate:"https://maponline{s}.bdimg.com/starpic/?qt=satepc&u=x={x};y={y};z={z};v=009;type=sate&fm=46&udt=20220624",subdomains:[1,2,3]});this.lingxMap.setBaseLayer(t),this.lingxMap.setSpatialReference({projection:"baidu"})},setGaodeLayer:function(){var t=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{urlTemplate:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&scl=1&ltype=7&x={x}&y={y}&z={z}",subdomains:[1,2,3,4]});this.lingxMap.setBaseLayer(t),this.lingxMap.setSpatialReference({projection:"EPSG:3857"})},setGaodeWxLayer:function(){var t=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{urlTemplate:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",subdomains:[1,2,3,4]});this.lingxMap.setBaseLayer(t),this.lingxMap.setSpatialReference({projection:"EPSG:3857"})},setDidu1Layer:function(){var t=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{urlTemplate:"//map.lingx.com/?type=map1&x={x}&y={y}&z={z}&ak=QmXLOUTRtdiviH9dlxuN5THmywqV8xPc",subdomains:[1,2,3]});this.lingxMap.setBaseLayer(t)},setDidu2Layer:function(){var t=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{urlTemplate:"//map.lingx.com/?type=map2&x={x}&y={y}&z={z}&ak=QmXLOUTRtdiviH9dlxuN5THmywqV8xPc",subdomains:[1,2,3]});this.lingxMap.setBaseLayer(t)},getMap:function(){return this.lingxMap},getDefaultMapURL:function(){return this.mapURL&&this.mapURL.length>2?this.mapURL:"baidu"==this.mapType?"https://maponline{s}.bdimg.com/tile/?qt=vtile&x={x}&y={y}&z={z}&styles=pl&scaler=1&from=jsapi2_0":"//map.lingx.com/?type=map1&x={x}&y={y}&z={z}&ak=QmXLOUTRtdiviH9dlxuN5THmywqV8xPc"}},created:function(){this.isLeftBottmButton1&&(window.app=this,$(window).mousemove(function(t){window.app.move1(t)}),$(window).mouseup(function(t){window.app.move1(t),window.app.end1(t)}));var t=sessionStorage.getItem("mapType");t&&"undefined"!=t&&(this.mapType=t),(t=sessionStorage.getItem("mapURL"))&&"undefined"!=t&&(this.mapURL=t),console.log("mapType:"+this.mapType),console.log("mapURL:"+this.mapURL)},mounted:function mounted(){var _this=this;this.lingxMap=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.g(this.mapid,{center:[_this.center.lng,_this.center.lat],zoom:_this.zoom,minZoom:1,maxZoom:20,scaleControl:{position:"bottom-right",maxWidth:100,metric:!0,imperial:!1},dragPitch:!0,dragRotate:!0,dragRotatePitch:!0,attribution:!1,spatialReference:{projection:"baidu"==this.mapType?"baidu":"EPSG:3857"},baseLayer:new __WEBPACK_IMPORTED_MODULE_1_maptalks__.j("base",{crossOrigin:void 0,urlTemplate:_this.getDefaultMapURL(),subdomains:[1,2,3]})});var items=["地图","卫星"].map(function(t){return{item:t,click:function(){switch(t){case"卫星":"baidu"==_this.mapType?_this.setNewBaiduWxLayer():_this.setDidu2Layer();break;case"地图":"baidu"==_this.mapType?_this.setNewBaiduLayer():_this.setDidu1Layer()}}}}),toolbar=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.m.Toolbar({items:[{item:"地图",children:items}]}).addTo(this.lingxMap);this.ispls&&(this.layer1=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.k("vector_def_1").addTo(this.lingxMap),this.layer2=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.k("vector_def_2").addTo(this.lingxMap),this.layer3=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.k("vector_def_3").addTo(this.lingxMap),this.callApi({apicode:1119},function(json){for(var _loop=function _loop(){var data=json.rows[i];switch(sss=symbolRed,sss.polygonFill=data.color,sss.lineColor=data.color,latlngs=eval("("+data.latlngs+")"),data.type-0){case 3:geometry=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.b(latlngs,data.radius,{symbol:sss}),_this.layer3.addGeometry(geometry);break;case 2:geometry=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.f(latlngs,{symbol:sss}),_this.layer2.addGeometry(geometry);break;case 1:geometry=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.i([latlngs],{symbol:sss}),_this.layer1.addGeometry(geometry)}geometry.on("click",function(t){_this.lgxInfo(data.name)})},i=0;i<json.rows.length;i++){var geometry,sss,latlngs;_loop()}})),this.distanceTool=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.d({once:!0,symbol:{lineColor:"#fc8046",lineWidth:2},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#ff0101",markerLineWidth:2,markerWidth:10,markerHeight:10},labelOptions:{textSymbol:{textFaceName:"monospace",textFill:"#888",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15,markerLineColor:"#b4b3b3",markerFill:"#fff"},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:1,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerLineColor:"#999",markerDx:20}],language:"zh-CN"}).addTo(this.lingxMap).disable(),this.areaTool=new __WEBPACK_IMPORTED_MODULE_1_maptalks__.a({once:!0,symbol:{lineColor:"#fc8046",lineWidth:2,polygonFill:"#fff",polygonOpacity:.5},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#ff0101",markerLineWidth:2,markerWidth:10,markerHeight:10},labelOptions:{textSymbol:{textFaceName:"monospace",textFill:"#888",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15,markerLineColor:"#b4b3b3",markerFill:"#fff"},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:1,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerLineColor:"#999",markerDx:20}],language:"zh-CN"}).addTo(this.lingxMap).disable()},watch:{zoom:function(t){this.lingxMap.setZoom(t)},checked1:function(t){t?this.layer1.show():this.layer1.hide()},checked2:function(t){t?this.layer2.show():this.layer2.hide()},checked3:function(t){t?this.layer3.show():this.layer3.hide()},checked4:function(t){this.$emit("isShowInfoWindow",t)},checked5:function(t){t?this.overview.addTo(this.lingxMap):this.overview.removeTo(this.lingxMap)}}}},m6LY:function(t,e){},mtSL:function(t,e,i){var n;window,n=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=14)}([function(t,e,i){"use strict";var n=i(6),r=i.n(n),o=function(){function t(){}return t.e=function(e,i){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+i;t.ENABLE_CALLBACK&&t.emitter.emit("log","error",n),t.ENABLE_ERROR&&(console.error?console.error(n):console.warn?console.warn(n):console.log(n))},t.i=function(e,i){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+i;t.ENABLE_CALLBACK&&t.emitter.emit("log","info",n),t.ENABLE_INFO&&(console.info?console.info(n):console.log(n))},t.w=function(e,i){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+i;t.ENABLE_CALLBACK&&t.emitter.emit("log","warn",n),t.ENABLE_WARN&&(console.warn?console.warn(n):console.log(n))},t.d=function(e,i){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+i;t.ENABLE_CALLBACK&&t.emitter.emit("log","debug",n),t.ENABLE_DEBUG&&(console.debug?console.debug(n):console.log(n))},t.v=function(e,i){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+i;t.ENABLE_CALLBACK&&t.emitter.emit("log","verbose",n),t.ENABLE_VERBOSE&&console.log(n)},t}();o.GLOBAL_TAG="mpegts.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new r.a,e.a=o},function(t,e,i){"use strict";e.a={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},function(t,e,i){"use strict";i.d(e,"c",function(){return r}),i.d(e,"b",function(){return o}),i.d(e,"a",function(){return s});var n=i(3),r={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function t(t){this._type=t||"undefined",this._status=r.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return t.prototype.destroy=function(){this._status=r.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},t.prototype.isWorking=function(){return this._status===r.kConnecting||this._status===r.kBuffering},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(t){this._onContentLengthKnown=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(t){this._onURLRedirect=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onComplete",{get:function(){return this._onComplete},set:function(t){this._onComplete=t},enumerable:!1,configurable:!0}),t.prototype.open=function(t,e){throw new n.c("Unimplemented abstract function!")},t.prototype.abort=function(){throw new n.c("Unimplemented abstract function!")},t}()},function(t,e,i){"use strict";i.d(e,"d",function(){return o}),i.d(e,"a",function(){return s}),i.d(e,"b",function(){return a}),i.d(e,"c",function(){return h});var n,r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=function(){function t(t){this._message=t}return Object.defineProperty(t.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this.name+": "+this.message},t}(),s=function(t){function e(e){return t.call(this,e)||this}return r(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),e}(o),a=function(t){function e(e){return t.call(this,e)||this}return r(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),e}(o),h=function(t){function e(e){return t.call(this,e)||this}return r(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),e}(o)},function(t,e,i){"use strict";var n={};!function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],r={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},o={};if(r.browser){o[r.browser]=!0;var s=r.majorVersion.split(".");o.version={major:parseInt(r.majorVersion,10),string:r.version},s.length>1&&(o.version.minor=parseInt(s[1],10)),s.length>2&&(o.version.build=parseInt(s[2],10))}for(var a in r.platform&&(o[r.platform]=!0),(o.chrome||o.opr||o.safari)&&(o.webkit=!0),(o.rv||o.iemobile)&&(o.rv&&delete o.rv,r.browser="msie",o.msie=!0),o.edge&&(delete o.edge,r.browser="msedge",o.msedge=!0),o.opr&&(r.browser="opera",o.opera=!0),o.safari&&o.android&&(r.browser="android",o.android=!0),o.name=r.browser,o.platform=r.platform,n)n.hasOwnProperty(a)&&delete n[a];Object.assign(n,o)}(),e.a=n},function(t,e,i){"use strict";e.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(t,e,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(t,e){return new Promise(function(i,n){function r(i){t.removeListener(e,o),n(i)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",r),i([].slice.call(arguments))}m(t,e,o,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,r)})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var h=10;function l(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function u(t,e,i,n){var r,o,s,a;if(l(i),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),o=t._events),s=o[e]),void 0===s)s=o[e]=i,++t._eventsCount;else if("function"==typeof s?s=o[e]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=c(t))>0&&s.length>r&&!s.warned){s.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=s.length,a=h,console&&console.warn&&console.warn(a)}return t}function d(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(n);return r.listener=i,n.wrapFn=r,r}function f(t,e,i){var n=t._events;if(void 0===n)return[];var r=n[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):p(r,r.length)}function _(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function m(t,e,i,n){if("function"==typeof t.on)n.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function r(o){n.once&&t.removeEventListener(e,r),i(o)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var h=r[t];if(void 0===h)return!1;if("function"==typeof h)o(h,this,e);else{var l=h.length,c=p(h,l);for(i=0;i<l;++i)o(c[i],this,e)}return!0},a.prototype.addListener=function(t,e){return u(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return u(this,t,e,!0)},a.prototype.once=function(t,e){return l(e),this.on(t,d(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return l(e),this.prependListener(t,d(this,t,e)),this},a.prototype.removeListener=function(t,e){var i,n,r,o,s;if(l(e),void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,o=Object.keys(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},a.prototype.listeners=function(t){return f(this,t,!0)},a.prototype.rawListeners=function(t){return f(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):_.call(t,e)},a.prototype.listenerCount=_,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(t,e,i){"use strict";i.d(e,"d",function(){return n}),i.d(e,"b",function(){return r}),i.d(e,"a",function(){return o}),i.d(e,"c",function(){return s});var n=function(t,e,i,n,r){this.dts=t,this.pts=e,this.duration=i,this.originalDts=n,this.isSyncPoint=r,this.fileposition=null},r=function(){function t(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return t.prototype.appendSyncPoint=function(t){t.isSyncPoint=!0,this.syncPoints.push(t)},t}(),o=function(){function t(){this._list=[]}return t.prototype.clear=function(){this._list=[]},t.prototype.appendArray=function(t){var e=this._list;0!==t.length&&(e.length>0&&t[0].originalDts<e[e.length-1].originalDts&&this.clear(),Array.prototype.push.apply(e,t))},t.prototype.getLastSyncPointBeforeDts=function(t){if(0==this._list.length)return null;var e=this._list,i=0,n=e.length-1,r=0,o=0,s=n;for(t<e[0].dts&&(i=0,o=s+1);o<=s;){if((r=o+Math.floor((s-o)/2))===n||t>=e[r].dts&&t<e[r+1].dts){i=r;break}e[r].dts<t?o=r+1:s=r-1}return this._list[i]},t}(),s=function(){function t(t){this._type=t,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return 0===this._list.length},t.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},t.prototype._searchNearestSegmentBefore=function(t){var e=this._list;if(0===e.length)return-2;var i=e.length-1,n=0,r=0,o=i,s=0;if(t<e[0].originalBeginDts)return-1;for(;r<=o;){if((n=r+Math.floor((o-r)/2))===i||t>e[n].lastSample.originalDts&&t<e[n+1].originalBeginDts){s=n;break}e[n].originalBeginDts<t?r=n+1:o=n-1}return s},t.prototype._searchNearestSegmentAfter=function(t){return this._searchNearestSegmentBefore(t)+1},t.prototype.append=function(t){var e=this._list,i=t,n=this._lastAppendLocation,r=0;-1!==n&&n<e.length&&i.originalBeginDts>=e[n].lastSample.originalDts&&(n===e.length-1||n<e.length-1&&i.originalBeginDts<e[n+1].originalBeginDts)?r=n+1:e.length>0&&(r=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,i)},t.prototype.getLastSegmentBefore=function(t){var e=this._searchNearestSegmentBefore(t);return e>=0?this._list[e]:null},t.prototype.getLastSampleBefore=function(t){var e=this.getLastSegmentBefore(t);return null!=e?e.lastSample:null},t.prototype.getLastSyncPointBefore=function(t){for(var e=this._searchNearestSegmentBefore(t),i=this._list[e].syncPoints;0===i.length&&e>0;)e--,i=this._list[e].syncPoints;return i.length>0?i[i.length-1]:null},t}()},function(t,e,i){"use strict";var n=function(){function t(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return t.prototype.isComplete=function(){var t=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,e=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&t&&e},t.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},t.prototype.getNearestKeyframe=function(t){if(null==this.keyframesIndex)return null;var e=this.keyframesIndex,i=this._search(e.times,t);return{index:i,milliseconds:e.times[i],fileposition:e.filepositions[i]}},t.prototype._search=function(t,e){var i=0,n=t.length-1,r=0,o=0,s=n;for(e<t[0]&&(i=0,o=s+1);o<=s;){if((r=o+Math.floor((s-o)/2))===n||e>=t[r]&&e<t[r+1]){i=r;break}t[r]<e?o=r+1:s=r-1}return i},t}();e.a=n},function(t,e,i){"use strict";var n=i(6),r=i.n(n),o=i(0),s=function(){function t(){}return Object.defineProperty(t,"forceGlobalTag",{get:function(){return o.a.FORCE_GLOBAL_TAG},set:function(e){o.a.FORCE_GLOBAL_TAG=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"globalTag",{get:function(){return o.a.GLOBAL_TAG},set:function(e){o.a.GLOBAL_TAG=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableAll",{get:function(){return o.a.ENABLE_VERBOSE&&o.a.ENABLE_DEBUG&&o.a.ENABLE_INFO&&o.a.ENABLE_WARN&&o.a.ENABLE_ERROR},set:function(e){o.a.ENABLE_VERBOSE=e,o.a.ENABLE_DEBUG=e,o.a.ENABLE_INFO=e,o.a.ENABLE_WARN=e,o.a.ENABLE_ERROR=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableDebug",{get:function(){return o.a.ENABLE_DEBUG},set:function(e){o.a.ENABLE_DEBUG=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableVerbose",{get:function(){return o.a.ENABLE_VERBOSE},set:function(e){o.a.ENABLE_VERBOSE=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableInfo",{get:function(){return o.a.ENABLE_INFO},set:function(e){o.a.ENABLE_INFO=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableWarn",{get:function(){return o.a.ENABLE_WARN},set:function(e){o.a.ENABLE_WARN=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableError",{get:function(){return o.a.ENABLE_ERROR},set:function(e){o.a.ENABLE_ERROR=e,t._notifyChange()},enumerable:!1,configurable:!0}),t.getConfig=function(){return{globalTag:o.a.GLOBAL_TAG,forceGlobalTag:o.a.FORCE_GLOBAL_TAG,enableVerbose:o.a.ENABLE_VERBOSE,enableDebug:o.a.ENABLE_DEBUG,enableInfo:o.a.ENABLE_INFO,enableWarn:o.a.ENABLE_WARN,enableError:o.a.ENABLE_ERROR,enableCallback:o.a.ENABLE_CALLBACK}},t.applyConfig=function(t){o.a.GLOBAL_TAG=t.globalTag,o.a.FORCE_GLOBAL_TAG=t.forceGlobalTag,o.a.ENABLE_VERBOSE=t.enableVerbose,o.a.ENABLE_DEBUG=t.enableDebug,o.a.ENABLE_INFO=t.enableInfo,o.a.ENABLE_WARN=t.enableWarn,o.a.ENABLE_ERROR=t.enableError,o.a.ENABLE_CALLBACK=t.enableCallback},t._notifyChange=function(){var e=t.emitter;if(e.listenerCount("change")>0){var i=t.getConfig();e.emit("change",i)}},t.registerListener=function(e){t.emitter.addListener("change",e)},t.removeListener=function(e){t.emitter.removeListener("change",e)},t.addLogListener=function(e){o.a.emitter.addListener("log",e),o.a.emitter.listenerCount("log")>0&&(o.a.ENABLE_CALLBACK=!0,t._notifyChange())},t.removeLogListener=function(e){o.a.emitter.removeListener("log",e),0===o.a.emitter.listenerCount("log")&&(o.a.ENABLE_CALLBACK=!1,t._notifyChange())},t}();s.emitter=new r.a,e.a=s},function(t,e,i){"use strict";var n=i(6),r=i.n(n),o=i(0),s=i(4),a=i(8);function h(t,e,i){var n=t;if(e+i<n.length){for(;i--;)if(128!=(192&n[++e]))return!1;return!0}return!1}var l,c=function(t){for(var e=[],i=t,n=0,r=t.length;n<r;)if(i[n]<128)e.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(h(i,n,1)&&(o=(31&i[n])<<6|63&i[n+1])>=128){e.push(String.fromCharCode(65535&o)),n+=2;continue}}else if(i[n]<240){if(h(i,n,2)&&(o=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2])>=2048&&55296!=(63488&o)){e.push(String.fromCharCode(65535&o)),n+=3;continue}}else if(i[n]<248){var o;if(h(i,n,3)&&(o=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3])>65536&&o<1114112){o-=65536,e.push(String.fromCharCode(o>>>10|55296)),e.push(String.fromCharCode(1023&o|56320)),n+=4;continue}}e.push(String.fromCharCode(65533)),++n}return e.join("")},u=i(3),d=(l=new ArrayBuffer(2),new DataView(l).setInt16(0,256,!0),256===new Int16Array(l)[0]),f=function(){function t(){}return t.parseScriptData=function(e,i,n){var r={};try{var s=t.parseValue(e,i,n),a=t.parseValue(e,i+s.size,n-s.size);r[s.data]=a.data}catch(t){o.a.e("AMF",t.toString())}return r},t.parseObject=function(e,i,n){if(n<3)throw new u.a("Data not enough when parse ScriptDataObject");var r=t.parseString(e,i,n),o=t.parseValue(e,i+r.size,n-r.size),s=o.objectEnd;return{data:{name:r.data,value:o.data},size:r.size+o.size,objectEnd:s}},t.parseVariable=function(e,i,n){return t.parseObject(e,i,n)},t.parseString=function(t,e,i){if(i<2)throw new u.a("Data not enough when parse String");var n=new DataView(t,e,i).getUint16(0,!d);return{data:n>0?c(new Uint8Array(t,e+2,n)):"",size:2+n}},t.parseLongString=function(t,e,i){if(i<4)throw new u.a("Data not enough when parse LongString");var n=new DataView(t,e,i).getUint32(0,!d);return{data:n>0?c(new Uint8Array(t,e+4,n)):"",size:4+n}},t.parseDate=function(t,e,i){if(i<10)throw new u.a("Data size invalid when parse Date");var n=new DataView(t,e,i),r=n.getFloat64(0,!d),o=n.getInt16(8,!d);return{data:new Date(r+=60*o*1e3),size:10}},t.parseValue=function(e,i,n){if(n<1)throw new u.a("Data not enough when parse Value");var r,s=new DataView(e,i,n),a=1,h=s.getUint8(0),l=!1;try{switch(h){case 0:r=s.getFloat64(1,!d),a+=8;break;case 1:r=!!s.getUint8(1),a+=1;break;case 2:var c=t.parseString(e,i+1,n-1);r=c.data,a+=c.size;break;case 3:r={};var f=0;for(9==(16777215&s.getUint32(n-4,!d))&&(f=3);a<n-4;){var _=t.parseObject(e,i+a,n-a-f);if(_.objectEnd)break;r[_.data.name]=_.data.value,a+=_.size}a<=n-3&&9==(16777215&s.getUint32(a-1,!d))&&(a+=3);break;case 8:for(r={},a+=4,f=0,9==(16777215&s.getUint32(n-4,!d))&&(f=3);a<n-8;){var p=t.parseVariable(e,i+a,n-a-f);if(p.objectEnd)break;r[p.data.name]=p.data.value,a+=p.size}a<=n-3&&9==(16777215&s.getUint32(a-1,!d))&&(a+=3);break;case 9:r=void 0,a=1,l=!0;break;case 10:r=[];var m=s.getUint32(1,!d);a+=4;for(var g=0;g<m;g++){var v=t.parseValue(e,i+a,n-a);r.push(v.data),a+=v.size}break;case 11:var y=t.parseDate(e,i+1,n-1);r=y.data,a+=y.size;break;case 12:var x=t.parseString(e,i+1,n-1);r=x.data,a+=x.size;break;default:a=n,o.a.w("AMF","Unsupported AMF value type "+h)}}catch(t){o.a.e("AMF",t.toString())}return{data:r,size:a,objectEnd:l}},t}(),_=function(){function t(t){this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return t.prototype.destroy=function(){this._buffer=null},t.prototype._fillCurrentWord=function(){var t=this._total_bytes-this._buffer_index;if(t<=0)throw new u.a("ExpGolomb: _fillCurrentWord() but no bytes available");var e=Math.min(4,t),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+e)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=e,this._current_word_bits_left=8*e},t.prototype.readBits=function(t){if(t>32)throw new u.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(t<=this._current_word_bits_left){var e=this._current_word>>>32-t;return this._current_word<<=t,this._current_word_bits_left-=t,e}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var n=t-this._current_word_bits_left;this._fillCurrentWord();var r=Math.min(n,this._current_word_bits_left),o=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,i<<r|o},t.prototype.readBool=function(){return 1===this.readBits(1)},t.prototype.readByte=function(){return this.readBits(8)},t.prototype._skipLeadingZero=function(){var t;for(t=0;t<this._current_word_bits_left;t++)if(0!=(this._current_word&2147483648>>>t))return this._current_word<<=t,this._current_word_bits_left-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()},t.prototype.readUEG=function(){var t=this._skipLeadingZero();return this.readBits(t+1)-1},t.prototype.readSEG=function(){var t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)},t}(),p=function(){function t(){}return t._ebsp2rbsp=function(t){for(var e=t,i=e.byteLength,n=new Uint8Array(i),r=0,o=0;o<i;o++)o>=2&&3===e[o]&&0===e[o-1]&&0===e[o-2]||(n[r]=e[o],r++);return new Uint8Array(n.buffer,0,r)},t.parseSPS=function(e){for(var i=e.subarray(1,4),n="avc1.",r=0;r<3;r++){var o=i[r].toString(16);o.length<2&&(o="0"+o),n+=o}var s=t._ebsp2rbsp(e),a=new _(s);a.readByte();var h=a.readByte();a.readByte();var l=a.readByte();a.readUEG();var c=t.getProfileString(h),u=t.getLevelString(l),d=1,f=420,p=8,m=8;if((100===h||110===h||122===h||244===h||44===h||83===h||86===h||118===h||128===h||138===h||144===h)&&(3===(d=a.readUEG())&&a.readBits(1),d<=3&&(f=[0,420,422,444][d]),p=a.readUEG()+8,m=a.readUEG()+8,a.readBits(1),a.readBool()))for(var g=3!==d?8:12,v=0;v<g;v++)a.readBool()&&(v<6?t._skipScalingList(a,16):t._skipScalingList(a,64));a.readUEG();var y=a.readUEG();if(0===y)a.readUEG();else if(1===y){a.readBits(1),a.readSEG(),a.readSEG();var x=a.readUEG();for(v=0;v<x;v++)a.readSEG()}var w=a.readUEG();a.readBits(1);var b=a.readUEG(),A=a.readUEG(),C=a.readBits(1);0===C&&a.readBits(1),a.readBits(1);var S=0,E=0,P=0,M=0;a.readBool()&&(S=a.readUEG(),E=a.readUEG(),P=a.readUEG(),M=a.readUEG());var T=1,k=1,R=0,L=!0,D=0,O=0;if(a.readBool()){if(a.readBool()){var I=a.readByte();I>0&&I<16?(T=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][I-1],k=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][I-1]):255===I&&(T=a.readByte()<<8|a.readByte(),k=a.readByte()<<8|a.readByte())}if(a.readBool()&&a.readBool(),a.readBool()&&(a.readBits(4),a.readBool()&&a.readBits(24)),a.readBool()&&(a.readUEG(),a.readUEG()),a.readBool()){var B=a.readBits(32),j=a.readBits(32);L=a.readBool(),R=(D=j)/(O=2*B)}}var z=1;1===T&&1===k||(z=T/k);var G=0,N=0;0===d?(G=1,N=2-C):(G=3===d?1:2,N=(1===d?2:1)*(2-C));var F=16*(b+1),U=16*(A+1)*(2-C);F-=(S+E)*G,U-=(P+M)*N;var H=Math.ceil(F*z);return a.destroy(),a=null,{codec_mimetype:n,profile_idc:h,level_idc:l,profile_string:c,level_string:u,chroma_format_idc:d,bit_depth:p,bit_depth_luma:p,bit_depth_chroma:m,ref_frames:w,chroma_format:f,chroma_format_string:t.getChromaFormatString(f),frame_rate:{fixed:L,fps:R,fps_den:O,fps_num:D},sar_ratio:{width:T,height:k},codec_size:{width:F,height:U},present_size:{width:H,height:U}}},t._skipScalingList=function(t,e){for(var i=8,n=8,r=0;r<e;r++)0!==n&&(n=(i+t.readSEG()+256)%256),i=0===n?i:n},t.getProfileString=function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},t.getLevelString=function(t){return(t/10).toFixed(1)},t.getChromaFormatString=function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},t}(),m=i(5),g=function(){function t(){}return t._ebsp2rbsp=function(t){for(var e=t,i=e.byteLength,n=new Uint8Array(i),r=0,o=0;o<i;o++)o>=2&&3===e[o]&&0===e[o-1]&&0===e[o-2]||(n[r]=e[o],r++);return new Uint8Array(n.buffer,0,r)},t.parseVPS=function(e){var i=t._ebsp2rbsp(e),n=new _(i);return n.readByte(),n.readByte(),n.readBits(4),n.readBits(2),n.readBits(6),{num_temporal_layers:n.readBits(3)+1,temporal_id_nested:n.readBool()}},t.parseSPS=function(e){var i=t._ebsp2rbsp(e),n=new _(i);n.readByte(),n.readByte();for(var r=0,o=0,s=0,a=0,h=(n.readBits(4),n.readBits(3)),l=(n.readBool(),n.readBits(2)),c=n.readBool(),u=n.readBits(5),d=n.readByte(),f=n.readByte(),p=n.readByte(),m=n.readByte(),g=n.readByte(),v=n.readByte(),y=n.readByte(),x=n.readByte(),w=n.readByte(),b=n.readByte(),A=n.readByte(),C=[],S=[],E=0;E<h;E++)C.push(n.readBool()),S.push(n.readBool());if(h>0)for(E=h;E<8;E++)n.readBits(2);for(E=0;E<h;E++)C[E]&&(n.readByte(),n.readByte(),n.readByte(),n.readByte(),n.readByte(),n.readByte(),n.readByte(),n.readByte(),n.readByte(),n.readByte(),n.readByte()),S[E]&&n.readByte();n.readUEG();var P=n.readUEG();3==P&&n.readBits(1);var M=n.readUEG(),T=n.readUEG();n.readBool()&&(r+=n.readUEG(),o+=n.readUEG(),s+=n.readUEG(),a+=n.readUEG());var k=n.readUEG(),R=n.readUEG(),L=n.readUEG();for(E=n.readBool()?0:h;E<=h;E++)n.readUEG(),n.readUEG(),n.readUEG();if(n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG(),n.readBool()&&n.readBool())for(var D=0;D<4;D++)for(var O=0;O<(3===D?2:6);O++)if(n.readBool()){var I=Math.min(64,1<<4+(D<<1));for(D>1&&n.readSEG(),E=0;E<I;E++)n.readSEG()}else n.readUEG();n.readBool(),n.readBool(),n.readBool()&&(n.readByte(),n.readUEG(),n.readUEG(),n.readBool());var B=n.readUEG(),j=0;for(E=0;E<B;E++){var z=!1;if(0!==E&&(z=n.readBool()),z){E===B&&n.readUEG(),n.readBool(),n.readUEG();for(var G=0,N=0;N<=j;N++){var F=n.readBool(),U=!1;F||(U=n.readBool()),(F||U)&&G++}j=G}else{var H=n.readUEG(),V=n.readUEG();for(j=H+V,N=0;N<H;N++)n.readUEG(),n.readBool();for(N=0;N<V;N++)n.readUEG(),n.readBool()}}if(n.readBool()){var W=n.readUEG();for(E=0;E<W;E++){for(N=0;N<L+4;N++)n.readBits(1);n.readBits(1)}}var Z=0,q=1,Y=1,Q=!1,K=1,X=1;if(n.readBool(),n.readBool(),n.readBool()){if(n.readBool()){var J=n.readByte();J>0&&J<=16?(q=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][J-1],Y=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][J-1]):255===J&&(q=n.readBits(16),Y=n.readBits(16))}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(3),n.readBool(),n.readBool()&&(n.readByte(),n.readByte(),n.readByte())),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool(),n.readBool(),n.readBool(),n.readBool()&&(n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG()),n.readBool()&&(K=n.readBits(32),X=n.readBits(32),n.readBool()&&(n.readUEG(),n.readBool()))){var $,tt,et=!1;for($=n.readBool(),tt=n.readBool(),($||tt)&&((et=n.readBool())&&(n.readByte(),n.readBits(5),n.readBool(),n.readBits(5)),n.readBits(4),n.readBits(4),et&&n.readBits(4),n.readBits(5),n.readBits(5),n.readBits(5)),E=0;E<=h;E++){var it=n.readBool();Q=it;var nt=!1,rt=1;it||(nt=n.readBool());var ot=!1;if(nt?n.readSEG():ot=n.readBool(),ot||(rt=n.readUEG()+1),$)for(N=0;N<rt;N++)n.readUEG(),n.readUEG(),et&&(n.readUEG(),n.readUEG());if(tt)for(N=0;N<rt;N++)n.readUEG(),n.readUEG(),et&&(n.readUEG(),n.readUEG())}}n.readBool()&&(n.readBool(),n.readBool(),n.readBool(),Z=n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG())}n.readBool();var st="hvc1."+u+".1.L"+A+".B0",at=M-(r+o)*(1===P||2===P?2:1),ht=T-(s+a)*(1===P?2:1),lt=1;return 1!==q&&1!==Y&&(lt=q/Y),n.destroy(),n=null,{codec_mimetype:st,level_string:t.getLevelString(A),profile_idc:u,bit_depth:k+8,ref_frames:1,chroma_format:P,chroma_format_string:t.getChromaFormatString(P),general_level_idc:A,general_profile_space:l,general_tier_flag:c,general_profile_idc:u,general_profile_compatibility_flags_1:d,general_profile_compatibility_flags_2:f,general_profile_compatibility_flags_3:p,general_profile_compatibility_flags_4:m,general_constraint_indicator_flags_1:g,general_constraint_indicator_flags_2:v,general_constraint_indicator_flags_3:y,general_constraint_indicator_flags_4:x,general_constraint_indicator_flags_5:w,general_constraint_indicator_flags_6:b,min_spatial_segmentation_idc:Z,constant_frame_rate:0,chroma_format_idc:P,bit_depth_luma_minus8:k,bit_depth_chroma_minus8:R,frame_rate:{fixed:Q,fps:X/K,fps_den:K,fps_num:X},sar_ratio:{width:q,height:Y},codec_size:{width:at,height:ht},present_size:{width:at*lt,height:ht}}},t.parsePPS=function(e){var i=t._ebsp2rbsp(e),n=new _(i);n.readByte(),n.readByte(),n.readUEG(),n.readUEG(),n.readBool(),n.readBool(),n.readBits(3),n.readBool(),n.readBool(),n.readUEG(),n.readUEG(),n.readSEG(),n.readBool(),n.readBool(),n.readBool()&&n.readUEG(),n.readSEG(),n.readSEG(),n.readBool(),n.readBool(),n.readBool(),n.readBool();var r=n.readBool(),o=n.readBool(),s=1;return o&&r?s=0:o?s=3:r&&(s=2),{parallelismType:s}},t.getChromaFormatString=function(t){switch(t){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},t.getProfileString=function(t){switch(t){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},t.getLevelString=function(t){return(t/30).toFixed(1)},t}();function v(t){return t.byteOffset%2==0&&t.byteLength%2==0}function y(t){return t.byteOffset%4==0&&t.byteLength%4==0}function x(t,e){for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}var w,b=function(t,e){return t.byteLength===e.byteLength&&(y(t)&&y(e)?function(t,e){return x(new Uint32Array(t.buffer,t.byteOffset,t.byteLength/4),new Uint32Array(e.buffer,e.byteOffset,e.byteLength/4))}(t,e):v(t)&&v(e)?function(t,e){return x(new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2))}(t,e):function(t,e){return x(t,e)}(t,e))},A=function(){function t(t,e){this.TAG="FLVDemuxer",this._config=e,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new a.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}()}return t.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},t.probe=function(t){var e=new Uint8Array(t);if(e.byteLength<9)return{needMoreData:!0};var i={match:!1};if(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])return i;var n,r=(4&e[4])>>>2!=0,o=0!=(1&e[4]),s=(n=e)[5]<<24|n[6]<<16|n[7]<<8|n[8];return s<9?i:{match:!0,consumed:s,dataOffset:s,hasAudioTrack:r,hasVideoTrack:o}},t.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(t.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),t.prototype.resetMediaInfo=function(){this._mediaInfo=new a.a},t.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},t.prototype.parseChunks=function(e,i){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new u.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var n=0,r=this._littleEndian;if(0===i){if(!(e.byteLength>13))return 0;n=t.probe(e).dataOffset}for(this._firstParse&&(this._firstParse=!1,i+n!==this._dataOffset&&o.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(s=new DataView(e,n)).getUint32(0,!r)&&o.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),n+=4);n<e.byteLength;){this._dispatch=!0;var s=new DataView(e,n);if(n+11+4>e.byteLength)break;var a=s.getUint8(0),h=16777215&s.getUint32(0,!r);if(n+11+h+4>e.byteLength)break;if(8===a||9===a||18===a){var l=s.getUint8(4),c=s.getUint8(5),d=s.getUint8(6)|c<<8|l<<16|s.getUint8(7)<<24;0!=(16777215&s.getUint32(7,!r))&&o.a.w(this.TAG,"Meet tag which has StreamID != 0!");var f=n+11;switch(a){case 8:this._parseAudioData(e,f,h,d);break;case 9:this._parseVideoData(e,f,h,d,i+n);break;case 18:this._parseScriptData(e,f,h)}var _=s.getUint32(11+h,!r);_!==11+h&&o.a.w(this.TAG,"Invalid PrevTagSize "+_),n+=11+h+4}else o.a.w(this.TAG,"Unsupported tag type "+a+", skipped"),n+=11+h+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),n},t.prototype._parseScriptData=function(t,e,i){var n=f.parseScriptData(t,e,i);if(n.hasOwnProperty("onMetaData")){if(null==n.onMetaData||"object"!=typeof n.onMetaData)return void o.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&o.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=n;var r=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},r)),"boolean"==typeof r.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=r.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof r.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=r.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof r.audiodatarate&&(this._mediaInfo.audioDataRate=r.audiodatarate),"number"==typeof r.videodatarate&&(this._mediaInfo.videoDataRate=r.videodatarate),"number"==typeof r.width&&(this._mediaInfo.width=r.width),"number"==typeof r.height&&(this._mediaInfo.height=r.height),"number"==typeof r.duration){if(!this._durationOverrided){var s=Math.floor(r.duration*this._timescale);this._duration=s,this._mediaInfo.duration=s}}else this._mediaInfo.duration=0;if("number"==typeof r.framerate){var a=Math.floor(1e3*r.framerate);if(a>0){var h=a/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=h,this._referenceFrameRate.fps_num=a,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=h}}if("object"==typeof r.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var l=r.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(l),r.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=r,o.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(n).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},n))},t.prototype._parseKeyframesIndex=function(t){for(var e=[],i=[],n=1;n<t.times.length;n++){var r=this._timestampBase+Math.floor(1e3*t.times[n]);e.push(r),i.push(t.filepositions[n])}return{times:e,filepositions:i}},t.prototype._parseAudioData=function(t,e,i,n){if(i<=1)o.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var r=new DataView(t,e,i).getUint8(0),s=r>>>4;if(2===s||10===s){var a=0,h=(12&r)>>>2;if(h>=0&&h<=4){a=this._flvSoundRateTable[h];var l=1&r,c=this._audioMetadata,u=this._audioTrack;if(c||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(c=this._audioMetadata={}).type="audio",c.id=u.id,c.timescale=this._timescale,c.duration=this._duration,c.audioSampleRate=a,c.channelCount=0===l?1:2),10===s){var d=this._parseAACAudioData(t,e+1,i-1);if(null==d)return;if(0===d.packetType){if(c.config){if(b(d.data.config,c.config))return;o.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var f=d.data;c.audioSampleRate=f.samplingRate,c.channelCount=f.channelCount,c.codec=f.codec,c.originalCodec=f.originalCodec,c.config=f.config,c.refSampleDuration=1024/c.audioSampleRate*c.timescale,o.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",c),(g=this._mediaInfo).audioCodec=c.originalCodec,g.audioSampleRate=c.audioSampleRate,g.audioChannelCount=c.channelCount,g.hasVideo?null!=g.videoCodec&&(g.mimeType='video/x-flv; codecs="'+g.videoCodec+","+g.audioCodec+'"'):g.mimeType='video/x-flv; codecs="'+g.audioCodec+'"',g.isComplete()&&this._onMediaInfo(g)}else if(1===d.packetType){var _=this._timestampBase+n,p={unit:d.data,length:d.data.byteLength,dts:_,pts:_};u.samples.push(p),u.length+=d.data.length}else o.a.e(this.TAG,"Flv: Unsupported AAC data type "+d.packetType)}else if(2===s){if(!c.codec){var g;if(null==(f=this._parseMP3AudioData(t,e+1,i-1,!0)))return;c.audioSampleRate=f.samplingRate,c.channelCount=f.channelCount,c.codec=f.codec,c.originalCodec=f.originalCodec,c.refSampleDuration=1152/c.audioSampleRate*c.timescale,o.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",c),(g=this._mediaInfo).audioCodec=c.codec,g.audioSampleRate=c.audioSampleRate,g.audioChannelCount=c.channelCount,g.audioDataRate=f.bitRate,g.hasVideo?null!=g.videoCodec&&(g.mimeType='video/x-flv; codecs="'+g.videoCodec+","+g.audioCodec+'"'):g.mimeType='video/x-flv; codecs="'+g.audioCodec+'"',g.isComplete()&&this._onMediaInfo(g)}var v=this._parseMP3AudioData(t,e+1,i-1,!1);if(null==v)return;_=this._timestampBase+n;var y={unit:v,length:v.byteLength,dts:_,pts:_};u.samples.push(y),u.length+=v.length}}else this._onError(m.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+h)}else this._onError(m.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s)}},t.prototype._parseAACAudioData=function(t,e,i){if(!(i<=1)){var n={},r=new Uint8Array(t,e,i);return n.packetType=r[0],0===r[0]?n.data=this._parseAACAudioSpecificConfig(t,e+1,i-1):n.data=r.subarray(1),n}o.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},t.prototype._parseAACAudioSpecificConfig=function(t,e,i){var n,r,o=new Uint8Array(t,e,i),s=null,a=0,h=null;if(a=n=o[0]>>>3,(r=(7&o[0])<<1|o[1]>>>7)<0||r>=this._mpegSamplingRates.length)this._onError(m.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var l=this._mpegSamplingRates[r],c=(120&o[1])>>>3;if(!(c<0||c>=8)){5===a&&(h=(7&o[1])<<1|o[2]>>>7,o[2]);var u=self.navigator.userAgent.toLowerCase();return-1!==u.indexOf("firefox")?r>=6?(a=5,s=new Array(4),h=r-3):(a=2,s=new Array(2),h=r):-1!==u.indexOf("android")?(a=2,s=new Array(2),h=r):(a=5,h=r,s=new Array(4),r>=6?h=r-3:1===c&&(a=2,s=new Array(2),h=r)),s[0]=a<<3,s[0]|=(15&r)>>>1,s[1]=(15&r)<<7,s[1]|=(15&c)<<3,5===a&&(s[1]|=(15&h)>>>1,s[2]=(1&h)<<7,s[2]|=8,s[3]=0),{config:s,samplingRate:l,channelCount:c,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+n}}this._onError(m.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},t.prototype._parseMP3AudioData=function(t,e,i,n){if(!(i<4)){this._littleEndian;var r=new Uint8Array(t,e,i),s=null;if(n){if(255!==r[0])return;var a=r[1]>>>3&3,h=(6&r[1])>>1,l=(240&r[2])>>>4,c=(12&r[2])>>>2,u=3!=(r[3]>>>6&3)?2:1,d=0,f=0;switch(a){case 0:d=this._mpegAudioV25SampleRateTable[c];break;case 2:d=this._mpegAudioV20SampleRateTable[c];break;case 3:d=this._mpegAudioV10SampleRateTable[c]}switch(h){case 1:l<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[l]);break;case 2:l<this._mpegAudioL2BitRateTable.length&&(f=this._mpegAudioL2BitRateTable[l]);break;case 3:l<this._mpegAudioL1BitRateTable.length&&(f=this._mpegAudioL1BitRateTable[l])}s={bitRate:f,samplingRate:d,channelCount:u,codec:"mp3",originalCodec:"mp3"}}else s=r;return s}o.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},t.prototype._parseVideoData=function(t,e,i,n,r){if(i<=1)o.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var s=new Uint8Array(t,e,i)[0],a=(112&s)>>>4;if(0!=(128&s)){var h=15&s,l=String.fromCharCode.apply(String,new Uint8Array(t,e,i).slice(1,5));if("hvc1"!==l)return void this._onError(m.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+l);this._parseEnhancedHEVCVideoPacket(t,e+5,i-5,n,r,a,h)}else{var c=15&s;if(7===c)this._parseAVCVideoPacket(t,e+1,i-1,n,r,a);else{if(12!==c)return void this._onError(m.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+c);this._parseHEVCVideoPacket(t,e+1,i-1,n,r,a)}}}},t.prototype._parseAVCVideoPacket=function(t,e,i,n,r,s){if(i<4)o.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var a=this._littleEndian,h=new DataView(t,e,i),l=h.getUint8(0),c=(16777215&h.getUint32(0,!a))<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(t,e+4,i-4);else if(1===l)this._parseAVCVideoData(t,e+4,i-4,n,r,s,c);else if(2!==l)return void this._onError(m.a.FORMAT_ERROR,"Flv: Invalid video packet type "+l)}},t.prototype._parseHEVCVideoPacket=function(t,e,i,n,r,s){if(i<4)o.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var a=this._littleEndian,h=new DataView(t,e,i),l=h.getUint8(0),c=(16777215&h.getUint32(0,!a))<<8>>8;if(0===l)this._parseHEVCDecoderConfigurationRecord(t,e+4,i-4);else if(1===l)this._parseHEVCVideoData(t,e+4,i-4,n,r,s,c);else if(2!==l)return void this._onError(m.a.FORMAT_ERROR,"Flv: Invalid video packet type "+l)}},t.prototype._parseEnhancedHEVCVideoPacket=function(t,e,i,n,r,s,a){if(i<4)o.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var h=this._littleEndian,l=new DataView(t,e,i);if(0===a)this._parseHEVCDecoderConfigurationRecord(t,e,i);else if(1===a){var c=(4294967040&l.getUint32(0,!h))>>8;this._parseHEVCVideoData(t,e+3,i-3,n,r,s,c)}else if(3===a)this._parseHEVCVideoData(t,e,i,n,r,s,0);else if(2!==a)return void this._onError(m.a.FORMAT_ERROR,"Flv: Invalid video packet type "+a)}},t.prototype._parseAVCDecoderConfigurationRecord=function(t,e,i){if(i<7)o.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var n=this._videoMetadata,r=this._videoTrack,s=this._littleEndian,a=new DataView(t,e,i);if(n){if(void 0!==n.avcc){var h=new Uint8Array(t,e,i);if(b(h,n.avcc))return;o.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(n=this._videoMetadata={}).type="video",n.id=r.id,n.timescale=this._timescale,n.duration=this._duration;var l=a.getUint8(0),c=a.getUint8(1);if(a.getUint8(2),a.getUint8(3),1===l&&0!==c)if(this._naluLengthSize=1+(3&a.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var u=31&a.getUint8(5);if(0!==u){u>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+u);for(var d=6,f=0;f<u;f++){var _=a.getUint16(d,!s);if(d+=2,0!==_){var g=new Uint8Array(t,e+d,_);d+=_;var v=p.parseSPS(g);if(0===f){n.codecWidth=v.codec_size.width,n.codecHeight=v.codec_size.height,n.presentWidth=v.present_size.width,n.presentHeight=v.present_size.height,n.profile=v.profile_string,n.level=v.level_string,n.bitDepth=v.bit_depth,n.chromaFormat=v.chroma_format,n.sarRatio=v.sar_ratio,n.frameRate=v.frame_rate,!1!==v.frame_rate.fixed&&0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den||(n.frameRate=this._referenceFrameRate);var y=n.frameRate.fps_den,x=n.frameRate.fps_num;n.refSampleDuration=n.timescale*(y/x);for(var w=g.subarray(1,4),A="avc1.",C=0;C<3;C++){var S=w[C].toString(16);S.length<2&&(S="0"+S),A+=S}n.codec=A;var E=this._mediaInfo;E.width=n.codecWidth,E.height=n.codecHeight,E.fps=n.frameRate.fps,E.profile=n.profile,E.level=n.level,E.refFrames=v.ref_frames,E.chromaFormat=v.chroma_format_string,E.sarNum=n.sarRatio.width,E.sarDen=n.sarRatio.height,E.videoCodec=A,E.hasAudio?null!=E.audioCodec&&(E.mimeType='video/x-flv; codecs="'+E.videoCodec+","+E.audioCodec+'"'):E.mimeType='video/x-flv; codecs="'+E.videoCodec+'"',E.isComplete()&&this._onMediaInfo(E)}}}var P=a.getUint8(d);if(0!==P){for(P>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+P),d++,f=0;f<P;f++)_=a.getUint16(d,!s),d+=2,0!==_&&(d+=_);n.avcc=new Uint8Array(i),n.avcc.set(new Uint8Array(t,e,i),0),o.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",n)}else this._onError(m.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(m.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(m.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(m.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},t.prototype._parseHEVCDecoderConfigurationRecord=function(t,e,i){if(i<22)o.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var n=this._videoMetadata,r=this._videoTrack,s=this._littleEndian,a=new DataView(t,e,i);if(n){if(void 0!==n.hvcc){var h=new Uint8Array(t,e,i);if(b(h,n.hvcc))return;o.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(n=this._videoMetadata={}).type="video",n.id=r.id,n.timescale=this._timescale,n.duration=this._duration;var l=a.getUint8(0),c=31&a.getUint8(1);if(1===l&&0!==c)if(this._naluLengthSize=1+(3&a.getUint8(21)),3===this._naluLengthSize||4===this._naluLengthSize){for(var u=a.getUint8(22),d=0,f=23;d<u;d++){var _=63&a.getUint8(f+0),p=a.getUint16(f+1,!s);f+=3;for(var v=0;v<p;v++){var y=a.getUint16(f+0,!s);if(0===v)if(33===_){f+=2;var x=new Uint8Array(t,e+f,y),w=g.parseSPS(x);n.codecWidth=w.codec_size.width,n.codecHeight=w.codec_size.height,n.presentWidth=w.present_size.width,n.presentHeight=w.present_size.height,n.profile=w.profile_string,n.level=w.level_string,n.bitDepth=w.bit_depth,n.chromaFormat=w.chroma_format,n.sarRatio=w.sar_ratio,n.frameRate=w.frame_rate,!1!==w.frame_rate.fixed&&0!==w.frame_rate.fps_num&&0!==w.frame_rate.fps_den||(n.frameRate=this._referenceFrameRate);var A=n.frameRate.fps_den,C=n.frameRate.fps_num;n.refSampleDuration=n.timescale*(A/C),n.codec=w.codec_mimetype;var S=this._mediaInfo;S.width=n.codecWidth,S.height=n.codecHeight,S.fps=n.frameRate.fps,S.profile=n.profile,S.level=n.level,S.refFrames=w.ref_frames,S.chromaFormat=w.chroma_format_string,S.sarNum=n.sarRatio.width,S.sarDen=n.sarRatio.height,S.videoCodec=w.codec_mimetype,S.hasAudio?null!=S.audioCodec&&(S.mimeType='video/x-flv; codecs="'+S.videoCodec+","+S.audioCodec+'"'):S.mimeType='video/x-flv; codecs="'+S.videoCodec+'"',S.isComplete()&&this._onMediaInfo(S),f+=y}else f+=2+y;else f+=2+y}}n.hvcc=new Uint8Array(i),n.hvcc.set(new Uint8Array(t,e,i),0),o.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",n)}else this._onError(m.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(m.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord")}},t.prototype._parseAVCVideoData=function(t,e,i,n,r,s,a){for(var h=this._littleEndian,l=new DataView(t,e,i),c=[],u=0,d=0,f=this._naluLengthSize,_=this._timestampBase+n,p=1===s;d<i;){if(d+4>=i){o.a.w(this.TAG,"Malformed Nalu near timestamp "+_+", offset = "+d+", dataSize = "+i);break}var m=l.getUint32(d,!h);if(3===f&&(m>>>=8),m>i-f)return void o.a.w(this.TAG,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var g=31&l.getUint8(d+f);5===g&&(p=!0);var v=new Uint8Array(t,e+d,f+m),y={type:g,data:v};c.push(y),u+=v.byteLength,d+=f+m}if(c.length){var x=this._videoTrack,w={units:c,length:u,isKeyframe:p,dts:_,cts:a,pts:_+a};p&&(w.fileposition=r),x.samples.push(w),x.length+=u}},t.prototype._parseHEVCVideoData=function(t,e,i,n,r,s,a){for(var h=this._littleEndian,l=new DataView(t,e,i),c=[],u=0,d=0,f=this._naluLengthSize,_=this._timestampBase+n,p=1===s;d<i;){if(d+4>=i){o.a.w(this.TAG,"Malformed Nalu near timestamp "+_+", offset = "+d+", dataSize = "+i);break}var m=l.getUint32(d,!h);if(3===f&&(m>>>=8),m>i-f)return void o.a.w(this.TAG,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var g=31&l.getUint8(d+f);19!==g&&20!==g||(p=!0);var v=new Uint8Array(t,e+d,f+m),y={type:g,data:v};c.push(y),u+=v.byteLength,d+=f+m}if(c.length){var x=this._videoTrack,w={units:c,length:u,isKeyframe:p,dts:_,cts:a,pts:_+a};p&&(w.fileposition=r),x.samples.push(w),x.length+=u}},t}(),C=function(){function t(){}return t.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},t}();!function(t){t[t.kMPEG1Audio=3]="kMPEG1Audio",t[t.kMPEG2Audio=4]="kMPEG2Audio",t[t.kPESPrivateData=6]="kPESPrivateData",t[t.kADTSAAC=15]="kADTSAAC",t[t.kLOASAAC=17]="kLOASAAC",t[t.kAC3=129]="kAC3",t[t.kID3=21]="kID3",t[t.kSCTE35=134]="kSCTE35",t[t.kH264=27]="kH264",t[t.kH265=36]="kH265"}(w||(w={}));var S,E=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};!function(t){t[t.kUnspecified=0]="kUnspecified",t[t.kSliceNonIDR=1]="kSliceNonIDR",t[t.kSliceDPA=2]="kSliceDPA",t[t.kSliceDPB=3]="kSliceDPB",t[t.kSliceDPC=4]="kSliceDPC",t[t.kSliceIDR=5]="kSliceIDR",t[t.kSliceSEI=6]="kSliceSEI",t[t.kSliceSPS=7]="kSliceSPS",t[t.kSlicePPS=8]="kSlicePPS",t[t.kSliceAUD=9]="kSliceAUD",t[t.kEndOfSequence=10]="kEndOfSequence",t[t.kEndOfStream=11]="kEndOfStream",t[t.kFiller=12]="kFiller",t[t.kSPSExt=13]="kSPSExt",t[t.kReserved0=14]="kReserved0"}(S||(S={}));var P,M,T=function(){},k=function(t){var e=t.data.byteLength;this.type=t.type,this.data=new Uint8Array(4+e),new DataView(this.data.buffer).setUint32(0,e),this.data.set(t.data,4)},R=function(){function t(t){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=t,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return t.prototype.findNextStartCodeOffset=function(t){for(var e=t,i=this.data_;;){if(e+3>=i.byteLength)return this.eof_flag_=!0,i.byteLength;var n=i[e+0]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3],r=i[e+0]<<16|i[e+1]<<8|i[e+2];if(1===n||1===r)return e;e++}},t.prototype.readNextNaluPayload=function(){for(var t=this.data_,e=null;null==e&&!this.eof_flag_;){var i=this.current_startcode_offset_,n=31&t[i+=1==(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])?4:3],r=(128&t[i])>>>7,o=this.findNextStartCodeOffset(i);if(this.current_startcode_offset_=o,!(n>=S.kReserved0)&&0===r){var s=t.subarray(i,o);(e=new T).type=n,e.data=s}}return e},t}(),L=function(){function t(t,e,i){var n=8+t.byteLength+1+2+e.byteLength,r=!1;66!==t[3]&&77!==t[3]&&88!==t[3]&&(r=!0,n+=4);var o=this.data=new Uint8Array(n);o[0]=1,o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=255,o[5]=225;var s=t.byteLength;o[6]=s>>>8,o[7]=255&s;var a=8;o.set(t,8),o[a+=s]=1;var h=e.byteLength;o[a+1]=h>>>8,o[a+2]=255&h,o.set(e,a+3),a+=3+h,r&&(o[a]=252|i.chroma_format_idc,o[a+1]=248|i.bit_depth_luma-8,o[a+2]=248|i.bit_depth_chroma-8,o[a+3]=0,a+=4)}return t.prototype.getData=function(){return this.data},t}();!function(t){t[t.kNull=0]="kNull",t[t.kAACMain=1]="kAACMain",t[t.kAAC_LC=2]="kAAC_LC",t[t.kAAC_SSR=3]="kAAC_SSR",t[t.kAAC_LTP=4]="kAAC_LTP",t[t.kAAC_SBR=5]="kAAC_SBR",t[t.kAAC_Scalable=6]="kAAC_Scalable",t[t.kLayer1=32]="kLayer1",t[t.kLayer2=33]="kLayer2",t[t.kLayer3=34]="kLayer3"}(P||(P={})),function(t){t[t.k96000Hz=0]="k96000Hz",t[t.k88200Hz=1]="k88200Hz",t[t.k64000Hz=2]="k64000Hz",t[t.k48000Hz=3]="k48000Hz",t[t.k44100Hz=4]="k44100Hz",t[t.k32000Hz=5]="k32000Hz",t[t.k24000Hz=6]="k24000Hz",t[t.k22050Hz=7]="k22050Hz",t[t.k16000Hz=8]="k16000Hz",t[t.k12000Hz=9]="k12000Hz",t[t.k11025Hz=10]="k11025Hz",t[t.k8000Hz=11]="k8000Hz",t[t.k7350Hz=12]="k7350Hz"}(M||(M={}));var D,O,I=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],B=(D=function(t,e){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}D(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),j=function(){},z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return B(e,t),e}(j),G=function(){function t(t){this.TAG="AACADTSParser",this.data_=t,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return t.prototype.findNextSyncwordOffset=function(t){for(var e=t,i=this.data_;;){if(e+7>=i.byteLength)return this.eof_flag_=!0,i.byteLength;if(4095==(i[e+0]<<8|i[e+1])>>>4)return e;e++}},t.prototype.readNextAACFrame=function(){for(var t=this.data_,e=null;null==e&&!this.eof_flag_;){var i=this.current_syncword_offset_,n=(8&t[i+1])>>>3,r=(6&t[i+1])>>>1,o=1&t[i+1],s=(192&t[i+2])>>>6,a=(60&t[i+2])>>>2,h=(1&t[i+2])<<2|(192&t[i+3])>>>6,l=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>>5;if(t[i+6],i+l>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var c=1===o?7:9,u=l-c;i+=c;var d=this.findNextSyncwordOffset(i+u);if(this.current_syncword_offset_=d,(0===n||1===n)&&0===r){var f=t.subarray(i,i+u);(e=new j).audio_object_type=s+1,e.sampling_freq_index=a,e.sampling_frequency=I[a],e.channel_config=h,e.data=f}}return e},t.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},t.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},t}(),N=function(){function t(t){this.TAG="AACLOASParser",this.data_=t,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return t.prototype.findNextSyncwordOffset=function(t){for(var e=t,i=this.data_;;){if(e+1>=i.byteLength)return this.eof_flag_=!0,i.byteLength;if(695==(i[e+0]<<3|i[e+1]>>>5))return e;e++}},t.prototype.getLATMValue=function(t){for(var e=t.readBits(2),i=0,n=0;n<=e;n++)i<<=8,i|=t.readByte();return i},t.prototype.readNextAACFrame=function(t){for(var e=this.data_,i=null;null==i&&!this.eof_flag_;){var n=this.current_syncword_offset_,r=(31&e[n+1])<<8|e[n+2];if(n+3+r>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var s=new _(e.subarray(n+3,n+3+r)),a=null;if(s.readBool()){if(null==t){o.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(n+3+r),s.destroy();continue}a=t}else{var h=s.readBool();if(h&&s.readBool()){o.a.e(this.TAG,"audioMuxVersionA is Not Supported"),s.destroy();break}if(h&&this.getLATMValue(s),!s.readBool()){o.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),s.destroy();break}if(0!==s.readBits(6)){o.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),s.destroy();break}if(0!==s.readBits(4)){o.a.e(this.TAG,"more than 2 numProgram Not Supported"),s.destroy();break}if(0!==s.readBits(3)){o.a.e(this.TAG,"more than 2 numLayer Not Supported"),s.destroy();break}var l=h?this.getLATMValue(s):0,c=s.readBits(5);l-=5;var u=s.readBits(4);l-=4;var d=s.readBits(4);l-=4,s.readBits(3),(l-=3)>0&&s.readBits(l);var f=s.readBits(3);if(0!==f){o.a.e(this.TAG,"frameLengthType = "+f+". Only frameLengthType = 0 Supported"),s.destroy();break}s.readByte();var p=s.readBool();if(p)if(h)this.getLATMValue(s);else{for(var m=0;;){m<<=8;var g=s.readBool();if(m+=s.readByte(),!g)break}console.log(m)}s.readBool()&&s.readByte(),(a=new z).audio_object_type=c,a.sampling_freq_index=u,a.sampling_frequency=I[a.sampling_freq_index],a.channel_config=d,a.other_data_present=p}for(var v=0;;){var y=s.readByte();if(v+=y,255!==y)break}for(var x=new Uint8Array(v),w=0;w<v;w++)x[w]=s.readByte();(i=new z).audio_object_type=a.audio_object_type,i.sampling_freq_index=a.sampling_freq_index,i.sampling_frequency=I[a.sampling_freq_index],i.channel_config=a.channel_config,i.other_data_present=a.other_data_present,i.data=x,this.current_syncword_offset_=this.findNextSyncwordOffset(n+3+r)}return i},t.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},t.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},t}(),F=function(){};!function(t){t[t.kSpliceNull=0]="kSpliceNull",t[t.kSpliceSchedule=4]="kSpliceSchedule",t[t.kSpliceInsert=5]="kSpliceInsert",t[t.kTimeSignal=6]="kTimeSignal",t[t.kBandwidthReservation=7]="kBandwidthReservation",t[t.kPrivateCommand=255]="kPrivateCommand"}(O||(O={}));var U,H=function(t){var e=t.readBool();return e?(t.readBits(6),{time_specified_flag:e,pts_time:4*t.readBits(31)+t.readBits(2)}):(t.readBits(7),{time_specified_flag:e})},V=function(t){var e=t.readBool();return t.readBits(6),{auto_return:e,duration:4*t.readBits(31)+t.readBits(2)}},W=function(t,e){var i=e.readBits(8);return t?{component_tag:i}:{component_tag:i,splice_time:H(e)}},Z=function(t){return{component_tag:t.readBits(8),utc_splice_time:t.readBits(32)}},q=function(t){var e=t.readBits(32),i=t.readBool();t.readBits(7);var n={splice_event_id:e,splice_event_cancel_indicator:i};if(i)return n;if(n.out_of_network_indicator=t.readBool(),n.program_splice_flag=t.readBool(),n.duration_flag=t.readBool(),t.readBits(5),n.program_splice_flag)n.utc_splice_time=t.readBits(32);else{n.component_count=t.readBits(8),n.components=[];for(var r=0;r<n.component_count;r++)n.components.push(Z(t))}return n.duration_flag&&(n.break_duration=V(t)),n.unique_program_id=t.readBits(16),n.avail_num=t.readBits(8),n.avails_expected=t.readBits(8),n},Y=function(t,e,i,n){return{descriptor_tag:t,descriptor_length:e,identifier:i,provider_avail_id:n.readBits(32)}},Q=function(t,e,i,n){var r=n.readBits(8),o=n.readBits(3);n.readBits(5);for(var s="",a=0;a<o;a++)s+=String.fromCharCode(n.readBits(8));return{descriptor_tag:t,descriptor_length:e,identifier:i,preroll:r,dtmf_count:o,DTMF_char:s}},K=function(t){var e=t.readBits(8);return t.readBits(7),{component_tag:e,pts_offset:4*t.readBits(31)+t.readBits(2)}},X=function(t,e,i,n){var r=n.readBits(32),o=n.readBool();n.readBits(7);var s={descriptor_tag:t,descriptor_length:e,identifier:i,segmentation_event_id:r,segmentation_event_cancel_indicator:o};if(o)return s;if(s.program_segmentation_flag=n.readBool(),s.segmentation_duration_flag=n.readBool(),s.delivery_not_restricted_flag=n.readBool(),s.delivery_not_restricted_flag?n.readBits(5):(s.web_delivery_allowed_flag=n.readBool(),s.no_regional_blackout_flag=n.readBool(),s.archive_allowed_flag=n.readBool(),s.device_restrictions=n.readBits(2)),!s.program_segmentation_flag){s.component_count=n.readBits(8),s.components=[];for(var a=0;a<s.component_count;a++)s.components.push(K(n))}s.segmentation_duration_flag&&(s.segmentation_duration=n.readBits(40)),s.segmentation_upid_type=n.readBits(8),s.segmentation_upid_length=n.readBits(8);var h=new Uint8Array(s.segmentation_upid_length);for(a=0;a<s.segmentation_upid_length;a++)h[a]=n.readBits(8);return s.segmentation_upid=h.buffer,s.segmentation_type_id=n.readBits(8),s.segment_num=n.readBits(8),s.segments_expected=n.readBits(8),52!==s.segmentation_type_id&&54!==s.segmentation_type_id&&56!==s.segmentation_type_id&&58!==s.segmentation_type_id||(s.sub_segment_num=n.readBits(8),s.sub_segments_expected=n.readBits(8)),s},J=function(t,e,i,n){return{descriptor_tag:t,descriptor_length:e,identifier:i,TAI_seconds:n.readBits(48),TAI_ns:n.readBits(32),UTC_offset:n.readBits(16)}},$=function(t){return{component_tag:t.readBits(8),ISO_code:String.fromCharCode(t.readBits(8),t.readBits(8),t.readBits(8)),Bit_Stream_Mode:t.readBits(3),Num_Channels:t.readBits(4),Full_Srvc_Audio:t.readBool()}},tt=function(t,e,i,n){for(var r=n.readBits(4),o=[],s=0;s<r;s++)o.push($(n));return{descriptor_tag:t,descriptor_length:e,identifier:i,audio_count:r,components:o}};!function(t){t[t.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",t[t.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",t[t.kSliceCRA_NUT=21]="kSliceCRA_NUT",t[t.kSliceVPS=32]="kSliceVPS",t[t.kSliceSPS=33]="kSliceSPS",t[t.kSlicePPS=34]="kSlicePPS",t[t.kSliceAUD=35]="kSliceAUD"}(U||(U={}));var et=function(){},it=function(t){var e=t.data.byteLength;this.type=t.type,this.data=new Uint8Array(4+e),new DataView(this.data.buffer).setUint32(0,e),this.data.set(t.data,4)},nt=function(){function t(t){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=t,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return t.prototype.findNextStartCodeOffset=function(t){for(var e=t,i=this.data_;;){if(e+3>=i.byteLength)return this.eof_flag_=!0,i.byteLength;var n=i[e+0]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3],r=i[e+0]<<16|i[e+1]<<8|i[e+2];if(1===n||1===r)return e;e++}},t.prototype.readNextNaluPayload=function(){for(var t=this.data_,e=null;null==e&&!this.eof_flag_;){var i=this.current_startcode_offset_,n=t[i+=1==(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])?4:3]>>1&63,r=(128&t[i])>>>7,o=this.findNextStartCodeOffset(i);if(this.current_startcode_offset_=o,0===r){var s=t.subarray(i,o);(e=new et).type=n,e.data=s}}return e},t}(),rt=function(){function t(t,e,i,n){var r=23+(5+t.byteLength)+(5+e.byteLength)+(5+i.byteLength),o=this.data=new Uint8Array(r);o[0]=1,o[1]=(3&n.general_profile_space)<<6|(n.general_tier_flag?1:0)<<5|31&n.general_profile_idc,o[2]=n.general_profile_compatibility_flags_1,o[3]=n.general_profile_compatibility_flags_2,o[4]=n.general_profile_compatibility_flags_3,o[5]=n.general_profile_compatibility_flags_4,o[6]=n.general_constraint_indicator_flags_1,o[7]=n.general_constraint_indicator_flags_2,o[8]=n.general_constraint_indicator_flags_3,o[9]=n.general_constraint_indicator_flags_4,o[10]=n.general_constraint_indicator_flags_5,o[11]=n.general_constraint_indicator_flags_6,o[12]=n.general_level_idc,o[13]=240|(3840&n.min_spatial_segmentation_idc)>>8,o[14]=255&n.min_spatial_segmentation_idc,o[15]=252|3&n.parallelismType,o[16]=252|3&n.chroma_format_idc,o[17]=248|7&n.bit_depth_luma_minus8,o[18]=248|7&n.bit_depth_chroma_minus8,o[19]=0,o[20]=0,o[21]=(3&n.constant_frame_rate)<<6|(7&n.num_temporal_layers)<<3|(n.temporal_id_nested?1:0)<<2|3,o[22]=3,o[23]=128|U.kSliceVPS,o[24]=0,o[25]=1,o[26]=(65280&t.byteLength)>>8,o[27]=(255&t.byteLength)>>0,o.set(t,28),o[23+(5+t.byteLength)+0]=128|U.kSliceSPS,o[23+(5+t.byteLength)+1]=0,o[23+(5+t.byteLength)+2]=1,o[23+(5+t.byteLength)+3]=(65280&e.byteLength)>>8,o[23+(5+t.byteLength)+4]=(255&e.byteLength)>>0,o.set(e,23+(5+t.byteLength)+5),o[23+(5+t.byteLength+5+e.byteLength)+0]=128|U.kSlicePPS,o[23+(5+t.byteLength+5+e.byteLength)+1]=0,o[23+(5+t.byteLength+5+e.byteLength)+2]=1,o[23+(5+t.byteLength+5+e.byteLength)+3]=(65280&i.byteLength)>>8,o[23+(5+t.byteLength+5+e.byteLength)+4]=(255&i.byteLength)>>0,o.set(i,23+(5+t.byteLength+5+e.byteLength)+5)}return t.prototype.getData=function(){return this.data},t}(),ot=function(){},st=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],at=function(){function t(t){this.TAG="AC3Parser",this.data_=t,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return t.prototype.findNextSyncwordOffset=function(t){for(var e=t,i=this.data_;;){if(e+7>=i.byteLength)return this.eof_flag_=!0,i.byteLength;if(2935==(i[e+0]<<8|i[e+1]<<0))return e;e++}},t.prototype.readNextAC3Frame=function(){for(var t=this.data_,e=null;null==e&&!this.eof_flag_;){var i=this.current_syncword_offset_,n=t[i+4]>>6,r=[48e3,44200,33e3][n],o=63&t[i+4],s=2*st[n][o];if(i+s>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var a=this.findNextSyncwordOffset(i+s);this.current_syncword_offset_=a;var h=t[i+5]>>3,l=7&t[i+5],c=t[i+6]>>5,u=0;0!=(1&c)&&1!==c&&(u+=2),0!=(4&c)&&(u+=2),2===c&&(u+=2);var d=(t[i+6]<<8|t[i+7]<<0)>>12-u&1,f=[2,1,2,3,3,4,4,5][c]+d;(e=new ot).sampling_frequency=r,e.channel_count=f,e.channel_mode=c,e.bit_stream_identification=h,e.low_frequency_effects_channel_on=d,e.bit_stream_mode=l,e.frame_size_code=o,e.data=t.subarray(i,i+s)}return e},t.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},t.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},t}(),ht=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),lt=function(){return(lt=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},ct=function(t){function e(e,i){var n=t.call(this)||this;return n.TAG="TSDemuxer",n.first_parse_=!0,n.media_info_=new a.a,n.timescale_=90,n.duration_=0,n.current_pmt_pid_=-1,n.program_pmt_map_={},n.pes_slice_queues_={},n.section_slice_queues_={},n.video_metadata_={vps:void 0,sps:void 0,pps:void 0,details:void 0},n.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},n.aac_last_sample_pts_=void 0,n.aac_last_incomplete_data_=null,n.has_video_=!1,n.has_audio_=!1,n.video_init_segment_dispatched_=!1,n.audio_init_segment_dispatched_=!1,n.video_metadata_changed_=!1,n.audio_metadata_changed_=!1,n.loas_previous_frame=null,n.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},n.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},n.ts_packet_size_=e.ts_packet_size,n.sync_offset_=e.sync_offset,n.config_=i,n}return ht(e,t),e.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,t.prototype.destroy.call(this)},e.probe=function(t){var e=new Uint8Array(t),i=-1,n=188;if(e.byteLength<=3*n)return{needMoreData:!0};for(;-1===i;){for(var r=Math.min(1e3,e.byteLength-3*n),s=0;s<r;){if(71===e[s]&&71===e[s+n]&&71===e[s+2*n]){i=s;break}s++}if(-1===i)if(188===n)n=192;else{if(192!==n)break;n=204}}return-1===i?{match:!1}:(192===n&&i>=4?(o.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),i-=4):204===n&&o.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:n,sync_offset:i})},e.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},e.prototype.resetMediaInfo=function(){this.media_info_=new a.a},e.prototype.parseChunks=function(t,e){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new u.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0;for(this.first_parse_&&(this.first_parse_=!1,i=this.sync_offset_);i+this.ts_packet_size_<=t.byteLength;){var n=e+i;192===this.ts_packet_size_&&(i+=4);var r=new Uint8Array(t,i,188),s=r[0];if(71!==s){o.a.e(this.TAG,"sync_byte = "+s+", not 0x47");break}var a=(64&r[1])>>>6,h=(r[1],(31&r[1])<<8|r[2]),l=(48&r[3])>>>4,c=15&r[3],d={},f=4;if(2==l||3==l){var _=r[4];if(5+_===188){i+=188,204===this.ts_packet_size_&&(i+=16);continue}_>0&&(d=this.parseAdaptationField(t,i+4,1+_)),f=5+_}if(1==l||3==l)if(0===h||h===this.current_pmt_pid_||null!=this.pmt_&&this.pmt_.pid_stream_type[h]===w.kSCTE35){var p=188-f;this.handleSectionSlice(t,i+f,p,{pid:h,file_position:n,payload_unit_start_indicator:a,continuity_conunter:c,random_access_indicator:d.random_access_indicator})}else if(null!=this.pmt_&&null!=this.pmt_.pid_stream_type[h]){p=188-f;var m=this.pmt_.pid_stream_type[h];h!==this.pmt_.common_pids.h264&&h!==this.pmt_.common_pids.h265&&h!==this.pmt_.common_pids.adts_aac&&h!==this.pmt_.common_pids.loas_aac&&h!==this.pmt_.common_pids.ac3&&h!==this.pmt_.common_pids.opus&&h!==this.pmt_.common_pids.mp3&&!0!==this.pmt_.pes_private_data_pids[h]&&!0!==this.pmt_.timed_id3_pids[h]||this.handlePESSlice(t,i+f,p,{pid:h,stream_type:m,file_position:n,payload_unit_start_indicator:a,continuity_conunter:c,random_access_indicator:d.random_access_indicator})}i+=188,204===this.ts_packet_size_&&(i+=16)}return this.dispatchAudioVideoMediaSegment(),i},e.prototype.parseAdaptationField=function(t,e,i){var n=new Uint8Array(t,e,i),r=n[0];return r>0?r>183?(o.a.w(this.TAG,"Illegal adaptation_field_length: "+r),{}):{discontinuity_indicator:(128&n[1])>>>7,random_access_indicator:(64&n[1])>>>6,elementary_stream_priority_indicator:(32&n[1])>>>5}:{}},e.prototype.handleSectionSlice=function(t,e,i,n){var r=new Uint8Array(t,e,i),o=this.section_slice_queues_[n.pid];if(n.payload_unit_start_indicator){var s=r[0];if(null!=o&&0!==o.total_length){var a=new Uint8Array(t,e+1,Math.min(i,s));o.slices.push(a),o.total_length+=a.byteLength,o.total_length===o.expected_length?this.emitSectionSlices(o,n):this.clearSlices(o,n)}for(var h=1+s;h<r.byteLength&&255!==r[h+0];){var l=(15&r[h+1])<<8|r[h+2];this.section_slice_queues_[n.pid]=new E,(o=this.section_slice_queues_[n.pid]).expected_length=l+3,o.file_position=n.file_position,o.random_access_indicator=n.random_access_indicator,a=new Uint8Array(t,e+h,Math.min(i-h,o.expected_length-o.total_length)),o.slices.push(a),o.total_length+=a.byteLength,o.total_length===o.expected_length?this.emitSectionSlices(o,n):o.total_length>=o.expected_length&&this.clearSlices(o,n),h+=a.byteLength}}else null!=o&&0!==o.total_length&&(a=new Uint8Array(t,e,Math.min(i,o.expected_length-o.total_length)),o.slices.push(a),o.total_length+=a.byteLength,o.total_length===o.expected_length?this.emitSectionSlices(o,n):o.total_length>=o.expected_length&&this.clearSlices(o,n))},e.prototype.handlePESSlice=function(t,e,i,n){var r=new Uint8Array(t,e,i),s=r[0]<<16|r[1]<<8|r[2],a=(r[3],r[4]<<8|r[5]);if(n.payload_unit_start_indicator){if(1!==s)return void o.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value "+s);var h=this.pes_slice_queues_[n.pid];h&&(0===h.expected_length||h.expected_length===h.total_length?this.emitPESSlices(h,n):this.clearSlices(h,n)),this.pes_slice_queues_[n.pid]=new E,this.pes_slice_queues_[n.pid].file_position=n.file_position,this.pes_slice_queues_[n.pid].random_access_indicator=n.random_access_indicator}if(null!=this.pes_slice_queues_[n.pid]){var l=this.pes_slice_queues_[n.pid];l.slices.push(r),n.payload_unit_start_indicator&&(l.expected_length=0===a?0:a+6),l.total_length+=r.byteLength,l.expected_length>0&&l.expected_length===l.total_length?this.emitPESSlices(l,n):l.expected_length>0&&l.expected_length<l.total_length&&this.clearSlices(l,n)}},e.prototype.emitSectionSlices=function(t,e){for(var i=new Uint8Array(t.total_length),n=0,r=0;n<t.slices.length;n++){var o=t.slices[n];i.set(o,r),r+=o.byteLength}t.slices=[],t.expected_length=-1,t.total_length=0;var s=new function(){};s.pid=e.pid,s.data=i,s.file_position=t.file_position,s.random_access_indicator=t.random_access_indicator,this.parseSection(s)},e.prototype.emitPESSlices=function(t,e){for(var i=new Uint8Array(t.total_length),n=0,r=0;n<t.slices.length;n++){var o=t.slices[n];i.set(o,r),r+=o.byteLength}t.slices=[],t.expected_length=-1,t.total_length=0;var s=new function(){};s.pid=e.pid,s.data=i,s.stream_type=e.stream_type,s.file_position=t.file_position,s.random_access_indicator=t.random_access_indicator,this.parsePES(s)},e.prototype.clearSlices=function(t,e){t.slices=[],t.expected_length=-1,t.total_length=0},e.prototype.parseSection=function(t){var e=t.data,i=t.pid;0===i?this.parsePAT(e):i===this.current_pmt_pid_?this.parsePMT(e):null!=this.pmt_&&this.pmt_.scte_35_pids[i]&&this.parseSCTE35(e)},e.prototype.parsePES=function(t){var e=t.data,i=e[0]<<16|e[1]<<8|e[2],n=e[3],r=e[4]<<8|e[5];if(1===i)if(188!==n&&190!==n&&191!==n&&240!==n&&241!==n&&255!==n&&242!==n&&248!==n){e[6];var s=(192&e[7])>>>6,a=e[8],h=void 0,l=void 0;2!==s&&3!==s||(h=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,l=3===s?536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2:h);var c=9+a,u=void 0;if(0!==r){if(r<3+a)return void o.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");u=r-3-a}else u=e.byteLength-c;var d=e.subarray(c,c+u);switch(t.stream_type){case w.kMPEG1Audio:case w.kMPEG2Audio:this.parseMP3Payload(d,h);break;case w.kPESPrivateData:this.pmt_.common_pids.opus===t.pid?this.parseOpusPayload(d,h):this.pmt_.common_pids.ac3===t.pid?this.parseAC3Payload(d,h):this.pmt_.smpte2038_pids[t.pid]?this.parseSMPTE2038MetadataPayload(d,h,l,t.pid,n):this.parsePESPrivateDataPayload(d,h,l,t.pid,n);break;case w.kADTSAAC:this.parseADTSAACPayload(d,h);break;case w.kLOASAAC:this.parseLOASAACPayload(d,h);break;case w.kAC3:this.parseAC3Payload(d,h);break;case w.kID3:this.parseTimedID3MetadataPayload(d,h,l,t.pid,n);break;case w.kH264:this.parseH264Payload(d,h,l,t.file_position,t.random_access_indicator);break;case w.kH265:this.parseH265Payload(d,h,l,t.file_position,t.random_access_indicator)}}else 188!==n&&191!==n&&240!==n&&241!==n&&255!==n&&242!==n&&248!==n||t.stream_type!==w.kPESPrivateData||(c=6,u=void 0,u=0!==r?r:e.byteLength-c,d=e.subarray(c,c+u),this.parsePESPrivateDataPayload(d,void 0,void 0,t.pid,n));else o.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value "+i)},e.prototype.parsePAT=function(t){var e=t[0];if(0===e){var i=(15&t[1])<<8|t[2],n=(t[3],t[4],(62&t[5])>>>1),r=1&t[5],s=t[6],a=(t[7],null);if(1===r&&0===s)(a=new function(){this.program_pmt_pid={}}).version_number=n;else if(null==(a=this.pat_))return;for(var h=i-5-4,l=-1,c=-1,u=8;u<8+h;u+=4){var d=t[u]<<8|t[u+1],f=(31&t[u+2])<<8|t[u+3];0===d?a.network_pid=f:(a.program_pmt_pid[d]=f,-1===l&&(l=d),-1===c&&(c=f))}1===r&&0===s&&(null==this.pat_&&o.a.v(this.TAG,"Parsed first PAT: "+JSON.stringify(a)),this.pat_=a,this.current_program_=l,this.current_pmt_pid_=c)}else o.a.e(this.TAG,"parsePAT: table_id "+e+" is not corresponded to PAT!")},e.prototype.parsePMT=function(t){var e=t[0];if(2===e){var i=(15&t[1])<<8|t[2],n=t[3]<<8|t[4],r=(62&t[5])>>>1,s=1&t[5],a=t[6],h=(t[7],null);if(1===s&&0===a)(h=new function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.scte_35_pids={},this.smpte2038_pids={}}).program_number=n,h.version_number=r,this.program_pmt_map_[n]=h;else if(null==(h=this.program_pmt_map_[n]))return;t[8],t[9];for(var l=(15&t[10])<<8|t[11],c=12+l,u=i-9-l-4,d=c;d<c+u;){var f=t[d],_=(31&t[d+1])<<8|t[d+2],p=(15&t[d+3])<<8|t[d+4];h.pid_stream_type[_]=f;var m=h.common_pids.h264||h.common_pids.h265,g=h.common_pids.adts_aac||h.common_pids.loas_aac||h.common_pids.ac3||h.common_pids.opus||h.common_pids.mp3;if(f!==w.kH264||m)if(f!==w.kH265||m)if(f!==w.kADTSAAC||g)if(f!==w.kLOASAAC||g)if(f!==w.kAC3||g)if(f!==w.kMPEG1Audio&&f!==w.kMPEG2Audio||g)if(f===w.kPESPrivateData){if(h.pes_private_data_pids[_]=!0,p>0){for(var v=d+5;v<d+5+p;){var y=t[v+0],x=t[v+1];if(5===y){var b=String.fromCharCode.apply(String,Array.from(t.subarray(v+2,v+2+x)));"VANC"===b?h.smpte2038_pids[_]=!0:"Opus"===b&&(h.common_pids.opus=_)}else if(127===y&&_===h.common_pids.opus){var A=null;if(128===t[v+2]&&(A=t[v+3]),null==A){o.a.e(this.TAG,"Not Supported Opus channel count.");continue}var C={codec:"opus",channel_count:0==(15&A)?2:15&A,channel_config_code:A,sample_rate:48e3},S={codec:"opus",meta:C};0==this.audio_init_segment_dispatched_?(this.audio_metadata_=C,this.dispatchAudioInitSegment(S)):this.detectAudioMetadataChange(S)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(S))}v+=2+x}var E=t.subarray(d+5,d+5+p);this.dispatchPESPrivateDataDescriptor(_,f,E)}}else f===w.kID3?h.timed_id3_pids[_]=!0:f===w.kSCTE35&&(h.scte_35_pids[_]=!0);else h.common_pids.mp3=_;else h.common_pids.ac3=_;else h.common_pids.loas_aac=_;else h.common_pids.adts_aac=_;else h.common_pids.h265=_;else h.common_pids.h264=_;d+=5+p}n===this.current_program_&&(null==this.pmt_&&o.a.v(this.TAG,"Parsed first PMT: "+JSON.stringify(h)),this.pmt_=h,(h.common_pids.h264||h.common_pids.h265)&&(this.has_video_=!0),(h.common_pids.adts_aac||h.common_pids.loas_aac||h.common_pids.ac3||h.common_pids.opus||h.common_pids.mp3)&&(this.has_audio_=!0))}else o.a.e(this.TAG,"parsePMT: table_id "+e+" is not corresponded to PMT!")},e.prototype.parseSCTE35=function(t){var e=function(t){var e=new _(t),i=e.readBits(8),n=e.readBool(),r=e.readBool();e.readBits(2);var o=e.readBits(12),s=e.readBits(8),a=e.readBool(),h=e.readBits(6),l=4*e.readBits(31)+e.readBits(2),c=e.readBits(8),u=e.readBits(12),d=e.readBits(12),f=e.readBits(8),p=null;f===O.kSpliceNull?p={}:f===O.kSpliceSchedule?p=function(t){for(var e=t.readBits(8),i=[],n=0;n<e;n++)i.push(q(t));return{splice_count:e,events:i}}(e):f===O.kSpliceInsert?p=function(t){var e=t.readBits(32),i=t.readBool();t.readBits(7);var n={splice_event_id:e,splice_event_cancel_indicator:i};if(i)return n;if(n.out_of_network_indicator=t.readBool(),n.program_splice_flag=t.readBool(),n.duration_flag=t.readBool(),n.splice_immediate_flag=t.readBool(),t.readBits(4),n.program_splice_flag&&!n.splice_immediate_flag&&(n.splice_time=H(t)),!n.program_splice_flag){n.component_count=t.readBits(8),n.components=[];for(var r=0;r<n.component_count;r++)n.components.push(W(n.splice_immediate_flag,t))}return n.duration_flag&&(n.break_duration=V(t)),n.unique_program_id=t.readBits(16),n.avail_num=t.readBits(8),n.avails_expected=t.readBits(8),n}(e):f===O.kTimeSignal?p={splice_time:H(e)}:f===O.kBandwidthReservation?p={}:f===O.kPrivateCommand?p=function(t,e){for(var i=String.fromCharCode(e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)),n=new Uint8Array(t-4),r=0;r<t-4;r++)n[r]=e.readBits(8);return{identifier:i,private_data:n.buffer}}(d,e):e.readBits(8*d);for(var m=[],g=e.readBits(16),v=0;v<g;){var y=e.readBits(8),x=e.readBits(8),w=String.fromCharCode(e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8));0===y?m.push(Y(y,x,w,e)):1===y?m.push(Q(y,x,w,e)):2===y?m.push(X(y,x,w,e)):3===y?m.push(J(y,x,w,e)):4===y?m.push(tt(y,x,w,e)):e.readBits(8*(x-4)),v+=2+x}var b={table_id:i,section_syntax_indicator:n,private_indicator:r,section_length:o,protocol_version:s,encrypted_packet:a,encryption_algorithm:h,pts_adjustment:l,cw_index:c,tier:u,splice_command_length:d,splice_command_type:f,splice_command:p,descriptor_loop_length:g,splice_descriptors:m,E_CRC32:a?e.readBits(32):void 0,CRC32:e.readBits(32)};if(f===O.kSpliceInsert){var A=p;if(A.splice_event_cancel_indicator)return{splice_command_type:f,detail:b,data:t};if(A.program_splice_flag&&!A.splice_immediate_flag){var C=A.duration_flag?A.break_duration.auto_return:void 0,S=A.duration_flag?A.break_duration.duration/90:void 0;return A.splice_time.time_specified_flag?{splice_command_type:f,pts:(l+A.splice_time.pts_time)%Math.pow(2,33),auto_return:C,duraiton:S,detail:b,data:t}:{splice_command_type:f,auto_return:C,duraiton:S,detail:b,data:t}}return{splice_command_type:f,auto_return:C=A.duration_flag?A.break_duration.auto_return:void 0,duraiton:S=A.duration_flag?A.break_duration.duration/90:void 0,detail:b,data:t}}if(f===O.kTimeSignal){var E=p;return E.splice_time.time_specified_flag?{splice_command_type:f,pts:(l+E.splice_time.pts_time)%Math.pow(2,33),detail:b,data:t}:{splice_command_type:f,detail:b,data:t}}return{splice_command_type:f,detail:b,data:t}}(t);if(null!=e.pts){var i=Math.floor(e.pts/this.timescale_);e.pts=i}else e.nearest_pts=this.aac_last_sample_pts_;this.onSCTE35Metadata&&this.onSCTE35Metadata(e)},e.prototype.parseH264Payload=function(t,e,i,n,r){for(var s=new R(t),a=null,h=[],l=0,c=!1;null!=(a=s.readNextNaluPayload());){var u=new k(a);if(u.type===S.kSliceSPS){var d=p.parseSPS(a.data);this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(u,d)&&(o.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:u,pps:void 0,details:d}):(this.video_metadata_.sps=u,this.video_metadata_.details=d)}else u.type===S.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=u,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(u.type===S.kSliceIDR||u.type===S.kSliceNonIDR&&1===r)&&(c=!0);this.video_init_segment_dispatched_&&(h.push(u),l+=u.data.byteLength)}var f=Math.floor(e/this.timescale_),_=Math.floor(i/this.timescale_);if(h.length){var m=this.video_track_,g={units:h,length:l,isKeyframe:c,dts:_,pts:f,cts:f-_,file_position:n};m.samples.push(g),m.length+=l}},e.prototype.parseH265Payload=function(t,e,i,n,r){for(var s=new nt(t),a=null,h=[],l=0,c=!1;null!=(a=s.readNextNaluPayload());){var u=new it(a);if(u.type===U.kSliceVPS){if(!this.video_init_segment_dispatched_){var d=g.parseVPS(a.data);this.video_metadata_.vps=u,this.video_metadata_.details=lt(lt({},this.video_metadata_.details),d)}}else u.type===U.kSliceSPS?(d=g.parseSPS(a.data),this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(u,d)&&(o.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:u,pps:void 0,details:d}):(this.video_metadata_.sps=u,this.video_metadata_.details=lt(lt({},this.video_metadata_.details),d))):u.type===U.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(d=g.parsePPS(a.data),this.video_metadata_.pps=u,this.video_metadata_.details=lt(lt({},this.video_metadata_.details),d),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):u.type!==U.kSliceIDR_W_RADL&&u.type!==U.kSliceIDR_N_LP&&u.type!==U.kSliceCRA_NUT||(c=!0);this.video_init_segment_dispatched_&&(h.push(u),l+=u.data.byteLength)}var f=Math.floor(e/this.timescale_),_=Math.floor(i/this.timescale_);if(h.length){var p=this.video_track_,m={units:h,length:l,isKeyframe:c,dts:_,pts:f,cts:f-_,file_position:n};p.samples.push(m),p.length+=l}},e.prototype.detectVideoMetadataChange=function(t,e){if(e.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return o.a.v(this.TAG,"Video: Codec mimeType changed from "+this.video_metadata_.details.codec_mimetype+" to "+e.codec_mimetype),!0;if(e.codec_size.width!==this.video_metadata_.details.codec_size.width||e.codec_size.height!==this.video_metadata_.details.codec_size.height){var i=this.video_metadata_.details.codec_size,n=e.codec_size;return o.a.v(this.TAG,"Video: Coded Resolution changed from "+i.width+"x"+i.height+" to "+n.width+"x"+n.height),!0}return e.present_size.width!==this.video_metadata_.details.present_size.width&&(o.a.v(this.TAG,"Video: Present resolution width changed from "+this.video_metadata_.details.present_size.width+" to "+e.present_size.width),!0)},e.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},e.prototype.dispatchVideoInitSegment=function(){var t=this.video_metadata_.details,e={type:"video"};e.id=this.video_track_.id,e.timescale=1e3,e.duration=this.duration_,e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height,e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.sarRatio=t.sar_ratio,e.frameRate=t.frame_rate;var i=e.frameRate.fps_den,n=e.frameRate.fps_num;if(e.refSampleDuration=i/n*1e3,e.codec=t.codec_mimetype,this.video_metadata_.vps){var r=this.video_metadata_.vps.data.subarray(4),s=this.video_metadata_.sps.data.subarray(4),a=this.video_metadata_.pps.data.subarray(4),h=new rt(r,s,a,t);e.hvcc=h.getData(),0==this.video_init_segment_dispatched_&&o.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: "+e.codec)}else{s=this.video_metadata_.sps.data.subarray(4),a=this.video_metadata_.pps.data.subarray(4);var l=new L(s,a,t);e.avcc=l.getData(),0==this.video_init_segment_dispatched_&&o.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: "+e.codec)}this.onTrackMetadata("video",e),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var c=this.media_info_;c.hasVideo=!0,c.width=e.codecWidth,c.height=e.codecHeight,c.fps=e.frameRate.fps,c.profile=e.profile,c.level=e.level,c.refFrames=t.ref_frames,c.chromaFormat=t.chroma_format_string,c.sarNum=e.sarRatio.width,c.sarDen=e.sarRatio.height,c.videoCodec=e.codec,c.hasAudio&&c.audioCodec?c.mimeType='video/mp2t; codecs="'+c.videoCodec+","+c.audioCodec+'"':c.mimeType='video/mp2t; codecs="'+c.videoCodec+'"',c.isComplete()&&this.onMediaInfo(c)},e.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},e.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},e.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},e.prototype.parseADTSAACPayload=function(t,e){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var i=new Uint8Array(t.byteLength+this.aac_last_incomplete_data_.byteLength);i.set(this.aac_last_incomplete_data_,0),i.set(t,this.aac_last_incomplete_data_.byteLength),t=i}var n,r;if(null!=e&&(r=e/this.timescale_),"aac"===this.audio_metadata_.codec){if(null==e&&null!=this.aac_last_sample_pts_)n=1024/this.audio_metadata_.sampling_frequency*1e3,r=this.aac_last_sample_pts_+n;else if(null==e)return void o.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){n=1024/this.audio_metadata_.sampling_frequency*1e3;var s=this.aac_last_sample_pts_+n;Math.abs(s-r)>1&&(o.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+s+"ms, PES pts: "+r+"ms"),r=s)}}for(var a,h=new G(t),l=null,c=r;null!=(l=h.readNextAACFrame());){n=1024/l.sampling_frequency*1e3;var u={codec:"aac",data:l};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"aac",audio_object_type:l.audio_object_type,sampling_freq_index:l.sampling_freq_index,sampling_frequency:l.sampling_frequency,channel_config:l.channel_config},this.dispatchAudioInitSegment(u)):this.detectAudioMetadataChange(u)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(u)),a=c;var d=Math.floor(c),f={unit:l.data,length:l.data.byteLength,pts:d,dts:d};this.audio_track_.samples.push(f),this.audio_track_.length+=l.data.byteLength,c+=n}h.hasIncompleteData()&&(this.aac_last_incomplete_data_=h.getIncompleteData()),a&&(this.aac_last_sample_pts_=a)}},e.prototype.parseLOASAACPayload=function(t,e){var i;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var n=new Uint8Array(t.byteLength+this.aac_last_incomplete_data_.byteLength);n.set(this.aac_last_incomplete_data_,0),n.set(t,this.aac_last_incomplete_data_.byteLength),t=n}var r,s;if(null!=e&&(s=e/this.timescale_),"aac"===this.audio_metadata_.codec){if(null==e&&null!=this.aac_last_sample_pts_)r=1024/this.audio_metadata_.sampling_frequency*1e3,s=this.aac_last_sample_pts_+r;else if(null==e)return void o.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){r=1024/this.audio_metadata_.sampling_frequency*1e3;var a=this.aac_last_sample_pts_+r;Math.abs(a-s)>1&&(o.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+a+"ms, PES pts: "+s+"ms"),s=a)}}for(var h,l=new N(t),c=null,u=s;null!=(c=l.readNextAACFrame(null!==(i=this.loas_previous_frame)&&void 0!==i?i:void 0));){this.loas_previous_frame=c,r=1024/c.sampling_frequency*1e3;var d={codec:"aac",data:c};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"aac",audio_object_type:c.audio_object_type,sampling_freq_index:c.sampling_freq_index,sampling_frequency:c.sampling_frequency,channel_config:c.channel_config},this.dispatchAudioInitSegment(d)):this.detectAudioMetadataChange(d)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(d)),h=u;var f=Math.floor(u),_={unit:c.data,length:c.data.byteLength,pts:f,dts:f};this.audio_track_.samples.push(_),this.audio_track_.length+=c.data.byteLength,u+=r}l.hasIncompleteData()&&(this.aac_last_incomplete_data_=l.getIncompleteData()),h&&(this.aac_last_sample_pts_=h)}},e.prototype.parseAC3Payload=function(t,e){if(!this.has_video_||this.video_init_segment_dispatched_){var i,n;if(null!=e&&(n=e/this.timescale_),"ac-3"===this.audio_metadata_.codec)if(null==e&&null!=this.aac_last_sample_pts_)i=1536/this.audio_metadata_.sampling_frequency*1e3,n=this.aac_last_sample_pts_+i;else if(null==e)return void o.a.w(this.TAG,"Opus: Unknown pts");for(var r,s=new at(t),a=null,h=n;null!=(a=s.readNextAC3Frame());){i=1536/a.sampling_frequency*1e3;var l={codec:"ac-3",data:a};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"ac-3",sampling_frequency:a.sampling_frequency,bit_stream_identification:a.bit_stream_identification,bit_stream_mode:a.bit_stream_mode,low_frequency_effects_channel_on:a.low_frequency_effects_channel_on,channel_mode:a.channel_mode},console.log(JSON.stringify(this.audio_metadata_)),this.dispatchAudioInitSegment(l)):this.detectAudioMetadataChange(l)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(l)),r=h;var c=Math.floor(h),u={unit:a.data,length:a.data.byteLength,pts:c,dts:c};this.audio_track_.samples.push(u),this.audio_track_.length+=a.data.byteLength,h+=i}r&&(this.aac_last_sample_pts_=r)}},e.prototype.parseOpusPayload=function(t,e){if(!this.has_video_||this.video_init_segment_dispatched_){var i,n;if(null!=e&&(n=e/this.timescale_),"opus"===this.audio_metadata_.codec)if(null==e&&null!=this.aac_last_sample_pts_)i=20,n=this.aac_last_sample_pts_+i;else if(null==e)return void o.a.w(this.TAG,"Opus: Unknown pts");for(var r,s=n,a=0;a<t.length;){i=20;for(var h=0!=(16&t[a+1]),l=0!=(8&t[a+1]),c=a+2,u=0;255===t[c];)u+=255,c+=1;u+=t[c],c+=1,c+=h?2:0,c+=l?2:0,r=s;var d=Math.floor(s),f=t.slice(c,c+u),_={unit:f,length:f.byteLength,pts:d,dts:d};this.audio_track_.samples.push(_),this.audio_track_.length+=f.byteLength,s+=i,a=c+u}r&&(this.aac_last_sample_pts_=r)}},e.prototype.parseMP3Payload=function(t,e){if(!this.has_video_||this.video_init_segment_dispatched_){var i=t[1]>>>3&3,n=(6&t[1])>>1,r=(t[2],(12&t[2])>>>2),o=3!=(t[3]>>>6&3)?2:1,s=0,a=34;switch(i){case 0:s=[11025,12e3,8e3,0][r];break;case 2:s=[22050,24e3,16e3,0][r];break;case 3:s=[44100,48e3,32e3,0][r]}switch(n){case 1:a=34;break;case 2:a=33;break;case 3:a=32}var h=new function(){};h.object_type=a,h.sample_rate=s,h.channel_count=o,h.data=t;var l={codec:"mp3",data:h};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"mp3",object_type:a,sample_rate:s,channel_count:o},this.dispatchAudioInitSegment(l)):this.detectAudioMetadataChange(l)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(l));var c={unit:t,length:t.byteLength,pts:e/this.timescale_,dts:e/this.timescale_};this.audio_track_.samples.push(c),this.audio_track_.length+=t.byteLength}},e.prototype.detectAudioMetadataChange=function(t){if(t.codec!==this.audio_metadata_.codec)return o.a.v(this.TAG,"Audio: Audio Codecs changed from "+this.audio_metadata_.codec+" to "+t.codec),!0;if("aac"===t.codec&&"aac"===this.audio_metadata_.codec){if((e=t.data).audio_object_type!==this.audio_metadata_.audio_object_type)return o.a.v(this.TAG,"AAC: AudioObjectType changed from "+this.audio_metadata_.audio_object_type+" to "+e.audio_object_type),!0;if(e.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return o.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+this.audio_metadata_.sampling_freq_index+" to "+e.sampling_freq_index),!0;if(e.channel_config!==this.audio_metadata_.channel_config)return o.a.v(this.TAG,"AAC: Channel configuration changed from "+this.audio_metadata_.channel_config+" to "+e.channel_config),!0}else if("ac-3"===t.codec&&"ac-3"===this.audio_metadata_.codec){var e;if((e=t.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return o.a.v(this.TAG,"AC3: Sampling Frequency changed from "+this.audio_metadata_.sampling_frequency+" to "+e.sampling_frequency),!0;if(e.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return o.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+this.audio_metadata_.bit_stream_identification+" to "+e.bit_stream_identification),!0;if(e.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return o.a.v(this.TAG,"AC3: BitStream Mode changed from "+this.audio_metadata_.bit_stream_mode+" to "+e.bit_stream_mode),!0;if(e.channel_mode!==this.audio_metadata_.channel_mode)return o.a.v(this.TAG,"AC3: Channel Mode changed from "+this.audio_metadata_.channel_mode+" to "+e.channel_mode),!0;if(e.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return o.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+this.audio_metadata_.low_frequency_effects_channel_on+" to "+e.low_frequency_effects_channel_on),!0}else if("opus"===t.codec&&"opus"===this.audio_metadata_.codec){if((i=t.meta).sample_rate!==this.audio_metadata_.sample_rate)return o.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+i.sample_rate),!0;if(i.channel_count!==this.audio_metadata_.channel_count)return o.a.v(this.TAG,"Opus: Channel count changed from "+this.audio_metadata_.channel_count+" to "+i.channel_count),!0}else if("mp3"===t.codec&&"mp3"===this.audio_metadata_.codec){var i;if((i=t.data).object_type!==this.audio_metadata_.object_type)return o.a.v(this.TAG,"MP3: AudioObjectType changed from "+this.audio_metadata_.object_type+" to "+i.object_type),!0;if(i.sample_rate!==this.audio_metadata_.sample_rate)return o.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+i.sample_rate),!0;if(i.channel_count!==this.audio_metadata_.channel_count)return o.a.v(this.TAG,"MP3: Channel count changed from "+this.audio_metadata_.channel_count+" to "+i.channel_count),!0}return!1},e.prototype.dispatchAudioInitSegment=function(t){var e={type:"audio"};if(e.id=this.audio_track_.id,e.timescale=1e3,e.duration=this.duration_,"aac"===this.audio_metadata_.codec){var i=new function(t){var e=null,i=t.audio_object_type,n=t.audio_object_type,r=t.sampling_freq_index,o=t.channel_config,s=0,a=navigator.userAgent.toLowerCase();-1!==a.indexOf("firefox")?r>=6?(n=5,e=new Array(4),s=r-3):(n=2,e=new Array(2),s=r):-1!==a.indexOf("android")?(n=2,e=new Array(2),s=r):(n=5,s=r,e=new Array(4),r>=6?s=r-3:1===o&&(n=2,e=new Array(2),s=r)),e[0]=n<<3,e[0]|=(15&r)>>>1,e[1]=(15&r)<<7,e[1]|=(15&o)<<3,5===n&&(e[1]|=(15&s)>>>1,e[2]=(1&s)<<7,e[2]|=8,e[3]=0),this.config=e,this.sampling_rate=I[r],this.channel_count=o,this.codec_mimetype="mp4a.40."+n,this.original_codec_mimetype="mp4a.40."+i}("aac"===t.codec?t.data:null);e.audioSampleRate=i.sampling_rate,e.channelCount=i.channel_count,e.codec=i.codec_mimetype,e.originalCodec=i.original_codec_mimetype,e.config=i.config,e.refSampleDuration=1024/e.audioSampleRate*e.timescale}else if("ac-3"===this.audio_metadata_.codec){var n=new function(t){var e;e=[t.sampling_rate_code<<6|t.bit_stream_identification<<1|t.bit_stream_mode>>2,(3&t.bit_stream_mode)<<6|t.channel_mode<<3|t.low_frequency_effects_channel_on<<2|t.frame_size_code>>4,t.frame_size_code<<4&224],this.config=e,this.sampling_rate=t.sampling_frequency,this.bit_stream_identification=t.bit_stream_identification,this.bit_stream_mode=t.bit_stream_mode,this.low_frequency_effects_channel_on=t.low_frequency_effects_channel_on,this.channel_count=t.channel_count,this.channel_mode=t.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"}("ac-3"===t.codec?t.data:null);e.audioSampleRate=n.sampling_rate,e.channelCount=n.channel_count,e.codec=n.codec_mimetype,e.originalCodec=n.original_codec_mimetype,e.config=n.config,e.refSampleDuration=1536/e.audioSampleRate*e.timescale}else"opus"===this.audio_metadata_.codec?(e.audioSampleRate=this.audio_metadata_.sample_rate,e.channelCount=this.audio_metadata_.channel_count,e.channelConfigCode=this.audio_metadata_.channel_config_code,e.codec="opus",e.originalCodec="opus",e.config=void 0,e.refSampleDuration=20):"mp3"===this.audio_metadata_.codec&&(e.audioSampleRate=this.audio_metadata_.sample_rate,e.channelCount=this.audio_metadata_.channel_count,e.codec="mp3",e.originalCodec="mp3",e.config=void 0);0==this.audio_init_segment_dispatched_&&o.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: "+e.codec),this.onTrackMetadata("audio",e),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var r=this.media_info_;r.hasAudio=!0,r.audioCodec=e.originalCodec,r.audioSampleRate=e.audioSampleRate,r.audioChannelCount=e.channelCount,r.hasVideo&&r.videoCodec?r.mimeType='video/mp2t; codecs="'+r.videoCodec+","+r.audioCodec+'"':r.mimeType='video/mp2t; codecs="'+r.audioCodec+'"',r.isComplete()&&this.onMediaInfo(r)},e.prototype.dispatchPESPrivateDataDescriptor=function(t,e,i){var n=new function(){};n.pid=t,n.stream_type=e,n.descriptor=i,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(n)},e.prototype.parsePESPrivateDataPayload=function(t,e,i,n,r){var o=new F;if(o.pid=n,o.stream_id=r,o.len=t.byteLength,o.data=t,null!=e){var s=Math.floor(e/this.timescale_);o.pts=s}else o.nearest_pts=this.aac_last_sample_pts_;if(null!=i){var a=Math.floor(i/this.timescale_);o.dts=a}this.onPESPrivateData&&this.onPESPrivateData(o)},e.prototype.parseTimedID3MetadataPayload=function(t,e,i,n,r){var o=new F;if(o.pid=n,o.stream_id=r,o.len=t.byteLength,o.data=t,null!=e){var s=Math.floor(e/this.timescale_);o.pts=s}if(null!=i){var a=Math.floor(i/this.timescale_);o.dts=a}this.onTimedID3Metadata&&this.onTimedID3Metadata(o)},e.prototype.parseSMPTE2038MetadataPayload=function(t,e,i,n,r){var o=new function(){};if(o.pid=n,o.stream_id=r,o.len=t.byteLength,o.data=t,null!=e){var s=Math.floor(e/this.timescale_);o.pts=s}if(o.nearest_pts=this.aac_last_sample_pts_,null!=i){var a=Math.floor(i/this.timescale_);o.dts=a}o.ancillaries=function(t){for(var e=new _(t),i=0,n=[];i+=6,0===e.readBits(6);){var r=e.readBool();i+=1;var o=e.readBits(11);i+=11;var s=e.readBits(12);i+=12;var a=255&e.readBits(10);i+=10;var h=255&e.readBits(10);i+=10;var l=255&e.readBits(10);i+=10;for(var c=new Uint8Array(l),u=0;u<l;u++){var d=255&e.readBits(10);i+=10,c[u]=d}e.readBits(10),i+=10;var f="User Defined";65===a?7===h&&(f="SCTE-104"):95===a?220===h?f="ARIB STD-B37 (1SEG)":221===h?f="ARIB STD-B37 (ANALOG)":222===h?f="ARIB STD-B37 (SD)":223===h&&(f="ARIB STD-B37 (HD)"):97===a&&(1===h?f="EIA-708":2===h&&(f="EIA-608")),n.push({yc_indicator:r,line_number:o,horizontal_offset:s,did:a,sdid:h,user_data:c,description:f,information:{}}),e.readBits(8-(i-Math.floor(i/8))%8),i+=(8-(i-Math.floor(i/8)))%8}return e.destroy(),e=null,n}(t),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(o)},e}(C),ut=function(){function t(){}return t.init=function(){for(var e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=t.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},t.box=function(t){for(var e=8,i=null,n=Array.prototype.slice.call(arguments,1),r=n.length,o=0;o<r;o++)e+=n[o].byteLength;(i=new Uint8Array(e))[0]=e>>>24&255,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=255&e,i.set(t,4);var s=8;for(o=0;o<r;o++)i.set(n[o],s),s+=n[o].byteLength;return i},t.generateInitSegment=function(e){var i=t.box(t.types.ftyp,t.constants.FTYP),n=t.moov(e),r=new Uint8Array(i.byteLength+n.byteLength);return r.set(i,0),r.set(n,i.byteLength),r},t.moov=function(e){var i=t.mvhd(e.timescale,e.duration),n=t.trak(e),r=t.mvex(e);return t.box(t.types.moov,i,n,r)},t.mvhd=function(e,i){return t.box(t.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},t.trak=function(e){return t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.tkhd=function(e){var i=e.id,n=e.duration,r=e.presentWidth,o=e.presentHeight;return t.box(t.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,o>>>8&255,255&o,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e),t.hdlr(e),t.minf(e))},t.mdhd=function(e){var i=e.timescale,n=e.duration;return t.box(t.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))},t.hdlr=function(e){var i;return i="audio"===e.type?t.constants.HDLR_AUDIO:t.constants.HDLR_VIDEO,t.box(t.types.hdlr,i)},t.minf=function(e){var i;return i="audio"===e.type?t.box(t.types.smhd,t.constants.SMHD):t.box(t.types.vmhd,t.constants.VMHD),t.box(t.types.minf,i,t.dinf(),t.stbl(e))},t.dinf=function(){return t.box(t.types.dinf,t.box(t.types.dref,t.constants.DREF))},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.constants.STTS),t.box(t.types.stsc,t.constants.STSC),t.box(t.types.stsz,t.constants.STSZ),t.box(t.types.stco,t.constants.STCO))},t.stsd=function(e){return"audio"===e.type?"mp3"===e.codec?t.box(t.types.stsd,t.constants.STSD_PREFIX,t.mp3(e)):"ac-3"===e.codec?t.box(t.types.stsd,t.constants.STSD_PREFIX,t.ac3(e)):"opus"===e.codec?t.box(t.types.stsd,t.constants.STSD_PREFIX,t.Opus(e)):t.box(t.types.stsd,t.constants.STSD_PREFIX,t.mp4a(e)):"video"===e.type&&e.codec.startsWith("hvc1")?t.box(t.types.stsd,t.constants.STSD_PREFIX,t.hvc1(e)):t.box(t.types.stsd,t.constants.STSD_PREFIX,t.avc1(e))},t.mp3=function(e){var i=e.channelCount,n=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return t.box(t.types[".mp3"],r)},t.mp4a=function(e){var i=e.channelCount,n=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return t.box(t.types.mp4a,r,t.esds(e))},t.ac3=function(e){var i=e.channelCount,n=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return t.box(t.types["ac-3"],r,t.box(t.types.dac3,new Uint8Array(e.config)))},t.esds=function(e){var i=e.config||[],n=i.length,r=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(i).concat([6,1,2]));return t.box(t.types.esds,r)},t.Opus=function(e){var i=e.channelCount,n=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return t.box(t.types.Opus,r,t.dOps(e))},t.dOps=function(e){var i=e.channelCount,n=e.channelConfigCode,r=e.audioSampleRate;if(e.config)return t.box(t.types.dOps,s);var o=[];switch(n){case 1:case 2:o=[0];break;case 0:o=[255,1,1,0,1];break;case 128:o=[255,2,0,0,1];break;case 3:o=[1,2,1,0,2,1];break;case 4:o=[1,2,2,0,1,2,3];break;case 5:o=[1,3,2,0,4,1,2,3];break;case 6:o=[1,4,2,0,4,1,2,3,5];break;case 7:o=[1,4,2,0,4,1,2,3,5,6];break;case 8:o=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:o=[1,1,2,0,1];break;case 131:o=[1,1,3,0,1,2];break;case 132:o=[1,1,4,0,1,2,3];break;case 133:o=[1,1,5,0,1,2,3,4];break;case 134:o=[1,1,6,0,1,2,3,4,5];break;case 135:o=[1,1,7,0,1,2,3,4,5,6];break;case 136:o=[1,1,8,0,1,2,3,4,5,6,7]}var s=new Uint8Array(function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)n[r]=o[s];return n}([0,i,0,0,r>>>24&255,r>>>17&255,r>>>8&255,r>>>0&255,0,0],o));return t.box(t.types.dOps,s)},t.avc1=function(e){var i=e.avcc,n=e.codecWidth,r=e.codecHeight,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return t.box(t.types.avc1,o,t.box(t.types.avcC,i))},t.hvc1=function(e){var i=e.hvcc,n=e.codecWidth,r=e.codecHeight,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return t.box(t.types.hvc1,o,t.box(t.types.hvcC,i))},t.mvex=function(e){return t.box(t.types.mvex,t.trex(e))},t.trex=function(e){var i=e.id,n=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return t.box(t.types.trex,n)},t.moof=function(e,i){return t.box(t.types.moof,t.mfhd(e.sequenceNumber),t.traf(e,i))},t.mfhd=function(e){var i=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return t.box(t.types.mfhd,i)},t.traf=function(e,i){var n=e.id,r=t.box(t.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),o=t.box(t.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),s=t.sdtp(e),a=t.trun(e,s.byteLength+16+16+8+16+8+8);return t.box(t.types.traf,r,o,a,s)},t.sdtp=function(e){for(var i=e.samples||[],n=i.length,r=new Uint8Array(4+n),o=0;o<n;o++){var s=i[o].flags;r[o+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return t.box(t.types.sdtp,r)},t.trun=function(e,i){var n=e.samples||[],r=n.length,o=12+16*r,s=new Uint8Array(o);i+=8+o,s.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var a=0;a<r;a++){var h=n[a].duration,l=n[a].size,c=n[a].flags,u=n[a].cts;s.set([h>>>24&255,h>>>16&255,h>>>8&255,255&h,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*a)}return t.box(t.types.trun,s)},t.mdat=function(e){return t.box(t.types.mdat,e)},t}();ut.init();var dt=ut,ft=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),_t=i(7),pt=function(){function t(t){this.TAG="MP4Remuxer",this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new _t.c("audio"),this._videoSegmentInfoList=new _t.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!s.a.chrome||!(s.a.version.major<50||50===s.a.version.major&&s.a.version.build<2661)),this._fillSilentAfterSeek=s.a.msedge||s.a.msie,this._mp3UseMpegAudio=!s.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return t.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},t.prototype.bindDataSource=function(t){return t.onDataAvailable=this.remux.bind(this),t.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(t.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(t){this._onInitSegment=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(t){this._onMediaSegment=t},enumerable:!1,configurable:!0}),t.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},t.prototype.seek=function(t){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},t.prototype.remux=function(t,e){if(!this._onMediaSegment)throw new u.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(t,e),e&&this._remuxVideo(e),t&&this._remuxAudio(t)},t.prototype._onTrackMetadataReceived=function(t,e){var i=null,n="mp4",r=e.codec;if("audio"===t)this._audioMeta=e,"mp3"===e.codec&&this._mp3UseMpegAudio?(n="mpeg",r="",i=new Uint8Array):i=dt.generateInitSegment(e);else{if("video"!==t)return;this._videoMeta=e,i=dt.generateInitSegment(e)}if(!this._onInitSegment)throw new u.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(t,{type:t,data:i.buffer,codec:r,container:t+"/"+n,mediaDuration:e.duration})},t.prototype._calculateDtsBase=function(t,e){this._dtsBaseInited||(t&&t.samples&&t.samples.length&&(this._audioDtsBase=t.samples[0].dts),e&&e.samples&&e.samples.length&&(this._videoDtsBase=e.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},t.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},t.prototype.flushStashedSamples=function(){var t=this._videoStashedLastSample,e=this._audioStashedLastSample,i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=t&&(i.samples.push(t),i.length=t.length);var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=e&&(n.samples.push(e),n.length=e.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(i,!0),this._remuxAudio(n,!0)},t.prototype._remuxAudio=function(t,e){if(null!=this._audioMeta){var i,n=t,r=n.samples,a=void 0,h=-1,l=this._audioMeta.refSampleDuration,c="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,u=this._dtsBaseInited&&void 0===this._audioNextDts,d=!1;if(r&&0!==r.length&&(1!==r.length||e)){var f=0,_=null,p=0;c?(f=0,p=n.length):(f=8,p=8+n.length);var m=null;if(r.length>1&&(p-=(m=r.pop()).length),null!=this._audioStashedLastSample){var g=this._audioStashedLastSample;this._audioStashedLastSample=null,r.unshift(g),p+=g.length}null!=m&&(this._audioStashedLastSample=m);var v=r[0].dts-this._dtsBase;if(this._audioNextDts)a=v-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())a=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(d=!0);else{var y=this._audioSegmentInfoList.getLastSampleBefore(v);if(null!=y){var x=v-(y.originalDts+y.duration);x<=3&&(x=0),a=v-(y.dts+y.duration+x)}else a=0}if(d){var w=v-a,b=this._videoSegmentInfoList.getLastSegmentBefore(v);if(null!=b&&b.beginDts<w){if(D=ft.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var A=b.beginDts,C=w-b.beginDts;o.a.v(this.TAG,"InsertPrefixSilentAudio: dts: "+A+", duration: "+C),r.unshift({unit:D,dts:A,pts:A}),p+=D.byteLength}}else d=!1}for(var S=[],E=0;E<r.length;E++){var P=(g=r[E]).unit,M=g.dts-this._dtsBase,T=(A=M,!1),k=null,R=0;if(!(M<-.001)){if("mp3"!==this._audioMeta.codec){var L=M;if(this._audioNextDts&&(L=this._audioNextDts),(a=M-L)<=-3*l){o.a.w(this.TAG,"Dropping 1 audio frame (originalDts: "+M+" ms ,curRefDts: "+L+" ms)  due to dtsCorrection: "+a+" ms overlap.");continue}if(a>=3*l&&this._fillAudioTimestampGap&&!s.a.safari){T=!0;var D,O=Math.floor(a/l);o.a.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+M+" ms, curRefDts: "+L+" ms, dtsCorrection: "+Math.round(a)+" ms, generate: "+O+" frames"),A=Math.floor(L),R=Math.floor(L+l)-A,null==(D=ft.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(o.a.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),D=P),k=[];for(var I=0;I<O;I++){L+=l;var B=Math.floor(L),j=Math.floor(L+l)-B,z={dts:B,pts:B,cts:0,unit:D,size:D.byteLength,duration:j,originalDts:M,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};k.push(z),p+=z.size}this._audioNextDts=L+l}else A=Math.floor(L),R=Math.floor(L+l)-A,this._audioNextDts=L+l}else A=M-a,R=E!==r.length-1?r[E+1].dts-this._dtsBase-a-A:null!=m?m.dts-this._dtsBase-a-A:S.length>=1?S[S.length-1].duration:Math.floor(l),this._audioNextDts=A+R;-1===h&&(h=A),S.push({dts:A,pts:A,cts:0,unit:g.unit,size:g.unit.byteLength,duration:R,originalDts:M,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),T&&S.push.apply(S,k)}}if(0===S.length)return n.samples=[],void(n.length=0);for(c?_=new Uint8Array(p):((_=new Uint8Array(p))[0]=p>>>24&255,_[1]=p>>>16&255,_[2]=p>>>8&255,_[3]=255&p,_.set(dt.types.mdat,4)),E=0;E<S.length;E++)P=S[E].unit,_.set(P,f),f+=P.byteLength;var G=S[S.length-1];i=G.dts+G.duration;var N=new _t.b;N.beginDts=h,N.endDts=i,N.beginPts=h,N.endPts=i,N.originalBeginDts=S[0].originalDts,N.originalEndDts=G.originalDts+G.duration,N.firstSample=new _t.d(S[0].dts,S[0].pts,S[0].duration,S[0].originalDts,!1),N.lastSample=new _t.d(G.dts,G.pts,G.duration,G.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(N),n.samples=S,n.sequenceNumber++;var F;F=c?new Uint8Array:dt.moof(n,h),n.samples=[],n.length=0;var U={type:"audio",data:this._mergeBoxes(F,_).buffer,sampleCount:S.length,info:N};c&&u&&(U.timestampOffset=h),this._onMediaSegment("audio",U)}}},t.prototype._remuxVideo=function(t,e){if(null!=this._videoMeta){var i,n,r=t,o=r.samples,s=void 0,a=-1,h=-1;if(o&&0!==o.length&&(1!==o.length||e)){var l=8,c=null,u=8+t.length,d=null;if(o.length>1&&(u-=(d=o.pop()).length),null!=this._videoStashedLastSample){var f=this._videoStashedLastSample;this._videoStashedLastSample=null,o.unshift(f),u+=f.length}null!=d&&(this._videoStashedLastSample=d);var _=o[0].dts-this._dtsBase;if(this._videoNextDts)s=_-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())s=0;else{var p=this._videoSegmentInfoList.getLastSampleBefore(_);if(null!=p){var m=_-(p.originalDts+p.duration);m<=3&&(m=0),s=_-(p.dts+p.duration+m)}else s=0}for(var g=new _t.b,v=[],y=0;y<o.length;y++){var x=(f=o[y]).dts-this._dtsBase,w=f.isKeyframe,b=x-s,A=f.cts,C=b+A;-1===a&&(a=b,h=C);var S=0;if(S=y!==o.length-1?o[y+1].dts-this._dtsBase-s-b:null!=d?d.dts-this._dtsBase-s-b:v.length>=1?v[v.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),w){var E=new _t.d(b,C,S,f.dts,!0);E.fileposition=f.fileposition,g.appendSyncPoint(E)}v.push({dts:b,pts:C,cts:A,units:f.units,size:f.length,isKeyframe:w,duration:S,originalDts:x,flags:{isLeading:0,dependsOn:w?2:1,isDependedOn:w?1:0,hasRedundancy:0,isNonSync:w?0:1}})}for((c=new Uint8Array(u))[0]=u>>>24&255,c[1]=u>>>16&255,c[2]=u>>>8&255,c[3]=255&u,c.set(dt.types.mdat,4),y=0;y<v.length;y++)for(var P=v[y].units;P.length;){var M=P.shift().data;c.set(M,l),l+=M.byteLength}var T=v[v.length-1];if(i=T.dts+T.duration,n=T.pts+T.duration,this._videoNextDts=i,g.beginDts=a,g.endDts=i,g.beginPts=h,g.endPts=n,g.originalBeginDts=v[0].originalDts,g.originalEndDts=T.originalDts+T.duration,g.firstSample=new _t.d(v[0].dts,v[0].pts,v[0].duration,v[0].originalDts,v[0].isKeyframe),g.lastSample=new _t.d(T.dts,T.pts,T.duration,T.originalDts,T.isKeyframe),this._isLive||this._videoSegmentInfoList.append(g),r.samples=v,r.sequenceNumber++,this._forceFirstIDR){var k=v[0].flags;k.dependsOn=2,k.isNonSync=0}var R=dt.moof(r,a);r.samples=[],r.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(R,c).buffer,sampleCount:v.length,info:g})}}},t.prototype._mergeBoxes=function(t,e){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(t,0),i.set(e,t.byteLength),i},t}(),mt=i(11),gt=i(1),vt=function(){function t(t,e){this.TAG="TransmuxingController",this._emitter=new r.a,this._config=e,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),"boolean"!=typeof t.cors&&(t.cors=!0),"boolean"!=typeof t.withCredentials&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var i=0;this._mediaDataSource.segments.forEach(function(n){n.timestampBase=i,i+=n.duration,n.cors=t.cors,n.withCredentials=t.withCredentials,e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy)}),isNaN(i)||this._mediaDataSource.duration===i||(this._mediaDataSource.duration=i),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return t.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},t.prototype._loadSegment=function(t,e){this._currentSegmentIndex=t;var i=this._mediaDataSource.segments[t],n=this._ioctl=new mt.a(i,this._config,t);n.onError=this._onIOException.bind(this),n.onSeeked=this._onIOSeeked.bind(this),n.onComplete=this._onIOComplete.bind(this),n.onRedirect=this._onIORedirect.bind(this),n.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),e?this._demuxer.bindDataSource(this._ioctl):n.onDataArrival=this._onInitChunkArrival.bind(this),n.open(e)},t.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},t.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},t.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},t.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},t.prototype.seek=function(t){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var e=this._searchSegmentIndexContains(t);if(e===this._currentSegmentIndex){var i=this._mediaInfo.segments[e];if(null==i)this._pendingSeekTime=t;else{var n=i.getNearestKeyframe(t);this._remuxer.seek(n.milliseconds),this._ioctl.seek(n.fileposition),this._pendingResolveSeekPoint=n.milliseconds}}else{var r=this._mediaInfo.segments[e];null==r?(this._pendingSeekTime=t,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(e)):(n=r.getNearestKeyframe(t),this._internalAbort(),this._remuxer.seek(t),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[e].timestampBase,this._loadSegment(e,n.fileposition),this._pendingResolveSeekPoint=n.milliseconds,this._reportSegmentMediaInfo(e))}this._enableStatisticsReporter()}},t.prototype._searchSegmentIndexContains=function(t){for(var e=this._mediaDataSource.segments,i=e.length-1,n=0;n<e.length;n++)if(t<e[n].timestampBase){i=n-1;break}return i},t.prototype._onInitChunkArrival=function(t,e){var i=this,n=0;if(e>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,n=this._demuxer.parseChunks(t,e);else{var r=null;(r=A.probe(t)).match&&(this._setupFLVDemuxerRemuxer(r),n=this._demuxer.parseChunks(t,e)),r.match||r.needMoreData||(r=ct.probe(t)).match&&(this._setupTSDemuxerRemuxer(r),n=this._demuxer.parseChunks(t,e)),r.match||r.needMoreData||(r=null,o.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){i._internalAbort()}),this._emitter.emit(gt.a.DEMUX_ERROR,m.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return n},t.prototype._setupFLVDemuxerRemuxer=function(t){this._demuxer=new A(t,this._config),this._remuxer||(this._remuxer=new pt(this._config));var e=this._mediaDataSource;null==e.duration||isNaN(e.duration)||(this._demuxer.overridedDuration=e.duration),"boolean"==typeof e.hasAudio&&(this._demuxer.overridedHasAudio=e.hasAudio),"boolean"==typeof e.hasVideo&&(this._demuxer.overridedHasVideo=e.hasVideo),this._demuxer.timestampBase=e.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},t.prototype._setupTSDemuxerRemuxer=function(t){var e=this._demuxer=new ct(t,this._config);this._remuxer||(this._remuxer=new pt(this._config)),e.onError=this._onDemuxException.bind(this),e.onMediaInfo=this._onMediaInfo.bind(this),e.onMetaDataArrived=this._onMetaDataArrived.bind(this),e.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),e.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),e.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),e.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),e.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},t.prototype._onMediaInfo=function(t){var e=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},t),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,a.a.prototype));var i=Object.assign({},t);Object.setPrototypeOf(i,a.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=i,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then(function(){var t=e._pendingSeekTime;e._pendingSeekTime=null,e.seek(t)})},t.prototype._onMetaDataArrived=function(t){this._emitter.emit(gt.a.METADATA_ARRIVED,t)},t.prototype._onScriptDataArrived=function(t){this._emitter.emit(gt.a.SCRIPTDATA_ARRIVED,t)},t.prototype._onTimedID3Metadata=function(t){var e=this._remuxer.getTimestampBase();null!=e&&(null!=t.pts&&(t.pts-=e),null!=t.dts&&(t.dts-=e),this._emitter.emit(gt.a.TIMED_ID3_METADATA_ARRIVED,t))},t.prototype._onSMPTE2038Metadata=function(t){var e=this._remuxer.getTimestampBase();null!=e&&(null!=t.pts&&(t.pts-=e),null!=t.dts&&(t.dts-=e),null!=t.nearest_pts&&(t.nearest_pts-=e),this._emitter.emit(gt.a.SMPTE2038_METADATA_ARRIVED,t))},t.prototype._onSCTE35Metadata=function(t){var e=this._remuxer.getTimestampBase();null!=e&&(null!=t.pts&&(t.pts-=e),null!=t.nearest_pts&&(t.nearest_pts-=e),this._emitter.emit(gt.a.SCTE35_METADATA_ARRIVED,t))},t.prototype._onPESPrivateDataDescriptor=function(t){this._emitter.emit(gt.a.PES_PRIVATE_DATA_DESCRIPTOR,t)},t.prototype._onPESPrivateData=function(t){var e=this._remuxer.getTimestampBase();null!=e&&(null!=t.pts&&(t.pts-=e),null!=t.nearest_pts&&(t.nearest_pts-=e),null!=t.dts&&(t.dts-=e),this._emitter.emit(gt.a.PES_PRIVATE_DATA_ARRIVED,t))},t.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},t.prototype._onIOComplete=function(t){var e=t+1;e<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(e)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(gt.a.LOADING_COMPLETE),this._disableStatisticsReporter())},t.prototype._onIORedirect=function(t){var e=this._ioctl.extraData;this._mediaDataSource.segments[e].redirectedURL=t},t.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(gt.a.RECOVERED_EARLY_EOF)},t.prototype._onIOException=function(t,e){o.a.e(this.TAG,"IOException: type = "+t+", code = "+e.code+", msg = "+e.msg),this._emitter.emit(gt.a.IO_ERROR,t,e),this._disableStatisticsReporter()},t.prototype._onDemuxException=function(t,e){o.a.e(this.TAG,"DemuxException: type = "+t+", info = "+e),this._emitter.emit(gt.a.DEMUX_ERROR,t,e)},t.prototype._onRemuxerInitSegmentArrival=function(t,e){this._emitter.emit(gt.a.INIT_SEGMENT,t,e)},t.prototype._onRemuxerMediaSegmentArrival=function(t,e){if(null==this._pendingSeekTime&&(this._emitter.emit(gt.a.MEDIA_SEGMENT,t,e),null!=this._pendingResolveSeekPoint&&"video"===t)){var i=e.info.syncPoints,n=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.a.safari&&i.length>0&&i[0].originalDts===n&&(n=i[0].pts),this._emitter.emit(gt.a.RECOMMEND_SEEKPOINT,n)}},t.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},t.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},t.prototype._reportSegmentMediaInfo=function(t){var e=this._mediaInfo.segments[t],i=Object.assign({},e);i.duration=this._mediaInfo.duration,i.segmentCount=this._mediaInfo.segmentCount,delete i.segments,delete i.keyframesIndex,this._emitter.emit(gt.a.MEDIA_INFO,i)},t.prototype._reportStatisticsInfo=function(){var t={};t.url=this._ioctl.currentURL,t.hasRedirect=this._ioctl.hasRedirect,t.hasRedirect&&(t.redirectedURL=this._ioctl.currentRedirectedURL),t.speed=this._ioctl.currentSpeed,t.loaderType=this._ioctl.loaderType,t.currentSegmentIndex=this._currentSegmentIndex,t.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(gt.a.STATISTICS_INFO,t)},t}();e.a=vt},function(t,e,i){"use strict";var n,r=i(0),o=function(){function t(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return t.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},t.prototype.addBytes=function(t){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=t,this._totalBytes+=t):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=t,this._totalBytes+=t):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=t,this._totalBytes+=t,this._lastCheckpoint=this._now())},Object.defineProperty(t.prototype,"currentKBps",{get:function(){this.addBytes(0);var t=(this._now()-this._lastCheckpoint)/1e3;return 0==t&&(t=1),this._intervalBytes/t/1024},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"averageKBps",{get:function(){var t=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/t/1024},enumerable:!1,configurable:!0}),t}(),s=i(2),a=i(4),h=i(3),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=function(t){function e(e,i){var n=t.call(this,"fetch-stream-loader")||this;return n.TAG="FetchStreamLoader",n._seekHandler=e,n._config=i,n._needStash=!0,n._requestAbort=!1,n._abortController=null,n._contentLength=null,n._receivedLength=0,n}return l(e,t),e.isSupported=function(){try{var t=a.a.msedge&&a.a.version.minor>=15048,e=!a.a.msedge||t;return self.fetch&&self.ReadableStream&&e}catch(t){return!1}},e.prototype.destroy=function(){this.isWorking()&&this.abort(),t.prototype.destroy.call(this)},e.prototype.open=function(t,e){var i=this;this._dataSource=t,this._range=e;var n=t.url;this._config.reuseRedirectedURL&&null!=t.redirectedURL&&(n=t.redirectedURL);var r=this._seekHandler.getConfig(n,e),o=new self.Headers;if("object"==typeof r.headers){var a=r.headers;for(var l in a)a.hasOwnProperty(l)&&o.append(l,a[l])}var c={method:"GET",headers:o,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var l in this._config.headers)o.append(l,this._config.headers[l]);!1===t.cors&&(c.mode="same-origin"),t.withCredentials&&(c.credentials="include"),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,c.signal=this._abortController.signal),this._status=s.c.kConnecting,self.fetch(r.url,c).then(function(t){if(i._requestAbort)return i._status=s.c.kIdle,void t.body.cancel();if(t.ok&&t.status>=200&&t.status<=299){if(t.url!==r.url&&i._onURLRedirect){var e=i._seekHandler.removeURLParameters(t.url);i._onURLRedirect(e)}var n=t.headers.get("Content-Length");return null!=n&&(i._contentLength=parseInt(n),0!==i._contentLength&&i._onContentLengthKnown&&i._onContentLengthKnown(i._contentLength)),i._pump.call(i,t.body.getReader())}if(i._status=s.c.kError,!i._onError)throw new h.d("FetchStreamLoader: Http code invalid, "+t.status+" "+t.statusText);i._onError(s.b.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}).catch(function(t){if(!i._abortController||!i._abortController.signal.aborted){if(i._status=s.c.kError,!i._onError)throw t;i._onError(s.b.EXCEPTION,{code:-1,msg:t.message})}})},e.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==s.c.kBuffering||!a.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(t){}},e.prototype._pump=function(t){var e=this;return t.read().then(function(i){if(i.done)if(null!==e._contentLength&&e._receivedLength<e._contentLength){e._status=s.c.kError;var n=s.b.EARLY_EOF,r={code:-1,msg:"Fetch stream meet Early-EOF"};if(!e._onError)throw new h.d(r.msg);e._onError(n,r)}else e._status=s.c.kComplete,e._onComplete&&e._onComplete(e._range.from,e._range.from+e._receivedLength-1);else{if(e._abortController&&e._abortController.signal.aborted)return void(e._status=s.c.kComplete);if(!0===e._requestAbort)return e._status=s.c.kComplete,t.cancel();e._status=s.c.kBuffering;var o=i.value.buffer,a=e._range.from+e._receivedLength;e._receivedLength+=o.byteLength,e._onDataArrival&&e._onDataArrival(o,a,e._receivedLength),e._pump(t)}}).catch(function(t){if(e._abortController&&e._abortController.signal.aborted)e._status=s.c.kComplete;else if(11!==t.code||!a.a.msedge){e._status=s.c.kError;var i=0,n=null;if(19!==t.code&&"network error"!==t.message||!(null===e._contentLength||null!==e._contentLength&&e._receivedLength<e._contentLength)?(i=s.b.EXCEPTION,n={code:t.code,msg:t.message}):(i=s.b.EARLY_EOF,n={code:t.code,msg:"Fetch stream meet Early-EOF"}),!e._onError)throw new h.d(n.msg);e._onError(i,n)}})},e}(s.a),u=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),d=function(t){function e(e,i){var n=t.call(this,"xhr-moz-chunked-loader")||this;return n.TAG="MozChunkedLoader",n._seekHandler=e,n._config=i,n._needStash=!0,n._xhr=null,n._requestAbort=!1,n._contentLength=null,n._receivedLength=0,n}return u(e,t),e.isSupported=function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===t.responseType}catch(t){return r.a.w("MozChunkedLoader",t.message),!1}},e.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),t.prototype.destroy.call(this)},e.prototype.open=function(t,e){this._dataSource=t,this._range=e;var i=t.url;this._config.reuseRedirectedURL&&null!=t.redirectedURL&&(i=t.redirectedURL);var n=this._seekHandler.getConfig(i,e);this._requestURL=n.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",n.url,!0),r.responseType="moz-chunked-arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onloadend=this._onLoadEnd.bind(this),r.onerror=this._onXhrError.bind(this),t.withCredentials&&(r.withCredentials=!0),"object"==typeof n.headers){var o=n.headers;for(var a in o)o.hasOwnProperty(a)&&r.setRequestHeader(a,o[a])}if("object"==typeof this._config.headers)for(var a in o=this._config.headers)o.hasOwnProperty(a)&&r.setRequestHeader(a,o[a]);this._status=s.c.kConnecting,r.send()},e.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=s.c.kComplete},e.prototype._onReadyStateChange=function(t){var e=t.target;if(2===e.readyState){if(null!=e.responseURL&&e.responseURL!==this._requestURL&&this._onURLRedirect){var i=this._seekHandler.removeURLParameters(e.responseURL);this._onURLRedirect(i)}if(0!==e.status&&(e.status<200||e.status>299)){if(this._status=s.c.kError,!this._onError)throw new h.d("MozChunkedLoader: Http code invalid, "+e.status+" "+e.statusText);this._onError(s.b.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}else this._status=s.c.kBuffering}},e.prototype._onProgress=function(t){if(this._status!==s.c.kError){null===this._contentLength&&null!==t.total&&0!==t.total&&(this._contentLength=t.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var e=t.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=e.byteLength,this._onDataArrival&&this._onDataArrival(e,i,this._receivedLength)}},e.prototype._onLoadEnd=function(t){!0!==this._requestAbort?this._status!==s.c.kError&&(this._status=s.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},e.prototype._onXhrError=function(t){this._status=s.c.kError;var e=0,i=null;if(this._contentLength&&t.loaded<this._contentLength?(e=s.b.EARLY_EOF,i={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(e=s.b.EXCEPTION,i={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new h.d(i.msg);this._onError(e,i)},e}(s.a),f=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),_=function(t){function e(e,i){var n=t.call(this,"xhr-range-loader")||this;return n.TAG="RangeLoader",n._seekHandler=e,n._config=i,n._needStash=!1,n._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],n._currentChunkSizeKB=384,n._currentSpeedNormalized=0,n._zeroSpeedChunkCount=0,n._xhr=null,n._speedSampler=new o,n._requestAbort=!1,n._waitForTotalLength=!1,n._totalLengthReceived=!1,n._currentRequestURL=null,n._currentRedirectedURL=null,n._currentRequestRange=null,n._totalLength=null,n._contentLength=null,n._receivedLength=0,n._lastTimeLoaded=0,n}return f(e,t),e.isSupported=function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="arraybuffer","arraybuffer"===t.responseType}catch(t){return r.a.w("RangeLoader",t.message),!1}},e.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),t.prototype.destroy.call(this)},Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),e.prototype.open=function(t,e){this._dataSource=t,this._range=e,this._status=s.c.kConnecting;var i=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(i=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||i?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},e.prototype._openSubRange=function(){var t=1024*this._currentChunkSizeKB,e=this._range.from+this._receivedLength,i=e+t;null!=this._contentLength&&i-this._range.from>=this._contentLength&&(i=this._range.from+this._contentLength-1),this._currentRequestRange={from:e,to:i},this._internalOpen(this._dataSource,this._currentRequestRange)},e.prototype._internalOpen=function(t,e){this._lastTimeLoaded=0;var i=t.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?i=this._currentRedirectedURL:null!=t.redirectedURL&&(i=t.redirectedURL));var n=this._seekHandler.getConfig(i,e);this._currentRequestURL=n.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",n.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),t.withCredentials&&(r.withCredentials=!0),"object"==typeof n.headers){var o=n.headers;for(var s in o)o.hasOwnProperty(s)&&r.setRequestHeader(s,o[s])}if("object"==typeof this._config.headers)for(var s in o=this._config.headers)o.hasOwnProperty(s)&&r.setRequestHeader(s,o[s]);r.send()},e.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=s.c.kComplete},e.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},e.prototype._onReadyStateChange=function(t){var e=t.target;if(2===e.readyState){if(null!=e.responseURL){var i=this._seekHandler.removeURLParameters(e.responseURL);e.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}if(e.status>=200&&e.status<=299){if(this._waitForTotalLength)return;this._status=s.c.kBuffering}else{if(this._status=s.c.kError,!this._onError)throw new h.d("RangeLoader: Http code invalid, "+e.status+" "+e.statusText);this._onError(s.b.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}}},e.prototype._onProgress=function(t){if(this._status!==s.c.kError){if(null===this._contentLength){var e=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,e=!0;var i=t.total;this._internalAbort(),null!=i&0!==i&&(this._totalLength=i)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,e)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var n=t.loaded-this._lastTimeLoaded;this._lastTimeLoaded=t.loaded,this._speedSampler.addBytes(n)}},e.prototype._normalizeSpeed=function(t){var e=this._chunkSizeKBList,i=e.length-1,n=0,r=0,o=i;if(t<e[0])return e[0];for(;r<=o;){if((n=r+Math.floor((o-r)/2))===i||t>=e[n]&&t<e[n+1])return e[n];e[n]<t?r=n+1:o=n-1}},e.prototype._onLoad=function(t){if(this._status!==s.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var e=this._speedSampler.lastSecondKBps;if(0===e&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(e=this._speedSampler.currentKBps)),0!==e){var i=this._normalizeSpeed(e);this._currentSpeedNormalized!==i&&(this._currentSpeedNormalized=i,this._currentChunkSizeKB=i)}var n=t.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var o=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():o=!0,this._onDataArrival&&this._onDataArrival(n,r,this._receivedLength),o&&(this._status=s.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},e.prototype._onXhrError=function(t){this._status=s.c.kError;var e=0,i=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(e=s.b.EARLY_EOF,i={code:-1,msg:"RangeLoader meet Early-Eof"}):(e=s.b.EXCEPTION,i={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new h.d(i.msg);this._onError(e,i)},e}(s.a),p=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),m=function(t){function e(){var e=t.call(this,"websocket-loader")||this;return e.TAG="WebSocketLoader",e._needStash=!0,e._ws=null,e._requestAbort=!1,e._receivedLength=0,e}return p(e,t),e.isSupported=function(){try{return void 0!==self.WebSocket}catch(t){return!1}},e.prototype.destroy=function(){this._ws&&this.abort(),t.prototype.destroy.call(this)},e.prototype.open=function(t){try{var e=this._ws=new self.WebSocket(t.url);e.binaryType="arraybuffer",e.onopen=this._onWebSocketOpen.bind(this),e.onclose=this._onWebSocketClose.bind(this),e.onmessage=this._onWebSocketMessage.bind(this),e.onerror=this._onWebSocketError.bind(this),this._status=s.c.kConnecting}catch(t){this._status=s.c.kError;var i={code:t.code,msg:t.message};if(!this._onError)throw new h.d(i.msg);this._onError(s.b.EXCEPTION,i)}},e.prototype.abort=function(){var t=this._ws;!t||0!==t.readyState&&1!==t.readyState||(this._requestAbort=!0,t.close()),this._ws=null,this._status=s.c.kComplete},e.prototype._onWebSocketOpen=function(t){this._status=s.c.kBuffering},e.prototype._onWebSocketClose=function(t){!0!==this._requestAbort?(this._status=s.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},e.prototype._onWebSocketMessage=function(t){var e=this;if(t.data instanceof ArrayBuffer)this._dispatchArrayBuffer(t.data);else if(t.data instanceof Blob){var i=new FileReader;i.onload=function(){e._dispatchArrayBuffer(i.result)},i.readAsArrayBuffer(t.data)}else{this._status=s.c.kError;var n={code:-1,msg:"Unsupported WebSocket message type: "+t.data.constructor.name};if(!this._onError)throw new h.d(n.msg);this._onError(s.b.EXCEPTION,n)}},e.prototype._dispatchArrayBuffer=function(t){var e=t,i=this._receivedLength;this._receivedLength+=e.byteLength,this._onDataArrival&&this._onDataArrival(e,i,this._receivedLength)},e.prototype._onWebSocketError=function(t){this._status=s.c.kError;var e={code:t.code,msg:t.message};if(!this._onError)throw new h.d(e.msg);this._onError(s.b.EXCEPTION,e)},e}(s.a),g=function(){function t(t){this._zeroStart=t||!1}return t.prototype.getConfig=function(t,e){var i={};if(0!==e.from||-1!==e.to){var n;n=-1!==e.to?"bytes="+e.from.toString()+"-"+e.to.toString():"bytes="+e.from.toString()+"-",i.Range=n}else this._zeroStart&&(i.Range="bytes=0-");return{url:t,headers:i}},t.prototype.removeURLParameters=function(t){return t},t}(),v=function(){function t(t,e){this._startName=t,this._endName=e}return t.prototype.getConfig=function(t,e){var i=t;if(0!==e.from||-1!==e.to){var n=!0;-1===i.indexOf("?")&&(i+="?",n=!1),n&&(i+="&"),i+=this._startName+"="+e.from.toString(),-1!==e.to&&(i+="&"+this._endName+"="+e.to.toString())}return{url:i,headers:{}}},t.prototype.removeURLParameters=function(t){var e=t.split("?")[0],i=void 0,n=t.indexOf("?");-1!==n&&(i=t.substring(n+1));var r="";if(null!=i&&i.length>0)for(var o=i.split("&"),s=0;s<o.length;s++){var a=o[s].split("="),h=s>0;a[0]!==this._startName&&a[0]!==this._endName&&(h&&(r+="&"),r+=o[s])}return 0===r.length?e:e+"?"+r},t}(),y=function(){function t(t,e,i){this.TAG="IOController",this._config=e,this._extraData=i,this._stashInitialSize=65536,null!=e.stashInitialSize&&e.stashInitialSize>0&&(this._stashInitialSize=e.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===e.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=t,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url),this._refTotalLength=t.filesize?t.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new o,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return t.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},t.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},t.prototype.isPaused=function(){return this._paused},Object.defineProperty(t.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extraData",{get:function(){return this._extraData},set:function(t){this._extraData=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(t){this._onSeeked=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onComplete",{get:function(){return this._onComplete},set:function(t){this._onComplete=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(t){this._onRedirect=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(t){this._onRecoveredEarlyEof=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._loaderClass===_?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),t.prototype._selectSeekHandler=function(){var t=this._config;if("range"===t.seekType)this._seekHandler=new g(this._config.rangeLoadZeroStart);else if("param"===t.seekType){var e=t.seekParamStart||"bstart",i=t.seekParamEnd||"bend";this._seekHandler=new v(e,i)}else{if("custom"!==t.seekType)throw new h.b("Invalid seekType in config: "+t.seekType);if("function"!=typeof t.customSeekHandler)throw new h.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new t.customSeekHandler}},t.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=m;else if(c.isSupported())this._loaderClass=c;else if(d.isSupported())this._loaderClass=d;else{if(!_.isSupported())throw new h.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=_}},t.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},t.prototype.open=function(t){this._currentRange={from:0,to:-1},t&&(this._currentRange.from=t),this._speedSampler.reset(),t||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},t.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},t.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},t.prototype.resume=function(){if(this._paused){this._paused=!1;var t=this._resumeFrom;this._resumeFrom=0,this._internalSeek(t,!0)}},t.prototype.seek=function(t){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(t,!0)},t.prototype._internalSeek=function(t,e){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(e),this._loader.destroy(),this._loader=null;var i={from:t,to:-1};this._currentRange={from:i.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,i),this._onSeeked&&this._onSeeked()},t.prototype.updateUrl=function(t){if(!t||"string"!=typeof t||0===t.length)throw new h.b("Url must be a non-empty string!");this._dataSource.url=t},t.prototype._expandBuffer=function(t){for(var e=this._stashSize;e+1048576<t;)e*=2;if((e+=1048576)!==this._bufferSize){var i=new ArrayBuffer(e);if(this._stashUsed>0){var n=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(i,0,e).set(n,0)}this._stashBuffer=i,this._bufferSize=e}},t.prototype._normalizeSpeed=function(t){var e=this._speedNormalizeList,i=e.length-1,n=0,r=0,o=i;if(t<e[0])return e[0];for(;r<=o;){if((n=r+Math.floor((o-r)/2))===i||t>=e[n]&&t<e[n+1])return e[n];e[n]<t?r=n+1:o=n-1}},t.prototype._adjustStashSize=function(t){var e=0;(e=this._config.isLive?t/8:t<512?t:t>=512&&t<=1024?Math.floor(1.5*t):2*t)>8192&&(e=8192);var i=1024*e+1048576;this._bufferSize<i&&this._expandBuffer(i),this._stashSize=1024*e},t.prototype._dispatchChunks=function(t,e){return this._currentRange.to=e+t.byteLength-1,this._onDataArrival(t,e)},t.prototype._onURLRedirect=function(t){this._redirectedURL=t,this._onRedirect&&this._onRedirect(t)},t.prototype._onContentLengthKnown=function(t){t&&this._fullRequestFlag&&(this._totalLength=t,this._fullRequestFlag=!1)},t.prototype._onLoaderChunkArrival=function(t,e,i){if(!this._onDataArrival)throw new h.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(t.byteLength);var n=this._speedSampler.lastSecondKBps;if(0!==n){var r=this._normalizeSpeed(n);this._speedNormalized!==r&&(this._speedNormalized=r,this._adjustStashSize(r))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=e),this._stashUsed+t.byteLength<=this._stashSize)(a=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength;else if(a=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var o=this._stashBuffer.slice(0,this._stashUsed);(l=this._dispatchChunks(o,this._stashByteStart))<o.byteLength?l>0&&(c=new Uint8Array(o,l),a.set(c,0),this._stashUsed=c.byteLength,this._stashByteStart+=l):(this._stashUsed=0,this._stashByteStart+=l),this._stashUsed+t.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+t.byteLength),a=new Uint8Array(this._stashBuffer,0,this._bufferSize)),a.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else(l=this._dispatchChunks(t,e))<t.byteLength&&((s=t.byteLength-l)>this._bufferSize&&(this._expandBuffer(s),a=new Uint8Array(this._stashBuffer,0,this._bufferSize)),a.set(new Uint8Array(t,l),0),this._stashUsed+=s,this._stashByteStart=e+l);else if(0===this._stashUsed){var s;(l=this._dispatchChunks(t,e))<t.byteLength&&((s=t.byteLength-l)>this._bufferSize&&this._expandBuffer(s),(a=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(t,l),0),this._stashUsed+=s,this._stashByteStart=e+l)}else{var a,l;if(this._stashUsed+t.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+t.byteLength),(a=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength,(l=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&l>0){var c=new Uint8Array(this._stashBuffer,l);a.set(c,0)}this._stashUsed-=l,this._stashByteStart+=l}}},t.prototype._flushStashBuffer=function(t){if(this._stashUsed>0){var e=this._stashBuffer.slice(0,this._stashUsed),i=this._dispatchChunks(e,this._stashByteStart),n=e.byteLength-i;if(i<e.byteLength){if(!t){if(i>0){var o=new Uint8Array(this._stashBuffer,0,this._bufferSize),s=new Uint8Array(e,i);o.set(s,0),this._stashUsed=s.byteLength,this._stashByteStart+=i}return 0}r.a.w(this.TAG,n+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,n}return 0},t.prototype._onLoaderComplete=function(t,e){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},t.prototype._onLoaderError=function(t,e){switch(r.a.e(this.TAG,"Loader error, code = "+e.code+", msg = "+e.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,t=s.b.UNRECOVERABLE_EARLY_EOF),t){case s.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var i=this._currentRange.to+1;return void(i<this._totalLength&&(r.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(i,!1)))}t=s.b.UNRECOVERABLE_EARLY_EOF;break;case s.b.UNRECOVERABLE_EARLY_EOF:case s.b.CONNECTING_TIMEOUT:case s.b.HTTP_STATUS_CODE_INVALID:case s.b.EXCEPTION:}if(!this._onError)throw new h.d("IOException: "+e.msg);this._onError(t,e)},t}();e.a=y},function(t,e,i){"use strict";var n=function(){function t(){}return t.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Object.assign=Object.assign||function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e},"function"!=typeof self.Promise&&i(15).polyfill()},t}();n.install(),e.a=n},function(t,e,i){function n(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var n=i(i.s=ENTRY_MODULE);return n.default||n}function r(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,e,n){var o={};o[n]=[];var s=e.toString(),a=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return o;for(var h,l=a[1],c=new RegExp("(\\\\n|\\W)"+r(l)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");h=c.exec(s);)"dll-reference"!==h[3]&&o[n].push(h[3]);for(c=new RegExp("\\("+r(l)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");h=c.exec(s);)t[h[2]]||(o[n].push(h[1]),t[h[2]]=i(h[1]).m),o[h[2]]=o[h[2]]||[],o[h[2]].push(h[4]);for(var u,d=Object.keys(o),f=0;f<d.length;f++)for(var _=0;_<o[d[f]].length;_++)u=o[d[f]][_],isNaN(1*u)||(o[d[f]][_]=1*o[d[f]][_]);return o}function s(t){return Object.keys(t).reduce(function(e,i){return e||t[i].length>0},!1)}t.exports=function(t,e){e=e||{};var r={main:i.m},a=e.all?{main:Object.keys(r.main)}:function(t,e){for(var i={main:[e]},n={main:[]},r={main:{}};s(i);)for(var a=Object.keys(i),h=0;h<a.length;h++){var l=a[h],c=i[l].pop();if(r[l]=r[l]||{},!r[l][c]&&t[l][c]){r[l][c]=!0,n[l]=n[l]||[],n[l].push(c);for(var u=o(t,t[l][c],l),d=Object.keys(u),f=0;f<d.length;f++)i[d[f]]=i[d[f]]||[],i[d[f]]=i[d[f]].concat(u[d[f]])}}return n}(r,t),h="";Object.keys(a).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;a[t][e];)e++;a[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+t+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map(function(e){return JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"}),h=h+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map(function(t){return JSON.stringify(t)+": "+r.main[t].toString()}).join(",")+"}))(self);";var l=new window.Blob([h],{type:"text/javascript"});if(e.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),u=new window.Worker(c);return u.objectURL=c,u}},function(t,e,i){t.exports=i(19).default},function(t,e,i){(function(e,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */
var n;n=function(){"use strict";function t(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,o=void 0,s=void 0,a=function(t,e){_[r]=t,_[r+1]=e,2===(r+=2)&&(s?s(p):x())},h="undefined"!=typeof window?window:void 0,l=h||{},c=l.MutationObserver||l.WebKitMutationObserver,u="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(p,1)}}var _=new Array(1e3);function p(){for(var t=0;t<r;t+=2)(0,_[t])(_[t+1]),_[t]=void 0,_[t+1]=void 0;r=0}var m,g,v,y,x=void 0;function w(t,e){var i=this,n=new this.constructor(C);void 0===n[A]&&O(n);var r=i._state;if(r){var o=arguments[r-1];a(function(){return L(r,n,o,i._result)})}else k(i,n,t,e);return n}function b(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(C);return E(e,t),e}u?x=function(){return e.nextTick(p)}:c?(g=0,v=new c(p),y=document.createTextNode(""),v.observe(y,{characterData:!0}),x=function(){y.data=g=++g%2}):d?((m=new MessageChannel).port1.onmessage=p,x=function(){return m.port2.postMessage(0)}):x=void 0===h?function(){try{var t=Function("return this")().require("vertx");return void 0!==(o=t.runOnLoop||t.runOnContext)?function(){o(p)}:f()}catch(t){return f()}}():f();var A=Math.random().toString(36).substring(2);function C(){}function S(e,i,n){i.constructor===e.constructor&&n===w&&i.constructor.resolve===b?function(t,e){1===e._state?M(t,e._result):2===e._state?T(t,e._result):k(e,void 0,function(e){return E(t,e)},function(e){return T(t,e)})}(e,i):void 0===n?M(e,i):t(n)?function(t,e,i){a(function(t){var n=!1,r=function(t,e,i,n){try{t.call(e,i,n)}catch(t){return t}}(i,e,function(i){n||(n=!0,e!==i?E(t,i):M(t,i))},function(e){n||(n=!0,T(t,e))},t._label);!n&&r&&(n=!0,T(t,r))},t)}(e,i,n):M(e,i)}function E(t,e){if(t===e)T(t,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(n=e),null===n||"object"!==r&&"function"!==r)M(t,e);else{var i=void 0;try{i=e.then}catch(e){return void T(t,e)}S(t,e,i)}var n,r}function P(t){t._onerror&&t._onerror(t._result),R(t)}function M(t,e){void 0===t._state&&(t._result=e,t._state=1,0!==t._subscribers.length&&a(R,t))}function T(t,e){void 0===t._state&&(t._state=2,t._result=e,a(P,t))}function k(t,e,i,n){var r=t._subscribers,o=r.length;t._onerror=null,r[o]=e,r[o+1]=i,r[o+2]=n,0===o&&t._state&&a(R,t)}function R(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,r=void 0,o=t._result,s=0;s<e.length;s+=3)n=e[s],r=e[s+i],n?L(i,n,r,o):r(o);t._subscribers.length=0}}function L(e,i,n,r){var o=t(n),s=void 0,a=void 0,h=!0;if(o){try{s=n(r)}catch(t){h=!1,a=t}if(i===s)return void T(i,new TypeError("A promises callback cannot return that same promise."))}else s=r;void 0!==i._state||(o&&h?E(i,s):!1===h?T(i,a):1===e?M(i,s):2===e&&T(i,s))}var D=0;function O(t){t[A]=D++,t._state=void 0,t._result=void 0,t._subscribers=[]}var I=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(C),this.promise[A]||O(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?M(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&M(this.promise,this._result))):T(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;void 0===this._state&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===b){var r=void 0,o=void 0,s=!1;try{r=t.then}catch(t){s=!0,o=t}if(r===w&&void 0!==t._state)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(i===B){var a=new i(C);s?T(a,o):S(a,t,r),this._willSettleAt(a,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,i){var n=this.promise;void 0===n._state&&(this._remaining--,2===t?T(n,i):this._result[e]=i),0===this._remaining&&M(n,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;k(t,void 0,function(t){return i._settledAt(1,e,t)},function(t){return i._settledAt(2,e,t)})},t}(),B=function(){function e(t){this[A]=D++,this._result=this._state=void 0,this._subscribers=[],C!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e(function(e){E(t,e)},function(e){T(t,e)})}catch(e){T(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this.constructor;return t(e)?this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return B.prototype.then=w,B.all=function(t){return new I(this,t).promise},B.race=function(t){var e=this;return n(t)?new e(function(i,n){for(var r=t.length,o=0;o<r;o++)e.resolve(t[o]).then(i,n)}):new e(function(t,e){return e(new TypeError("You must pass an array to race."))})},B.resolve=b,B.reject=function(t){var e=new this(C);return T(e,t),e},B._setScheduler=function(t){s=t},B._setAsap=function(t){a=t},B._asap=a,B.polyfill=function(){var t=void 0;if(void 0!==i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=B},B.Promise=B,B},t.exports=n()}).call(this,i(16),i(17))},function(t,e){var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var h,l=[],c=!1,u=-1;function d(){c&&h&&(c=!1,h.length?l=h.concat(l):u=-1,l.length&&f())}function f(){if(!c){var t=a(d);c=!0;for(var e=l.length;e;){for(h=l,l=[];++u<e;)h&&h[u].run();u=-1,e=l.length}h=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new _(t,e)),1!==l.length||c||a(f)},_.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";i.r(e);var n=i(9),r=i(12),o=i(10),s=i(1);e.default=function(t){var e=null,i=function(e,i){t.postMessage({msg:"logcat_callback",data:{type:e,logcat:i}})}.bind(this);r.a.install(),t.addEventListener("message",function(r){switch(r.data.cmd){case"init":(e=new o.a(r.data.param[0],r.data.param[1])).on(s.a.IO_ERROR,function(e,i){t.postMessage({msg:s.a.IO_ERROR,data:{type:e,info:i}})}.bind(this)),e.on(s.a.DEMUX_ERROR,function(e,i){t.postMessage({msg:s.a.DEMUX_ERROR,data:{type:e,info:i}})}.bind(this)),e.on(s.a.INIT_SEGMENT,function(e,i){var n={msg:s.a.INIT_SEGMENT,data:{type:e,data:i}};t.postMessage(n,[i.data])}.bind(this)),e.on(s.a.MEDIA_SEGMENT,function(e,i){var n={msg:s.a.MEDIA_SEGMENT,data:{type:e,data:i}};t.postMessage(n,[i.data])}.bind(this)),e.on(s.a.LOADING_COMPLETE,function(){var e={msg:s.a.LOADING_COMPLETE};t.postMessage(e)}.bind(this)),e.on(s.a.RECOVERED_EARLY_EOF,function(){var e={msg:s.a.RECOVERED_EARLY_EOF};t.postMessage(e)}.bind(this)),e.on(s.a.MEDIA_INFO,function(e){var i={msg:s.a.MEDIA_INFO,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.METADATA_ARRIVED,function(e){var i={msg:s.a.METADATA_ARRIVED,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.SCRIPTDATA_ARRIVED,function(e){var i={msg:s.a.SCRIPTDATA_ARRIVED,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.TIMED_ID3_METADATA_ARRIVED,function(e){var i={msg:s.a.TIMED_ID3_METADATA_ARRIVED,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.SMPTE2038_METADATA_ARRIVED,function(e){var i={msg:s.a.SMPTE2038_METADATA_ARRIVED,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.SCTE35_METADATA_ARRIVED,function(e){var i={msg:s.a.SCTE35_METADATA_ARRIVED,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.PES_PRIVATE_DATA_DESCRIPTOR,function(e){var i={msg:s.a.PES_PRIVATE_DATA_DESCRIPTOR,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.PES_PRIVATE_DATA_ARRIVED,function(e){var i={msg:s.a.PES_PRIVATE_DATA_ARRIVED,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.STATISTICS_INFO,function(e){var i={msg:s.a.STATISTICS_INFO,data:e};t.postMessage(i)}.bind(this)),e.on(s.a.RECOMMEND_SEEKPOINT,function(e){t.postMessage({msg:s.a.RECOMMEND_SEEKPOINT,data:e})}.bind(this));break;case"destroy":e&&(e.destroy(),e=null),t.postMessage({msg:"destroyed"});break;case"start":e.start();break;case"stop":e.stop();break;case"seek":e.seek(r.data.param);break;case"pause":e.pause();break;case"resume":e.resume();break;case"logging_config":var a=r.data.param;n.a.applyConfig(a),!0===a.enableCallback?n.a.addLogListener(i):n.a.removeLogListener(i)}})}},function(t,e,i){"use strict";i.r(e);var n=i(12),r=i(11),o={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function s(){return Object.assign({},o)}var a=function(){function t(){}return t.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},t.supportMSEH265Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')},t.supportNetworkStreamIO=function(){var t=new r.a({},s()),e=t.loaderType;return t.destroy(),"fetch-stream-loader"==e||"xhr-moz-chunked-loader"==e},t.getNetworkLoaderTypeName=function(){var t=new r.a({},s()),e=t.loaderType;return t.destroy(),e},t.supportNativeMediaPlayback=function(e){null==t.videoElement&&(t.videoElement=window.document.createElement("video"));var i=t.videoElement.canPlayType(e);return"probably"===i||"maybe"==i},t.getFeatureList=function(){var e={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return e.msePlayback=t.supportMSEH264Playback(),e.networkStreamIO=t.supportNetworkStreamIO(),e.networkLoaderName=t.getNetworkLoaderTypeName(),e.mseLivePlayback=e.msePlayback&&e.networkStreamIO,e.mseH265Playback=t.supportMSEH265Playback(),e.nativeMP4H264Playback=t.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),e.nativeMP4H265Playback=t.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),e.nativeWebmVP8Playback=t.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),e.nativeWebmVP9Playback=t.supportNativeMediaPlayback('video/webm; codecs="vp9"'),e},t}(),h=i(2),l=i(6),c=i.n(l),u=i(0),d=i(4),f={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info"},_=i(13),p=i.n(_),m=i(9),g=i(10),v=i(1),y=i(8),x=function(){function t(t,e){if(this.TAG="Transmuxer",this._emitter=new c.a,e.enableWorker&&"undefined"!=typeof Worker)try{this._worker=p()(18),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[t,e]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},m.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:m.a.getConfig()})}catch(i){u.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new g.a(t,e)}else this._controller=new g.a(t,e);if(this._controller){var i=this._controller;i.on(v.a.IO_ERROR,this._onIOError.bind(this)),i.on(v.a.DEMUX_ERROR,this._onDemuxError.bind(this)),i.on(v.a.INIT_SEGMENT,this._onInitSegment.bind(this)),i.on(v.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),i.on(v.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),i.on(v.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),i.on(v.a.MEDIA_INFO,this._onMediaInfo.bind(this)),i.on(v.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),i.on(v.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),i.on(v.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),i.on(v.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),i.on(v.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),i.on(v.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),i.on(v.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),i.on(v.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),i.on(v.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return t.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),m.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.hasWorker=function(){return null!=this._worker},t.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},t.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},t.prototype.seek=function(t){this._worker?this._worker.postMessage({cmd:"seek",param:t}):this._controller.seek(t)},t.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},t.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},t.prototype._onInitSegment=function(t,e){var i=this;Promise.resolve().then(function(){i._emitter.emit(v.a.INIT_SEGMENT,t,e)})},t.prototype._onMediaSegment=function(t,e){var i=this;Promise.resolve().then(function(){i._emitter.emit(v.a.MEDIA_SEGMENT,t,e)})},t.prototype._onLoadingComplete=function(){var t=this;Promise.resolve().then(function(){t._emitter.emit(v.a.LOADING_COMPLETE)})},t.prototype._onRecoveredEarlyEof=function(){var t=this;Promise.resolve().then(function(){t._emitter.emit(v.a.RECOVERED_EARLY_EOF)})},t.prototype._onMediaInfo=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.MEDIA_INFO,t)})},t.prototype._onMetaDataArrived=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.METADATA_ARRIVED,t)})},t.prototype._onScriptDataArrived=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.SCRIPTDATA_ARRIVED,t)})},t.prototype._onTimedID3MetadataArrived=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.TIMED_ID3_METADATA_ARRIVED,t)})},t.prototype._onSMPTE2038MetadataArrived=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.SMPTE2038_METADATA_ARRIVED,t)})},t.prototype._onSCTE35MetadataArrived=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.SCTE35_METADATA_ARRIVED,t)})},t.prototype._onPESPrivateDataDescriptor=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.PES_PRIVATE_DATA_DESCRIPTOR,t)})},t.prototype._onPESPrivateDataArrived=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.PES_PRIVATE_DATA_ARRIVED,t)})},t.prototype._onStatisticsInfo=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.STATISTICS_INFO,t)})},t.prototype._onIOError=function(t,e){var i=this;Promise.resolve().then(function(){i._emitter.emit(v.a.IO_ERROR,t,e)})},t.prototype._onDemuxError=function(t,e){var i=this;Promise.resolve().then(function(){i._emitter.emit(v.a.DEMUX_ERROR,t,e)})},t.prototype._onRecommendSeekpoint=function(t){var e=this;Promise.resolve().then(function(){e._emitter.emit(v.a.RECOMMEND_SEEKPOINT,t)})},t.prototype._onLoggingConfigChanged=function(t){this._worker&&this._worker.postMessage({cmd:"logging_config",param:t})},t.prototype._onWorkerMessage=function(t){var e=t.data,i=e.data;if("destroyed"===e.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(e.msg){case v.a.INIT_SEGMENT:case v.a.MEDIA_SEGMENT:this._emitter.emit(e.msg,i.type,i.data);break;case v.a.LOADING_COMPLETE:case v.a.RECOVERED_EARLY_EOF:this._emitter.emit(e.msg);break;case v.a.MEDIA_INFO:Object.setPrototypeOf(i,y.a.prototype),this._emitter.emit(e.msg,i);break;case v.a.METADATA_ARRIVED:case v.a.SCRIPTDATA_ARRIVED:case v.a.TIMED_ID3_METADATA_ARRIVED:case v.a.SMPTE2038_METADATA_ARRIVED:case v.a.SCTE35_METADATA_ARRIVED:case v.a.PES_PRIVATE_DATA_DESCRIPTOR:case v.a.PES_PRIVATE_DATA_ARRIVED:case v.a.STATISTICS_INFO:this._emitter.emit(e.msg,i);break;case v.a.IO_ERROR:case v.a.DEMUX_ERROR:this._emitter.emit(e.msg,i.type,i.info);break;case v.a.RECOMMEND_SEEKPOINT:this._emitter.emit(e.msg,i);break;case"logcat_callback":u.a.emitter.emit("log",i.type,i.logcat)}},t}(),w="error",b="source_open",A="update_end",C="buffer_full",S=i(7),E=i(3),P=function(){function t(t){this.TAG="MSEController",this._config=t,this._emitter=new c.a,this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new S.a}return t.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new E.a("MediaSource has been attached to an HTMLMediaElement!");var e=this._mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},t.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var e in this._sourceBuffers){var i=this._pendingSegments[e];i.splice(0,i.length),this._pendingSegments[e]=null,this._pendingRemoveRanges[e]=null,this._lastInitSegments[e]=null;var n=this._sourceBuffers[e];if(n){if("closed"!==t.readyState){try{t.removeSourceBuffer(n)}catch(t){u.a.e(this.TAG,t.message)}n.removeEventListener("error",this.e.onSourceBufferError),n.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[e]=null,this._sourceBuffers[e]=null}}if("open"===t.readyState)try{t.endOfStream()}catch(t){u.a.e(this.TAG,t.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},t.prototype.appendInitSegment=function(t,e){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(t),void this._pendingSegments[t.type].push(t);var i=t,n=""+i.container;i.codec&&i.codec.length>0&&(n+=";codecs="+i.codec);var r=!1;if(u.a.v(this.TAG,"Received Initialization Segment, mimeType: "+n),this._lastInitSegments[i.type]=i,n!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])u.a.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+n);else{r=!0;try{var o=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(n);o.addEventListener("error",this.e.onSourceBufferError),o.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(t){return u.a.e(this.TAG,t.message),void this._emitter.emit(w,{code:t.code,msg:t.message})}}this._mimeTypes[i.type]=n}e||this._pendingSegments[i.type].push(i),r||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),d.a.safari&&"audio/mpeg"===i.container&&i.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())},t.prototype.appendMediaSegment=function(t){var e=t;this._pendingSegments[e.type].push(e),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[e.type];!i||i.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},t.prototype.seek=function(t){for(var e in this._sourceBuffers)if(this._sourceBuffers[e]){var i=this._sourceBuffers[e];if("open"===this._mediaSource.readyState)try{i.abort()}catch(t){u.a.e(this.TAG,t.message)}this._idrList.clear();var n=this._pendingSegments[e];if(n.splice(0,n.length),"closed"!==this._mediaSource.readyState){for(var r=0;r<i.buffered.length;r++){var o=i.buffered.start(r),s=i.buffered.end(r);this._pendingRemoveRanges[e].push({start:o,end:s})}if(i.updating||this._doRemoveRanges(),d.a.safari){var a=this._lastInitSegments[e];a&&(this._pendingSegments[e].push(a),i.updating||this._doAppendSegments())}}}},t.prototype.endOfStream=function(){var t=this._mediaSource,e=this._sourceBuffers;t&&"open"===t.readyState?e.video&&e.video.updating||e.audio&&e.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream()):t&&"closed"===t.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},t.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},t.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var i=this._sourceBuffers[e];if(i){var n=i.buffered;if(n.length>=1&&t-n.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},t.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var i=this._sourceBuffers[e];if(i){for(var n=i.buffered,r=!1,o=0;o<n.length;o++){var s=n.start(o),a=n.end(o);if(s<=t&&t<a+3){if(t-s>=this._config.autoCleanupMaxBackwardDuration){r=!0;var h=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[e].push({start:s,end:h})}}else a<t&&(r=!0,this._pendingRemoveRanges[e].push({start:s,end:a}))}r&&!i.updating&&this._doRemoveRanges()}}},t.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var e=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(isNaN(e)||i>e)&&(u.a.v(this.TAG,"Update MediaSource duration from "+e+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},t.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating)for(var e=this._sourceBuffers[t],i=this._pendingRemoveRanges[t];i.length&&!e.updating;){var n=i.shift();e.remove(n.start,n.end)}},t.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var e in t)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating&&t[e].length>0){var i=t[e].shift();if(i.timestampOffset){var n=this._sourceBuffers[e].timestampOffset,r=i.timestampOffset/1e3;Math.abs(n-r)>.1&&(u.a.v(this.TAG,"Update MPEG audio timestampOffset from "+n+" to "+r),this._sourceBuffers[e].timestampOffset=r),delete i.timestampOffset}if(!i.data||0===i.data.byteLength)continue;try{this._sourceBuffers[e].appendBuffer(i.data),this._isBufferFull=!1,"video"===e&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(t){this._pendingSegments[e].unshift(i),22===t.code?(this._isBufferFull||this._emitter.emit(C),this._isBufferFull=!0):(u.a.e(this.TAG,t.message),this._emitter.emit(w,{code:t.code,msg:t.message}))}}},t.prototype._onSourceOpen=function(){if(u.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var e=t.shift();this.appendInitSegment(e,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(b)},t.prototype._onSourceEnded=function(){u.a.v(this.TAG,"MediaSource onSourceEnded")},t.prototype._onSourceClose=function(){u.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},t.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},t.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},t.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(A)},t.prototype._onSourceBufferError=function(t){u.a.e(this.TAG,"SourceBuffer Error: "+t)},t}(),M=i(5),T={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},k={NETWORK_EXCEPTION:h.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:h.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:h.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:h.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:M.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:M.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:M.a.CODEC_UNSUPPORTED},R=function(){function t(t,e){this.TAG="MSEPlayer",this._type="MSEPlayer",this._emitter=new c.a,this._config=s(),"object"==typeof e&&Object.assign(this._config,e);var i=t.type.toLowerCase();if("mse"!==i&&"mpegts"!==i&&"m2ts"!==i&&"flv"!==i)throw new E.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");!0===t.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=t,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var n=d.a.chrome&&(d.a.version.major<50||50===d.a.version.major&&d.a.version.build<2661);this._alwaysSeekKeyframe=!!(n||d.a.msedge||d.a.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return t.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){var i=this;t===f.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then(function(){i._emitter.emit(f.MEDIA_INFO,i.mediaInfo)}):t===f.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then(function(){i._emitter.emit(f.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.attachMediaElement=function(t){var e=this;if(this._mediaElement=t,t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),t.addEventListener("seeking",this.e.onvSeeking),t.addEventListener("canplay",this.e.onvCanPlay),t.addEventListener("stalled",this.e.onvStalled),t.addEventListener("progress",this.e.onvProgress),this._msectl=new P(this._config),this._msectl.on(A,this._onmseUpdateEnd.bind(this)),this._msectl.on(C,this._onmseBufferFull.bind(this)),this._msectl.on(b,function(){e._mseSourceOpened=!0,e._hasPendingLoad&&(e._hasPendingLoad=!1,e.load())}),this._msectl.on(w,function(t){e._emitter.emit(f.ERROR,T.MEDIA_ERROR,k.MEDIA_MSE_ERROR,t)}),this._msectl.attachMediaElement(t),null!=this._pendingSeekTime)try{t.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}},t.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},t.prototype.load=function(){var t=this;if(!this._mediaElement)throw new E.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new E.a("MSEPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new x(this._mediaDataSource,this._config),this._transmuxer.on(v.a.INIT_SEGMENT,function(e,i){t._msectl.appendInitSegment(i)}),this._transmuxer.on(v.a.MEDIA_SEGMENT,function(e,i){if(t._msectl.appendMediaSegment(i),t._config.lazyLoad&&!t._config.isLive){var n=t._mediaElement.currentTime;i.info.endDts>=1e3*(n+t._config.lazyLoadMaxDuration)&&null==t._progressChecker&&(u.a.v(t.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),t._suspendTransmuxer())}}),this._transmuxer.on(v.a.LOADING_COMPLETE,function(){t._msectl.endOfStream(),t._emitter.emit(f.LOADING_COMPLETE)}),this._transmuxer.on(v.a.RECOVERED_EARLY_EOF,function(){t._emitter.emit(f.RECOVERED_EARLY_EOF)}),this._transmuxer.on(v.a.IO_ERROR,function(e,i){t._emitter.emit(f.ERROR,T.NETWORK_ERROR,e,i)}),this._transmuxer.on(v.a.DEMUX_ERROR,function(e,i){t._emitter.emit(f.ERROR,T.MEDIA_ERROR,e,{code:-1,msg:i})}),this._transmuxer.on(v.a.MEDIA_INFO,function(e){t._mediaInfo=e,t._emitter.emit(f.MEDIA_INFO,Object.assign({},e))}),this._transmuxer.on(v.a.METADATA_ARRIVED,function(e){t._emitter.emit(f.METADATA_ARRIVED,e)}),this._transmuxer.on(v.a.SCRIPTDATA_ARRIVED,function(e){t._emitter.emit(f.SCRIPTDATA_ARRIVED,e)}),this._transmuxer.on(v.a.TIMED_ID3_METADATA_ARRIVED,function(e){t._emitter.emit(f.TIMED_ID3_METADATA_ARRIVED,e)}),this._transmuxer.on(v.a.SMPTE2038_METADATA_ARRIVED,function(e){t._emitter.emit(f.SMPTE2038_METADATA_ARRIVED,e)}),this._transmuxer.on(v.a.SCTE35_METADATA_ARRIVED,function(e){t._emitter.emit(f.SCTE35_METADATA_ARRIVED,e)}),this._transmuxer.on(v.a.PES_PRIVATE_DATA_DESCRIPTOR,function(e){t._emitter.emit(f.PES_PRIVATE_DATA_DESCRIPTOR,e)}),this._transmuxer.on(v.a.PES_PRIVATE_DATA_ARRIVED,function(e){t._emitter.emit(f.PES_PRIVATE_DATA_ARRIVED,e)}),this._transmuxer.on(v.a.STATISTICS_INFO,function(e){t._statisticsInfo=t._fillStatisticsInfo(e),t._emitter.emit(f.STATISTICS_INFO,Object.assign({},t._statisticsInfo))}),this._transmuxer.on(v.a.RECOMMEND_SEEKPOINT,function(e){t._mediaElement&&!t._config.accurateSeek&&(t._requestSetTime=!0,t._mediaElement.currentTime=e/1e3)}),this._transmuxer.open()))},t.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},t.prototype.play=function(){return this._mediaElement.play()},t.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(t){this._mediaElement.volume=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(t){this._mediaElement.muted=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(t){this._mediaElement?this._internalSeek(t):this._pendingSeekTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),t.prototype._fillStatisticsInfo=function(t){if(t.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return t;var e=!0,i=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();i=r.totalVideoFrames,n=r.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(t.decodedFrames=i,t.droppedFrames=n),t},t.prototype._onmseUpdateEnd=function(){var t=this._mediaElement.buffered,e=this._mediaElement.currentTime;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&t.length>0&&!this._mediaElement.paused){var i=t.end(t.length-1);if(i>this._config.liveBufferLatencyMaxLatency&&i-e>this._config.liveBufferLatencyMaxLatency){var n=i-this._config.liveBufferLatencyMinRemain;this.currentTime=n}}if(this._config.lazyLoad&&!this._config.isLive){for(var r=0,o=0;o<t.length;o++){var s=t.start(o),a=t.end(o);if(s<=e&&e<a){r=a;break}}r>=e+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(u.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},t.prototype._onmseBufferFull=function(){u.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},t.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},t.prototype._checkProgressAndResume=function(){for(var t=this._mediaElement.currentTime,e=this._mediaElement.buffered,i=!1,n=0;n<e.length;n++){var r=e.start(n),o=e.end(n);if(t>=r&&t<o){t>=o-this._config.lazyLoadRecoverDuration&&(i=!0);break}}i&&(window.clearInterval(this._progressChecker),this._progressChecker=null,i&&(u.a.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},t.prototype._isTimepointBuffered=function(t){for(var e=this._mediaElement.buffered,i=0;i<e.length;i++){var n=e.start(i),r=e.end(i);if(t>=n&&t<r)return!0}return!1},t.prototype._internalSeek=function(t){var e=this._isTimepointBuffered(t),i=!1,n=0;if(t<1&&this._mediaElement.buffered.length>0){var r=this._mediaElement.buffered.start(0);(r<1&&t<r||d.a.safari)&&(i=!0,n=d.a.safari?.1:r)}if(i)this._requestSetTime=!0,this._mediaElement.currentTime=n;else if(e){if(this._alwaysSeekKeyframe){var o=this._msectl.getNearestKeyframe(Math.floor(1e3*t));this._requestSetTime=!0,this._mediaElement.currentTime=null!=o?o.dts/1e3:t}else this._requestSetTime=!0,this._mediaElement.currentTime=t;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(t),this._transmuxer.seek(Math.floor(1e3*t)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=t)},t.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var t=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(t)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(t),this._transmuxer.seek(Math.floor(1e3*t)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=t))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},t.prototype._checkAndResumeStuckPlayback=function(t){var e=this._mediaElement;if(t||!this._receivedCanPlay||e.readyState<2){var i=e.buffered;i.length>0&&e.currentTime<i.start(0)&&(u.a.w(this.TAG,"Playback seems stuck at "+e.currentTime+", seek to "+i.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=i.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},t.prototype._onvLoadedMetadata=function(t){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},t.prototype._onvSeeking=function(t){var e=this._mediaElement.currentTime,i=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(e<1&&i.length>0){var n=i.start(0);if(n<1&&e<n||d.a.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=d.a.safari?.1:n)}if(this._isTimepointBuffered(e)){if(this._alwaysSeekKeyframe){var r=this._msectl.getNearestKeyframe(Math.floor(1e3*e));null!=r&&(this._requestSetTime=!0,this._mediaElement.currentTime=r.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:e,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},t.prototype._onvCanPlay=function(t){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},t.prototype._onvStalled=function(t){this._checkAndResumeStuckPlayback(!0)},t.prototype._onvProgress=function(t){this._checkAndResumeStuckPlayback()},t}(),L=function(){function t(t,e){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new c.a,this._config=s(),"object"==typeof e&&Object.assign(this._config,e);var i=t.type.toLowerCase();if("mse"===i||"mpegts"===i||"m2ts"===i||"flv"===i)throw new E.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(t.hasOwnProperty("segments"))throw new E.b("NativePlayer("+t.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=t,this._mediaElement=null}return t.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){var i=this;t===f.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(f.MEDIA_INFO,i.mediaInfo)}):t===f.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(f.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.attachMediaElement=function(t){if(this._mediaElement=t,t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{t.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}},t.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},t.prototype.load=function(){if(!this._mediaElement)throw new E.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},t.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},t.prototype.play=function(){return this._mediaElement.play()},t.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(t){this._mediaElement.volume=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(t){this._mediaElement.muted=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(t){this._mediaElement?this._mediaElement.currentTime=t:this._pendingSeekTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaInfo",{get:function(){var t={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(t.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(t.width=this._mediaElement.videoWidth,t.height=this._mediaElement.videoHeight)),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statisticsInfo",{get:function(){var t={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return t;var e=!0,i=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();i=r.totalVideoFrames,n=r.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(t.decodedFrames=i,t.droppedFrames=n),t},enumerable:!1,configurable:!0}),t.prototype._onvLoadedMetadata=function(t){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(f.MEDIA_INFO,this.mediaInfo)},t.prototype._reportStatisticsInfo=function(){this._emitter.emit(f.STATISTICS_INFO,this.statisticsInfo)},t}();n.a.install();var D={createPlayer:function(t,e){var i=t;if(null==i||"object"!=typeof i)throw new E.b("MediaDataSource must be an javascript object!");if(!i.hasOwnProperty("type"))throw new E.b("MediaDataSource must has type field to indicate video file type!");switch(i.type){case"mse":case"mpegts":case"m2ts":case"flv":return new R(i,e);default:return new L(i,e)}},isSupported:function(){return a.supportMSEH264Playback()},getFeatureList:function(){return a.getFeatureList()}};D.BaseLoader=h.a,D.LoaderStatus=h.c,D.LoaderErrors=h.b,D.Events=f,D.ErrorTypes=T,D.ErrorDetails=k,D.MSEPlayer=R,D.NativePlayer=L,D.LoggingControl=m.a,Object.defineProperty(D,"version",{enumerable:!0,get:function(){return"1.7.3"}}),e.default=D}])},t.exports=n()},"nbn+":function(t,e,i){(function(e,i){!function(e){"use strict";var n,r,o="fulfilled",s="undefined",a=function(){var t=[],n=0;function o(){for(;t.length-n;){try{t[n]()}catch(t){e.console&&e.console.error(t)}t[n++]=r,1024==n&&(t.splice(0,1024),n=0)}}var a=function(){if(typeof MutationObserver===s)return typeof i!==s&&"function"==typeof i.nextTick?function(){i.nextTick(o)}:typeof setImmediate!==s?function(){setImmediate(o)}:function(){setTimeout(o,0)};var t=document.createElement("div");return new MutationObserver(o).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}();return function(e){t.push(e),t.length-n==1&&a()}}();function h(t){if(!(this instanceof h))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof t){var e=this;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(t){e.reject(t)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+t+" is not a function")}function l(t,e){if("function"==typeof t.y)try{var i=t.y.call(r,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.resolve(e)}function c(t,e){if("function"==typeof t.n)try{var i=t.n.call(r,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.reject(e)}h.prototype={resolve:function(t){if(this.state===n){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var e=this;if(t&&("function"==typeof t||"object"==typeof t))try{var i=!0,r=t.then;if("function"==typeof r)return void r.call(t,function(t){i&&(i=!1,e.resolve(t))},function(t){i&&(i=!1,e.reject(t))})}catch(r){return void(i&&this.reject(r))}this.state=o,this.v=t,e.c&&a(function(){for(var i=0,n=e.c.length;i<n;i++)l(e.c[i],t)})}},reject:function(t){if(this.state===n){var i=this;this.state="rejected",this.v=t;var r=this.c;a(r?function(){for(var e=0,i=r.length;e<i;e++)c(r[e],t)}:function(){i.handled||!h.suppressUncaughtRejectionError&&e.console&&h.warn("You upset Zousan. Please catch rejections: ",t,t?t.stack:null)})}},then:function(t,e){var i=new h,r={y:t,n:e,p:i};if(this.state===n)this.c?this.c.push(r):this.c=[r];else{var s=this.state,u=this.v;this.handled=!0,a(function(){s===o?l(r,u):c(r,u)})}return i},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,e){e=e||"Timeout";var i=this;return new h(function(n,r){setTimeout(function(){r(Error(e))},t),i.then(function(t){n(t)},function(t){r(t)})})}},h.resolve=function(t){var e=new h;return e.resolve(t),e},h.reject=function(t){var e=new h;return e.c=[],e.reject(t),e},h.all=function(t){var e=[],i=0,n=new h;function r(r,o){r&&"function"==typeof r.then||(r=h.resolve(r)),r.then(function(r){e[o]=r,++i==t.length&&n.resolve(e)},function(t){n.reject(t)})}for(var o=0;o<t.length;o++)r(t[o],o);return t.length||n.resolve(e),n},h.warn=console.warn,typeof t!=s&&t.exports&&(t.exports=h),e.define&&e.define.amd&&e.define([],function(){return h}),(e.Zousan=h).soon=a}(void 0!==e?e:this)}).call(e,i("DuR2"),i("W2nU"))},nmoT:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("Jw2W"),r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.title,visible:t.dialogVisible1,width:"720px",height:"480px","show-close":"","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible1=e}}},[i("div",{staticStyle:{height:"380px",overflow:"auto"}},[i("div",{staticStyle:{width:"600px",margin:"10px"}},[i("el-form",{attrs:{"label-position":"right","label-width":"120px",size:"mini"}},[i("el-form-item",{attrs:{label:"指令",rules:[{required:!0}]}},[i("div",[i("b",[t._v(t._s(t.cmd.name))])]),t._v(" "),i("div",{staticStyle:{"font-size":"12px",color:"#999"}},[t._v(t._s(t.cmd.remark))])]),t._v(" "),t._l(t.fields,function(e,n){return i("el-form-item",{key:n,attrs:{label:e.name,rules:[{required:!0}]}},["text"!=e.inputType&&e.inputType?t._e():i("el-input",{model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}}),t._v(" "),"checkbox"==e.inputType?i("el-checkbox-group",{model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}},t._l(e.optionitem,function(n,r){return i("el-checkbox",{key:r,attrs:{name:"itemcode",label:n.value,"data-value":e.value}},[i("span",{domProps:{innerHTML:t._s(n.text)}})])}),1):t._e(),t._v(" "),"combobox"==e.inputType?i("el-select",{attrs:{placeholder:""},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}},t._l(e.optionitem,function(t){return i("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})}),1):t._e()],1)})],2)],1)]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.ok}},[t._v("确 定")]),t._v(" "),i("el-button",{attrs:{size:"medium"},on:{click:t.closeDialog}},[t._v("关 闭")])],1)])],1)},staticRenderFns:[]};var o=function(t){i("algf")},s=i("VU/8")(n.a,r,!1,o,"data-v-eef23278",null);e.default=s.exports},ow4a:function(t,e,i){"use strict";(function(t){i.d(e,"g",function(){return ko}),i.d(e,"m",function(){return Ua}),i.d(e,"e",function(){return Rs}),i.d(e,"a",function(){return la}),i.d(e,"d",function(){return ha}),i.d(e,"c",function(){return tn}),i.d(e,"j",function(){return ah}),i.d(e,"l",function(){return _h}),i.d(e,"k",function(){return Ps}),i.d(e,"b",function(){return as}),i.d(e,"f",function(){return Ko}),i.d(e,"h",function(){return Yo}),i.d(e,"i",function(){return Wo});var n=i("nbn+"),r=i.n(n),o=i("emf4"),s=i.n(o),a=i("QLfZ"),h=i.n(a),l=i("dEjA"),c=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],u=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(c),d=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],f=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],_={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},p=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],m=14;function g(){return Date.now()}function v(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function y(t){return null==t}function x(t){return"number"==typeof t&&!isNaN(t)}function w(t){return(0|t)===t}function b(t){return"object"==typeof t&&!!t}function A(t){return!y(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function C(t){return!y(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var S=Object.prototype.hasOwnProperty;function E(t,e){return S.call(t,e)}var P=Math.PI/180;function M(t){return t*P}function T(t){return t/P}var k="[object process]"===Object.prototype.toString.call(void 0!==t?t:0)&&!t.versions.electron&&!t.versions.nw&&!t.versions["node-webkit"],R={},L={};function D(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!k){var O=navigator.userAgent.toLowerCase(),I=document.documentElement,B="ActiveXObject"in window,j=-1!==O.indexOf("webkit"),z=-1!==O.indexOf("phantom"),G=-1!==O.search("android [23]"),N=-1!==O.indexOf("chrome"),F=-1!==O.indexOf("gecko")&&!j&&!window.opera&&!B,U="undefined"!=typeof orientation||-1!==O.indexOf("mobile"),H=!window.PointerEvent&&window.MSPointerEvent,V=window.PointerEvent&&navigator.pointerEnabled||H,W=B&&"transition"in I.style,Z="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!G,q="MozPerspective"in I.style,Y="OTransition"in I.style,Q=(W||Z||q)&&!Y&&!z,K="undefined"!=typeof window&&C(window.createImageBitmap),X="undefined"!=typeof window&&C(window.ResizeObserver),J="undefined"!=typeof window&&C(window.btoa),$=0;N&&($=O.match(/chrome\/([\d.]+)/)[1]);var tt=!z&&(V||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),et="undefined"!=typeof window&&"WebGLRenderingContext"in window,it=D(),nt=!1;try{new OffscreenCanvas(2,2).getContext("2d"),nt=!0}catch(t){nt=!1}var rt=!1;try{window.addEventListener("testPassive",function(){},{get passive(){rt=!0}})}catch(t){}if(R={ie:B,ielt9:B&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:j,gecko:F,android:-1!==O.indexOf("android"),android23:G,chrome:N,chromeVersion:$,safari:!N&&-1!==O.indexOf("safari"),phantomjs:z,ie3d:W,webkit3d:Z,gecko3d:q,opera12:Y,any3d:Q,mobile:U,mobileWebkit:U&&j,mobileWebkit3d:U&&Z,mobileOpera:U&&window.opera,mobileGecko:U&&F,touch:!!tt,msPointer:!!H,pointer:!!V,retina:it>1,devicePixelRatio:it,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:B&&9===document.documentMode,ie10:B&&10===document.documentMode,webgl:et,imageBitMap:K,resizeObserver:X,btoa:J,decodeImageInWorker:nt,monitorDPRChange:!0,supportsPassive:rt,removeDPRListening:function(t){t&&delete L[t.id]},checkDevicePixelRatio:function(){if("undefined"!=typeof window&&R.monitorDPRChange){var t=D(),e=t!==R.devicePixelRatio;return e&&(R.devicePixelRatio=t),e}return!1},addDPRListening:function(t){t&&(L[t.id]=t)}},"undefined"!=typeof window&&window.matchMedia)for(var ot=1;ot<500;ot++){var st=(.01*ot).toFixed(2),at=window.matchMedia("screen and (resolution: "+st+"dppx)");at&&(at.addEventListener?at.addEventListener("change",R.checkDevicePixelRatio):at.addListener&&at.addListener(R.checkDevicePixelRatio))}if(R.devicePixelRatio){var ht=R.devicePixelRatio;Object.defineProperty(R,"devicePixelRatio",{get:function(){return ht},set:function(t){if(t!==ht&&(ht=t,R.monitorDPRChange))for(var e in L){var i=L[e];if(i&&i.options&&!i.options.devicePixelRatio&&i.checkSize&&i.getRenderer)i.getRenderer()&&i.checkSize(!0)}}})}}var lt=R;function ct(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function ut(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var dt,ft,_t=function(){function t(t,e){if(y(t)||y(e)?y(t.x)||y(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1]):(this.x=+t.x,this.y=+t.y):(this.x=+t,this.y=+e),this._isNaN())throw new Error("Position is NaN")}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},e._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},e._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},e.distanceTo=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},e.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},e.copy=function(){return new this.constructor(this.x,this.y)},e._add=function(t,e){return y(t.x)?y(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e.add=function(t,e){var i,n;return y(t.x)?y(t[0])?(i=this.x+t,n=this.y+e):(i=this.x+t[0],n=this.y+t[1]):(i=this.x+t.x,n=this.y+t.y),new this.constructor(i,n)},e._sub=function(t,e){return y(t.x)?y(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(t,e){var i,n;return y(t.x)?y(t[0])?(i=this.x-t,n=this.y-e):(i=this.x-t[0],n=this.y-t[1]):(i=this.x-t.x,n=this.y-t.y),new this.constructor(i,n)},e.substract=function(){return this.sub.apply(this,arguments)},e.multi=function(t){return new this.constructor(this.x*t,this.y*t)},e._multi=function(t){return this.x*=t,this.y*=t,this},e.div=function(t){return this.multi(1/t)},e._div=function(t){return this._multi(1/t)},e.equals=function(t){return t instanceof this.constructor&&(this.x===t.x&&this.y===t.y)},e._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},e.isZero=function(){return 0===this.x&&0===this.y},e.toArray=function(){return[this.x,this.y]},e.toFixed=function(t){return new this.constructor(this.x.toFixed(t),this.y.toFixed(t))},e.toJSON=function(){return{x:this.x,y:this.y}},t}(),pt=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},i.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.unit=function(){return this.copy()._unit()},i._unit=function(){return this._div(this.mag()),this},i.perp=function(){return this.copy()._perp()},i._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},i.angleWith=function(t){return this.angleWithSep(t.x,t.y)},i.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},i._rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},i.rotate=function(t){return this.copy()._rotate(t)},e}(_t);function mt(t){return t.length>4&&".svg"===t.slice(-4)?1:"data:image/svg+xml"===t.slice(0,"data:image/svg+xml".length)?2:0}function gt(t,e){k&&gt.node?gt.node(t,e):t.src=e[0]}!function(){if(k)return dt=function(t){return setTimeout(t,16)},void(ft=clearTimeout);var t,e,i=1e3/30;function n(t){return setTimeout(t,i)}function r(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(t=window.requestAnimationFrame||r("RequestAnimationFrame")||n,e=window.cancelAnimationFrame||r("CancelAnimationFrame")||r("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(t=n,e=clearTimeout),dt=function(e){return t(e)},ft=function(t){t&&e(t)}}();var vt=0;function yt(){return vt++}function xt(t){return t&&A(t)?JSON.parse(t):t}function wt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n=0,r=i.length;n<r;n++)t.push(i[n])}return t.length}function bt(t,e){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function At(t,e,i){if(!Array.isArray(t))return i?e.call(i,t):e(t);for(var n,r,o=[],s=0,a=t.length;s<a;s++)y(n=t[s])?o.push(null):Array.isArray(n)?o.push(At(n,e,i)):(r=i?e.call(i,n):e(n),o.push(r));return o}function Ct(t,e){return void 0===t?e:t}function St(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):t>0?1:-1}function Et(t){if(Math.log2)return Math.log2(t);var e=Math.log(t)*Math.LOG2E,i=Math.round(e);return Math.abs(i-e)<1e-14?i:e}function Pt(t,e,i){return t*(1-i)+e*i}function Mt(t,e,i){if(t===i||t===e)return t;var n=i-e;return((t-e)%n+n)%n+e}function Tt(t,e,i){return Math.min(i,Math.max(e,t))}function kt(t){return Array.isArray(t)&&t.length>0}var Rt=/^url\((['"])(.+)\1\)$/i,Lt=/^url\(([^'"].*[^'"])\)$/i;function Dt(t){return A(t)?Lt.test(t)?1:Rt.test(t)?2:3:0}function Ot(t){var e=Dt(t);return 3===e?t:1===e?Lt.exec(t)[1]:2===e?Rt.exec(t)[2]:t}var It="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Bt(t){if(lt.btoa)return window.btoa(t);for(var e,i,n=String(t),r="",o=0,s=It;n.charAt(0|o)||(s="=",o%1);r+=s.charAt(63&e>>8-o%1*8)){if((i=n.charCodeAt(o+=.75))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|i}return r}function jt(t,e){for(var i=atob(t),n=new ArrayBuffer(i.length),r=new Uint8Array(n),o=0;o<i.length;o++)r[o]=255&i.charCodeAt(o);return new Blob([n],{type:e})}function zt(t,e,i,n){var r=i-t,o=n-e;return Math.atan2(o,r)}var Gt,Nt="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function Ft(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var i in t)if("center"===i){if(!e[i]||!Ut(t[i][0],e[i][0])||!Ut(t[i][1],e[i][1]))return!1}else if(t[i]!==e[i])return!1;return!0}function Ut(t,e,i){return null==i&&(i=1e-6),t>=e-i&&t<=e+i}function Ht(t,e,i,n){t||(t=100),e||(e=4);var r=this;return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout(function o(){if(0===e)return r.show(),void(i&&(n?i.call(n):i()));e%2==0?r.hide():r.show(),e--,r._flashTimeout=setTimeout(o,t)},t),this}function Vt(t,e){void 0===t&&(t=[]),void 0===e&&(e="_pt");for(var i=[],n=0,r=t.length;n<r;n++){var o=t[n];if(o){o[e]||(o[e]=new pt(0,0));var s=o[e];s.x=0,s.y=0,i.push(s)}else i.push(null)}return i}if(lt.decodeImageInWorker){var Wt=document.createElement("canvas");Wt.width=1,Wt.height=1,Gt=Wt.getContext("2d")}function Zt(t,e){var i=Gt.createImageData(t.width,t.height);i.data.set(t.data),createImageBitmap(i).then(function(t){e(t)})}function qt(t){if(t&&0===t.indexOf("http://")||0===t.indexOf("https://"))return t;var e=document.createElement("a");return e.href=t,t=e.href,e=null,t}var Yt={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function Qt(t,e){void 0===e&&(e=1);var i=t.width,n=t.height;return Yt.cssWidth=i+"px",Yt.cssHeight=n+"px",Yt.width=Math.round(i*e),Yt.height=Math.round(n*e),Yt}function Kt(t,e){for(var i=0;i<t.stops.length;i++)if(e===t.stops[i][0])return t.stops[i][1];return t.default}function Xt(t,e){for(var i=0;i<t.stops.length&&!(e<t.stops[i][0]);i++);return t.stops[Math.max(i-1,0)][1]}function Jt(t,e){for(var i=void 0!==t.base?t.base:1,n=0;!(n>=t.stops.length||e<=t.stops[n][0]);)n++;return 0===n?t.stops[n][1]:n===t.stops.length?t.stops[n-1][1]:function t(e,i,n,r,o,s){return"function"==typeof o?function(){var a=o.apply(void 0,arguments),h=s.apply(void 0,arguments);return t(e,i,n,r,a,h)}:o.length?function(t,e,i,n,r,o){for(var s=[],a=0;a<r.length;a++)s[a]=te(t,e,i,n,r[a],o[a]);return s}(e,i,n,r,o,s):te(e,i,n,r,o,s)}(e,i,t.stops[n-1][0],t.stops[n][0],t.stops[n-1][1],t.stops[n][1])}function $t(t,e){return i=e,n=t.default,void 0!==i?i:void 0!==n?n:void 0!==r?r:null;var i,n,r}function te(t,e,i,n,r,o){var s,a=n-i,h=t-i;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function ee(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function ie(t){for(var e in t)if(ee(t[e]))return!0;return!1}function ne(t){return se(t,"exponential")}function re(t,e){if(!t)return null;var i=!1;if(Array.isArray(t)){for(var n,r=[],o=0;o<t.length;o++)(n=re(t[o],e))?(r.push(n),i=!0):r.push(t[o]);return i?r:t}var s,a={__fn_types_loaded:!0},h=[];for(s in t)t.hasOwnProperty(s)&&h.push(s);for(var l=function(t){Object.defineProperty(a,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=ne(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},c=0,u=h.length;c<u;c++)ee(t[s=h[c]])?(i=!0,a["_"+s]=t[s],l(s)):a[s]=t[s];return i?a:t}function oe(t){if(!t||!t.stops)return[];for(var e=[],i=0,n=t.stops.length;i<n;i++)e.push(t.stops[i][1]);return e}function se(t,e){if(!ee(t))return function(){return t};var i=!0,n=!0,r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(var o=0;o<r.length;o++)if(ee(r[o][1])){var s=se(r[o][1],e);i=i&&s.isZoomConstant,n=n&&s.isFeatureConstant,r[o]=[r[o][0],s]}var a=function t(e,i){var n,r,o;if(ee(e)){var s,a=e.stops&&"object"==typeof e.stops[0][0],h=a||void 0!==e.property,l=a||!h,c=e.type||i||"exponential";if("exponential"===c)s=Jt;else if("interval"===c)s=Xt;else if("categorical"===c)s=Kt;else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');s=$t}if(a){for(var u={},d=[],f=0;f<e.stops.length;f++){var _=e.stops[f];void 0===u[_[0].zoom]&&(u[_[0].zoom]={zoom:_[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),u[_[0].zoom].stops.push([_[0].value,_[1]])}for(var p in u)d.push([u[p].zoom,t(u[p])]);n=function(t,i){var n=Jt({stops:d,base:e.base},t)(t,i);return"function"==typeof n?n(t,i):n},r=!1,o=!1}else l?(n=function(t){var i=s(e,t);return"function"==typeof i?i(t):i},r=!0,o=!1):(n=function(t,i){var n=s(e,i?i[e.property]:null);return"function"==typeof n?n(t,i):n},r=!1,o=!0)}else n=function(){return e},r=!0,o=!0;return n.isZoomConstant=o,n.isFeatureConstant=r,n}(t,e);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=n&&a.isFeatureConstant,a}var ae=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function he(t){return new Function("f","var p = (f && f.properties || {}); return "+le(t))}function le(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?ue(t[1],t[2],"===",!1):"!="===e?ue(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?ue(t[1],t[2],e,!0):"any"===e?de(t.slice(1),"||"):"all"===e?de(t.slice(1),"&&"):"none"===e?pe(de(t.slice(1),"||")):"in"===e?fe(t[1],t.slice(2)):"!in"===e?pe(fe(t[1],t.slice(2))):"has"===e?_e(t[1]):"!has"===e?pe(_e(t[1])):"true")+")"}function ce(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function ue(t,e,i,n){var r=ce(t),o="$type"===t?ae.indexOf(e):JSON.stringify(e);return(n?"typeof "+r+"=== typeof "+o+"&&":"")+r+i+o}function de(t,e){return t.map(le).join(e)}function fe(t,e){"$type"===t&&(e=e.map(function(t){return ae.indexOf(t)}));var i=JSON.stringify(e.sort(me)),n=ce(t);return e.length<=200?i+".indexOf("+n+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+n+", "+i+",0,"+(e.length-1)+")"}function _e(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function pe(t){return"!("+t+")"}function me(t,e){return t<e?-1:t>e?1:0}function ge(t){var e=t._toJSON(),i=e.feature;return i.type=ae.indexOf(i.geometry.type),i.subType=e.subType,i}function ve(t){if(!Array.isArray(t))return ve([t]);for(var e=[],i=0;i<t.length;i++){var n=void 0;n=!0===t[i].filter?function(){return!0}:he(t[i].filter),e.push(ye({},t[i],{filter:n}))}return e}function ye(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}var xe=[],we={};function be(t,e){return re(t,function(){var t=e.getMap();return function(t,e,i){return t[0]=e,t[1]=i,t}(xe,t?t.getZoom():12,v({},e.getProperties(),function(t,e,i,n){return t["{bearing}"]=e,t["{pitch}"]=i,t["{zoom}"]=n,t}(we,t&&t.getBearing()||0,t&&t.getPitch()||0,t?t.getZoom():10)))})}function Ae(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function Ce(t,e,i){if(!t.markerPath)return null;var n=1,r=Ae(t);x(t.markerOpacity)&&(n=t.markerOpacity),x(t.opacity)&&(n*=t.opacity);var o={};if(r){for(var s in r.stroke)r.stroke.hasOwnProperty(s)&&(y(r.stroke[s])||(o[s]=r.stroke[s]));for(var a in r.fill)r.fill.hasOwnProperty(a)&&(y(r.fill[a])||(o[a]=r.fill[a]))}for(var h,l=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath],c=[],u=0;u<l.length;u++)(h=v({},h=A(l[u])?{path:l[u]}:l[u],o)).d=h.path,delete h.path,c.push(h);var d=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];n<1&&d.push('opacity="'+n+'"'),t.markerPathWidth&&t.markerPathHeight&&d.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),d.push('preserveAspectRatio="none"'),e&&d.push('width="'+e+'"'),i&&d.push('height="'+i+'"'),d.push("><defs></defs>");for(var f=0;f<c.length;f++){var _="<path ";for(var p in c[f])c[f].hasOwnProperty(p)&&(_+=" "+p+'="'+c[f][p]+'"');_+="></path>",d.push(_)}return d.push("</svg>"),"data:image/svg+xml;base64,"+Bt(d.join(" "))}function Se(t,e){if(!t)return[];var i=t;Array.isArray(t)||(i=[t]);for(var n,r,o,s,a=[],h=d,l=i.length-1;l>=0;l--)if(t=i[l]){e&&(t=Ee(t));for(var c=0;c<h.length;c++)if(ee(n=t[h[c]])&&(n=oe(n)),n){Array.isArray(n)||(n=[n]);for(var u=0;u<n.length;u++)"url("===n[u].slice(0,4)&&(n[u]=Ot(n[u])),r=f[c],a.push([n[u],t[r[0]],t[r[1]]])}if("path"===t.markerType&&t.markerPath)if(o=ee(t.markerWidth)?200:t.markerWidth,s=ee(t.markerHeight)?200:t.markerHeight,ee(t.markerPath)){n=oe(t.markerPath);for(var _=t.markerPath,p=0;p<n.length;p++)t.markerPath=n[p],a.push([Ce(t),o,s]);t.markerPath=_}else a.push([Ce(t),o,s])}return a}function Ee(t){if(!t)return null;var e=t;if(k)return e;for(var i,n=d,r=0,o=n.length;r<o;r++)(i=e[n[r]])&&(e[n[r]]=Pe(i));return e}function Pe(t){if(ee(t)){for(var e=t.stops,i=0;i<e.length;i++)e[i][1]=Pe(e[i][1]);return t}return"url("===t.slice(0,4)&&(t=Ot(t)),t}var Me=function(){function t(t,e){x(t)&&x(e)?(this.width=t,this.height=e):x(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}var e=t.prototype;return e.copy=function(){return new t(this.width,this.height)},e.add=function(e,i){var n,r;return e instanceof t?(n=this.width+e.width,r=this.height+e.height):(n=this.width+e,r=this.height+i),new t(n,r)},e.equals=function(t){return this.width===t.width&&this.height===t.height},e.multi=function(e){return new t(this.width*e,this.height*e)},e._multi=function(t){return this.width*=t,this.height*=t,this},e._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},e.toPoint=function(){return new pt(this.width,this.height)},e.toArray=function(){return[this.width,this.height]},e.toJSON=function(){return{width:this.width,height:this.height}},t}();function Te(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}var ke=/[\b\t\r\v\f]/gim;function Re(t){return A(t)?t.replace(ke,""):t}function Le(t){return Te(t).split(/\s+/)}var De="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function Oe(t,e){return Oe.node?Oe.node(t,e):(De.font=e,De.measureText(t).width)}function Ie(t,e,i){var n=Oe(t,e);return new Me(n,i||m)}function Be(t,e,i,n){if(!t||0===t.length)return[{text:"",width:0}];var r=y(n)?Oe(t,e):n,o=r/t.length,s=Math.floor(i/o/2);if(o>=i||s<=0)return[{text:"",width:i}];if(r<=i)return[{text:t,width:r}];for(var a=[],h=t.substring(0,s),l=o*s,c=s,u=t.length;c<u;c++){var d=t[c],f=Oe(h+d);f>=i?(a.push({text:h,width:l}),h=t.substring(c,s+c),c+=s-1,l=o*s):(h+=d,l=f),c>=u-1&&(l=Oe(h),a.push({text:h,width:l}))}return a}var je=/\{([\w_]+)\}/g;function ze(t,e){return A(t)?t.replace(je,function(t,i){if(!e)return"";var n=e[i];return y(n)?"":Array.isArray(n)?n.join():n}):t}function Ge(t,e){x(t)&&(t+=""),t=t||"";var i=e.textMaxHeight||0,n=He(t,e);return i&&i<n.size.height&&(n.size.height=i),n}function Ne(t,e,i){var n=t.width,r=t.height;return new pt("left"===e?-n:"right"===e?0:-n/2,"top"===i?-r:"bottom"===i?0:-r/2)}var Fe="monospace";function Ue(t){return t.textFont?t.textFont:(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+t.textSize+"px "+(t.textFaceName?'"'===t.textFaceName[0]?t.textFaceName:'"'+t.textFaceName+'"':Fe)}function He(t,e){var i=Ue(e),n=e.textLineSpacing||0,r=Ie(t,i,e.textSize),o=r.width,s=r.height,a=e.textWrapCharacter,h=[],l=e.textWrapWidth;(!l||l>o)&&(l=o),A(t)||(t+="");var c=0;if(a&&t.indexOf(a)>=0)for(var u=t.split(a),d=0,f=u.length;d<f;d++){var _=u[d],p=Oe(_,i);if(p>l)for(var m=Be(_,i,l,p),g=0,v=m.length;g<v;g++){var y=m[g].width;y>c&&(c=y),h.push({text:m[g].text,size:new Me(y,s)})}else p>c&&(c=p),h.push({text:_,size:new Me(p,s)})}else if(o>l)for(var x=Be(t,i,l,o),w=0;w<x.length;w++){var b=x[w].width;b>c&&(c=b),h.push({text:x[w].text,size:new Me(b,s)})}else o>c&&(c=o),h.push({text:t,size:r});var C=h.length;return{total:C,size:new Me(c,s*C+n*(C-1)),rows:h,rawSize:r}}function Ve(t){var e=0,i=t&&t.length||0;if(!i)return e;for(var n=0;n<i;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return e}function We(t){return t&&t.colorStops}function Ze(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var i=[],n=t.colorStops.length-1;n>=0;n--)i.push(t.colorStops[n].join());e.push(i.join(","))}return e.join("_")}function qe(t,e){if(!t)return 1;var i=[];if(Array.isArray(t)){for(var n=0;n<t.length;n++)i.push(qe(t[n],e));return i.sort().join(",")}var r=Object.keys(t).sort().reduce(function(i,n){return e&&0!==n.indexOf(e)||(i[n]=t[n]),i},{});return Ve(JSON.stringify(r))}function Ye(t,e){function i(t,e){y(t.opacity)?t.opacity=e:t.opacity*=e}var n;if(Array.isArray(t)){n=[];for(var r=0;r<t.length;r++){var o=v({},t[r]);i(o,e),n.push(o)}}else i(n=v({},t),e);return n}function Qe(t){var e=Array.prototype.slice.call(arguments,1);if(e&&e.length||(e=[{}]),Array.isArray(t)){for(var i,n,r=[],o=0,s=t.length;o<s;o++){i=t[o],n={};for(var a=0,h=e.length;a<h;a++)Array.isArray(e[a])?y(e[a][o])?v(n,i||{}):v(n,i,e[a][o]):v(n,i,e[a]?e[a]:{});r.push(n)}return r}var l=[{},t];return l.push.apply(l,e),v.apply(this,l)}function Ke(t){if(t.symbol&&(t=[t]),Array.isArray(t))return t;var e=t.$root,i=t.$iconset;if(t=t.style,e||i){e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),i&&"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));Xe(t,function(t){return"{$root}"===t?e:"{$iconset}"===t?i:null})}return t}function Xe(t,e){for(var i=0;i<t.length;i++){var n=t[i].symbol;n&&$e(n,e)}}var Je=/(\{\$root\}|\{\$iconset\})/g;function $e(t,e){for(var i in t)t.hasOwnProperty(i)&&"textName"!==i&&(A(t[i])&&t[i].length>2?t[i]=t[i].replace(Je,e):ee(t[i])?t[i]=ti(t[i],e):b(t[i])&&$e(t[i],e))}function ti(t,e){var i=t.default;A(i)&&(t.default=i.replace(Je,e));for(var n=t.stops,r=0;r<n.length;r++)Array.isArray(n[r])&&(A(n[r][1])?n[r][1]=n[r][1].replace(Je,e):ee(n[r][1])&&(n[r][1]=ti(n[r][1],e)));return t}function ei(t){void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);for(var e=t.length,i=0;i<e;i++){var n=t[i];if(n.style){var r=n.style,o=r.lineDasharray,s=r.lineWidth;if(s&&x(s)&&s>0&&o&&Array.isArray(o)&&o.length)return!0}}return!1}var ii=k?function(t){return t[0]}:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1},ni=ii(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),ri=ii(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),oi=ii(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]);ii(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function si(t,e){var i=document.createElement(t);return e&&wi(i,e),i}function ai(t,e,i){var n=si(t);return e&&vi(n,e),i&&i.appendChild(n),n}function hi(t){if(!t)return this;if(lt.ielt9||lt.ie9){var e=si("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function li(t,e,i,n){if(!(t&&t.addEventListener&&e&&i))return this;for(var r=function(e){e||(e=window.event),i.call(n||t,e)},o=e.split(" "),s=o.length-1;s>=0;s--){var a=o[s];if(a)t["Z__"+a]||(t["Z__"+a]=[]),ui(t,a,i)>=0&&ci(t,a,i),t["Z__"+a].push({callback:r,src:i}),t.addEventListener(a,r,!!lt.supportsPassive&&{capture:!1,passive:!1})}return this}function ci(t,e,i){function n(e,i){"mousewheel"===e&&lt.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,i,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),o=r.length-1;o>=0;o--){var s=r[o];if(s){if(!i&&t["Z__"+s]){for(var a=t["Z__"+s],h=0,l=a.length;h<l;h++)n(a[h].callback);return delete t["Z__"+s],this}var c=ui(t,s,i);if(c<0)return this;n(s,t["Z__"+s][c].callback),t["Z__"+s].splice(c,1)}}return this}function ui(t,e,i){if(!t||!t["Z__"+e]||!i)return-1;for(var n=t["Z__"+e],r=0,o=n.length;r<o;r++)if(n[r].src===i)return r;return-1}function di(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function fi(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function _i(t){return t.onselectstart=function(){return!1},t.ondragstart=function(){return!1},t.setAttribute("unselectable","on"),this}function pi(t,e){return t?(lt.any3d?Ai(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function mi(t){var e=window.getComputedStyle(t),i=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],n=t.getBoundingClientRect(),r=t.offsetWidth,o=t.offsetHeight,s=r?n.width/r:1,a=o?n.height/o:1;return t.__position=[n.left+i[0],n.top+i[1],s,a],t.__position}function gi(t,e){t||(t=window.event);var i=e.__position;return i||(i=mi(e)),new pt((t.clientX-i[0]-e.clientLeft)/i[2],(t.clientY-i[1]-e.clientTop)/i[3])}function vi(t,e){var i,n,r,o=t.style.cssText;return n=";",(r=(i=o).length-n.length)>=0&&i.indexOf(n,r)===r||(o+=";"),t.style.cssText=o+e,this}function yi(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=bi(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function xi(t,e){if(void 0===t.classList||yi(t,e)){var i=bi(t);wi(t,(i?i+" ":"")+e)}else for(var n=Le(e),r=0,o=n.length;r<o;r++)t.classList.add(n[r]);return this}function wi(t,e){return y(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function bi(t){return y(t.className.baseVal)?t.className:t.className.baseVal}function Ai(t,e){var i=e||new pt(0,0);return t.style[ni]=lt.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)",this}function Ci(t){return/<[a-z\][\s\S]*>/i.test(t)}function Si(t,e){var i=Ei(t);A(e)?i.innerHTML=e:i.appendChild(e);var n=new Me(i.clientWidth,i.clientHeight);return hi(i),n}function Ei(t){var e=document.createElement(t);return e.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(e),e}var Pi,Mi=li,Ti=ci,ki="function"==typeof Map,Ri=function(){function t(t,e){this.max=t,this.onRemove=e,this.reset()}var e=t.prototype;return e.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},e.has=function(t){return t in this.data},e.keys=function(){return this.order},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},e.get=function(t){return this.has(t)?this.data[t]:null},e.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},e.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},t}();ki&&(Pi=function(){function t(t,e){this.max=t,this.onRemove=e,this.reset()}var e=t.prototype;return e.reset=function(){if(this.data){var t=this.data.values(),e=Array.isArray(t),i=0;for(t=e?t:t[Symbol.iterator]();;){var n;if(e){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var r=n;this.onRemove(r)}}return this.data=new Map,this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):this.data.set(t,e),this):this},e.keys=function(){var t=new Array(this.data.size),e=0,i=this.data.keys(),n=Array.isArray(i),r=0;for(i=n?i:i[Symbol.iterator]();;){var o;if(n){if(r>=i.length)break;o=i[r++]}else{if((r=i.next()).done)break;o=r.value}var s=o;t[e++]=s}return t},e.shrink=function(){for(var t=this.data.keys(),e=t.next();this.data.size>this.max;){var i=this.getAndRemove(e.value);i&&this.onRemove(i),e=t.next()}},e.has=function(t){return this.data.has(t)},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data.get(t);return this.data.delete(t),e},e.get=function(t){return this.has(t)?this.data.get(t):null},e.remove=function(t){if(!this.has(t))return this;var e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this},e.setMaxSize=function(t){return this.max=t,this.data.size>this.max&&this.shrink(),this},t}());var Li=ki?Pi:Ri,Di={jsonp:function(t,e){var i="_maptalks_jsonp_"+yt();t.match(/\?/)?t+="&callback="+i:t+="?callback="+i;var n=document.createElement("script");return n.type="text/javascript",n.src=t,window[i]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(n),this},get:function(t,e,i){if(C(e)){var n=i;i=e,e=n}if(k&&Di.get.node)return Di.get.node(t,i,e);var r=Di._getClient(i);if(r.open("GET",t,!0),e){for(var o in e.headers)r.setRequestHeader(o,e.headers[o]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(null),r},post:function(t,e,i){var n;if(A(t)){if(C(e)){var r=i;i=e,e=r}n=(e=e||{}).postData}else{var o=i;n=e,t=(e=t).url,i=o}if(k&&Di.post.node)return e.url=t,Di.post.node(e,n,i);var s=Di._getClient(i);if(s.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in s)for(var a in e.headers)e.headers.hasOwnProperty(a)&&s.setRequestHeader(a,e.headers[a]);return A(n)||(n=JSON.stringify(n)),s.send(n),s},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=Di._wrapCallback(e,t),e},getArrayBuffer:function(t,e,i){if(C(e)){var n=i;i=e,e=n}return e||(e={}),e.responseType="arraybuffer",Di.get(t,e,i)},getImage:function(t,e,i){return Di.getArrayBuffer(e,i,function(e,i){if(e)t.onerror&&t.onerror(e);else if(i){var n=window.URL||window.webkitURL,r=t.onload;t.onload=function(){r&&r(),n.revokeObjectURL(t.src)};var o=new Blob([new Uint8Array(i.data)],{type:i.contentType});t.cacheControl=i.cacheControl,t.expires=i.expires,t.src=i.data.byteLength?n.createObjectURL(o):Nt}})},getJSON:function(t,e,i){if(C(e)){var n=i;i=e,e=n}var r=function(t,e){var n=e?xt(e):null;i(t,n)};return e&&e.jsonp?Di.jsonp(t,r):Di.get(t,e,r)}},Oi=!1,Ii=null,Bi=Math.PI/180,ji={setHitTesting:function(t){Oi=t},createCanvas:function(t,e,i){var n;return k?n=new i(t,e):((n=si("canvas")).width=t,n.height=e),n},prepareCanvasFont:function(t,e){t.textBaseline="top",t.font=Ue(e);var i=e.textFill;i||(i="#000"),t.fillStyle=ji.getRgba(i,e.textOpacity)},prepareCanvas:function(t,e,i,n){if(e){var r=e.lineWidth;y(r)||t.lineWidth===r||(t.lineWidth=r);var o=e.linePatternFile,s=e.lineColor||"#000";if(n)t.strokeStyle="#000";else if(o&&i){var a;(e.linePatternDx||e.linePatternDy)&&(a=[e.linePatternDx,e.linePatternDy]),ji._setStrokePattern(t,o,r,a,i),e.lineDasharray=[]}else We(s)?e.lineGradientExtent?t.strokeStyle=ji._createGradient(t,s,e.lineGradientExtent):t.strokeStyle="#000":(Array.isArray(s)&&(s=ji.normalizeColorToRGBA(s)),t.strokeStyle=s);e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&kt(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var h=e.polygonPatternFile,l=e.polygonFill||"rgba(255,255,255,0)";if(n)t.fillStyle="#000";else if(h&&i){var c=Ni(h),u=i.getImage([c,null,null]);if(u||(u=i.getImage([c+"-texture",null,r])),mt(c)&&u instanceof Image&&(lt.edge||lt.ie)){var d=u.width||20,f=u.height||20,_=ji.createCanvas(d,f);ji.image(_.getContext("2d"),u,0,0,d,f),u=_}u?(t.fillStyle=t.createPattern(u,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",c)}else We(l)?e.polygonGradientExtent?t.fillStyle=ji._createGradient(t,l,e.polygonGradientExtent):t.fillStyle="rgba(255,255,255,0)":(Array.isArray(l)&&(l=ji.normalizeColorToRGBA(l)),t.fillStyle=l)}},_createGradient:function(t,e,i){var n=null,r=e.places,o=i.getMin(),s=i.getMax(),a=i.getWidth(),h=i.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,a*r[2],o.x+r[3]*a,o.y+r[4]*h,a*r[5]]}else{var l=i.getCenter()._round();r=[l.x,l.y,Math.abs(l.x-o.x),l.x,l.y,0]}n=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,o.x+r[2]*a,o.y+r[3]*h]}else r=[o.x,o.y,s.x,o.y];n=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach(function(t){n.addColorStop.apply(n,t)}),n},_setStrokePattern:function(t,e,i,n,r){var o,s=Ni(e);if(k)o=r.getImage([s,null,i]);else{var a=s+"-texture-"+i;if(!(o=r.getImage(a))){var h=r.getImage([s,null,null]);if(h){var l;l=h.width&&h.height?Math.round(h.width*i/h.height):i;var c=ji.createCanvas(l,i,t.canvas.constructor);ji.image(c.getContext("2d"),h,0,0,l,i),r.addResource([a,null,i],c),o=c}}}o?(t.strokeStyle=t.createPattern(o,"repeat"),t.strokeStyle.linePatternOffset=n):"undefined"!=typeof console&&console.warn("img not found for",s)},clearRect:function(t,e,i,n,r){t.canvas._drawn=!1,t.clearRect(e,i,n,r)},fillCanvas:function(t,e,i,n){if(Oi&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=ji._isPattern(t.fillStyle),s=t.fillStyle&&t.fillStyle.polygonPatternOffset,a=s?s[0]:0,h=s?s[1]:0;y(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),o&&(i=i||0,n=n||0,t.translate(i+a,n+h)),t.fill(),o&&t.translate(-i-a,-n-h),e<1&&(t.globalAlpha=r)}},getRgba:function(t,e){return y(e)&&(e=1),"#"!==t[0]?(Array.isArray(t)&&(t=ji.normalizeColorToRGBA(t,e)),t):(7===t.length?(i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(i=17*parseInt(t.substring(1,2),16),n=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+i+","+n+","+r+","+e+")");var i,n,r},normalizeColorToRGBA:function(t,e){return void 0===e&&(e=1),"rgba("+255*t[0]+","+255*t[1]+","+255*t[2]+","+(4===t.length?t[3]:1)*e+")"},image:function(t,e,i,n,r,o){t.canvas._drawn=!0;try{x(r)&&x(o)?t.drawImage(e,i,n,r,o):t.drawImage(e,i,n)}catch(t){console&&(console.warn("error when drawing image on canvas:",t),console.warn(e))}},text:function(t,e,i,n,r){ji._textOnMultiRow(t,r.rows,n,i,r.size,r.rawSize)},_textOnMultiRow:function(t,e,i,n,r,o){for(var s,a,h=Ne(r,i.textHorizontalAlignment,i.textVerticalAlignment),l=o.height+i.textLineSpacing,c=n.add(0,h.y),u=i.textMaxHeight,d=0,f=0,_=e.length;f<_&&(s=e[f].text,a=Ne(e[f].size,i.textHorizontalAlignment,i.textVerticalAlignment),ji._textOnLine(t,s,c.add(a.x,f*l),i.textHaloRadius,i.textHaloFill,i.textHaloOpacity),!(u>0&&(d+=l)+o.height>=u));f++);},_textOnLine:function(t,e,i,n,r,o){Oi&&(o=1);var s,a,h=0!==o&&0!==n;t.textBaseline="top";var l=t.shadowBlur,c=t.shadowOffsetX,u=t.shadowOffsetY;if(h){var d=t.globalAlpha;t.globalAlpha*=o,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*n,Array.isArray(r)&&(r=ji.normalizeColorToRGBA(r)),t.strokeStyle=r,t.strokeText(e,i.x,i.y+1),t.miterLimit=10,t.globalAlpha=d,s=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",a=t.fillStyle,t.fillStyle="#000"}l&&h&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),ji.fillText(t,e,i),s&&(t.globalCompositeOperation=s,ji.fillText(t,e,i,a),l&&(t.shadowBlur=l,t.shadowOffsetX=c,t.shadowOffsetY=u))},fillText:function(t,e,i,n){t.canvas._drawn=!0,n&&(t.fillStyle=n),t.fillText(e,i.x,i.y+1)},_stroke:function(t,e,i,n){if(Oi&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=t.strokeStyle&&t.strokeStyle.linePatternOffset,s=o?o[0]:0,a=o?o[1]:0,h=ji._isPattern(t.strokeStyle)&&(!y(i)&&!y(n)||!y(s)&&!y(a));y(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),h&&(i=i||0,n=n||0,t.translate(i+s,n+a)),t.stroke(),h&&t.translate(-i-s,-n-a),e<1&&(t.globalAlpha=r)}},_path:function(t,e,i,n,r){if(kt(e))for(var o,s,a=kt(i),h=!0!==r&&ji._isPattern(t.strokeStyle),l=0,c=e.length;l<c;l++)if(o=e[l],!a||t.setLineDash)t.lineTo(o.x,o.y),h&&l>0&&(u(e[l-1],o),t.beginPath(),t.moveTo(o.x,o.y));else if(a){if(l===c-1)break;s=e[l+1],zi(t,o,s,i)}function u(e,i){var r=zt(e.x,e.y,i.x,i.y);t.save();var o=Math.cos(r);Math.abs(o)<1e-7?t.translate(e.x-t.lineWidth/2,e.y):t.translate(e.x,e.y-t.lineWidth/2/o),t.rotate(r),ji._stroke(t,n),t.restore()}},path:function(t,e,i,n,r){kt(e)&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),ji._path(t,e,r,i),ji._stroke(t,i))},_multiClip:function(t,e){if(e&&0!==e.length)for(var i=0,n=(e=e[0]).length;i<n;i++){var r=e[i],o=r.x,s=r.y;0===i?t.moveTo(o,s):t.lineTo(o,s),i===n-1&&(o=e[0].x,s=e[0].y,t.lineTo(o,s))}},polygon:function(t,e,i,n,r,o){if(t.isMultiClip)ji._multiClip(t,e);else if(kt(e)){var s=ji._isPattern(t.strokeStyle),a=kt(r)&&!t.setLineDash||s&&!o;kt(e[0])||(e=[e]);var h,l,c,u=t;if(e.length>1&&!k&&(Ii||(Ii=ji.createCanvas(1,1)),t.canvas._drawn=!1,Ii.width=t.canvas.width,Ii.height=t.canvas.height,Fi(t=Ii.getContext("2d"),u)),a){for(t.save(),l=0,c=e.length;l<c;l++)kt(e[l])&&(ji._ring(t,e[l],null,0,!0),h=n,l>0&&(t.globalCompositeOperation="destination-out",h=1),ji.fillCanvas(t,h,e[l][0].x,e[l][0].y),l>0?t.globalCompositeOperation="source-over":c>1&&(t.fillStyle="#fff"),ji._stroke(t,0));t.restore()}var d=t.fillStyle;for(l=0,c=e.length;l<c;l++)kt(e[l])&&(o?(ji.paintSmoothLine(t,e[l],i,o,!0),t.closePath()):ji._ring(t,e[l],r,i),a||(h=n,l>0&&(t.globalCompositeOperation="destination-out",h=1),ji.fillCanvas(t,h,e[l][0].x,e[l][0].y),l>0?t.globalCompositeOperation="source-over":c>1&&(t.fillStyle="#fff")),ji._stroke(t,i));t.fillStyle!==d&&(t.fillStyle=d),e.length>1&&!k&&(u.drawImage(Ii,0,0),u.canvas._drawn=t.canvas._drawn,Fi(u,t))}},_ring:function(t,e,i,n,r){var o=ji._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),ji._path(t,e,i,n,r),o||t.closePath()},paintSmoothLine:function(t,e,i,n,r,o,s){if(e)if(e.length<=2||!n)ji.path(t,e,i);else{var a,h=e.length,l=r?h:h-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(l-=Math.max(l-o-1,0));for(var c=0;c<l;c++){var u=e[c].x,d=e[c].y,f=void 0,_=void 0,p=void 0,m=void 0,g=void 0,v=void 0;c-1<0?r?(f=e[l-1].x,_=e[l-1].y):(f=e[c+1].x,_=e[c+1].y):(f=e[c-1].x,_=e[c-1].y),c+1<h?(p=e[c+1].x,m=e[c+1].y):(p=e[c+1-h].x,m=e[c+1-h].y),c+2<h?(g=e[c+2].x,v=e[c+2].y):r?(g=e[c+2-h].x,v=e[c+2-h].y):(g=e[c].x,v=e[c].y);var y=w(f,_,u,d,p,m,g,v,n,c===l-1?s:1);if(c===l-1&&s>=0&&s<1){t.bezierCurveTo(y[0],y[1],y[2],y[3],y[4],y[5]),e.splice(l-1,h-(l-1)-1);var x=new pt(y[4],y[5]);x.prevCtrlPoint=new pt(y[2],y[3]),e.push(x),h=e.length}else t.bezierCurveTo(y[0],y[1],y[2],y[3],p,m);e[c].nextCtrlPoint=y.slice(0,2),e[c].prevCtrlPoint=a?a.slice(2):null,a=y}!r&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[h-1].prevCtrlPoint||(e[h-1].prevCtrlPoint=e[h-2].nextCtrlPoint),ji._stroke(t,i)}function w(t,e,i,n,r,o,s,a,h,l){var c=(t+i)/2,u=(e+n)/2,d=(i+r)/2,f=(n+o)/2,_=(r+s)/2,p=(o+a)/2,m=Math.sqrt((i-t)*(i-t)+(n-e)*(n-e)),g=Math.sqrt((r-i)*(r-i)+(o-n)*(o-n)),v=m/(m+g),y=g/(g+Math.sqrt((s-r)*(s-r)+(a-o)*(a-o))),x=c+(d-c)*v,w=u+(f-u)*v,b=d+(_-d)*y,A=f+(p-f)*y,C=x+(d-x)*h+i-x,S=w+(f-w)*h+n-w,E=b+(d-b)*h+r-b,P=A+(f-A)*h+o-A,M=[C,S,E,P];return l<1?function(t,e,i,n,r,o,s,a,h,l){var c=1-t,u=1-e,d=i*u*u+2*r*e*u+s*e*e,f=r*u*u+2*s*e*u+h*e*e,_=n*u*u+2*o*e*u+a*e*e,p=o*u*u+2*a*e*u+l*e*e;return[(i*c*c+2*r*t*c+s*t*t)*u+(r*c*c+2*s*t*c+h*t*t)*e,(n*c*c+2*o*t*c+a*t*t)*u+(o*c*c+2*a*t*c+l*t*t)*e,d*c+f*t,_*c+p*t,d*u+f*e,_*u+p*e]}(0,l,i,n,C,S,E,P,r,o):M}},_arcBetween:function(t,e,i,n){var r=n,o=e.distanceTo(i),s=o/2/Math.sin(r/2),a=Math.asin((i.y-e.y)/o);e.x>i.x&&(a=Math.PI-a);var h=a-(90*Bi-r/2),l=Math.cos(h)*s,c=Math.sin(h)*s,u=e.x+l,d=e.y+c,f=Math.asin((i.y-d)/s);u>i.x&&(f=Math.PI-f);var _=f+r;return t.beginPath(),t.arc(u,d,s,f,_),[u,d]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,i,n){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),ji._bezierCurveTo.apply(ji,o),ji.fillCanvas(t,n),ji._stroke(t,i)},_bezierCurveTo:function(t,e,i,n){t.bezierCurveTo(e.x,e.y,i.x,i.y,n.x,n.y)},ellipse:function(t,e,i,n,r,o,s){var a,h,l,c,u,d,f,_,p;t.beginPath(),i===n&&i===r?t.arc(e.x,e.y,i,0,2*Math.PI):t.ellipse?n!==r?(t.ellipse(e.x,e.y,i,n,0,180*Bi,360*Bi,!1),t.ellipse(e.x,e.y,i,r,0,0,180*Bi,!1)):t.ellipse(e.x,e.y,i,n,0,0,360*Bi,!1):(a=e.x,h=e.y,f=(l=i)*(d=.5522848),_=(c=n)*d,p=(u=r)*d,t.moveTo(a-l,h),t.bezierCurveTo(a-l,h-_,a-f,h-c,a,h-c),t.bezierCurveTo(a+f,h-c,a+l,h-_,a+l,h),t.bezierCurveTo(a+l,h+p,a+f,h+u,a,h+u),t.bezierCurveTo(a-f,h+u,a-l,h+p,a-l,h),t.closePath()),ji.fillCanvas(t,s,e.x-i,e.y-n),ji._stroke(t,o,e.x-i,e.y-n)},rectangle:function(t,e,i,n,r){var o=e.x,s=e.y;t.beginPath(),t.rect(o,s,i.width,i.height),ji.fillCanvas(t,r,o,s),ji._stroke(t,n,o,s)},sector:function(t,e,i,n,r,o){var s=Bi,a=n[0],h=n[1];function l(t,e,i,n,a,h){var l=s*-h,c=s*-a;t.beginPath(),t.moveTo(e,i),t.arc(e,i,n,l,c),t.lineTo(e,i),ji.fillCanvas(t,o,e-n,i-n),ji._stroke(t,r,e-n,i-n)}l(t,e.x,e.y,i,a,h)},_isPattern:function(t){return!(A(t)||"addColorStop"in t)},drawCross:function(t,e,i,n,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=n,t.beginPath(),t.moveTo(e-5,i),t.lineTo(e+5,i),t.moveTo(e,i-5),t.lineTo(e,i+5),t.stroke()},copy:function(t,e){var i=e||si("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0),i},pixelRect:function(t,e,i,n){var r=t.lineWidth,o=t.globalAlpha,s=!1;if(r>0&&i>0)s=!0,i<1&&(t.globalAlpha*=i);else{if(!(n>0))return;n<1&&(t.globalAlpha*=n)}t.canvas._drawn=!0,s?t.strokeRect(e[0],e[1],1,1):t.fillRect(e[0],e[1],1,1),t.globalAlpha!==o&&(t.globalAlpha=o)}};function zi(t,e,i,n){var r=e.x,o=e.y,s=i.x,a=i.y,h=n,l=function(t,e){return t<=e},c=function(t,e){return t>=e},u=function(t,e){return Math.min(t,e)},d=function(t,e){return Math.max(t,e)},f={thereYet:c,cap:u},_={thereYet:c,cap:u};o-a>0&&(_.thereYet=l,_.cap=d),r-s>0&&(f.thereYet=l,f.cap=d),t.moveTo(r,o);for(var p,m,g=r,v=o,y=0,x=!0;!f.thereYet(g,s)||!_.thereYet(v,a);)p=Math.atan2(a-o,s-r),m=h[y],g=f.cap(s,g+Math.cos(p)*m),v=_.cap(a,v+Math.sin(p)*m),x?t.lineTo(g,v):t.moveTo(g,v),y=(y+1)%h.length,x=!x}var Gi="data:image/";function Ni(t){return t.substring(0,Gi.length)===Gi?t:Ot(t)}function Fi(t,e){t.filter=e.filter,t.fillStyle=e.fillStyle,t.globalAlpha=e.globalAlpha,t.lineCap=e.lineCap,t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle}var Ui="undefined"!=typeof Promise?Promise:r.a,Hi=function(t){return function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.on=function(t,e,i){if(!t)return this;if(!A(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var n,r,o=t.toLowerCase().split(" ");i||(i=this);for(var s=0,a=o.length;s<a;s++){n=o[s],(r=this._eventMap[n])||(r=[],this._eventMap[n]=r);var h=r.length;if(h>0)for(var l=0;l<h;l++)if(e===r[l].handler&&r[l].context===i)return this;r.push({handler:e,context:i})}return this},i.addEventListener=function(){return this.on.apply(this,arguments)},i.once=function(t,e,i){if(!A(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=this._wrapOnceHandler(r,t[r],i));return this._switch("on",n)}for(var o=t.split(" "),s=0,a=o.length;s<a;s++)this.on(o[s],this._wrapOnceHandler(o[s],e,i));return this},i.off=function(t,e,i){if(!this._eventMap||!t)return this;if(!A(t))return this._switch("off",t,e);if(!e)return this;var n,r,o,s=t.split(" ");i||(i=this);for(var a=0,h=s.length;a<h;a++){if(o="Z__"+(n=s[a].toLowerCase()),!(r=this._eventMap[n]))return this;for(var l=r.length-1;l>=0;l--){var c=r[l];e!==c.handler&&e!==c.handler[o]||c.context!==i||(delete c.handler[o],r.splice(l,1))}r.length||delete this._eventMap[n]}return this},i.removeEventListener=function(){return this.off.apply(this,arguments)},i.listens=function(t,e,i){if(!this._eventMap||!A(t))return 0;var n=this._eventMap[t.toLowerCase()];if(!n||!n.length)return 0;if(!e)return n.length;for(var r=0,o=n.length;r<o;r++)if(e===n[r].handler&&(y(i)||n[r].context===i))return 1;return 0},i.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},i.copyEventListeners=function(t){var e,i=t._eventMap;if(!i)return this;for(var n in i)for(var r=0,o=(e=i[n]).length;r<o;r++)this.on(n,e[r].handler,e[r].context);return this},i.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},i._wrapOnceHandler=function(t,e,i){var n=this,r="Z__"+t,o=!1,s=function a(){o||(delete s[r],o=!0,i?e.apply(i,arguments):e.apply(this,arguments),n.off(t,a,this))};return s[r]=e,s},i._switch=function(t,e,i){for(var n in e)e.hasOwnProperty(n)&&this[t](n,e[n],i);return this},i._clearListeners=function(t){this._eventMap&&A(t)&&(this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null))},i._clearAllListeners=function(){this._eventMap=null},i._setEventParent=function(t){return this._eventParent=t,this},i._setEventTarget=function(t){return this._eventTarget=t,this},i._fire=function(t,e){if(!this._eventMap)return this;var i=this._eventMap[t.toLowerCase()];if(!i)return this;e||(e={}),e.type=t,e.target=this._eventTarget||this;for(var n,r,o=i.slice(0),s=0,a=o.length;s<a;s++)o[s]&&(n=o[s].context,!0,r=v({},e),!1===(n?o[s].handler.call(n,r):o[s].handler(r))&&e.domEvent&&fi(e.domEvent));return this},e}(t)},Vi=Hi(function(){function t(t){this.target=t}var e=t.prototype;return e.enable=function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},e.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},e.enabled=function(){return!!this._enabled},e.remove=function(){this.disable(),delete this.target,delete this.dom},t}()),Wi=function(){function t(t){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks()}var e=t.prototype;return e.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},e.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},e.config=function(t){if(!t){var e={};for(var i in this.options)this.options.hasOwnProperty(i)&&(e[i]=this.options[i]);return e}if(2===arguments.length){var n={};n[t]=arguments[1],t=n}for(var r in t)this.options[r]=t[r],this[r]&&this[r]instanceof Vi&&(t[r]?this[r].enable():this[r].disable());return this.onConfig(t),this},e.onConfig=function(){},e._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var i=t._initHooks;if(i&&i!==e._initHooks)for(var n=0;n<i.length;n++)i[n].call(this)}},t.addInitHook=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r="function"==typeof t?t:function(){this[t].apply(this,i)},o=this.prototype,s=Object.getPrototypeOf(o);return o._initHooks&&o._initHooks!==s._initHooks||(o._initHooks=[]),o._initHooks.push(r),this},t.include=function(){for(var t=0;t<arguments.length;t++)v(this.prototype,t<0||arguments.length<=t?void 0:arguments[t]);return this},t.mergeOptions=function(t){var e=this.prototype,i=Object.getPrototypeOf(e);return e.options&&e.options!==i.options||(e.options=e.options?Object.create(e.options):{}),v(e.options,t),this},t}(),Zi={},qi=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return ct(e,t),e.registerJSONType=function(t){return t?(Zi[t]=this,this):this},e.getJSONClass=function(t){return t?Zi[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in Zi)if(Zi[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},e}(t)},Yi={},Qi=function(){function t(){this._tree=s()(9,["[0]","[1]","[2]","[3]"])}var e=t.prototype;return e.collides=function(t){return Yi.minX=t[0],Yi.minY=t[1],Yi.maxX=t[2],Yi.maxY=t[3],this._tree.collides(Yi)},e.insertBox=function(t){return this._tree.insert(t),this},e.bulkInsertBox=function(t){return this._tree.load(t),this},e.clear=function(){return this._tree.clear(),this},t}();function Ki(t){return function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},i.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var i=this._handlers.indexOf(e);i>=0&&this._handlers.splice(i,1),this[t].remove(),delete this[t]}return this},i._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)}var Xi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Ji={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},$i=function(t){function e(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,null)||this).dom=e,n.options=i,n}ct(e,t);var i=e.prototype;return i.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},Mi(this.dom,"touchstart mousedown",this._onMouseDown,this),this):this},i.disable=function(){return this.dom?(this._offEvents(),Ti(this.dom,"touchstart mousedown",this._onMouseDown),delete this._onMouseDown,this):this},i.onMouseDown=function(t){if((this.options.rightclick||2!==t.button)&&!(t.touches&&t.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(t))){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var i=t.touches?t.touches[0]:t;this.startPos=new pt(i.clientX,i.clientY),Mi(document,Xi[t.type],this.onMouseMove,this),Mi(document,Ji[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||Mi(this.dom,"mouseleave",this.onMouseUp,this),this.fire("mousedown",{domEvent:t,mousePos:new pt(i.clientX,i.clientY)})}},i.onMouseMove=function(t){if(t.touches&&t.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var e=t.touches?t.touches[0]:t,i=new pt(e.clientX,e.clientY).sub(this.startPos);(i.x||i.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new pt(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},i.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var i={domEvent:t};x(e.clientX)&&(i.mousePos=new pt(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(i.interupted=this.interupted,this.fire("dragend",i),delete this.interupted,delete this.moved),this.fire("mouseup",i)},i._offEvents=function(){var t=this.dom;if(Ti(t,"mouseleave",this.onMouseUp,this),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in Xi)Ti(document,Xi[e],this.onMouseMove,this),Ti(document,Ji[e],this.onMouseUp,this);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},e}(Vi),tn=function(t){function e(){return t.apply(this,arguments)||this}return ct(e,t),e.toNumberArrays=function(t){return Array.isArray(t)?At(t,function(t){return[t.x,t.y]}):[t.x,t.y]},e.toCoordinates=function(t){if(x(t[0])&&x(t[1]))return new e(t);if(t instanceof e)return t;for(var i=[],n=0,r=t.length;n<r;n++){var o=t[n];Array.isArray(o)?x(o[0])?i.push(new e(o)):i.push(e.toCoordinates(o)):o instanceof e?i.push(o):i.push(new e(o))}return i},e}(_t),en=function(){function t(t,e){this.type=t,this.properties=e}return t.createProj4=function(e){return new t("proj4",{proj:e})},t.fromProjectionCode=function(e){return e&&t[e=e.toUpperCase().replace(":","")]||null},t}();en.WGS84=en.createProj4("+proj=longlat +datum=WGS84 +no_defs"),en.EPSG4326=en.WGS84,en.EPSG3857=en.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),en.IDENTITY=en.createProj4("+proj=identity +no_defs"),en.CGCS2000=en.createProj4("+proj=longlat +datum=CGCS2000"),en.EPSG4490=en.CGCS2000,en.BD09LL=en.createProj4("+proj=longlat +datum=BD09"),en.GCJ02=en.createProj4("+proj=longlat +datum=GCJ02");var nn,rn=new pt(0,0),on=new tn(0,0),sn=new tn(0,0),an=new tn(0,0),hn=new tn(0,0),ln=new tn(0,0),cn=new tn(0,0),un=new tn(0,0),dn=new tn(0,0),fn=[],_n=[],pn=function(){function t(t,e,i,n){this._clazz=tn;var r=arguments.length,o=r>0?arguments[r-1]:null;o&&o.unproject&&(this.projection=arguments[r-1]),this._dirty=!0,this._initialize(t,e,i,n)}var e=t.prototype;return e._initialize=function(t,e,i,n){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!y(t)){var r=this.projection;x(t)&&x(e)&&x(i)&&x(n)?r?this.set(t,e,i,n):this.set(Math.min(t,i),Math.min(e,n),Math.max(t,i),Math.max(e,n)):Array.isArray(t)?r?this.set(t[0],t[1],t[2],t[3]):this.set(Math.min(t[0],t[2]),Math.min(t[1],t[3]),Math.max(t[0],t[2]),Math.max(t[1],t[3])):x(t.x)&&x(e.x)&&x(t.y)&&x(e.y)?r?this.set(t.x,t.y,e.x,e.y):(t.x>e.x?(this.xmin=e.x,this.xmax=t.x):(this.xmin=t.x,this.xmax=e.x),t.y>e.y?(this.ymin=e.y,this.ymax=t.y):(this.ymin=t.y,this.ymax=e.y)):x(t.xmin)&&x(t.xmax)&&x(t.ymin)&&x(t.ymax)&&this.set(t.xmin,t.ymin,t.xmax,t.ymax)}},e._add=function(t){return this._dirty=!0,y(t.x)?y(t.xmin)?y(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},e.add=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._add.apply(t,arguments)},e._scale=function(t){return this._dirty=!0,this.xmin*=t,this.ymin*=t,this.xmax*=t,this.ymax*=t,this},e._sub=function(t){return this._dirty=!0,y(t.x)?y(t.xmin)?y(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._sub.apply(t,arguments)},e.substract=function(){return this.sub.apply(this,arguments)},e.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},e._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},e.getMin=function(t){return t?(t.set(this.xmin,this.ymin),t):new this._clazz(this.xmin,this.ymin)},e.getMax=function(t){return t?(t.set(this.xmax,this.ymax),t):new this._clazz(this.xmax,this.ymax)},e.getCenter=function(t){var e=(this.xmin+this.xmax)/2,i=(this.ymin+this.ymax)/2;return t?(t.set(e,i),t):new this._clazz(e,i)},e.isValid=function(){return!(y(this.xmin)||y(this.ymin)||y(this.xmax)||y(this.ymax))},e.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},e.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),i=Math.max(this.pymin,t.pymin),n=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax),o=!(e>n||i>r);return o},e.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},e.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;if(e)if(void 0!==t.x){var i=on;Array.isArray(t)?(i.x=t[0],i.y=t[1]):(i.x=t.x,i.y=t.y),t=e.project(i,i)}else void 0!==t.xmin&&this._project(t);return(t.x||t.pxmin||0)>=this.pxmin&&(t.x||t.pxmax||0)<=this.pxmax&&(t.y||t.pymin||0)>=this.pymin&&(t.y||t.pymax||0)<=this.pymax},e.getWidth=function(){return Math.abs(this.xmax-this.xmin)},e.getHeight=function(){return Math.abs(this.ymax-this.ymin)},e.getSize=function(){return new Me(this.getWidth(),this.getHeight())},e.set=function(t,e,i,n){return this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=n,this._dirty=!0,this},e.__combine=function(t){var e,i,n,r;void 0!==t.x&&(nn.xmin=nn.xmax=t.x,nn.ymin=nn.ymax=t.y,t=nn),this._project(t),this._project(this),x(this.pxmin)?(e=Math.min(this.pxmin,t.pxmin),i=Math.min(this.pymin,t.pymin),n=Math.max(this.pxmax,t.pxmax),r=Math.max(this.pymax,t.pymax)):(e=t.pxmin,i=t.pymin,n=t.pxmax,r=t.pymax);var o=this.projection;if(o){sn.set(e,i),an.set(n,r);var s=o.unproject(sn,sn),a=o.unproject(an,an);e=s.x,i=s.y,n=a.x,r=a.y}return _n[0]=e,_n[1]=i,_n[2]=n,_n[3]=r,_n},e._combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},e.combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},e.intersection=function(t){if(!this.intersects(t))return null;hn.x=Math.max(this.pxmin,t.pxmin),hn.y=Math.max(this.pymin,t.pymin),ln.x=Math.min(this.pxmax,t.pxmax),ln.y=Math.min(this.pymax,t.pymax);var e=hn,i=ln,n=this.projection;return n&&(e=n.unproject(e,e),i=n.unproject(i,i)),new this.constructor(e,i,n)},e.expand=function(t){var e,i;return x(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-i,this.xmax+e,this.ymax+i,this.projection)},e._expand=function(t){var e,i;return x(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=i,this.xmax+=e,this.ymax+=i,this._dirty=!0,this},e.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},e.toArray=function(t){var e=this.xmin,i=this.ymin,n=this.xmax,r=this.ymax;return t?(t[0].x=e,t[0].y=r,t[1].x=n,t[1].y=r,t[2].x=n,t[2].y=i,t[3].x=e,t[3].y=i,t[4].x=e,t[4].y=r,t):[new this._clazz([e,r]),new this._clazz([n,r]),new this._clazz([n,i]),new this._clazz([e,i]),new this._clazz([e,r])]},e.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},e.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},e.convertTo=function(t,e){if(!this.isValid())return null;var i,n=e||new this.constructor;return e&&n.set(null,null,null,null),this._clazz===tn?i=cn:this._clazz===pt&&(i=rn),i.x=this.xmin,i.y=this.ymax,n._combine(t(i)),i.x=this.xmax,n._combine(t(i)),i.y=this.ymin,n._combine(t(i)),i.x=this.xmin,n._combine(t(i)),n},e._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){un.set(t.xmax,t.ymin),dn.set(t.xmin,t.ymax),fn[0]=un,fn[1]=dn;var i=e.projectCoords(fn),n=i[0],r=i[1];t.pxmin=Math.min(n.x,r.x),t.pymin=Math.min(n.y,r.y),t.pxmax=Math.max(n.x,r.x),t.pymax=Math.max(n.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}else t&&(t.pxmin=t.pxmax=t.pymin=t.pymax=null)},t}();nn=new pn(0,0,0,0);var mn,gn=function(t){function e(e,i,n,r){var o;return(o=t.call(this,e,i,n,r)||this)._clazz=pt,o}return ct(e,t),e}(pn),vn=function(){function t(t){this.matrix=t}var e=t.prototype;return e.transform=function(t,e,i){var n=this.matrix[0]*(t.x-this.matrix[2])/e,r=-this.matrix[1]*(t.y-this.matrix[3])/e;return i?(i.x=n,i.y=r,i):new pt(n,r)},e.untransform=function(t,e,i){var n=t.x*e/this.matrix[0]+this.matrix[2],r=t.y*e/-this.matrix[1]+this.matrix[3];return i?(i.x=n,i.y=r,i):new tn(n,r)},t}(),yn={project:function(){},unproject:function(){},projectCoords:function(t){var e=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return At(t,this.project,this);if(Array.isArray(t[0]))return t.map(function(t){return e.projectCoords(t)});for(var i,n,r,o,s,a,h=this.getCircum(),l=this.getSphereExtent(),c=l.sx,u=l.sy,d=t[0],f=[this.project(d)],_=1,p=t.length;_<p;_++)o=(r=t[_]).x-d.x,s=r.y-d.y,a=this.project(r),Math.abs(o)>180&&(void 0===i&&(i=r.x>d.x),i&&(a._add(-h.x*St(o)*c,0),r._add(-360*St(o),0))),Math.abs(s)>90&&(void 0===n&&(n=r.y<d.y),n&&(a._add(0,-h.y*St(s)*u),r._add(0,-180*St(s)))),d=r,f.push(a);return f},unprojectCoords:function(t){return t?Array.isArray(t)?At(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),i=new tn(t);return e.contains(i)||(i.x=Mt(t.x,e.xmin,e.xmax),i.y=Mt(t.y,e.ymin,e.ymax)),i},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new tn(180,90)),e=this.project(new tn(-180,-90));this.extent=new pn(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},xn={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var i=0,n=0,r=t.length;n<r-1;n++)i+=this.measureLenBetween(t[n],t[n+1]);return i}},wn=v({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(t){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i],o=null;o=i===n-1?t[0]:t[i+1],e+=r.x*o.y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,i){return t=new tn(t.x,t.y),this._locate(t,e,i)},_locate:function(t,e,i){return t?(e||(e=0),i||(i=0),e||i?(t.x=t.x+e,t.y=t.y+i,t):t):null},rotate:function(t,e,i){return t=new tn(t.x,t.y),this._rotate(t,e,i)},_rotate:(mn=new pt(0,0),function(t,e,i){return mn.x=t.x-e.x,mn.y=t.y-e.y,mn._rotate(i*Math.PI/180),t.x=e.x+mn.x,t.y=e.y+mn.y,t})},xn),bn=function(){function t(t){this.radius=t}var e=t.prototype;return e.measureLenBetween=function(t,e){if(!t||!e)return 0;var i=M(t.y),n=M(e.y),r=i-n,o=M(t.x)-M(e.x);return i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(o/2),2))),i*=this.radius,Math.round(1e5*i)/1e5},e.measureArea=function(t){var e,i=M(this.radius),n=0,r=t,o=r.length;if(o<3)return 0;for(e=0;e<o-1;e++){var s=r[e],a=r[e+1];n+=s.x*i*Math.cos(M(s.y))*a.y*i-a.x*i*Math.cos(M(a.y))*s.y*i}return o=r[e],r=r[0],n+=o.x*i*Math.cos(M(o.y))*r.y*i-r.x*i*Math.cos(M(r.y))*o.y*i,.5*Math.abs(n)},e.locate=function(t,e,i){return t=new tn(t.x,t.y),this._locate(t,e,i)},e._locate=function(t,e,i){if(!t)return null;if(e||(e=0),i||(i=0),!e&&!i)return t;var n,r,o=M(t.y);if(0!==i){var s=Math.abs(i);r=Mt(180*(o+=2*Math.sin(s/(2*this.radius))*(i>0?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var a=Math.abs(e),h=M(t.x);n=Mt(180*(h+=2*Math.sqrt(Math.pow(Math.sin(a/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(e>0?1:-1))/Math.PI,-180,180)}else n=t.x;return t.x=n,t.y=r,t},e.rotate=function(t,e,i){return t=new tn(t),this._rotate(t,e,i)},e._rotate=function(t,e,i){var n=function(t,e,i){void 0===i&&(i={});var n;n=i.final?An(e,t):An(t,e);return n>180?-(360-n):n}(e,t)-i,r=this.measureLenBetween(e,t);return t.x=e.x,t.y=e.y,function(t,e,i,n){var r=e/n,o=t.x*Math.PI/180,s=M(t.y),a=M(i),h=r*Math.cos(a),l=s+h;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),u=Math.abs(c)>1e-11?h/c:Math.cos(s),d=r*Math.sin(a)/u,f=o+d;return t.x=(180*f/Math.PI+540)%360-180,t.y=180*l/Math.PI,t}(t,r,n,this.radius)},t}();function An(t,e){var i=M(t.y),n=M(e.y),r=M(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(T(Math.atan2(r,o))+360)%360}var Cn=v({measure:"EPSG:4326",sphere:new bn(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},xn),Sn=v({measure:"BAIDU",sphere:new bn(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},xn),En=Cn,Pn={};function Mn(t){Pn[t.measure]=t}Mn(wn),Mn(Cn),Mn(Sn);var Tn={getInstance:function(t){if(!t)return En;for(var e in Pn)if(E(Pn,e)){var i=Pn[e].measure;if(!i)continue;if(t.toLowerCase()===i.toLowerCase())return Pn[e]}return null}},kn=v({},yn,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,e){var i=this.rad,n=this.metersPerDegree,r=this.maxLatitude,o=t.x,s=Math.max(Math.min(r,t.y),-r),a=o*n,h=(0===s?0:Math.log(Math.tan((90+s)*i/2))/i)*n;return e?(e.x=a,e.y=h,e):new tn(a,h)},unproject:function(t,e){var i,n=this.rad,r=this.metersPerDegree,o=t.x/r,s=t.y;0===s?i=0:(i=s/r,i=(2*Math.atan(Math.exp(i*n))-Math.PI/2)/n),Math.abs(Math.abs(o)-180)<1e-7&&(o=180*St(o)),Math.abs(Math.abs(i)-this.maxLatitude)<1e-7&&(i=St(i)*this.maxLatitude);var a=Mt(o,-180,180),h=Mt(i,-this.maxLatitude,this.maxLatitude);return e?(e.x=a,e.y=h,e):new tn(a,h)}},Cn),Rn=v({},yn,{code:"EPSG:4326",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new tn(t)},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new tn(t)}},Cn),Ln=v({},Rn,{code:"EPSG:4490"}),Dn=v({},yn,{code:"BAIDU",project:function(t,e){return this.convertLL2MC(t,e)},unproject:function(t,e){return this.convertMC2LL(t,e)}},Sn,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,e){for(var i,n=0,r=this.MCBAND.length;n<r;n++)if(Math.abs(t.y)>=this.MCBAND[n]){i=this.MC2LL[n];break}return this.convertor(t,i,e)},convertLL2MC:function(t,e){var i,n,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var o=new tn(t.x,t.y);for(n=0,r=this.LLBAND.length;n<r;n++)if(o.y>=this.LLBAND[n]){i=this.LL2MC[n];break}if(!i)for(n=this.LLBAND.length-1;n>=0;n--)if(o.y<=-this.LLBAND[n]){i=this.LL2MC[n];break}return this.convertor(t,i,e)},convertor:function(t,e,i){if(!t||!e)return null;var n=e[0]+e[1]*Math.abs(t.x),r=Math.abs(t.y)/e[9],o=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return n*=t.x<0?-1:1,o*=t.y<0?-1:1,i?(i.x=n,i.y=o,i):new tn(n,o)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},getLoop:function(t,e,i){if(t===1/0)return i;if(t===-1/0)return e;for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}}),On=v({},yn,{code:"IDENTITY",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()}},wn),In=kn,Bn=Object.freeze({EPSG3857:kn,DEFAULT:In,EPSG4326:Rn,EPSG4490:Ln,BAIDU:Dn,IDENTITY:On,Common:yn}),jn=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return ct(e,t),e.registerRenderer=function(t,e){var i=this.prototype,n=Object.getPrototypeOf(i);return i._rendererClasses&&i._rendererClasses!==n._rendererClasses||(i._rendererClasses=i._rendererClasses?Object.create(i._rendererClasses):{}),i._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)},zn={};var Gn,Nn="\n    var adapters = {};\n    onmessage = function (msg) {\n        msg = msg.data;\n        if (msg.messageType === 'batch') {\n            const messages = msg.messages;\n            if (messages) {\n                for (let i = 0; i < messages.length; i++) {\n                    dispatch(messages[i]);\n                }\n            }\n        } else {\n            dispatch(msg);\n        }\n    };\n\n    function dispatch(msg) {\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    }\n\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            post(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n",Fn="\n    workerExports = null;\n";function Un(){if("undefined"==typeof window)return null;if(!Gn){var t=function(){var t=Nn;for(var e in zn){var i=zn[e];C(i)&&0===i.length&&(i=i()),t+="\n    workerExports = {};\n    ("+i+")(workerExports, self);\n    adapters['"+e+"'] = workerExports",t+="\n    workerExports.initialize && workerExports.initialize(self);\n        "}return t+=Fn}();Gn=window.URL.createObjectURL(new Blob([t],{type:"text/javascript"})),zn=null}return Gn}var Hn,Vn="undefined"!=typeof window?window.navigator.hardwareConcurrency||4:0,Wn=Math.max(Math.floor(Vn/2),1),Zn=function(){function t(t){void 0===t&&(t=50),this._limit=t,this._messages=[],this.buffers=[]}var e=t.prototype;return e.addMessage=function(t,e){if(this._messages.push(t),Array.isArray(e))for(var i=0;i<e.length;i++)this.buffers.indexOf(e[i])<0&&this.buffers.push(e[i])},e.isFull=function(){return this._messages.length>=this._limit},e.getMessage=function(){return{messageType:"batch",messages:this._messages}},t}(),qn=function(){function t(){this.active={},this.workerCount="undefined"!=typeof window?window.MAPTALKS_WORKER_COUNT||Wn:0,this._messages=[],this._messageBuffers=[]}var e=t.prototype;return e.acquire=function(t){if(!this.workers){this.workers=[];for(var e=Un(),i=0;i<this.workerCount;i++){var n=new Worker(e);n.id=i,this.workers.push(n)}URL.revokeObjectURL(e)}return this.active[t]=!0,this.workers.slice()},e.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},e.addMessage=function(t,e,i){var n=this._messages[t];n&&n.length||(n=this._messages[t]=[new Zn]);var r=n[n.length-1];r.isFull()&&(r=new Zn,this._messages[t].push(r)),r.addMessage(e,i)},e.commit=function(){if(this._messages.length)for(var t=0;t<this._messages.length;t++)if(this._messages[t]&&this._messages[t].length){var e=this._messages[t].shift();this.workers[t].postMessage(e.getMessage(),e.buffers)}},t}();function Yn(){return Hn||(Hn=new qn),Hn}var Qn=0,Kn=[],Xn=function(){function t(t){var e=this;this.workerKey=t,this.workerPool=Yn(),this.currentActor=0,this.actorId=yt(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach(function(t){t.addEventListener("message",e.receiveFn,!1)})}var e=t.prototype;return e.isActive=function(){return!!this.workers},e.broadcast=function(t,e,i){var n=this;return i=i||function(){},function(t,e,i){t.length||i(null,[]);var n=t.length,r=new Array(t.length),o=null;t.forEach(function(t,s){e(t,function(t,e){t&&(o=t),r[s]=e,0==--n&&i(o,r)})})}(this.workers,function(i,r){n.send(t,e,r,i.id)},i),this},e.send=function(t,e,i,n){var r=i?this.actorId+":"+this.callbackID++:null;return i&&(this.callbacks[r]=i),this.post({data:t,callback:String(r)},e,n),this},e.receive=function(t){var e=this,i=t.data,n=i.callback,r=this.callbacks[n];delete this.callbacks[n],"<request>"===i.type?this.actorId===i.actorId&&this[i.command](i.params,function(t,n,r){var o={type:"<response>",callback:i.callback};t?o.error=t.message:o.data=n,e.post(o,r||Kn,i.workerId)}):r&&i.error?r(i.error):r&&r(null,i.data)},e.remove=function(){var t=this;this.workers.forEach(function(e){e.removeEventListener("message",t.receiveFn,!1)}),this.workerPool.release(this.actorId),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},e.post=function(t,e,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),t.workerId=i,t.workerKey=this.workerKey,t.actorId=this.actorId,this.workerPool.addMessage(i,t,e||Kn),i},e.getDedicatedWorker=function(){return Qn=(Qn+1)%this.workerPool.workerCount},t}();var Jn="core-fetch-image",$n=[],tr=function(t){function e(){return t.call(this,Jn)||this}return ct(e,t),e.prototype.fetchImage=function(t,e){var i={url:t};this.send(i,$n,e)},e}(Xn),er=function(t){function e(e){var i;return(i=t.call(this)||this).layer=e,i._painted=!1,i._drawTime=0,lt.decodeImageInWorker&&(i._resWorkerConn=new tr),i.setToRedraw(),i}ct(e,t);var i=e.prototype;return i.render=function(t){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new ir),this.checkAndDraw(this._tryToDraw,t))},i.checkAndDraw=function(t){var e=this;this._toRedraw=!1;for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];if(this.checkResources){var o=this.checkResources();o.length>0?(this._loadingResource=!0,this.loadResources(o).then(function(){e._loadingResource=!1,e.layer&&(e.layer.fire("resourceload"),e.setToRedraw())})):t.call.apply(t,[this].concat(n))}else t.call.apply(t,[this].concat(n))},i.testIfNeedRedraw=function(){var t=this.getMap();return!this._loadingResource&&(!!this._toRedraw||!(t.isInteracting()&&!this.drawOnInteracting)&&!!this.needToRedraw())},i.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()&&!t.getRenderer().isViewChanged())&&!(!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},i.onSkipDrawOnInteracting=function(){},i.isLoadingResource=function(){return this._loadingResource},i.isRenderComplete=function(){return!!this._renderComplete},i.mustRenderOnInteracting=function(){return!this._painted},i.setToRedraw=function(){return this._toRedraw=!0,this},i.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},i.isCanvasUpdated=function(){return!!this._canvasUpdated},i.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,delete this.layer},i.onRemove=function(){},i.onAdd=function(){},i.getMap=function(){return this.layer?this.layer.getMap():null},i.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.southWest)._add(0,-t.height);return{image:this.canvas,layer:this.layer,point:e}},i.clear=function(){this.clearCanvas()},i.isBlank=function(){return!this._painted},i.show=function(){this.setToRedraw()},i.hide=function(){this.clear(),this.setToRedraw()},i.setZIndex=function(){this.setToRedraw()},i.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown)return!1;var e=this.getMap(),i=e.getDevicePixelRatio(),n=e.getSize();if(t.x<0||t.x>n.width*i||t.y<0||t.y>n.height*i)return!1;var r=this.getImageData&&this.getImageData();if(r){var o=i*t.x,s=i*t.y*r.width*4+4*o;return r.data[s+3]>0}try{if(this.context.getImageData(i*t.x,i*t.y,1,1).data[3]>0)return!0}catch(t){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t),this._errorThrown=!0),!1}return!1},i.loadResources=function(t){this.resources||(this.resources=new ir);var e=this.resources,i=[];if(kt(t))for(var n={},r=t.length-1;r>=0;r--){var o=t[r];o&&o.length&&!n[o.join("-")]&&(n[o.join("-")]=1,e.isResourceLoaded(o,!0)||i.push(new Ui(this._promiseResource(o))))}return Ui.all(i)},i.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t._get2DExtent(),this.southWest=t._containerPointToPoint(new pt(0,t.height))},i.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),i=t.getDevicePixelRatio(),n=Math.round(i*e.width),r=Math.round(i*e.height);if(this.layer._canvas){var o=this.layer._canvas;o.width=n,o.height=r,o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=ji.createCanvas(n,r,t.CanvasClass);this.onCanvasCreate()}},i.onCanvasCreate=function(){},i.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=this.canvas.getContext("2d"),this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();1!==t&&this.context.scale(t,t)}},i.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},i.resizeCanvas=function(t){var e=this.canvas;if(e){var i=t||this.getMap().getSize(),n=this.getMap().getDevicePixelRatio(),r=Qt(i,n),o=r.width,s=r.height,a=r.cssWidth,h=r.cssHeight;!this.layer._canvas||e.style.width===a&&e.style.height===h||(e.style.width=a,e.style.height=h),e.width===o&&e.height===s||(e.height=s,e.width=o,1!==n&&this.context&&this.context.scale(n,n))}},i.clearCanvas=function(){if(this.context&&this.getMap()){var t=1/this.getMap().getDevicePixelRatio(),e=this.canvas.width*t,i=this.canvas.height*t;ji.clearRect(this.context,0,0,Math.max(e,this.canvas.width),Math.max(i,this.canvas.height))}},i.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},i.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var i=this.southWest,n=this.getMap();this.southWest=n._containerPointToPoint(new pt(0,n.height)),t.save();var r=n.getDevicePixelRatio();if(1!==r&&(t.save(),t.scale(r,r)),e.getGeometries){t.isMultiClip=!0;var o=e.getGeometries()||[];t.beginPath(),o.forEach(function(e){e._getMaskPainter().paint(null,t)}),t.stroke(),delete t.isMultiClip}else{e._getMaskPainter().paint(null,t)}return 1!==r&&t.restore(),t.clip(),this.southWest=i,!0},i.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},i.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},i.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},i.onZoomStart=function(){},i.onZoomEnd=function(){this.setToRedraw()},i.onZooming=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){this.setToRedraw()},i.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},i.onDragRotateStart=function(){},i.onDragRotating=function(){},i.onDragRotateEnd=function(){this.setToRedraw()},i.onSpatialReferenceChange=function(){},i.getDrawTime=function(){return this._drawTime},i._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},i._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var i=g();this.draw(t),i=g()-i,this._drawTime=e?i:i/2,e&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",t,"drawTime:",this._drawTime)}},i._promiseResource=function(t){var e=this,i=this.resources,n=this.layer.options.crossOrigin,r=this.layer.options.renderer||"";return function(o){if(i.isResourceLoaded(t,!0))o(t);else if(!mt(t[0])&&lt.decodeImageInWorker){var s=qt(t[0]);e._resWorkerConn.fetchImage(s,function(i,n){if(i)return i&&"undefined"!=typeof console&&console.warn(i),void o(t);Zt(n,function(i){e._cacheResource(t,i),o(t)})})}else{var a=new Image;y(n)?"canvas"!==r&&(a.crossOrigin=""):a.crossOrigin=n,mt(t[0])&&!k&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),a.onload=function(){e._cacheResource(t,a),o(t)},a.onabort=function(e){console&&console.warn("image loading aborted: "+t[0]),e&&console&&console.warn(e),o(t)},a.onerror=function(e){e&&"undefined"!=typeof console&&console.warn(e),i.markErrorResource(t),o(t)},gt(a,t)}}},i._cacheResource=function(t,e){if(this.layer&&this.resources){var i=t[1],n=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===mt(t[0])&&(lt.edge||lt.ie)){y(i)&&(i=e.width||this.layer.options.defaultIconSize[0]),y(n)&&(n=e.height||this.layer.options.defaultIconSize[1]);var r=ji.createCanvas(i,n);ji.image(r.getContext("2d"),e,0,0,i,n),e=r}this.resources.addResource(t,e)}},e}(Wi),ir=function(){function t(){this.resources={},this._errors={}}var e=t.prototype;return e.addResource=function(t,e){var i=this;if(this.resources[t[0]]={image:e,width:+t[1],height:+t[2],refCnt:0},e&&!e.close&&lt.imageBitMap){if(e.src&&mt(e.src))return;createImageBitmap(e).then(function(e){i.resources[t[0]]&&(i.resources[t[0]].image=e)})}},e.isResourceLoaded=function(t,e){if(!t)return!1;var i=this._getImgUrl(t);if(this._errors[i])return!0;var n=this.resources[i];return!!n&&!(e&&mt(t[0])&&(+t[1]>n.width||+t[2]>n.height))},e.login=function(t){var e=this.resources[t];e&&e.refCnt++},e.logout=function(t){var e=this.resources[t];e&&e.refCnt--<=0&&delete this.resources[t]},e.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},e.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},e.merge=function(t){if(!t)return this;for(var e in t.resources){var i=t.resources[e];this.addResource([e,i.width,i.height],i.image)}return this},e.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)E(this.resources,e)&&t(e,this.resources[e]);return this},e._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},e.remove=function(){for(var t in this.resources){var e=this.resources[t];e&&e.image&&e.image.close&&e.image.close()}this.resources={}},t}(),nr={markerWidth:10,markerHeight:10,markerLineWidth:1};var rr=new pt(0,0);function or(t,e,i,n,r,o,s){var a,h,l,c,u,d,f=rr.set(e,i),_=t.set(f.x,f.y,f.x+o,f.y+s);return _._add(r),n&&(h=n,l=(a=_).xmin,c=a.ymin,u=a.xmax,d=a.ymax,fr.set(l,c,u,d),fr.convertTo(function(t){return t._rotate(h)},a)),_}var sr=[];function ar(t,e,i){var n=ur(e,(i=i||dr(sr,e))[0],i[1]);return or(t,e.markerDx||0,e.markerDy||0,_r(e),n,i[0],i[1])}function hr(t){return"rectangle"===t?"right":"middle"}function lr(t){return"bar"===t||"pie"===t||"pin"===t?"top":"rectangle"===t?"bottom":"middle"}var cr=new Me(0,0);function ur(t,e,i){var n=2*(t.shadowBlur||0)+.5;cr.width=e,cr.height=i;var r=t.markerType,o=Ne(cr,t.markerHorizontalAlignment||hr(r),t.markerVerticalAlignment||lr(r));return o.x!==-e/2&&(o.x-=St(o.x+e/2)*n),o.y!==-i/2&&(o.y-=St(o.y+i/2)*n),o}function dr(t,e){var i=Ct(e.markerWidth,nr.markerWidth),n=Ct(e.markerHeight,nr.markerHeight),r=Ct(e.markerLineWidth,nr.markerLineWidth),o=2*((e.shadowBlur||0)+Math.max(Math.abs(e.shadowOffsetX||0)+Math.abs(e.shadowOffsetY||0))),s=Math.round(i+r+o+1),a=Math.round(n+r+o+1);return t[0]=s,t[1]=a,t}var fr=new gn;function _r(t,e){void 0===e&&(e="markerRotation");var i=t[e];return x(i)?-i*Math.PI/180:0}function pr(t,e,i){var n=e.markerFile,r=i?i.getImage(n):null,o=e.markerWidth||(r?r.width:0),s=e.markerHeight||(r?r.height:0);cr.width=o,cr.height=s;var a=Ne(cr,e.markerHorizontalAlignment||"middle",e.markerVerticalAlignment||"top");return or(t,e.markerDx||0,e.markerDy||0,_r(e),a,o,s)}function mr(t,e,i){var n=i.size,r=Ne(n,e.textHorizontalAlignment,e.textVerticalAlignment);if(e.textHaloRadius){var o=e.textHaloRadius;n=n.add(2*o,2*o)}return or(t,e.textDx||0,e.textDy||0,_r(e,"textRotation"),r,n.width,n.height)}var gr=new gn;function vr(t,e,i,n){var r=t||new gn;if(Array.isArray(e)){for(var o=e,s=0;s<o.length;s++)vr(r,o[s],i,n[s]);return r}return yr(e)&&r._combine(mr(gr,e,n)),xr(e)&&r._combine(pr(gr,e,i)),wr(e)&&r._combine(ar(gr,e)),br(e)&&r._combine(pr(gr,e)),r}function yr(t){return!!t&&!y(t.textName)}function xr(t){return!!t&&!y(t.markerFile)}function wr(t){return!!t&&!(!y(t.markerFile)||y(t.markerType)||"path"===t.markerType)}function br(t){return!!t&&!(!y(t.markerFile)||"path"!==t.markerType)}var Ar,Cr=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation"],Sr=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY"];function Er(t,e,i,n){for(var r,o=[],s=0,a=0,h=t.length;a<h-1;a++)(r=Pr(t[a],t[a+1],e,a,i,n))&&(o[s]=o[s]||[],o[s].push({point:r[0],index:a}),r[1]===t[a+1]&&a!==h-2||(o[s].push({point:r[1],index:a+1}),s++));return o}function Pr(t,e,i,n,r,o){var s,a,h,l=n?Ar:kr(t,i),c=kr(e,i);for(Ar=c;;){if(!(l|c))return[t,e];if(l&c)return!1;if(o)return[t,e];h=kr(a=Tr(t,e,s=l||c,i,r),i),s===l?(t=a,l=h):(e=a,c=h)}}function Mr(t,e,i){var n,r,o,s,a,h,l,c,u,d=[1,4,2,8];for(r=0,l=t.length;r<l;r++)t[r]._code=kr(t[r],e);for(s=0;s<4;s++){for(c=d[s],n=[],r=0,o=(l=t.length)-1;r<l;o=r++)a=t[r],h=t[o],a._code&c?h._code&c||((u=Tr(h,a,c,e,i))._code=kr(u,e),n.push(u)):(h._code&c&&((u=Tr(h,a,c,e,i))._code=kr(u,e),n.push(u)),n.push(a));t=n}return t}function Tr(t,e,i,n,r){var o,s,a=e.x-t.x,h=e.y-t.y,l=n.getMin(),c=n.getMax();8&i?(o=t.x+a*(c.y-t.y)/h,s=c.y):4&i?(o=t.x+a*(l.y-t.y)/h,s=l.y):2&i?(o=c.x,s=t.y+h*(c.x-t.x)/a):1&i&&(o=l.x,s=t.y+h*(l.x-t.x)/a);var u=new pt(o,s);return r&&u._round(),u}function kr(t,e){var i=0;return t.x<e.getMin().x?i|=1:t.x>e.getMax().x&&(i|=2),t.y<e.getMin().y?i|=4:t.y>e.getMax().y&&(i|=8),i}function Rr(t,e,i,n){t=new pt(t);var r,o,s,a=Math.abs(i.x-e.x),h=Math.abs(i.y-e.y),l=Math.sqrt(Math.abs(a*a-h*h));return a>=h?(r=new pt(e.x-l,e.y),o=new pt(e.x+l,e.y),s=2*a):(r=new pt(e.x,e.y-l),o=new pt(e.x,e.y+l),s=2*h),t.distanceTo(r)+t.distanceTo(o)<=s+2*n}var Lr=function(){function t(){}var e=t.prototype;return e.getMap=function(){return this.geometry.getMap()},e.getPainter=function(){return this.painter},e.isDynamicSize=function(){return!1},t.testColor=function(t){return!(!t||!A(t))&&p.indexOf(t)>=0},t}(),Dr=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i._prepareContext=function(t){if(ee(this.symbol.opacity)?this._opacityFn||(this._opacityFn=ne(this.symbol.opacity)):delete this._opacityFn,x(this.symbol.opacity))t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var e=this.getMap();t.globalAlpha=this._opacityFn(e.getZoom())}else 1!==t.globalAlpha&&(t.globalAlpha=1)},i.prepareCanvas=function(t,e,i){t.setLineDash&&kt(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var n=this.getPainter().isHitTesting();ji.prepareCanvas(t,e,i,n)},i.remove=function(){},i.setZIndex=function(){},i.show=function(){},i.hide=function(){},i._defineStyle=function(t){return be(t,this.geometry)},e}(Lr);function Or(t,e,i,n){var r,o=Ir(i),s=i,a=s.markerType.toLowerCase(),h=Br(a,s.markerWidth,s.markerHeight),l=o.lineOpacity,c=o.polygonOpacity;We(o.polygonFill)&&(We(o.polygonFill)&&(r||(r=function(t,e,i){var n=new gn;return n._combine(t),n.xmin+=-e/2,n.ymin+=-i/2,n.xmax+=e/2,n.ymax+=i/2,n}(e,s.markerWidth,s.markerHeight)),o.polygonGradientExtent=r));ji.prepareCanvas(t,o,n);var u=s.markerWidth,d=s.markerHeight,f=s.markerLineWidth/2;if("ellipse"===a)ji.ellipse(t,e,u/2,d/2,d/2,l,c);else if("cross"===a||"x"===a){for(var _=h.length-1;_>=0;_--)h[_]._add(e);ji.path(t,h.slice(0,2),l),ji.path(t,h.slice(2,4),l)}else if("diamond"===a||"bar"===a||"square"===a||"rectangle"===a||"triangle"===a){"bar"===a?e=e.add(0,-f):"rectangle"===a&&(e=e.add(f,f));for(var p=h.length-1;p>=0;p--)h[p]._add(e);ji.polygon(t,h,l,c)}else if("pin"===a){e=e.add(0,-f);for(var m=h.length-1;m>=0;m--)h[m]._add(e);var g=t.lineCap;t.lineCap="round",ji.bezierCurveAndFill(t,h,l,c),t.lineCap=g}else{if("pie"!==a)throw new Error("unsupported markerType: "+a);e=e.add(0,-f);var v=180*Math.atan(u/2/d)/Math.PI,y=t.lineCap;t.lineCap="round",ji.sector(t,e,d,[90-v,90+v],l,c),t.lineCap=y}return t.canvas}function Ir(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e}function Br(t,e,i){var n,r=i/2,o=e/2;if("triangle"===t)return[n=new pt(0,0-r),new pt(0-o,0+r),new pt(0+o,0+r)];if("cross"===t)return[n=new pt(0-o,0),new pt(0+o,0),new pt(0,0-r),new pt(0,0+r)];if("diamond"===t)return[n=new pt(0-o,0),new pt(0,0-r),new pt(0+o,0),new pt(0,0+r)];if("square"===t)return[n=new pt(0-o,0+r),new pt(0+o,0+r),new pt(0+o,0-r),new pt(0-o,0-r)];if("rectangle"===t)return[n=new pt(0,0),n.add(e,0),n.add(e,i),n.add(0,i)];if("x"===t)return[n=new pt(0-o,0+r),new pt(0+o,0-r),new pt(0+o,0+r),new pt(0-o,0-r)];if("bar"===t)return[n=new pt(0-o,0-i),new pt(0+o,0-i),new pt(0+o,0),new pt(0-o,0)];if("pin"===t||"pie"===t){var s=i*Math.atan(o/r);return[n=new pt(0,0),new pt(0-s,0-i),new pt(0+s,0-i),new pt(0,0)]}return[]}var jr,zr=new pt(0,0),Gr=new pt(0,0),Nr=new pt(0,0),Fr=new pt(0,0),Ur=function(t){function e(e,i,n){var r;return(r=t.call(this)||this).symbol=e,r.geometry=i,r.painter=n,r}ct(e,t);var i=e.prototype;return i.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLRes(),i=new gn,n=this._getRenderPoints()[0],r=n.length-1;r>=0;r--)n[r]&&i._combine(t._pointAtResToPoint(n[r],e));return i},i.isDynamicSize=function(){var t=this.symbol;return ee(t.markerWidth)||ee(t.markerHeight)||ee(t.textSize)},i._rotateExtent=function(t,e){return t.convertTo(function(t){return t._rotate(e)})},i._getRenderPoints=function(){var t=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(t)},i._getRenderContainerPoints=function(t){var e=this.getPainter();if(e.isSpriting())return this._getRenderPoints()[0];var i,n=this.geometry,r=this.getDxDy();if(n._cPoint&&!t){var o=t?Nr:Fr;o.set(n._cPoint.x,n._cPoint.y);var s=e.containerOffset;o._sub(s);var a=r.x,h=r.y;(a||h)&&o._add(a||0,h||0),i=[o]}else{var l=this._getRenderPoints()[0];i=this.painter._pointContainerPoints(l,r.x,r.y,t,!0,this.getPlacement())}if(!i||!Array.isArray(i[0]))return i;for(var c=[],u=0,d=i.length;u<d;u++)for(var f=0,_=i[u].length;f<_;f++)c.push(i[u][f]);return c},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){return _r(this.style)},i.getDxDy=function(){var t=this.style,e=t.markerDx,i=t.markerDy;return new pt(e,i)},i._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var i=this._getRenderPoints()[1];if(!i||!i[t])return e;var n=this.getMap(),r=i[t][0],o=i[t][1];if(n.isTransforming()){var s=n.getGLRes();return r=n._pointAtResToContainerPoint(i[t][0],s,0,zr),o=n._pointAtResToContainerPoint(i[t][1],s,0,Gr),e+zt(r.x,r.y,o.x,o.y)}return e+-zt(r.x,r.y,o.x,o.y)},i._rotate=function(t,e,i){if(i){var n=this.getDxDy(),r=e.sub(n);return t.save(),t.translate(r.x,r.y),t.rotate(i),n}return null},e}(Dr),Hr=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.getPlacement=function(){return"point"},i.getDxDy=function(){return new pt(0,0)},i.symbolize=function(t){var e=this.geometry,i=e.getLayer();if(e.options.debug||!i||i.options.debug){var n=this.getMap();if(n&&!n.isZooming()){var r=i.options.debugOutline;t.strokeStyle=r,t.fillStyle=r;var o=e.getContainerExtent().toArray();ji.polygon(t,[o],1,0);for(var s=this._getRenderContainerPoints(),a=this.geometry.getId(),h=Br("cross",10,10),l=0;l<s.length;l++){var c=s[l];y(a)||ji.fillText(t,a,c.add(8,-4),r);for(var u=[],d=0;d<h.length;d++)u.push(h[d].add(c));ji.path(t,u.slice(0,2),1),ji.path(t,u.slice(2,4),1)}}}},e}(Ur),Vr=new Me(1,1),Wr=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this).style=r._defineStyle(r.translate()),r}ct(e,t),e.test=function(t){return xr(t)};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&0!==i.markerOpacity){var n=this._getRenderContainerPoints();if(kt(n)){var r=this._getImage(e);if(r){this._prepareContext(t);var o,s=i.markerWidth,a=i.markerHeight;if(!x(s)||!x(a)){s=r.width,a=r.height,i.markerWidth=s,i.markerHeight=a;var h=i.markerFile;e.isResourceLoaded(h)||e.addResource(h,r);var l=this.getPainter();l.isSpriting()||l.removeCache()}"path"!==this.symbol.markerType&&x(i.markerOpacity)&&i.markerOpacity<1&&(o=t.globalAlpha,t.globalAlpha*=i.markerOpacity),Vr.width=s,Vr.height=a;for(var c=Ne(Vr,i.markerHorizontalAlignment,i.markerVerticalAlignment),u=0,d=n.length;u<d;u++){var f=n[u],_=this.getRotation()?this._rotate(t,f,this._getRotationAt(u)):null;_&&(f=_),ji.image(t,r,f.x+c.x,f.y+c.y,s,a),_&&t.restore()}void 0!==o&&(t.globalAlpha=o)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}},i._getImage=function(t){return function(t,e){return t&&t.getImage(e)||null}(t,this.style.markerFile)},i.getFixedExtent=function(t){return this._fixedExtent=this._fixedExtent||new gn,pr(this._fixedExtent,this.style,t)},i.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:Ct(t.markerOpacity,1),markerWidth:Ct(t.markerWidth,null),markerHeight:Ct(t.markerHeight,null),markerRotation:Ct(t.markerRotation,0),markerDx:Ct(t.markerDx,0),markerDy:Ct(t.markerDy,0),markerHorizontalAlignment:Ct(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:Ct(t.markerVerticalAlignment,"top")}},e}(Ur),Zr=new tn(0,0),qr=new tn(0,0),Yr=function(t){function e(e,i,n){var r;return(r=t.call(this)||this).symbol=e,r.geometry=i,r.painter=n,"Point"===i.type?ut(r):(r.style=r._defineStyle(r.translate()),r)}ct(e,t),e.test=function(t,e){if(!t)return!1;if(e&&"Point"===e.type)return!1;for(var i in t){var n=i.slice(0,4);if("line"===n||"poly"===n)return!0}return!1};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(0!==i.polygonOpacity||0!==i.lineOpacity||this.painter.isHitTesting()){var n=this._getPaintParams();if(n){this._prepareContext(t);var r=We(i.lineColor),o="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!i.lineColor.places&&o||(i.lineGradientExtent=this.geometry.getContainerExtent()._expand(i.lineWidth)),We(i.polygonFill)&&(i.polygonGradientExtent=this.geometry.getContainerExtent());var s=n[0];if("Polygon"===this.geometry.getJSONType()&&s.length>0&&Array.isArray(s[0][0])||"LineString"===this.geometry.type&&s.length>0&&Array.isArray(s[0]))for(var a=0;a<s.length;a++){this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s[a],i.lineColor);var h=[t,s[a]];n.length>1&&h.push.apply(h,n.slice(1)),h.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,h)}else{this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s,i.lineColor);var l=[t];l.push.apply(l,n),l.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,l)}t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])}}},i.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new tn(0,0),this._extMax=new tn(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var i=t._prjToPoint(this._extMin,void 0,Zr),n=t._prjToPoint(this._extMax,void 0,qr);return this._pxExtent?this._pxExtent.set(Math.min(i.x,n.x),Math.min(i.y,n.y),Math.max(i.x,n.x),Math.max(i.y,n.y)):this._pxExtent=new gn(i,n),this._pxExtent},i.getFixedExtent=function(){var t=this.style.lineWidth/2;return new gn(-t,-t,t,t)},i._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},i.translate=function(){var t=this.symbol,e={lineColor:Ct(t.lineColor,"#000"),lineWidth:Ct(t.lineWidth,2),lineOpacity:Ct(t.lineOpacity,1),lineDasharray:Ct(t.lineDasharray,[]),lineCap:Ct(t.lineCap,"butt"),lineJoin:Ct(t.lineJoin,"miter"),linePatternFile:Ct(t.linePatternFile,null),lineDx:Ct(t.lineDx,0),lineDy:Ct(t.lineDy,0),polygonFill:Ct(t.polygonFill,null),polygonOpacity:Ct(t.polygonOpacity,1),polygonPatternFile:Ct(t.polygonPatternFile,null),polygonPatternDx:Ct(t.polygonPatternDx,0),polygonPatternDy:Ct(t.polygonPatternDy,0),linePatternDx:Ct(t.linePatternDx,0),linePatternDy:Ct(t.linePatternDy,0)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},i._createGradient=function(t,e,i){if(Array.isArray(e)&&e.length){var n=e.length,r=t.createLinearGradient(e[0].x,e[0].y,e[n-1].x,e[n-1].y);i.colorStops.forEach(function(t){r.addColorStop.apply(r,t)}),t.strokeStyle=r}},e}(Dr),Qr=function(t){function e(e,i,n){var r,o=(r=t.call(this,e,i,n)||this).translate();return r._dynamic=ie(o),r.style=r._defineStyle(o),0===r.style.textWrapWidth?ut(r):(r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style)),r)}ct(e,t),e.test=function(t){return yr(t)};var i=e.prototype;return i.symbolize=function(t,e){if(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth){var i=this._getRenderContainerPoints();if(kt(i)){var n=this.style,r=this.strokeAndFill,o=ze(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var s=this._textDesc=this._textDesc||Ge(o,this.style);this._prepareContext(t),this.prepareCanvas(t,r,e),ji.prepareCanvasFont(t,n);for(var a=0,h=i.length;a<h;a++){var l=i[a],c=this.getRotation()?this._rotate(t,l,this._getRotationAt(a)):null;c&&(l=c),ji.text(t,o,l,n,s),c&&t.restore()}}}},i.getPlacement=function(){return this.symbol.textPlacement},i.getRotation=function(){var t=this.style.textRotation;return x(t)?-t*Math.PI/180:null},i.getDxDy=function(){var t=this.style;return new pt(t.textDx,t.textDy)},i.getFixedExtent=function(){var t=this.geometry.getTextDesc();return Array.isArray(t)&&(t=t[this._index]),this._fixedExtent=this._fixedExtent||new gn,t?mr(this._fixedExtent,this.style,t):this._fixedExtent},i.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:Ct(t.textFaceName,"monospace"),textWeight:Ct(t.textWeight,"normal"),textStyle:Ct(t.textStyle,"normal"),textSize:Ct(t.textSize,m),textFont:Ct(t.textFont,null),textFill:Ct(t.textFill,"#000"),textOpacity:Ct(t.textOpacity,1),textHaloFill:Ct(t.textHaloFill,"#ffffff"),textHaloRadius:Ct(t.textHaloRadius,0),textHaloOpacity:Ct(t.textHaloOpacity,1),textWrapWidth:Ct(t.textWrapWidth,null),textWrapCharacter:Ct(t.textWrapCharacter,"\n"),textLineSpacing:Ct(t.textLineSpacing,0),textDx:Ct(t.textDx,0),textDy:Ct(t.textDy,0),textHorizontalAlignment:Ct(t.textHorizontalAlignment,"middle"),textVerticalAlignment:Ct(t.textVerticalAlignment,"middle"),textAlign:Ct(t.textAlign,"center"),textRotation:Ct(t.textRotation,0),textMaxWidth:Ct(t.textMaxWidth,0),textMaxHeight:Ct(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},i.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},e}(Ur),Kr=[],Xr=function(t){function e(e,i,n){var r,o=(r=t.call(this,e,i,n)||this).translate();return r._dynamic=ie(o),r.style=r._defineStyle(o),r.strokeAndFill=r._defineStyle(Ir(r.style)),r.padding=0,r}ct(e,t),e.test=function(t){return wr(t)};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&(0!==i.polygonOpacity||0!==i.lineOpacity)){var n=this._getRenderContainerPoints();kt(n)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,n,e):this._drawMarkersWithCache(t,n,e))}},i._drawMarkers=function(t,e,i){for(var n=e.length-1;n>=0;n--){var r=e[n],o=this.getRotation()?this._rotate(t,r,this._getRotationAt(n)):null;o&&(r=o),this._drawVectorMarker(t,r,i),o&&t.restore()}},i._drawMarkersWithCache=function(t,e,i){var n=this._stampSymbol(),r=i.getImage(n);r||(r=this._createMarkerImage(t,i),i.addResource([n,r.width,r.height],r));for(var o=ur(this.style,r.width,r.height),s=e.length-1;s>=0;s--){var a=e[s],h=this.getRotation()?this._rotate(t,a,this._getRotationAt(s)):null;h&&(a=h),ji.image(t,r,a.x+o.x,a.y+o.y),h&&t.restore()}},i._createMarkerImage=function(t,e){var i=t.canvas.constructor,n=dr(Kr,this.style),r=ji.createCanvas(n[0],n[1],i),o=this._getCacheImageAnchor(n[0],n[1]),s=r.getContext("2d");return this._drawVectorMarker(s,o,e),r},i._stampSymbol=function(){return this._stamp||(this._stamp=Ve([this.style.markerType,We(this.style.markerFill)?Ze(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,We(this.style.markerLineColor)?Ze(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},i._getCacheImageAnchor=function(t,e){var i=2*(this.symbol.shadowBlur||0)+this.padding,n=this.style.markerType;return"bar"===n||"pie"===n||"pin"===n?new pt(t/2,e-i):"rectangle"===n?new pt(i,i):new pt(t/2,e/2)},i._getGraidentExtent=function(t){var e=new gn,i=this.getDxDy(),n=this.getFixedExtent();if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)e._combine(t[r]);else e._combine(t);return e.xmin+=n.xmin-i.x,e.ymin+=n.ymin-i.y,e.xmax+=n.xmax-i.x,e.ymax+=n.ymax-i.y,e},i._drawVectorMarker=function(t,e,i){Or(t,e,this.style,i)},i.getFixedExtent=function(){var t=this.isDynamicSize(),e=this.style.markerWidth,i=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new gn,ar(this._fixedExtent,this.style,t?[128,128*i/e]:null)},i.translate=function(){var t=this.symbol,e={markerType:Ct(t.markerType,"ellipse"),markerFill:Ct(t.markerFill,"#00f"),markerFillOpacity:Ct(t.markerFillOpacity,1),markerFillPatternFile:Ct(t.markerFillPatternFile,null),markerLineColor:Ct(t.markerLineColor,"#000"),markerLineWidth:Ct(t.markerLineWidth,nr.markerLineWidth),markerLineOpacity:Ct(t.markerLineOpacity,1),markerLineDasharray:Ct(t.markerLineDasharray,[]),markerLinePatternFile:Ct(t.markerLinePatternFile,null),markerDx:Ct(t.markerDx,0),markerDy:Ct(t.markerDy,0),markerWidth:Ct(t.markerWidth,nr.markerWidth),markerHeight:Ct(t.markerHeight,nr.markerHeight),markerRotation:Ct(t.markerRotation,0),shadowBlur:Ct(t.shadowBlur,0),shadowOffsetX:Ct(t.shadowOffsetX,0),shadowOffsetY:Ct(t.shadowOffsetY,0)},i=e.markerType,n=hr(i),r=lr(i);return e.markerHorizontalAlignment=Ct(t.markerHorizontalAlignment,n),e.markerVerticalAlignment=Ct(t.markerVerticalAlignment,r),x(t.markerOpacity)&&(x(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),x(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},e}(Ur),Jr=function(t){function e(e,i,n){var r;y(e.markerWidth)&&(e.markerWidth=80),y(e.markerHeight)&&(e.markerHeight=80),e=v(e,(r=t.call(this,e,i,n)||this).translate());var o=r.style=r._defineStyle(e);return lt.gecko?r._url=[Ce(o,o.markerWidth,o.markerHeight),o.markerWidth,o.markerHeight]:r._url=[Ce(o),o.markerWidth,o.markerHeight],r}ct(e,t),e.test=function(t){return br(t)};var i=e.prototype;return i._prepareContext=function(){},i._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var i=this.painter,n=new Image;return n.onload=function(){var t=i.getLayer()&&i.getLayer().getRenderer();t&&t.setToRedraw()},n.onerror=function(i){i&&"undefined"!=typeof console&&console.warn(i),t.markErrorResource(e._url)},n.src=this._url[0],t&&t.addResource(this._url,n),n},e}(Wr),$r={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},to=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this).style=i.getLayer().options.drawAltitude,r.style&&b(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:e.textDx||e.markerDx,dy:e.textDy||e.markerDy}),r}ct(e,t),e.test=function(t,e){if(!e.getLayer())return!1;var i=e.getJSONType();return"Marker"===i||"LineString"===i};var i=e.prototype;return i.symbolize=function(t){var e=this.geometry.getLayer();if(e.options.drawAltitude){var i=this.geometry.getProperties();if(i&&i[e.options.altitudeProperty]){var n=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var r=this._getPaintParams(n.lineDx,n.lineDy,!1,!0);if(!r)return;var o=this.getPainter().getPaintParams(n.lineDx,n.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(t,r[0],o)}else{var s=this._getRenderContainerPoints(),a=this._getRenderContainerPoints(!0);if(!s||0===s.length)return;this._drawMarkerAltitude(t,s[0],a[0])}}}},i.getDxDy=function(){var t=this.dxdy;return new pt(t.dx||0,t.dy||0)},i.get2DExtent=function(){return"LineString"===this.geometry.type?Yr.prototype.get2DExtent.apply(this):t.prototype.get2DExtent.call(this)},i.getPlacement=function(){return"point"},i._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0,null,!0,"_altpt")},i._drawMarkerAltitude=function(t,e,i){var n=this._getStyle();this.prepareCanvas(t,n),ji.path(t,[e,i],n.lineOpacity,null,n.lineDasharray)},i._drawLineAltitude=function(t,e,i){var n=this._getStyle();if(e.length>0&&Array.isArray(e[0]))for(var r=0;r<e.length;r++)this._drawLine(t,e[r],i[r]);else this._drawLine(t,e,i);t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([])},i._drawLine=function(t,e,i){var n=this._getStyle();this.prepareCanvas(t,n);for(var r=0,o=e.length-1;r<o;r++)ji.polygon(t,[e[r],e[r+1],i[r+1],i[r]],n.lineOpacity,n.polygonOpacity,n.lineDasharray)},i._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return b(t)||(t=$r),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},e}(Ur),eo=[to,Yr,Wr,Jr,Xr,Qr],io=new pt(0,0),no=new gn,ro=new gn,oo=new gn,so=new gn,ao=new gn,ho={},lo={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},co=function(t){function e(e){var i;return(i=t.call(this)||this).geometry=e,i.symbolizers=i._createSymbolizers(),i._altAtGL=i._getGeometryAltitude(),i}ct(e,t);var i=e.prototype;return i.getMap=function(){return this.geometry.getMap()},i.getLayer=function(){return this.geometry.getLayer()},i._createSymbolizers=function(){var t=this.getSymbol(),e=[],i=eo,n=t;Array.isArray(t)||(n=[t]);for(var r=n.length-1;r>=0;r--)for(var o=n[r],s=i.length-1;s>=0;s--)if(i[s].test(o,this.geometry)){var a=new i[s](o,this.geometry,this);a._index=r,e.push(a),a instanceof Ur&&(this._hasPoint=!0)}if(!e.length&&console){var h=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(h?":"+h:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new Hr(t,this.geometry,this),e},i.hasPoint=function(){return!!this._hasPoint},i.getRenderPoints=function(t){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},i.getPaintParams=function(t,e,i,n,r){void 0===r&&(r="_pt");var o,s,a,h,l,c=this.getLayer()._getRenderer().mapStateCache,u=this.getMap();c&&!this._hitPoint?(o=c.resolution,s=c.pitch,a=c.bearing,h=c.glScale,l=c.containerExtent):(o=u.getResolution(),s=u.getPitch(),a=u.getBearing(),h=u.getGLScale(),l=u.getContainerExtent());var d=this.geometry,f=o,_=0!==s,p=0!==a,m=this._cachedParams,g=d._paintAsPath&&d._paintAsPath();if(g&&this._unsimpledParams&&f<=this._unsimpledParams._res)m=this._unsimpledParams;else if(!m||m._res!==o||this._pitched!==_&&d._redrawWhenPitch()||this._rotated!==p&&d._redrawWhenRotate()){if(!(m=d._getPaintParams()))return null;m._res=f,!d._simplified&&g&&(this._unsimpledParams||(this._unsimpledParams=m),f>this._unsimpledParams._res&&(this._unsimpledParams._res=f)),this._cachedParams=m}if(!m)return null;this._pitched=_,this._rotated=p;var v=h,y=[],w=m[0],b=l,A=this._pointContainerPoints(w,t,e,i,n||this._hitPoint&&!b.contains(this._hitPoint),null,r);if(!A)return null;y.push(A);for(var C=1,S=m.length;C<S;C++)x(m[C])||m[C]instanceof Me?x(m[C])?y.push(m[C]/v):y.push(m[C].multi(1/v)):y.push(m[C]);return y},i._pointContainerPoints=function(t,e,i,n,r,o,s){if(void 0===s&&(s="_pt"),this._aboveCamera())return null;var a,h,l,c=this.getLayer()._getRenderer(),u=c.mapStateCache,d=this.getMap(),f=this.geometry,_=this.containerOffset;u?(a=u.glRes,h=u.containerExtent):(a=d.getGLRes(),h=d.getContainerExtent());var p=this.getLayer().options.roundPoint,m=1/0,g=1/0,v=-1/0,y=-1/0,w=!r,b=c.layer.options.clipBBoxBufferSize||3,A=this.symbolizers;function C(t,n){void 0===t&&(t=[]),void 0===n&&(n=[]);for(var r=Vt(t,s),o=0,l=(r=d._pointsAtResToContainerPoints(t,a,n,r)).length;o<l;o++){var c=r[o];c._sub(_),(e||i)&&c._add(e||0,i||0),p&&(c.x=Math.ceil(c.x),c.y=Math.ceil(c.y)),m=Math.min(c.x,m),g=Math.min(c.y,g),v=Math.max(c.x,v),y=Math.max(c.y,y)}if(w&&ei(A)){if(ao.ymin=h.ymin,ao.ymin<b&&(ao.ymin=h.ymin-b),ao.xmin=h.xmin-b,ao.xmax=h.xmax+b,ao.ymax=h.ymax+b,f.getShell&&f.getHoles)return Mr(r,ao);var u=Er(r,ao,!1);if(u.length){var x=[];return u.forEach(function(t){for(var e=0,i=t.length;e<i;e++)x.push(t[e].point)}),x}}return r}var S=this.getAltitude();if(Array.isArray(t)){var E,P=this.geometry;!r&&P.options.enableClip?(E=this._clip(t,S)).inView&&(w=!1):E={points:t,altitude:S};var M=E.points;S=E.altitude,n&&(S=0);var T=S;l=[];for(var k=[],R=x(S),L=0,D=M.length;L<D;L++){var O=M[L];if(Array.isArray(O)){if(R){var I=C(O,S);l.push(I);continue}for(var B=[],j=0,z=O.length;j<z;j++)Array.isArray(S)&&(T=S[L]?S[L][j]:0),B.push(T);var G=C(O,B);l.push(G)}else Array.isArray(S)&&(T="vertex-last"===o?S[S.length-1-L]:"line"===o?(S[L]+S[L+1])/2:S[L]),k.push(T)}k.length&&(l=C(M,k))}else t instanceof pt&&(n&&(S=0),l=d._pointAtResToContainerPoint(t,a,S)._sub(_),(e||i)&&l._add(e,i));return lo.minx=m,lo.miny=g,lo.maxx=v,lo.maxy=y,this._containerBbox=lo,l},i._clip=function(t,e){if(x(e)&&0!==e)return{points:t,altitude:e};if(Array.isArray(e)){for(var i=!1,n=0,r=e.length;n<r;n++)if(0!==e[n]){i=!0;break}if(i)return{points:t,altitude:e}}var o=this.getMap(),s=this.geometry,a=this.getSymbol().lineWidth;x(a)||(a=4);var h,l,c,u=this.getLayer()._getRenderer().mapStateCache;u?(h=u._2DExtent,l=u.glExtent,c=u.pitch):(h=o._get2DExtent(),l=o._get2DExtentAtRes(o.getGLRes()),c=o.getPitch());var d=h._expand(a);if(c>0&&e){var f=o.cameraLookAt,_=o.cameraPosition;io.set(_.x,_.y),d=d._combine(io._add(St(f[0]-_[0]),St(f[1]-_[1])))}var p=t;if(this.get2DExtent(null,so).within(d))return{points:p,altitude:e,inView:!0};var m=l._expand(a*o._glScale);oo.xmin=m.xmin,oo.xmax=m.xmax,oo.ymin=m.ymin,oo.ymax=m.ymax;var g=s.options.smoothness;if(s.getShell&&this.geometry.getHoles&&!g){var v=m.xmin,y=m.ymin,w=m.xmax,b=m.ymax,A=Math.abs(w-v),C=Math.abs(b-y),S=Math.sqrt(A*A+C*C),E=(S-A)/2,P=(S-C)/2;if(oo.xmin=m.xmin-E,oo.xmax=m.xmax+E,oo.ymin=m.ymin-P,oo.ymax=m.ymax+P,Array.isArray(t[0])){p=[];for(var M=0;M<t.length;M++){var T=Mr(t[M],oo);T.length&&p.push(T)}}else p=Mr(t,oo)}else if("LineString"===s.getJSONType()&&!g){if(Array.isArray(t[0])){p=[];for(var k=0;k<t.length;k++)wt(p,Er(t[k],oo,!1,!!g))}else p=Er(t,oo,!1,!!g);return this._interpolateSegAlt(p,t,e)}return{points:p,altitude:e}},i._interpolateSegAlt=function(t,e,i){if(!Array.isArray(i)){var n=function(t){return t.point};return{points:t.map(function(t){return Array.isArray(t)?t.map(n):t.point}),altitude:i}}var r=function t(e,i,n){if(!Array.isArray(n))return e;var r=[];for(var o=0,s=e.length;o<s;o++)if(Array.isArray(e[o]))r.push(t(e[o],i,n));else{var a=e[o];if(a.point.equals(i[a.index]))a.altitude=n[a.index],r.push(a);else{var h=void 0,l=void 0;0===a.index?(h=a.index,l=a.index+1):(h=a.index-1,l=a.index);var c=a.point.distanceTo(i[l]),u=c/(c+i[h].distanceTo(a.point)),d=Pt(n[h],n[l],1-u);a.altitude=d,r.push(a)}}return r}(t,e,i);return i=[],{points:r.map(function(t){if(Array.isArray(t)){var e=[],n=t.map(function(t){return e.push(t.altitude),t.point});return i.push(e),n}return i.push(t.altitude),t.point}),altitude:i}},i.getSymbol=function(){return this.geometry._getInternalSymbol()},i.paint=function(t,e,i){if(this.symbolizers){var n=this.getLayer(),r=n._getRenderer();if(r&&(r.context||e)){var o=r.mapStateCache||{};if(this.geometry._isCheck||!t||t.intersects(this.get2DExtent(r.resources,no))){var s=this.getMap(),a=this.getMinAltitude(),h=s.getFrustumAltitude();if(!(a&&h&&h<a)){this.containerOffset=i||o.offset||s._pointToContainerPoint(r.southWest)._add(0,-s.height),this._beforePaint();for(var l=e||r.context,c=[l,r.resources],u=this.symbolizers.length-1;u>=0;u--)(l.shadowBlur||this.symbolizers[u].symbol.shadowBlur)&&this._prepareShadow(l,this.symbolizers[u].symbol),this.symbolizers[u].symbolize.apply(this.symbolizers[u],c);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||n.options.debug)&&this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,c)}}}}},i.getSprite=function(t,e){if("Point"!==this.geometry.type)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var i=new gn;this.symbolizers.forEach(function(e){var n=e.getFixedExtent(t);i._combine(n)});var n,r=i.getMin().multi(-1),o=e||(this.getMap()?this.getMap().CanvasClass:null),s=ji.createCanvas(i.getWidth(),i.getHeight(),o);this._renderPoints&&(n=this._renderPoints);for(var a=s.getContext("2d"),h=[a,t],l=this.symbolizers.length-1;l>=0;l--){var c=this.symbolizers[l].getDxDy();this._renderPoints={center:[[r.add(c)]]},this._prepareShadow(a,this.symbolizers[l].symbol),this.symbolizers[l].symbolize.apply(this.symbolizers[l],h)}n&&(this._renderPoints=n),this._sprite={canvas:s,offset:i.getCenter()}}return this._spriting=!1,this._sprite},i.isSpriting=function(){return!!this._spriting},i.hitTest=function(t,e){if((!e||e<.5)&&(e=.5),this._hitPoint=t.sub(e,e),!jr){var i=this.getMap()?this.getMap().CanvasClass:null;jr=ji.createCanvas(1,1,i)}ji.setHitTesting(!0),jr.width=jr.height=2*e;var n=jr.getContext("2d");try{this.paint(null,n,this._hitPoint)}catch(t){throw t}finally{ji.setHitTesting(!1)}delete this._hitPoint;for(var r=n.getImageData(0,0,jr.width,jr.height).data,o=3,s=r.length;o<s;o+=4)if(r[o]>0)return!0;return!1},i.isHitTesting=function(){return!!this._hitPoint},i._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},i._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var i=this.symbolizers.length-1;i>=0;i--)t.apply(e,[this.symbolizers[i]])}},i.get2DExtent=function(t,e){this._verifyProjection();var i=this.getMap();t=t||this.getLayer()._getRenderer().resources;var n=i.getZoom(),r=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===n&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==n&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new gn),this._extent2D._zoom=n),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new gn)))),!this._extent2D)return r&&delete this._fixedExtent,null;var o=this._fixedExtent,s=o.xmin,a=o.ymin,h=o.xmax,l=o.ymax;return r&&delete this._fixedExtent,ro.set(s,-l,h,-a),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(ro),e):this._extent2D.add(ro)},i._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--){var i=this.symbolizers[e];t._combine(i.get2DExtent())}return t},i._computeFixedExtent=function(t,e){for(var i=this.symbolizers.length-1;i>=0;i--){var n=this.symbolizers[i];n.getFixedExtent&&e._combine(n.getFixedExtent(t))}return e},i._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--){if(this.symbolizers[t].isDynamicSize())return!0}return!1},i._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap().getFrustumAltitude();return t&&e&&e<t},i.getFixedExtent=function(){var t=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new gn):(this._extent2D&&this._extent2D._zoom===t||this.get2DExtent(null,ro),this._fixedExtent)},i.setZIndex=function(t){this._eachSymbolizer(function(e){e.setZIndex(t)})},i.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer(function(t){t.show()})):this.getLayer().isCanvasRender()||this.paint()},i.hide=function(){this._eachSymbolizer(function(t){t.hide()})},i.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},i.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},i.remove=function(){this.removeCache(),this._removeSymbolizers()},i._removeSymbolizers=function(){this._eachSymbolizer(function(t){delete t.painter,t.remove()}),delete this.symbolizers},i.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},i.getAltitude=function(){return this.geometry.getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},i.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},i.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},i._getGeometryAltitude=function(){var t=this;if(!this.getMap())return 0;var e=this.geometry.getAltitude();if(this._propAlt=e,!e)return this.minAltitude=this.maxAltitude=0,0;var i=this.geometry.getCenter();return i?Array.isArray(e)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,e.map(function(e){var n=t._meterToPoint(i,e);return n<t.minAltitude&&(t.minAltitude=n),n>t.maxAltitude&&(t.maxAltitude=n),n})):(this.minAltitude=this.maxAltitude=this._meterToPoint(i,e),this.minAltitude):0},i._meterToPoint=function(t,e){var i=this.getMap(),n=i.getGLRes();return i.distanceToPointAtRes(e,0,n,t).x*St(e)},i._verifyProjection=function(){var t=this.geometry._getProjection()||ho;this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},i._beforePaint=function(){},i._afterPaint=function(){},e}(Wi);var uo=new gn,fo=function(t){function e(e,i){var n;return(n=t.call(this)||this).geometry=e,n.isMask=i,n}ct(e,t);var i=e.prototype;return i._eachPainter=function(t){for(var e,i=this.geometry.getGeometries(),n=0,r=i.length;n<r&&(!(e=this.isMask?i[n]._getMaskPainter():i[n]._getPainter())||!e||!1!==t.call(this,e));n++);},i.paint=function(t){this.geometry&&this._eachPainter(function(e){e.paint(t)})},i.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var i=e||new gn;return this._eachPainter(function(e){i=i._combine(e.get2DExtent(t,uo))}),i},i.remove=function(){var t=arguments;this._eachPainter(function(e){e.remove.apply(e,t)})},i.setZIndex=function(){var t=arguments;this._eachPainter(function(e){e.setZIndex.apply(e,t)})},i.show=function(){var t=arguments;this._eachPainter(function(e){e.show.apply(e,t)})},i.hide=function(){var t=arguments;this._eachPainter(function(e){e.hide.apply(e,t)})},i.repaint=function(){var t=arguments;this._eachPainter(function(e){e.repaint.apply(e,t)})},i.refreshSymbol=function(){var t=arguments;this._eachPainter(function(e){e.refreshSymbol.apply(e,t)})},i.hasPoint=function(){var t=!1;return this._eachPainter(function(e){return!e.hasPoint()||(t=!0,!1)}),t},i.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter(function(i){var n=i.getMinAltitude();(t||n<e)&&(t=!1,e=n)}),e},i.getMaxAltitude=function(){var t=0;return this._eachPainter(function(e){var i=e.getMaxAltitude();i>t&&(t=i)}),t},e}(Wi),_o={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=12756274*Math.PI,i=0;i<23;i++)t[i]=e/(256*Math.pow(2,i));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<23;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{projection:"baidu",resolutions:function(){for(var t=Math.pow(2,18),e=[],i=0;i<23;i++)e[i]=t,t*=.5;return e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var t=Math.pow(2,8),e=[],i=0;i<23;i++)e[i]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=6378137*Math.PI,i=0;i<23;i++)t[i]=e/(256*Math.pow(2,i));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}}};_o["EPSG:4490"]=_o["EPSG:4326"];var po=function(){function t(t){void 0===t&&(t={}),this.options=t,this._initSpatialRef()}t.getPreset=function(t){return _o[t.toUpperCase()]},t.getAllPresets=function(){return Object.keys(_o)},t.getProjectionInstance=function(t){if(!t)return null;if(b(t))return t.locate||("identity"===(t=v({},t)).measure?v(t,Tn.getInstance("IDENTITY")):v(t,Tn.getInstance("EPSG:4326"))),t;for(var e in t=(t+"").toLowerCase(),Bn)if(E(Bn,e)){var i=Bn[e].code;if(i&&i.toLowerCase()===t)return Bn[e]}return null},t.equals=function(t,e){if(A(t)||A(e))return t===e;if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var i=t.fullExtent,n=e.fullExtent;if(i&&!n||!i&&n)return!1;if(i&&n&&(i.top!==n.top||i.bottom!==n.bottom||i.left!==n.left||i.right!==n.right))return!1;var r=t.resolutions,o=e.resolutions;if(r&&o){if(r.length!==o.length)return!1;for(var s=0;s<r.length;s++)if(r[s]!==o[s])return!1}else if(r||o)return!1;return!0};var e=t.prototype;return e._initSpatialRef=function(){var e=this.options.projection;if(!(e=e?t.getProjectionInstance(e):In))throw new Error("must provide a valid projection in map's spatial reference.");(e=v({},yn,e)).measureLength||v(e,Tn.DEFAULT),this._projection=e;var i,n=this.options.resolutions;if(!n&&(e.code&&(i=_o[e.code.toUpperCase()])&&(n=i.resolutions,this.isEPSG="IDENTITY"!==e.code),!n))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=n,this._pyramid=!0,this._pyramid)for(var r=0;r<n.length;r++)if(n[r]&&n[r-1]&&n[r-1]/n[r]!=2){this._pyramid=!1;break}var o=this.options.fullExtent;if(!o&&(e.code&&(i=_o[e.code.toUpperCase()])&&(o=i.fullExtent),!o))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(y(o.left)?(this._fullExtent=new pn(o),o.left=o.xmin,o.right=o.xmax,o.top=o.ymax,o.bottom=o.ymin):this._fullExtent=new pn(new tn(o.left,o.top),new tn(o.right,o.bottom)),y(o.top)||y(o.bottom)||y(o.left)||y(o.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");v(this._fullExtent,o),this._projection.fullExtent=o;var s=o.right>=o.left?1:-1,a=o.top>=o.bottom?-1:1;this._transformation=new vn([s,a,0,0])},e.getResolutions=function(){return this._resolutions||[]},e.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var i=this._resolutions[e];return e!==t&&t>0&&e<this._resolutions.length-1?i+(this._resolutions[e+1]-i)*(t-e):i},e.getProjection=function(){return this._projection},e.getFullExtent=function(){return this._fullExtent},e.getTransformation=function(){return this._transformation},e.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!y(this._resolutions[t]))return t;return 0},e.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!y(this._resolutions[t]))return t;return this._resolutions.length-1},e.getZoomDirection=function(){return St(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},e.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},e.isPyramid=function(){return this._pyramid},t}(),mo=new pt(0,0),go=new gn,vo=function(t){function e(e){var i,n=v({},e),r=n.symbol,o=n.properties,s=n.id;return delete n.symbol,delete n.id,delete n.properties,i=t.call(this,n)||this,r?i.setSymbol(r):i._genSizeSymbol(),o&&i.setProperties(o),y(s)||i.setId(s),i}ct(e,t);var i=e.prototype;return i.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},i.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},i.addTo=function(t,e){return t.addGeometry(this,e),this},i.getLayer=function(){return this._layer?this._layer:null},i.getMap=function(){return this._layer?this._layer.getMap():null},i.getId=function(){return this._id},i.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},i.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},i.setProperties=function(t){var e=this.properties;return this.properties=b(t)?v({},t):t,this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},i.getType=function(){return this.type},i.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?Qe(t):v({},t):null},i.setSymbol=function(t){return this._symbolUpdated=t,this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},i.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=qe(this._symbolUpdated)),this._symbolHash},i.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Parameter of updateSymbol is not an array.");for(var i=0;i<t.length;i++)yr(t[i])&&delete this._textDesc,e[i]&&t[i]&&(e[i]=Qe(e[i],t[i]))}else{if(Array.isArray(t))throw new Error("Geometry's symbol is not an array to update.");yr(e)&&delete this._textDesc,e=Qe(e||this._getInternalSymbol(),t)}return this._eventSymbolProperties=t,delete this._compiledSymbol,this.setSymbol(e)},i.getTextContent=function(){var t=this._getInternalSymbol();if(Array.isArray(t)){for(var e=[],i=!1,n=0;n<t.length;n++)e[n]=ze(t[n]&&t[n].textName,this.getProperties()),y(e[n])||(i=!0);return i?e:null}return ze(t&&t.textName,this.getProperties())},i.getTextDesc=function(){if(!this._textDesc){var t=this.getTextContent(),e=this._sizeSymbol,i=Array.isArray(t);Array.isArray(e)?this._textDesc=e.map(function(e,n){return Ge(i?t[n]:"",e)}):this._textDesc=Ge(t,e)}return this._textDesc},i.getCenter=function(){return this._computeCenter(this._getMeasurer())},i.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var i=e.unproject(new tn(t.xmin,t.ymin)),n=e.unproject(new tn(t.xmax,t.ymax));return new pn(i,n,e)}return this._computeExtent(this._getMeasurer())},i.getContainerExtent=function(t){var e=this.get2DExtent();if(!e||!e.isValid())return null;var i=this.getMap(),n=this.getCenter(),r=i.getGLRes(),o=this.getMinAltitude(),s=i.distanceToPointAtRes(o,0,r,n).x*St(o),a=e.convertTo(function(t){return i._pointAtResToContainerPoint(t,r,s,mo)},t),h=this.getMaxAltitude();if(h!==o){h=i.distanceToPointAtRes(h,0,r,n).x*St(h);var l=e.convertTo(function(t){return i._pointAtResToContainerPoint(t,r,h,mo)},go);a._combine(l)}var c=this.getLayer();if(c&&"LineString"===this.type&&h&&c.options.drawAltitude){var u=e.convertTo(function(t){return i._pointAtResToContainerPoint(t,r,0,mo)},go);a._combine(u)}return a&&a._add(this._getFixedExtent()),this.options.smoothness&&a._expand(.15*a.getWidth()),a},i._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new gn);var t=this._sizeSymbol,e=(t&&t.lineWidth||1)/2;this._fixedExtent.set(-e,-e,e,e);var i=t&&t.lineDx||0;this._fixedExtent._add([i,0]);var n=t&&t.lineDy||0;return this._fixedExtent._add([0,n]),this._fixedExtent},i.get2DExtent=function(){var t=this.getMap();if(!t)return null;if(this._extent2d)return this._extent2d;var e=this._getPrjExtent();if(!e||!e.isValid())return null;var i=e.getMin(),n=e.getMax(),r=t.getGLRes();return t._prjToPointAtRes(i,r,i),t._prjToPointAtRes(n,r,n),this._extent2d=new gn(i,n),this._extent2d.z=t.getZoom(),this._extent2d},i.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},i.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof tn&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},i._containsPoint=function(t,e){var i=this._getPainter();return!!i&&(y(e)&&this._hitTestTolerance&&(e=this._hitTestTolerance()),i.hitTest(t,e))},i.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},i.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,i=t.length;e<i;e++)if(y(t[e].opacity)||t[e].opacity>0)return!0;return!1}return y(t.opacity)||b(t.opacity)||x(t.opacity)&&t.opacity>0},i.getZIndex=function(){return this.options.zIndex||0},i.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},i.setZIndexSilently=function(t){return this.options.zIndex=t,this},i.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},i.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},i.translate=function(t,e){if(y(t))return this;var i=new tn(t,e);if(0===i.x&&0===i.y)return this;var n=this.getCoordinates();if(this._silence=!0,n)if(Array.isArray(n)){var r=At(n,function(t){return t.add(i)});this.setCoordinates(r)}else this.setCoordinates(n.add(i));return this._silence=!1,this._fireEvent("positionchange"),this},i.flash=function(t,e,i,n){return Ht.call(this,t,e,i,n)},i.copy=function(){var t=this.toJSON(),i=e.fromJSON(t);return i.options.visible=!0,i},i.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},i.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},i.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(y(t.geometry)||t.geometry){var i=this._exportGeoJSONGeometry();e.geometry=i}var n,r=this.getId();return y(r)||(e.id=r),(y(t.properties)||t.properties)&&(n=this._exportProperties()),e.properties=n,e},i.toJSON=function(t){t||(t={});var e=this._toJSON(t);return v(e,this._exportGraphicOptions(t)),e},i.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},i.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},i.rotate=function(t,e){if("GeometryCollection"===this.type)return this.getGeometries().forEach(function(i){return i.rotate(t,e)}),this;e=e?new tn(e):this.getCenter();var i=this._getMeasurer(),n=this.getCoordinates();if(!Array.isArray(n)){if(e.x!==n.x||e.y!==n.y){var r=i._rotate(n,e,t);this.setCoordinates(r)}return this}return At(n,function(n){return i._rotate(n,e,t)}),this.setCoordinates(n),this},i._getConnectPoints=function(){return[this.getCenter()]},i._initOptions=function(t){var e=v({},t),i=e.symbol,n=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),i&&this.setSymbol(i),n&&this.setProperties(n),y(r)||this.setId(r)},i._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._bindInfoWindow(),this._bindMenu()},i._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(Ee(this._checkAndCopySymbol(t[i])));return e}return t?Ee(t=this._checkAndCopySymbol(t)):null},i._checkAndCopySymbol=function(t){var e={};for(var i in t)_[i]&&A(t[i])?e[i]=+t[i]:e[i]=t[i];return e},i._getSymbol=function(){return this._symbol},i._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},i._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},i._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},i._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},i._getInternalId=function(){return this._internalId},i._setInternalId=function(t){this._internalId=t},i._getMeasurer=function(){return this._getProjection()?this._getProjection():po.getProjectionInstance(this.options.defaultProjection)},i._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},i._getExternalResources=function(){return Se(this._getInternalSymbol())},i._getPainter=function(){var t=this.getLayer();if(!this._painter&&t)if(-1!==c.indexOf(this.type)){if(t.constructor.getCollectionPainterClass){var e=t.constructor.getCollectionPainterClass();e&&(this._painter=new e(this))}}else if(t.constructor.getPainterClass){var i=t.constructor.getPainterClass();i&&(this._painter=new i(this))}return this._painter},i._getMaskPainter=function(){return this._maskPainter?this._maskPainter:(this._maskPainter=this.getGeometries&&this.getGeometries()?new fo(this,!0):new co(this),this._maskPainter)},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},i._paint=function(t){if(this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var e=this._getProjection();e&&(this._pcenter=e.project(this._coordinates),this._clearCache())}this._painter.paint(t)}},i._clearCache=function(){delete this._extent,delete this._extent2d},i._clearProjection=function(){delete this._extent,delete this._extent2d},i._repaint=function(){this._painter&&this._painter.repaint()},i.onHide=function(){this.closeMenu(),this.closeInfoWindow()},i.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},i.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},i.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties?(t.properties=v({},this._eventSymbolProperties),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",t)},i._genSizeSymbol=function(){var t=this._getInternalSymbol();if(t)if(Array.isArray(t)){this._sizeSymbol=[];for(var e=!1,i=0;i<t.length;i++){var n=this._sizeSymbol[i]=this._getSizeSymbol(t[i]);!e&&n&&n._dynamic&&(e=!0)}this._sizeSymbol._dynamic=e}else this._sizeSymbol=this._getSizeSymbol(t);else delete this._sizeSymbol},i._getSizeSymbol=function(t){var e=be({lineWidth:t.lineWidth,lineDx:t.lineDx,lineDy:t.lineDy},this);return(ee(t.lineWidth)||ee(t.lineDx)||ee(t.lineDy))&&(e._dynamic=!0),e},i._getCompiledSymbol=function(){return this._compiledSymbol?this._compiledSymbol:(this._compiledSymbol=be(this._getInternalSymbol(),this),this._compiledSymbol)},i.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var i=!1;for(var n in t)if(t.hasOwnProperty(n)){var r=n.slice(0,5);if("arrow"===r||"smoot"===r){i=!0;break}}e?(this.setProperties(e),this._repaint()):i&&this._repaint()},i._setParent=function(t){t&&(this._parent=t)},i._getParent=function(){return this._parent},i._fireEvent=function(t,e){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e))},i._toJSON=function(t){return{feature:this.toGeoJSON(t)}},i._exportGraphicOptions=function(t){var e={};return(y(t.options)||t.options)&&(e.options=this.config()),(y(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(y(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=tn.toNumberArrays(t);return{type:this.getType(),coordinates:e}},i._exportProperties=function(){var t=null,e=this.getProperties();return y(e)||(t=b(e)?v({},e):e),t},i.getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,i=this.getProperties(),n=e.enableAltitude&&i?i[e.altitudeProperty]:0,r=t.getAltitude?t.getAltitude():0;return Array.isArray(n)?n.map(function(t){return t+r}):n+r},i._genMinMaxAlt=function(){var t=this,e=this.getAltitude();Array.isArray(e)?(this._minAlt=Number.MAX_VALUE,this._maxAlt=Number.MIN_VALUE,e.forEach(function(e){var i=e;i<t._minAlt&&(t._minAlt=i),i>t._maxAlt&&(t._maxAlt=i)})):this._minAlt=this._maxAlt=e},i.getMinAltitude=function(){return void 0===this._minAlt&&this._genMinMaxAlt(),this._minAlt?this._minAlt:0},i.getMaxAltitude=function(){return void 0===this._maxAlt&&this._genMinMaxAlt(),this._maxAlt?this._maxAlt:0},e}(qi(Hi(Ki(Wi))));vo.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,defaultProjection:"EPSG:4326"});var yo={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!lt.mobile},xo=function(t){function e(e,i){var n,r;return i&&(r=i.canvas,delete i.canvas),(n=t.call(this,i)||this)._canvas=r,n.setId(e),i&&(n.setZIndex(i.zIndex),i.mask&&n.setMask(vo.fromJSON(i.mask))),n}ct(e,t);var i=e.prototype;return i.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();y(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},i.getId=function(){return this._id},i.setId=function(t){var e=this._id;return y(t)||(t+=""),this._id=t,this.fire("idchange",{old:e,new:t}),this},i.addTo=function(t){return t.addLayer(this),this},i.setZIndex=function(t){return this._zIndex=t,y(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},i.getZIndex=function(){return this._zIndex||0},i.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},i.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),y(e)?1/0:e):e},i.getOpacity=function(){return this.options.opacity},i.setOpacity=function(t){return this.config("opacity",t),this},i.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof er},i.getMap=function(){return this.map?this.map:null},i.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i+1),this},i.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i-1),this},i.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var i=this.getMap();e&&i?i.once("renderend",function(){t.fire("show")}):this.fire("show")}return this},i.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var i=this.getMap();e&&i?i.once("renderend",function(){t.fire("hide")}):this.fire("hide")}return this},i.isVisible=function(){if(x(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!y(this.options.maxZoom)&&this.options.maxZoom<e||!y(this.options.minZoom)&&this.options.minZoom>e)return!1}return y(this.options.visible)&&(this.options.visible=!0),this.options.visible},i.remove=function(){return this.map&&this.map.removeLayer(this),this},i.getMask=function(){return this._mask},i.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type||"MultiPolygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),"Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},i.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},i.onLoad=function(){return!0},i.onLoadEnd=function(){},i.isLoaded=function(){return!!this._loaded},i.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new Qi),this._collisionIndex;var t=this.getMap();return t?t.getCollisionIndex():null},i.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},i.getRenderer=function(){return this._getRenderer()},i.onConfig=function(t){if(x(t.opacity)||t.cssFilter){var e=this.getRenderer();e&&e.setToRedraw()}},i.onAdd=function(){},i.onRendererCreate=function(){},i.onCanvasCreate=function(){},i.onRemove=function(){},i._bindMap=function(t,e){t&&(this.map=t,y(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},i._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},i._doRemove=function(){this._loaded=!1,this.onRemove(),this._switchEvents("off",this),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},i._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()[t](e.getEvents(),e)},i._getRenderer=function(){return this._renderer},i._getLayerList=function(){return this.map?this.map._layers:[]},i._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},e}(qi(Hi(jn(Wi))));xo.mergeOptions(yo);var wo=xo.prototype.fire;xo.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={}),e.type=t,e.target=this,this.map._onLayerEvent(e)),wo.apply(this,arguments)};var bo,Ao,Co,So,Eo,Po,Mo=new tn(0,0),To={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!k,zoomAnimationDuration:330,panAnimation:!k,panAnimationDuration:600,rotateAnimation:!k,zoomable:!0,enableInfoWindow:!0,hitDetect:!lt.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0},ko=function(t){function e(i,n){var r;if(!n)throw new Error("Invalid options when creating map.");if(!n.center)throw new Error("Invalid center when creating map.");var o=v({},n),s=o.zoom;delete o.zoom;var a=new tn(o.center);delete o.center;var h=o.baseLayer;delete o.baseLayer;var l=o.layers;return delete o.layers,(r=t.call(this,o)||this).VERSION=e.VERSION,Object.defineProperty(ut(ut(r)),"id",{value:yt(),writable:!1}),r._loaded=!1,r._initContainer(i),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=s,r._center=a,r.setSpatialReference(o.spatialReference||o.view),r._mapViewPoint=new pt(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),h&&r.setBaseLayer(h),l&&r.addLayer(l),r.setMaxExtent(o.maxExtent),r._Load(),r}ct(e,t),e.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(i),this};var i=e.prototype;return i.isLoaded=function(){return!!this._loaded},i.getContainer=function(){return this._containerDOM},i.getSpatialReference=function(){return this._spatialReference},i.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&po.equals(e,t)?this:(this._updateSpatialReference(t,e),this)},i._updateSpatialReference=function(t,e){if(A(t)&&(t=po.getPreset(t)),t=v({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new po(t),this.options.spatialReference&&C(this.options.spatialReference.projection)){var i=this._spatialReference.getProjection();this.options.spatialReference.projection=i.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:v({},this.options.spatialReference)}),this},i.onConfig=function(t){var e=t.spatialReference||t.view;return y(e)||this._updateSpatialReference(e,null),this},i.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},i.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},i.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},i.resetCursor=function(){return this.setCursor(null)},i.getCenter=function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},i.setCenter=function(t){if(!t)return this;t=new tn(t);var e=this.getProjection().project(t);return this._verifyExtent(e)?this._loaded?(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},i.getSize=function(){return y(this.width)||y(this.height)?this._getContainerDomSize():new Me(this.width,this.height)},i.getContainerExtent=function(){var t=this.height,e=this.getPitch(),i=this.options.maxVisualPitch;return i&&e>i&&(t=this._getVisualHeight(i)),new gn(0,this.height-t,this.width,this.height)},i._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,i=this.getFov()*Math.PI/180;t*=Math.PI/180;var n=this.cameraCenterDistance/this.getGLScale(),r=Math.tan(i/2),o=n*r/(1/Math.tan(t)-r)/Math.sin(t),s=n*(Math.sin(e)*o/(n+Math.cos(e)*o));return this.height/2+s},i.getExtent=function(){return this._pointToExtent(this._get2DExtent())},i.getProjExtent=function(){var t=this._get2DExtent();return new pn(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},i.getPrjExtent=function(){return this.getProjExtent()},i.getMaxExtent=function(){return this.options.maxExtent?new pn(this.options.maxExtent,this.getProjection()):null},i.setMaxExtent=function(t){if(t){var e=new pn(t,this.getProjection());this.options.maxExtent=e;var i=this.getProjection();this._prjMaxExtent=e.convertTo(function(t){return i.project(t)}),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=i.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},i.getZoom=function(){return this._zoomLevel},i.getZoomForScale=function(t,e,i){var n=this.getZoom();if(y(e)&&(e=n),1===t&&e===n)return n;var r=this._getResolution(e)/t,o=this.getZoomFromRes(r);if(i)return o;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(o-1e-6):Math.floor(o+1e-6)},i.getZoomFromRes=function(t){var e=this._getResolutions(),i=this._getResolution(this.getMinZoom()),n=this._getResolution(this.getMaxZoom());if(i<=n){if(t<=i)return this.getMinZoom();if(t>=n)return this.getMaxZoom()}else{if(t>=i)return this.getMinZoom();if(t<=n)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var s=e[o+1]-e[o],a=t-e[o];if(St(s)===St(a)&&Math.abs(s)>=Math.abs(a))return o+a/s}return r-1},i.setZoom=function(t,e){return void 0===e&&(e={animation:!0}),isNaN(t)||y(t)?this:(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t),this)},i.getMaxZoom=function(){return y(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},i.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),null!==t&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},i.getMinZoom=function(){return y(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},i.setMinZoom=function(t){if(null!==t){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},i.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},i.getGLRes=function(){if(this._glRes)return this._glRes;var t=this.getSpatialReference().getFullExtent();return this._glRes=(t.right-t.left)/Math.pow(2,19),this._glRes},i.getGLScale=function(t){return y(t)&&(t=this.getZoom()),this._getResolution(t)/this.getGLRes()},i.zoomIn=function(){return this.setZoom(this.getZoom()+1)},i.zoomOut=function(){return this.setZoom(this.getZoom()-1)},i.isZooming=function(){return!!this._zooming},i.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},i.setCenterAndZoom=function(t,e){return y(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},i.getFitZoom=function(t,e){var i=this;if(!(t&&t instanceof pn))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var n=this.getSize(),r=t.convertTo(function(t){return i.coordToPoint(t)}),o=r.getWidth(),s=r.getHeight(),a=n.width/o,h=n.height/s,l=this.getSpatialReference().getZoomDirection()<0?Math.max(a,h):Math.min(a,h);return this.getZoomForScale(l,null,e)},i.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},i.setView=function(t){return t?(t.center&&this.setCenter(t.center),null===t.zoom||isNaN(+t.zoom)||this.setZoom(+t.zoom,{animation:!1}),null===t.pitch||isNaN(+t.pitch)||this.setPitch(+t.pitch),null===t.pitch||isNaN(+t.bearing)||this.setBearing(+t.bearing),this):this},i.getResolution=function(t){return this._getResolution(t)},i.getScale=function(t){var e=y(t)?this.getZoom():t,i=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/i},i.fitExtent=function(t,e,i,n){if(void 0===i&&(i={}),!t)return this;t=new pn(t,this.getProjection());var r=this.getFitZoom(t)+(e||0),o=t.getCenter();return void 0===i.animation||i.animation?this._animateTo({center:o,zoom:r},{duration:i.duration||this.options.zoomAnimationDuration,easing:i.easing||"out"},n):this.setCenterAndZoom(o,r)},i.getBaseLayer=function(){return this._baseLayer},i.setBaseLayer=function(t){var e=!1;if(this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!t)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;return this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))},this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},i.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},i.getLayers=function(t){return this._getLayers(function(e){return!(e===this._baseLayer||e.getId().indexOf("_maptalks__internal_layer_")>=0)&&(!t||t(e))})},i.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var i=this.getBaseLayer();return i&&i.getId()===t?i:null},i.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,i=0,n=t.length;i<n;i++){var r=t[i],o=r.getId();if(y(o))throw new Error("Invalid id for the layer: "+o);if(r.getMap()!==this){if(this._layerCache[o])throw new Error("Duplicate layer id in the map: "+o);this._layerCache[o]=r,r._bindMap(this),e.push(r),this._loaded&&r.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},i.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];if(r instanceof xo||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var s=r.getId();this._layerCache&&delete this._layerCache[s]}}}if(e.length>0){var a=this.getRenderer();a&&a.setLayerCanvasUpdated(),this.once("frameend",function(){e.forEach(function(t){t.fire("remove")})})}return this._fireEvent("removelayer",{layers:t}),this},i.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],i=Number.MAX_VALUE,n=0,r=t.length;n<r;n++){var o=t[n];if(A(t[n])&&(o=this.getLayer(o)),!(o instanceof xo&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<i&&(i=o.getZIndex()),e.push(o)}for(var s=0,a=e.length;s<a;s++)e[s].setZIndex(i+s);return this},i.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var i=t.save,n=this._getRenderer();if(n&&n.toDataURL){var r=t.fileName;r||(r="export");var o=n.toDataURL(e,t.quality||.92);if(i&&o){var s;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var a=jt(o.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),e);s=URL.createObjectURL(a)}else s=o;var h=document.createElement("a");h.download=r,h.href=s,document.body.appendChild(h),h.click(),document.body.removeChild(h)}return o}return null},i.coordToPoint=function(t,e,i){return this.coordinateToPoint(t,e,i)},i.coordToPointAtRes=function(t,e,i){return this.coordinateToPointAtRes(t,e,i)},i.pointToCoord=function(t,e,i){return this.pointToCoordinate(t,e,i)},i.pointAtResToCoord=function(t,e,i){return this.pointAtResToCoordinate(t,e,i)},i.coordToViewPoint=function(t,e,i){return this.coordinateToViewPoint(t,e,i)},i.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},i.coordToContainerPoint=function(t,e,i){return this.coordinateToContainerPoint(t,e,i)},i.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},i.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},i.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},i.checkSize=function(t){var e=g()-this._initTime<1500&&0===this.width||0===this.height,i=this._getContainerDomSize(),n=this.height,r=this.width;if(!t&&i.width===r&&i.height===n)return this;mi(this._containerDOM);var o=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(i);else{var s=this._getVisualHeight(this.getPitch()),a=new pt(0,this.height-s),h=this._containerPointToPrj(a);this._updateMapSize(i);var l=this._getVisualHeight(this.getPitch()),c=new pt(0,this.height-l);this._setPrjCoordAtContainerPoint(h,c),this._mapViewCoord=this._getPrjCenter()}var u=0===i.width||0===i.height||0===r||0===n;return(e||u)&&(this._eventSilence=!0,this.setCenter(o),delete this._eventSilence),this._fireEvent("resize"),this},i.locate=function(t,e,i){return this.getProjection()._locate(new tn(t),e,i)},i.getMainPanel=function(){return this._getRenderer().getMainPanel()},i.getPanels=function(){return this._panels},i.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),i=0;i<e.length;i++)e[i].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter(function(t){return"maptalks-wrapper"===t.className}).forEach(function(e){return t._containerDOM.removeChild(e)}),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),lt.removeDPRListening&&lt.removeDPRListening(this),this},i.isRemoved=function(){return!this._containerDOM},i.isMoving=function(){return!!this._moving},i.onMoveStart=function(t){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var e=this._getPrjCenter();this._originCenter&&!this._verifyExtent(e)||(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},i.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},i.onMoveEnd=function(t){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this._getPrjCenter())&&this._originCenter){var e=this._originCenter;this._panTo(e)}},i.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},i.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},i.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},i.isDragRotating=function(){return!!this._dragRotating},i.isOffscreen=function(t,e){void 0===e&&(e=0);var i=this.width+e,n=this.height+e,r=t.xmin,o=t.ymin,s=t.xmax,a=t.ymax;return Array.isArray(t)&&(r=t[0],o=t[1],s=t[2],a=t[3]),s<e||r>=i||a<e||o>n},i.getRenderer=function(){return this._getRenderer()},i.getDevicePixelRatio=function(){return this.options.devicePixelRatio||lt.devicePixelRatio||1},i.setDevicePixelRatio=function(t){return x(t)&&t>0&&t!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=t,this.checkSize(!0)),this},i._initContainer=function(t){if(A(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,k&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},i._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},i._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},i._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},i._removeLayer=function(t,e){if(t&&e){var i=e.indexOf(t);i>-1&&e.splice(i,1)}},i._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t,this._layers[t].sortLayersByZIndex&&this._layers[t].sortLayersByZIndex();this._layers.sort(function(t,e){var i=t.getZIndex()-e.getZIndex();return 0===i?t._order-e._order:i})}},i._fireEvent=function(t,e){this._eventSilence||(this.fire("_"+t,e),this.fire(t,e))},i._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=g()},i._initRenderer=function(){var t=this.options.renderer,i=e.getRendererClass(t);this._renderer=new i(this),this._renderer.load()},i._getRenderer=function(){return this._renderer},i._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer(function(t){t&&t.load()},this.getLayers())},i._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,i=[],n=0;n<e.length;n++)t&&!t.call(this,e[n])||i.push(e[n]);return i},i._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var i=[],n=0,r=e.length;n<r;n++)i=i.concat(e[n]);for(var o=0,s=i.length;o<s;o++)t.call(t,i[o])}},i._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},i._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),i=this._spatialReference.getMaxZoom(),n=this._spatialReference.getMinZoom();(y(t)||-1===t||t>i)&&this.setMaxZoom(i),(y(e)||-1===e||e<n)&&this.setMinZoom(n),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(y(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var r=this.getProjection();this._prjCenter=r.project(this._center),this._calcMatrices();var o=this._getRenderer();o&&o.resetContainer()},i._getContainerDomSize=function(){if(!this._containerDOM)return null;var t,e,i=this._containerDOM;if(this._containerDomContentRect)return t=this._containerDomContentRect.width,e=this._containerDomContentRect.height,new Me(t,e);if(y(i.width)||y(i.height)){if(y(i.clientWidth)||y(i.clientHeight))throw new Error("can not get size of container");t=parseInt(i.clientWidth,0),e=parseInt(i.clientHeight,0)}else{t=i.width,e=i.height;var n=this.getDevicePixelRatio();1!==n&&i.layer&&(t/=n,e/=n)}return new Me(t,e)},i._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},i._getPrjCenter=function(){return this._prjCenter},i._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},i._setPrjCoordAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var i=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),n=this._pointToPrj(this._prjToPoint(t).sub(i));return this._setPrjCenter(n),this},i._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return!e||e.contains(t)},i._offsetCenterByPixel=function(t){var e=new pt(this.width/2-t.x,this.height/2-t.y),i=this._containerPointToPrj(e);return this._setPrjCenter(i),i},i.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},i.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},i._resetMapViewPoint=function(){this._mapViewPoint=new pt(0,0),this._mapViewCoord=this._getPrjCenter()},i._getResolution=function(t){return void 0!==t&&t!==this._zoomLevel||void 0===this._mapRes?(y(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t)):this._mapRes},i._getResolutions=function(){return this._spatialReference.getResolutions()},i._prjToPoint=function(t,e,i){e=y(e)?this.getZoom():e;var n=this._getResolution(e);return this._prjToPointAtRes(t,n,i)},i._prjToPointAtRes=function(t,e,i){return this._spatialReference.getTransformation().transform(t,e,i)},i._prjsToPointsAtRes=function(t,e,i){void 0===i&&(i=[]);for(var n=this._spatialReference.getTransformation(),r=[],o=0,s=t.length;o<s;o++){var a=n.transform(t[o],e,i[o]);r.push(a)}return r},i._pointToPrj=function(t,e,i){e=y(e)?this.getZoom():e;var n=this._getResolution(e);return this._pointToPrjAtRes(t,n,i)},i._pointToPrjAtRes=function(t,e,i){return this._spatialReference.getTransformation().untransform(t,e,i)},i._pointToPoint=function(t,e,i){return y(e)?(i?(i.x=t.x,i.y=t.y):i=t.copy(),i):this._pointAtResToPoint(t,this._getResolution(e),i)},i._pointAtResToPoint=function(t,e,i){return i?(i.x=t.x,i.y=t.y):i=t.copy(),i._multi(e/this._getResolution())},i._pointToPointAtRes=function(t,e,i){return i?(i.x=t.x,i.y=t.y):i=t.copy(),i._multi(this._getResolution()/e)},i._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},i._callOnLoadHooks=function(){var t=e.prototype;if(t._onLoadHooks)for(var i=0,n=t._onLoadHooks.length;i<n;i++)t._onLoadHooks[i].call(this)},e}(Ki(Hi(jn(Wi))));ko.include({coordinateToPoint:function(t,e,i){var n=this._getResolution(e);return this.coordinateToPointAtRes(t,n,i)},coordinateToPointAtRes:(Po=new tn(0,0),function(t,e,i){var n=this.getProjection().project(t,Po);return this._prjToPointAtRes(n,e,i)}),pointToCoordinate:function(){var t=new tn(0,0);return function(e,i,n){var r=this._pointToPrj(e,i,t);return this.getProjection().unproject(r,n)}}(),pointAtResToCoordinate:function(){var t=new tn(0,0);return function(e,i,n){var r=this._pointToPrjAtRes(e,i,t);return this.getProjection().unproject(r,n)}}(),coordinateToViewPoint:function(){var t=new tn(0,0);return function(e,i,n){return this._prjToViewPoint(this.getProjection().project(e,t),i,n)}}(),viewPointToCoordinate:function(){var t=new tn(0,0);return function(e,i){return this.getProjection().unproject(this._viewPointToPrj(e,t),i)}}(),coordinateToContainerPoint:function(t,e,i){var n=this._getResolution(e);return this.coordinateToContainerPointAtRes(t,n,i)},coordinateToContainerPointAtRes:function(){var t=new tn(0,0);return function(e,i,n){var r=this.getProjection().project(e,t);return this._prjToContainerPointAtRes(r,i,n)}}(),coordinatesToContainerPoints:function(t,e){var i=this._getResolution(e);return this.coordinatesToContainerPointsAtRes(t,i)},coordinatesToContainerPointsAtRes:function(t,e){for(var i=[],n=this._spatialReference.getTransformation(),r=e/this._getResolution(),o=this.getProjection(),s=new tn(0,0),a=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,Mo),l=0,c=t.length;l<c;l++){var u=o.project(t[l],s),d=n.transform(u,e);d=d._multi(r),this._toContainerPoint(d,a,r,0,h),i.push(d)}return i},containerPointToCoordinate:function(){var t=new tn(0,0);return function(e,i){var n=this._containerPointToPrj(e,t);return this.getProjection().unproject(n,i)}}(),containerToExtent:(So=new pt(0,0),Eo=new pt(0,0),function(t){var e=new gn(this._containerPointToPoint(t.getMin(So),void 0,So),this._containerPointToPoint(t.getMax(Eo),void 0,Eo));return this._pointToExtent(e)}),distanceToPixel:function(){var t=new pt(0,0),e=new pt(0,0);return function(i,n,r){var o=this.getProjection();if(!o)return null;var s=this.getScale()/this.getScale(r),a=this.getCenter(),h=o.locate(a,i,n),l=this.coordToContainerPoint(a,void 0,t),c=this.coordToContainerPoint(h,void 0,e);return c._sub(l)._multi(s)._abs(),new Me(c.x,c.y)}}(),distanceToPoint:function(t,e,i,n){var r=this._getResolution(i);return this.distanceToPointAtRes(t,e,r,n)},distanceToPointAtRes:(Co=new pt(0,0),function(t,e,i,n){var r=this.getProjection();if(!r)return null;var o=n||this.getCenter(),s=r.locate(o,t,e),a=this.coordToPointAtRes(o,i,Co),h=this.coordToPointAtRes(s,i);return h._sub(a)._abs(),h}),pixelToDistance:(bo=new tn(0,0),Ao=new tn(0,0),function(t,e){var i=this.getProjection();if(!i)return null;var n=this.getFullExtent(),r=n.top>n.bottom?-1:1,o=bo.set(this.width/2+t,this.height/2+r*e),s=this.containerPointToCoord(o,Ao);return i.measureLength(this.getCenter(),s)}),pointToDistance:function(t,e,i){var n=this.getResolution(i);return this.pointAtResToDistance(t,e,n)},pointAtResToDistance:function(){var t=new pt(0,0),e=new tn(0,0);return function(i,n,r){var o=this.getProjection();if(!o)return null;var s=this._prjToPointAtRes(this._getPrjCenter(),r,t);s._add(i,n);var a=this.pointAtResToCoord(s,r,e);return o.measureLength(this.getCenter(),a)}}(),locateByPoint:function(){var t=new pt(0,0);return function(e,i,n){var r=this.coordToContainerPoint(e,void 0,t);return this.containerPointToCoord(r._add(i,n))}}(),_get2DExtent:function(t,e){var i;if(void 0!==t&&t!==this._zoomLevel||!this._mapExtent2D||(i=this._mapExtent2D),i)return e?(e.set(i.xmin,i.ymin,i.xmax,i.ymax),e):i.copy();var n=this._getResolution(t);return this._get2DExtentAtRes(n,e)},_get2DExtentAtRes:function(){var t=new pt(0,0);return function(e,i){var n=this;return e===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo(function(i){return n._containerPointToPointAtRes(i,e,t)},i)}}(),_pointToExtent:function(){var t=new tn(0,0),e=new tn(0,0);return function(i){var n=i.getMin(),r=i.getMax(),o=this.getFullExtent(),s=!o||o.left<=o.right?[n.x,r.x]:[r.x,n.x],a=s[0],h=s[1],l=!o||o.top>o.bottom?[r.y,n.y]:[n.y,r.y],c=l[0],u=l[1],d=n.set(a,u),f=r.set(h,c);return new pn(this.pointToCoord(d,void 0,t),this.pointToCoord(f,void 0,e),this.getProjection())}}(),_getViewPointFrameOffset:function(){var t=new pt(0,0);return function(){if(this.isZooming())return null;var e=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(e)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(e,void 0,t)):null}}(),_viewPointToPrj:function(){var t=new pt(0,0);return function(e,i){return this._containerPointToPrj(this.viewPointToContainerPoint(e,t),i)}}(),_prjToContainerPoint:function(t,e,i,n){var r=this._getResolution(e);return this._prjToContainerPointAtRes(t,r,i,n)},_prjToContainerPointAtRes:function(){var t=new pt(0,0);return function(e,i,n,r){return this._pointAtResToContainerPoint(this._prjToPointAtRes(e,i,t),i,r||0,n)}}(),_prjToViewPoint:function(){var t=new pt(0,0);return function(e,i,n){var r=this._prjToContainerPoint(e,void 0,t,n);return this.containerPointToViewPoint(r,i)}}(),_viewPointToPoint:function(){var t=new pt(0,0);return function(e,i,n){return this._containerPointToPoint(this.viewPointToContainerPoint(e,t),i,n)}}(),_pointToViewPoint:function(){var t=new tn(0,0);return function(e,i,n){return this._prjToViewPoint(this._pointToPrj(e,i,t),n)}}()}),ko.mergeOptions(To);var Ro=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},i.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},i._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var i=e.getZoom(),n=t.domEvent.shiftKey?Math.ceil(i)-1:Math.floor(i)+1;e._zoomAnimation(n,t.containerPoint)}},e}(Vi);ko.mergeOptions({doubleClickZoom:!0}),ko.addOnLoadHook("addHandler","doubleClickZoom",Ro);var Lo=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.addHooks=function(){var t=this.target;if(t){var e=t._panels.mapWrapper||t._containerDOM;this._dragHandler=new $i(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},i.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},i._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},i._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t))},i._onMouseDown=function(t){delete this.startDragTime,delete this._mode,2===t.domEvent.button||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),di(t.domEvent)},i._onDragStart=function(t){this.startDragTime=g(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},i._onDragging=function(t){this.target._isEventOutMap(t.domEvent)||("move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t))},i._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},i._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},i._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var i=gi(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e._containerPointToPrj(i)},i._moving=function(t){if(this.startDragTime){var e=this.target,i=gi(e._getActualEvent(t.domEvent),e.getContainer());e._setPrjCoordAtContainerPoint(this.startPrjCoord,i),e.onMoving(t)}},i._moveEnd=function(t){if(this.startDragTime){var e="touchend"===t.domEvent.type,i=this.target,n=g()-this.startDragTime,r=t.mousePos.x,o=t.mousePos.y,s=r-this.startX,a=o-this.startY,h=i._getPrjCenter(),l=h.sub(this._startPrjCenter);if(this._clear(),i.options.panAnimation&&!t.interupted&&i._verifyExtent(i._getPrjCenter())&&n<280&&Math.abs(a)+Math.abs(s)>5){n*=5;var c=e?5:2.8,u=h.add(l._multi(c)),d=i.getProjection().unproject(u);i.panTo(d,{duration:e?3*n:2*n,easing:"outExpo"})}else i.onMoveEnd(t)}},i._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},i._rotating=function(t){var e=this.target,i=t.mousePos.x,n=t.mousePos.y,r=e.getPitch(),o=e.getBearing(),s=Math.abs(i-this.preX),a=Math.abs(n-this.preY);if(this._rotateMode||(e.options.dragRotatePitch?this._rotateMode="rotate_pitch":this._rotateMode=s>a?"rotate":s<a?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&a<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var h=0;h=e.options.dragPitch||s>a?-.6*(this.preX-i):i>e.width/2?.6*(this.preY-n):-.6*(this.preY-n);var l=e.getBearing()+h;this._db=this._db||0,this._db+=h,e._setBearing(l)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e._setPitch(e.getPitch()+.4*(this.preY-n)),this.preX=i,this.preY=n,e.getBearing()===o&&e.getPitch()===r||e.onDragRotating(t)}},i._rotateEnd=function(t){var e=this.target,i=e.getBearing();this._clear();var n=g()-this.startDragTime;if(e.onDragRotateEnd(t),e.options.rotateAnimation&&Math.abs(i-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&n<400){var r=e.getBearing();e._animateTo({bearing:r+this._db/1.5},{easing:"outQuint",duration:1600})}},i._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(Vi);ko.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),ko.addOnLoadHook("addHandler","draggable",Lo);var Do="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",Oo=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.addHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;Mi(e,Do,this._identifyGeometryEvents,this)},i.removeHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;Ti(e,Do,this._identifyGeometryEvents,this)},i._identifyGeometryEvents=function(t,e){var i=this.target;if(!i.isInteracting()&&!i._ignoreEvent(t)){var n=null,r=e||t.type,o="mousedown"===r||"touchstart"===r&&t.touches&&1===t.touches.length;if(o)this._mouseDownTime=g();else if(("click"===r||"touchend"===r)&&this._mouseDownTime){var s=this._mouseDownTime;if(delete this._mouseDownTime,g()-s>300){if("click"===r)return}else"touchend"===r&&(n="click")}var a=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(a){var h=gi(a,i._containerDOM);"touchstart"===r&&di(t);for(var l=null,c=this.target.getRenderer().getTopElements(),u=o&&2!==t.button,d=0;d<c.length;d++)if(c[d].hitTest(h)){var f=c[d].options.cursor;if(f&&(l=f),u||c[d].events&&c[d].events.indexOf(r)>=0){var _={target:i,type:r,domEvent:t,containerPoint:h};if(u)return i._setPriorityCursor(l),void c[d].mousedown(_);c[d].onEvent(_)}}var p=i._getLayers(function(t){return!(!t.identify||!t.options.geometryEvents)});if(i._setPriorityCursor(l),p.length){var m={includeInternals:!0,filter:function(e){if(!(e instanceof vo))return!1;var i=e._getEventTypeToFire(t);if("mousemove"===r){if(!l&&e.options.cursor&&(l=e.options.cursor),!e.listens("mousemove")&&!e.listens("mouseover")&&!e.listens("mouseenter"))return!1}else if(!e.listens(i)&&!e.listens(n))return!1;return!0},count:1,containerPoint:h,onlyVisible:i.options.onlyVisibleGeometryEvents,layers:p},v=function(e){var o=!0;if("mousemove"===r){var s={};if(e.length>0)for(var a=e.length-1;a>=0;a--){var h=e[a];if(h instanceof vo){var c=h._getInternalId();s[c]=h,h._onEvent(t),this._prevOverGeos&&this._prevOverGeos.geomap[c]||h._onEvent(t,"mouseenter"),o=h._onEvent(t,"mouseover")}}i._setPriorityCursor(l);var u=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:e,geomap:s},u&&u.length>0)for(var d=u.length-1;d>=0;d--){var f=u[d];if(f instanceof vo){var _=u[d]._getInternalId();s[_]||(o=f._onEvent(t,"mouseout"))}}}else{if(!e||!e.length)return;for(var p=e.length-1;p>=0;p--)if(e[p]instanceof vo){o=e[p]._onEvent(t),n&&e[p]._onEvent(t,n);break}}!1===o&&fi(t)}.bind(this);"mousemove"===r||"touchmove"===r?this._queryIdentifyTimeout=i.getRenderer().callInNextFrame(function(){i.isInteracting()||i.identifyAtPoint(m,v)}):i.identifyAtPoint(m,v)}}}},e}(Vi);ko.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),ko.addOnLoadHook("addHandler","geometryEvents",Oo);var Io=.01,Bo=1/450,jo=function(t){function e(e){var i;return(i=t.call(this,e)||this)._thisScrollZoom=i._scrollZoom.bind(ut(ut(i))),i._wheelZoomRate=Bo,i._defaultZoomRate=Io,i._delta=0,i}ct(e,t);var i=e.prototype;return i.addHooks=function(){li(this.target._containerDOM,"wheel",this._onWheelScroll,this)},i.removeHooks=function(){ci(this.target._containerDOM,"wheel",this._onWheelScroll)},i._onWheelScroll=function(t){di(t),fi(t);var e=this.target;if(e._ignoreEvent(t)||!e.options.zoomable)return!1;var i=e._containerDOM,n=e._checkZoomOrigin(gi(t,i));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,n)):this._interval(t,n)},i._seamless=function(t,e){var i=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*t.deltaY:t.deltaY;if(i%4.000244140625!=0&&(this._ensureTrackpad||(Math.abs(i)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(i*=14)),t.shiftKey&&i&&(i/=4),this._lastWheelEvent=t,this._delta-=i,!this._zooming&&this._delta){var n=this.target;this._zoomOrigin=e,n.onZoomStart(null,e)}this._start()},i._start=function(){if(this._delta){this._zooming=!0;var t=this.target;this._active||(t.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},i._scrollZoom=function(){var t=this;if(this._active=!1,this._delta){var e=Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);var n=this.target,r=n.getZoom(),o=n.getZoomForScale(i,r,!0);this._delta=0,n.onZooming(o,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){t._zooming=!1,delete t._timeout,n.onZoomEnd(n.getZoom(),t._zoomOrigin)},210)}},i._interval=function(t,e){var i=this,n=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(t.deltaY?-1*t.deltaY:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(r*=-1);var o=n.getZoom(),s=o+r;if((s=n._checkZoom(r>0?Math.ceil(s):Math.floor(s)))===o)return!1;this._zooming=!0,this._delta||(n.onZoomStart(null,e),this._origin=e,this._delta=r,this._startZoom=n.getZoom());return n._animateTo({zoom:s-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},function(e){"finished"===e.state.playState?i._requesting<1||Math.abs(s-i._startZoom)>2||s===n.getMaxZoom()||s===n.getMinZoom()?(n._animateTo({zoom:s,around:i._origin},{continueOnViewChanged:!0,duration:100},function(t){"running"!==t.state.playState&&(delete i._zooming,delete i._requesting)}),delete i._startZoom,delete i._origin,delete i._delta,i._requesting=0):y(i._requesting)||(delete i._zooming,i._onWheelScroll(t)):"running"!==e.state.playState&&(delete i._zooming,delete i._requesting)}),!1},e}(Vi);ko.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),ko.addOnLoadHook("addHandler","scrollWheelZoom",jo);var zo=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.addHooks=function(){li(this.target.getContainer(),"touchstart",this._onTouchStart,this)},i.removeHooks=function(){ci(this.target.getContainer(),"touchstart",this._onTouchStart)},i._onTouchStart=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var i=e.getContainer(),n=gi(t.touches[0],i),r=gi(t.touches[1],i);this.preY=n.y,this._startP1=n,this._startP2=r,this._startDist=n.distanceTo(r),this._startVector=n.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),Ti(document,"touchmove",this._onTouchMove,this),Ti(document,"touchend",this._onTouchEnd,this),li(document,"touchmove",this._onTouchMove,this),li(document,"touchend",this._onTouchEnd,this),di(t),e._fireEvent("touchactstart")}},i._onTouchMove=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var i=e.getContainer(),n=gi(t.touches[0],i),r=gi(t.touches[1],i),o=n.sub(this._startP1),s=r.sub(this._startP2),a=n.sub(r),h=n.distanceTo(r)/this._startDist,l=180*a.angleWith(this._startVector)/Math.PI,c=.4*((this.preY||n.y)-n.y);this.preY=n.y;var u={domEvent:t,mousePos:[n,r]};if(this.mode||(e.options.touchRotate&&Math.abs(l)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&o.y*s.y>0&&Math.abs(o.y)>10&&Math.abs(s.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-h)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(u)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=h;var d=e._getResolution(this._startZoom)/h,f=e.getZoomFromRes(d);e.onZooming(f,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e._setBearing(this._startBearing+l),e.onDragRotating(u)):"pitch"===this.mode&&(e._setPitch(e.getPitch()+c),e.onDragRotating(u)),e._fireEvent("touchactinging")}},i._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var i=e.getSize();this._Origin=new pt(i.width/2,i.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},i._onTouchEnd=function(t){delete this.preY;var e=this.target;if(Ti(document,"touchmove",this._onTouchMove,this),Ti(document,"touchend",this._onTouchEnd,this),"zoom"===this.mode||"rotate_zoom"===this.mode){var i=this._scale,n=e._getResolution(this._startZoom)/i,r=e.getZoomFromRes(n);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(Vi);ko.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),ko.addOnLoadHook("addHandler","touchGesture",zo);var Go="__anim_player",No={outExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},outQuint:function(t){return 1-Math.pow(1-t,5)},in:function(t){return Math.pow(t,2)},out:function(t){return 1-No.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?No.inAndOut(2*t):1-No.inAndOut(2*(t-.5))}},Fo=function(t,e){this.state=t,this.styles=e},Uo=function(t,e,i,n){this._animation=t,this.options=e,this._onFrame=i,this.playState="idle",this.ready=!0,this.finished=!1,this.target=n},Ho={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return Ho._resolveStyles(t);for(var e=[],i=[],n=[],r=0;r<t.length;r++){var o=Ho._resolveStyles(t[r]);o&&(e.push(o[0]),i.push(o[1]),n.push(o[2]))}return e.length?[e,i,n]:null}function i(t){var e,i=t;Array.isArray(t)||(i=x(t)?[0,t]:t instanceof pt||t instanceof tn?[new(e=t.constructor)(0,0),t]:[t,t]);var n=i[0],r=i[1];return x(n)&&x(r)?n===r?null:[n,r-n,r]:Array.isArray(n)&&x(n[0])||n instanceof tn||n instanceof pt?(Array.isArray(n)?(n=new tn(n),r=new tn(r)):(n=new(e=n.constructor)(n),r=new e(r)),n.equals(r)?null:[n,r.sub(n),r]):[n,r,r]}var n,r={},o={},s={};for(var a in t)if(t.hasOwnProperty(a)){var h=t[a];if(!h)continue;if(Array.isArray(h)&&(y(h[0])||y(h[1])))continue;var l=void 0;n=h,(l=!Array.isArray(n)&&n.constructor===Object||Array.isArray(n)&&n[0].constructor===Object?e(h):i(h))&&(o[a]=l[0],r[a]=l[1],s[a]=l[2])}return[o,r,s]},framing:function(t,e){e||(e={});var i,n,r,o=e.easing?No[e.easing]:No.linear;o||(o=No.linear),(t=Ho._resolveStyles(t))&&(n=t[0],i=t[1],r=t[2]);return function(t,e){var s,a;if(t<0)s={playState:"idle",delta:0},a=n;else if(t<e){var h=o(t/e);s={playState:"running",delta:h},a=function t(e,i,n){if(!i||!n)return null;var o={};for(var s in n)if(n.hasOwnProperty(s)){if(i[s]===r[s]){o[s]=i[s];continue}var a=i[s],h=n[s];if(x(h))o[s]=a+e*h;else if(Array.isArray(h)){for(var l=[],c=0;c<h.length;c++)l.push(t(e,a[c],h[c]));o[s]=l}else h.constructor===Object?o[s]=t(e,a,h):o[s]=a instanceof pt||a instanceof tn?a.add(h.multi(e)):h}return o}(h,n,i)}else s={playState:"finished",delta:1},a=r;return s.startStyles=n,s.destStyles=r,s.progress=t,s.remainingMs=e-t,new Fo(s,a)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=dt(Ho._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]();this._frameQueue.length?this._animationFrameId=dt(Ho._frameFn):delete this._animationFrameId}},animate:function(t,e,i,n){e||(e={});var r=Ho.framing(t,e);return new Uo(r,e,i,n)}};Ho._frameFn=Ho._run.bind(Ho),v(Uo.prototype,{_prepare:function(){var t=this.options,e=t.speed||t.duration;A(e)&&((e=Ho.speed[e])||(e=+e)),e||(e=Ho.speed.normal),this.duration=e,this._framer=t.framer||Ho._requestAnimFrame.bind(Ho)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[Go])return this;this.target&&(this.target[Go]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=g();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return"paused"===this.playState?this:(this.playState="paused",this._run(),this)},cancel:function(){return"idle"===this.playState?this:(this.playState="idle",this.finished=!1,this._run(),this)},finish:function(){return"finished"===this.playState?this:(this.playState="finished",this.finished=!0,this._run(),this)},reverse:function(){},_run:function(){var t=this,e=this._onFrame,i=g(),n=i-this._playStartTime;if(this.options.repeat&&n>=this.duration&&(this._playStartTime=i,n=0),"running"===this.playState){var r=this._animation(n,this.duration);this.playState=r.state.playState,"running"!==this.playState&&this.target&&delete this.target[Go],"idle"===this.playState?this.startTime>i&&setTimeout(this._run.bind(this),this.startTime-i):"running"===this.playState?this._framer(function(){"running"===t.playState&&(t.currentTime=n,e&&e(r),t._run())}):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(this.target&&delete this.target[Go],e){"finished"===this.playState?n=this.duration:"idle"===this.playState&&(n=0);var o=this._animation(n,this.duration);o.state.playState=this.playState,e(o)}}});var Vo=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.animateShow=function(t,e){var i=this;void 0===t&&(t={}),this._showPlayer&&this._showPlayer.finish(),C(t)&&(e=t={});var n=this.getCoordinates();if(0===n.length)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var r=!!this.getShell?this.getShell().concat(this.getShell()[0]):n,o=this._getProjection(),s=o.projectCoords(r);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=o.unproject(this._prjAniShowCenter);var a=t.duration||1e3,h=t.easing||"out";this.setCoordinates([]);var l=0;s.length&&(s[0]._distance=0);for(var c=1;c<s.length;c++){var u=s[c].distanceTo(s[c-1]);s[c]._distance=u,l+=u}this._tempCoord=new tn(0,0),this._tempPrjCoord=new pt(0,0);var d=this._showPlayer=Ho.animate({t:a},{duration:a,easing:h},function(t){if(i.getMap()){var o=i._drawAnimShowFrame(t.styles.t,a,l,r,s);"finished"===t.state.playState&&(delete i._showPlayer,delete i._aniShowCenter,delete i._prjAniShowCenter,delete i._animIdx,delete i._animLenSoFar,delete i._animTailRatio,delete i._tempCoord,delete i._tempPrjCoord,i.setCoordinates(n)),e&&e(t,o)}else if("finished"!==d.playState&&(d.finish(),e)){var h=i.getCoordinates();e(t,h[h.length-1])}},this);return d.play(),d},i._drawAnimShowFrame=function(t,e,i,n,r){if(0===t)return n[0];var o,s,a=t/e*i,h=0;for(o=this._animIdx+1,s=r.length;o<s&&(h=r[o]._distance,!(this._animLenSoFar+h>a));o++)this._animLenSoFar+=h;if(this._animIdx=o-1,this._animIdx>=s-1)return this.setCoordinates(n),n[n.length-1];var l=this._animIdx,c=r[l],u=r[l+1],d=(a-this._animLenSoFar)/h;this._animTailRatio=d;var f=c.x+(u.x-c.x)*d,_=c.y+(u.y-c.y)*d;this._tempPrjCoord.x=f,this._tempPrjCoord.y=_;var p=this._tempPrjCoord,m=n[l],g=n[l+1],v=m.x+(g.x-m.x)*d,y=m.y+(g.y-m.y)*d;this._tempCoord.x=v,this._tempCoord.y=y;var x=this._tempCoord,w=!!this.getShell;if(!w&&this.options.smoothness>0){var b=n.slice(0,this._animIdx+3);this.setCoordinates(b);var A=r.slice(0,this._animIdx+3);this._setPrjCoordinates(A)}else{var C=n.slice(0,this._animIdx+1);C.push(x);var S=r.slice(0,this._animIdx+1);S.push(p),w?(this.setCoordinates([this._aniShowCenter].concat(C)),this._setPrjCoordinates([this._prjAniShowCenter].concat(S))):(this.setCoordinates(C),this._setPrjCoordinates(S))}return x},i._getCenterInExtent=function(t,e,i){var n=this.getExtent();if(!t.intersects(n))return null;var r=i(e,t);if(0===r.length)return null;var o=0,s=0,a=0;r.forEach(function(t){Array.isArray(t)?t.forEach(function(t){t.point&&(t=t.point),o+=t.x,s+=t.y,a++}):(t.point&&(t=t.point),o+=t.x,s+=t.y,a++)});var h=new tn(o,s)._multi(1/a);return h.count=a,h},i._getPath2DPoints=function(t,e,i){if(!kt(t))return[];var n=this.getMap(),r=!e&&this._shouldSimplify(),o=this.options.simplifyTolerance*n._getResolution(),s=Array.isArray(t[0]);if(delete this._simplified,r&&!s){var a=t.length;t=h()(t,o,!1),this._simplified=t.length<a}if(i||(i=n._getResolution()),Array.isArray(t)){var l=[];if(!Array.isArray(t[0]))return l=Vt(t,"_glPt"),n._prjsToPointsAtRes(t,i,l);for(var c=[],u=0,d=t.length;u<d;u++){var f=t[u];l=Vt(f,"_glPt");var _=n._prjsToPointsAtRes(f,i,l);c.push(_)}return c}return n._prjToPointAtRes(t,i)},i._shouldSimplify=function(){var t=this.getLayer(),e=this.getProperties(),i=e&&t.options.enableAltitude&&!y(e[t.options.altitudeProperty])&&0!==e[t.options.altitudeProperty];return t&&t.options.enableSimplify&&!i&&this.options.enableSimplify&&!this._showPlayer},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},i._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},i._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},i._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t):[]},i._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},i._computeCenter=function(){var t=this._coordinates;if(!kt(t))return null;for(var e=0,i=0,n=0,r=t.length,o=0;o<r;o++)t[o]&&x(t[o].x)&&x(t[o].y)&&(e+=t[o].x,i+=t[o].y,n++);return new tn(e/n,i/n)},i._computeExtent=function(){var t=this._coordinates;if(!kt(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},i._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},i._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,i=1,n=t.length;i<n;i++)e+=t[i].distanceTo(t[i-1]);return e},i._hitTestTolerance=function(){var t,e=this._getInternalSymbol();if(Array.isArray(e)){t=0;for(var i=0;i<e.length;i++)x(e[i].lineWidth)&&e[i].lineWidth>t&&(t=e[i].lineWidth)}else t=e.lineWidth;return x(t)?t/2:1.5},i._coords2Extent=function(t,e){if(!t||0===t.length||Array.isArray(t[0])&&0===t[0].length)return null;for(var i=new pn(e),n=0,r=t.length;n<r;n++)for(var o=0,s=t[n].length;o<s;o++)i._combine(t[n][o]);return i},e}(vo);Vo.mergeOptions({smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var Wo=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="Polygon",e&&n.setCoordinates(e),n}ct(e,t);var i=e.prototype;return i.getOutline=function(){return this._getPainter()?new e(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},i.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=tn.toCoordinates(t),i=e.length;if(Array.isArray(e[0])){if(this._coordinates=this._trimRing(e[0]),i>1){for(var n=[],r=1;r<i;r++)e[r]&&n.push(this._trimRing(e[r]));this._holes=n}}else this._coordinates=this._trimRing(e);return this._projectRings(),this},i.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],i=0,n=t.length;i<n;i++)e.push(this._copyAndCloseRing(t[i]));return e},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),Mr)},i.getShell=function(){return this._coordinates||[]},i.getHoles=function(){return this._holes||[]},i.hasHoles=function(){return this.getHoles().length>0},i._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},i._checkRing=function(t){if(this._cleanRing(t),!t||!kt(t))return!1;var e=t[t.length-1],i=!0;return t[0].x===e.x&&t[0].y===e.y||(i=!1),i},i._trimRing=function(t){var e=this._checkRing(t);return kt(t)&&e&&t.splice(t.length-1,1),t},i._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return kt(t)&&!e?(t.push(t[0].copy()),t):t},i._getPrjShell=function(){return"Polygon"===this.getJSONType()?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this.getShell())),this._prjShell)},i._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},i._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!kt(e))return 0;for(var i=0,n=0,r=e.length;n<r;n++)i+=t.measureLength(e[n]);return i},i._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!kt(e))return 0;for(var i=t.measureArea(e[0]),n=1,r=e.length;n<r;n++)i-=t.measureArea(e[n]);return i},i._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},i._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},i._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(Vo);function Zo(t){return function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){var e=t instanceof tn?t:new tn(t);if(e.equals(this._coordinates))return this;if(this._coordinates=e,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},i._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var i=this._getPrjCoordinates();return i?(t||(t=e._getResolution()),e._prjToPointAtRes(i,t)):null},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pcenter&&t&&this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter},i._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},i._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},i._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)}Wo.registerJSONType("Polygon");var qo=new gn,Yo=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="Point",e&&n.setCoordinates(e),n}ct(e,t);var i=e.prototype;return i.getOutline=function(){var t=this.getCoordinates(),i=this.getContainerExtent(),n=this.getMap().coordToContainerPoint(t);return new e(t,{symbol:{markerType:"square",markerWidth:i.getWidth(),markerHeight:i.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:i.xmin-(n.x-i.getWidth()/2),markerDy:i.ymin-(n.y-i.getHeight()/2)}})},i.setSymbol=function(){var e;delete this._fixedExtent;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.prototype.setSymbol).call.apply(e,[this].concat(n))},i._getSizeSymbol=function(t){for(var e,i={},n=!1,r=!1,o=0;o<Cr.length;o++){var s=t[Cr[o]];y(s)||(!n&&ee(s)&&(n=!0,r=!0),i[Cr[o]]=s)}for(var a=0;a<Sr.length;a++){var h=t[Sr[a]];y(h)||(!n&&ee(h)&&(n=!0),i[Sr[a]]=h)}return n?(e=be(i,this),r&&(e._dynamic=!0)):e=i,e},i._setExternSymbol=function(e){return this._symbol||delete this._fixedExtent,t.prototype._setExternSymbol.call(this,e)},i._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},i._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new gn,this._fixedExtent.set(null,null,null,null);var t=this._sizeSymbol;if(!t)return this._fixedExtent;var e=this.getLayer()&&this.getLayer().getRenderer(),i=e&&e.resources,n=this.getTextDesc();if(Array.isArray(t)){qo.set(0,0,0,0);for(var r=0;r<t.length;r++)t[r]&&this._fixedExtent._combine(vr(qo,t[r],i,n&&n[r]))}else this._fixedExtent=vr(this._fixedExtent,t,i,n);return this._fixedExtent},i._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&wr(t)},i._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(wr(t)||br(t)||xr(t))},i._containsPoint=function(e,i){var n=this.getContainerExtent();return i&&(n=n.expand(i)),!!n.contains(e)&&(!this.options.hitTestForEvent||t.prototype._containsPoint.call(this,e,i))},i._computeExtent=function(){return Qo.call(this,"getCenter")},i._computePrjExtent=function(){return Qo.call(this,"_getPrjCoordinates")},i._computeGeodesicLength=function(){return 0},i._computeGeodesicArea=function(){return 0},i._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new co(this).getSprite(t,e)},e}(Zo(vo));function Qo(t){var e=this[t]();return e?new pn(e,e,this._getProjection()):null}Yo.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1}),Yo.registerJSONType("Marker");var Ko=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="LineString",e&&n.setCoordinates(e),n}ct(e,t);var i=e.prototype;return i.getOutline=function(){return Wo.prototype.getOutline.call(this)},i.setCoordinates=function(t){return t?(this._coordinates=tn.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},i.getCoordinates=function(){return this._coordinates||[]},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),Er)},i._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},i._computeGeodesicArea=function(){return 0},e}(Vo);Ko.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),Ko.registerJSONType("LineString");var Xo=new gn,Jo=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="GeometryCollection",n.setGeometries(e),n}ct(e,t);var i=e.prototype;return i.getContainerExtent=function(t){var e=t||new gn;return this.forEach(function(t){e._combine(t.getContainerExtent(Xo))}),e},i.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),i=this._getSymbol(),n=this.config(),r=e.length-1;r>=0;r--)e[r]._initOptions(n),e[r]._setParent(this),e[r]._setEventParent(this),i&&e[r].setSymbol(i);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},i.getGeometries=function(){return this._geometries||[]},i.forEach=function(t,e){for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n]&&(e?t.call(e,i[n],n):t(i[n],n));return this},i.filter=function(t,i){if(!t)return new e;var n=[],r=C(t),o=r?t:he(t);return this.forEach(function(t){var e=r?t:ge(t);(i?o.call(i,e):o(e))&&n.push(t)},this),new e(n)},i.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach(function(t){t&&t.translate&&t.translate.apply(t,e)}),this},i.isEmpty=function(){return!kt(this.getGeometries())},i.remove=function(){return this.forEach(function(t){t._unbind()}),vo.prototype.remove.apply(this,arguments)},i.show=function(){return this.options.visible=!0,this.forEach(function(t){t.show()}),this},i.hide=function(){return this.options.visible=!1,this.forEach(function(t){t.hide()}),this},i.onConfig=function(t){this.forEach(function(e){e.config(t)})},i.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var i=[],n=!1;this.forEach(function(t){t.getSymbol()&&!n&&(n=!0),i.push(t.getSymbol())}),n&&(e={children:i})}return e},i.setSymbol=function(t){if(t&&t.children)this._symbol=null,this.forEach(function(e,i){e.setSymbol(t.children[i])});else{var e=this._prepareSymbol(t);this._symbol=e,this.forEach(function(t){t.setSymbol(e)})}return this.onSymbolChanged(),this},i._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach(function(e){e._setExternSymbol(t)}),this.onSymbolChanged(),this},i._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},i._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach(function(e){e._bindLayer(t)})},i._checkGeometries=function(t){if(t&&!Array.isArray(t)){if(t instanceof vo)return[t];throw new Error("The geometry added to collection is invalid.")}for(var e=0,i=t.length;e<i;e++)if(!this._checkGeo(t[e]))throw new Error("The geometry added to collection is invalid. Index: "+e);return t},i._checkGeo=function(t){return t instanceof vo},i._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach(function(t){t&&t._updateCache&&t._updateCache()})},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach(function(t){t._removePainter()})},i._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,i=0,n=0,r=this.getGeometries(),o=0,s=r.length;o<s;o++)if(r[o]){var a=r[o]._computeCenter(t);a&&(e+=a.x,i+=a.y,n++)}return 0===n?null:new tn(e/n,i/n)},i._containsPoint=function(t,e){if(this.isEmpty())return!1;for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)if(i[n]._containsPoint(t,e))return!0;return!1},i._computeExtent=function(t){return $o.call(this,t,"_computeExtent")},i._computePrjExtent=function(t){return $o.call(this,t,"_computePrjExtent")},i._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicLength(t));return i},i._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicArea(t));return i},i._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),i=0,n=e.length;i<n;i++)e[i]&&t.push(e[i]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},i._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e]&&t[e]._clearProjection()},i._getConnectPoints=function(){var t=this.getExtent();return[new tn(t.xmin,t.ymax),new tn(t.xmax,t.ymin),new tn(t.xmin,t.ymin),new tn(t.xmax,t.ymax)]},i._getExternalResources=function(){if(this.isEmpty())return[];for(var t,e,i=this.getGeometries(),n=[],r={},o=0,s=i.length;o<s;o++)if(i[o])for(var a=0,h=(t=Se(i[o]._getInternalSymbol())).length;a<h;a++)r[e=t[a].join()]||(n.push(t[a]),r[e]=1);return n},i.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n].startEdit(t);return this._editing=!0,this.hide(),setTimeout(function(){e.fire("editstart")},1),this},i.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},i.isEditing=function(){return!!this._editing},e}(vo);function $o(t,e){if(this.isEmpty())return null;for(var i=new pn,n=this.getGeometries(),r=0,o=n.length;r<o;r++)if(n[r]){var s=n[r][e](t);s&&i._combine(s)}return i}Jo.registerJSONType("GeometryCollection");var ts=function(t){function e(e,i,n,r){var o;return(o=t.call(this,null,r)||this).GeometryType=e,o.type=i,o._initData(n),o}ct(e,t);var i=e.prototype;return i.getCoordinates=function(){for(var t=[],e=this.getGeometries(),i=0,n=e.length;i<n;i++){var r=e[i];t.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return t},i.setCoordinates=function(t){for(var e=[],i=0,n=(t=t||[]).length;i<n;i++){var r=new this.GeometryType(t[i],this.config());e.push(r)}return this.setGeometries(e),this},i._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},i._checkGeo=function(t){return t instanceof this.GeometryType},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=tn.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e}(Jo),es=function(t){function e(e,i){return t.call(this,Yo,"MultiPoint",e,i)||this}return ct(e,t),e.prototype.findClosest=function(t){if(!t)return null;var e=null,i=1/0;return this.getCoordinates().forEach(function(n){var r,o,s,a,h=(r=n,s=(o=t).x-r.x,a=o.y-r.y,Math.sqrt(s*s+a*a));h<i&&(e=n,i=h)}),e},e}(ts);es.registerJSONType("MultiPoint");var is=function(t){function e(){return t.apply(this,arguments)||this}return ct(e,t),e.prototype.getCenterInExtent=function(t){var e=0,i=0,n=0;return this.getGeometries().forEach(function(r){var o=r.getCenterInExtent(t);o&&(e+=o.x*o.count,i+=o.y*o.count,n+=o.count)}),0===n?null:new tn(e,i)._multi(1/n)},e}(ts),ns=function(t){function e(e,i){return t.call(this,Ko,"MultiLineString",e,i)||this}return ct(e,t),e}(is);ns.registerJSONType("MultiLineString");var rs=function(t){function e(e,i){return t.call(this,Wo,"MultiPolygon",e,i)||this}return ct(e,t),e}(is);rs.registerJSONType("MultiPolygon");var os={Marker:Yo,LineString:Ko,Polygon:Wo,MultiPoint:es,MultiLineString:ns,MultiPolygon:rs},ss={toGeometry:function(t,e){if(A(t)&&(t=xt(t)),Array.isArray(t)){for(var i=[],n=0,r=t.length;n<r;n++){var o=ss._convert(t[n],e);Array.isArray(o)?wt(i,o):i.push(o)}return i}return ss._convert(t,e)},_convert:function(t,e){if(!t||y(t.type))return null;var i=t.type;if("Feature"===i){var n=t.geometry,r=ss._convert(n);return r?(r.setId(t.id),r.setProperties(t.properties),e&&e(r),r):null}if("FeatureCollection"===i){var o=t.features;return o?ss.toGeometry(o,e):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(i)>=0){var s=new os["Point"===i?"Marker":i](t.coordinates);return e&&e(s),s}if("GeometryCollection"===i){var a=t.geometries;if(!kt(a)){var h=new Jo;return e&&e(h),h}for(var l=[],c=a.length,u=0;u<c;u++)l.push(ss._convert(a[u]));var d=new Jo(l);return e&&e(d),d}return null}},as=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,e&&r.setCoordinates(e),r._radius=i,r}ct(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.radius,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getRadius=function(){return this._radius},i.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getRadius(),a=[],h=0,l=o-1;h<l;h++){t=360*h/l*Math.PI/180,e=s*Math.cos(t),i=s*Math.sin(t);var c=n.locate(r,e,i);a.push(c)}return a.push(a[0]),a},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,i){var n=this.getMap();if(n.getPitch())return t.prototype._containsPoint.call(this,e,i);var r=n._pointToContainerPoint(this._getCenter2DPoint()),o=this.getSize(),s=y(i)?this._hitTestTolerance():i;return Rr(e,r,r.add(o.width/2,o.height/2),s)},i._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var i=this._getPrjCoordinates(),n=e.map(function(e){return t.project(e)}),r=n[0].x-i.x,o=n[1].x-i.x,s=n[2].y-i.y,a=n[3].y-i.y;return new pn(i.add(r,s),i.add(o,a))},i._computeExtent=function(t){var e=this._getMinMax(t);return e?new pn(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},i._getMinMax=function(t){if(!t||!this._coordinates||y(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},i._computeGeodesicLength=function(){return y(this._radius)?0:2*Math.PI*this._radius},i._computeGeodesicArea=function(){return y(this._radius)?0:Math.PI*Math.pow(this._radius,2)},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:tn.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=this.getCenter(),i=v({},t);i.geometry=!1;var n=this.toGeoJSON(i);return n.geometry={type:"Polygon"},{feature:n,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},e}(Zo(Wo));as.mergeOptions({numberOfShellPoints:60}),as.registerJSONType("Circle");var hs=function(t){function e(e,i,n,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o.width=i,o.height=n,o}ct(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getWidth=function(){return this.width},i.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},i.getHeight=function(){return this.height},i.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n,r=this._getMeasurer(),o=this.getCoordinates(),s=this.options.numberOfShellPoints,a=this.getWidth(),h=this.getHeight(),l=[],c=Math.pow(a/2,2)*Math.pow(h/2,2),u=Math.pow(a/2,2),d=Math.pow(h/2,2),f=0;f<s;f++){e=(t=360*f/s)*Math.PI/180,i=Math.sqrt(c/(u*Math.pow(Math.tan(e),2)+d)),n=Math.sqrt(c/(d*Math.pow(1/Math.tan(e),2)+u)),t>90&&t<270&&(i*=-1),t>180&&t<360&&(n*=-1);var _=r.locate(o,i,n);l.push(_)}return l},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=n.getProjection(),o=y(i)?this._hitTestTolerance():i,s=r.projectCoords([this._coordinates,n.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)]);return Rr(e,n._prjToContainerPoint(s[0]),n._prjToContainerPoint(s[1]),o)},i._computePrjExtent=function(){return as.prototype._computePrjExtent.apply(this,arguments)},i._computeExtent=function(){return as.prototype._computeExtent.apply(this,arguments)},i._getMinMax=function(t){if(!t||!this._coordinates||y(this.width)||y(this.height))return null;var e=this.getWidth(),i=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-i/2),t.locate(this._coordinates,0,i/2)]},i._computeGeodesicLength=function(){if(y(this.width)||y(this.height))return 0;var t=this.width>this.height?this.width:this.height;return 2*Math.PI*t/2-4*Math.abs(this.width-this.height)},i._computeGeodesicArea=function(){return y(this.width)||y(this.height)?0:Math.PI*this.width*this.height/4},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:tn.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=v({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Ellipse",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},e}(Zo(Wo));hs.mergeOptions({numberOfShellPoints:80}),hs.registerJSONType("Ellipse");var ls=function(t){function e(e,i,n,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o._width=i,o._height=n,o}ct(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){if(this._coordinates=t instanceof tn?t:new tn(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},i.getShell=function(){var t=this._getMeasurer(),e=this._coordinates,i=this.getMap(),n=1,r=-1;if(i){var o=i.getFullExtent();o.left>o.right&&(n=-1),o.bottom>o.top&&(r=1)}var s=[];return s.push(e),s.push(t.locate(e,n*this._width,0)),s.push(t.locate(e,n*this._width,r*this._height)),s.push(t.locate(e,0,r*this._height)),s.push(e),s},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},i._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},i._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this),i=this._getProjection();if(!i.isSphere())return e;for(var n=i.getSphereExtent(),r=n.sx,o=n.sy,s=this._getProjection().getCircum(),a=e[0],h=1,l=e.length;h<l;h++){var c=e[h],u=0,d=0;r*(a.x-c.x)>0&&(u=s.x*r),o*(a.y-c.y)<0&&(d=s.y*o),e[h]._add(u,d)}return e},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},i._clearProjection=function(){this._pnw=null,t.prototype._clearProjection.call(this)},i._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=y(i)?this._hitTestTolerance():i,o=n._getResolution()*r,s=this._getPrjExtent().expand(o),a=n._containerPointToPrj(e);return s.contains(a)},i._computePrjExtent=function(t){var e=this._getSouthEast(t);if(!e)return null;var i=t.projectCoords([new tn(this._coordinates.x,e.y),new tn(e.x,this._coordinates.y)]);return new pn(i[0],i[1])},i._computeExtent=function(t){var e=this._getSouthEast(t);return e?new pn(this._coordinates,e,this._getProjection()):null},i._getSouthEast=function(t){if(!t||!this._coordinates||y(this._width)||y(this._height))return null;var e=this.getWidth(),i=-this.getHeight();if(t.fullExtent){var n=t.fullExtent;e*=n.right>n.left?1:-1,i*=n.top>n.bottom?1:-1}var r=t.locate(this._coordinates,e,0),o=t.locate(this._coordinates,0,i);return r.y=o.y,r},i._computeGeodesicLength=function(){return y(this._width)||y(this._height)?0:2*(this._width+this._height)},i._computeGeodesicArea=function(){return y(this._width)||y(this._height)?0:this._width*this._height},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:tn.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=v({},t),i=this.getCoordinates();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Rectangle",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},e}(Wo);ls.registerJSONType("Rectangle");var cs=function(t){function e(e,i,n,r,o){var s;return(s=t.call(this,e,i,o)||this).startAngle=n,s.endAngle=r,s}ct(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getStartAngle=function(){return this.startAngle},i.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},i.getEndAngle=function(){return this.endAngle},i.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints-2,s=this.getRadius(),a=[r.copy()],h=this.getStartAngle(),l=this.getEndAngle()-h,c=0;c<o;c++){t=(l*c/(o-1)+h)*Math.PI/180,e=s*Math.cos(t),i=s*Math.sin(t);var u=n.locate(r,e,i);a.push(u)}return a.push(r.copy()),a},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=n._pointToContainerPoint(this._getCenter2DPoint()),o=y(i)?this._hitTestTolerance():i,s=this.getSize(),a=r,h=e,l=h.x-a.x,c=a.y-h.y,u=Math.atan2(c,l),d=u<0?360*(u+2*Math.PI)/(2*Math.PI):360*u/(2*Math.PI),f=this.startAngle%360,_=this.endAngle%360,p=!1;return p=f>_?!(d>_&&d<f):d>=f&&d<=_,h.distanceTo(a)<=s.width/2+o&&p},i._computeGeodesicLength=function(){return y(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},i._computeGeodesicArea=function(){return y(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},i._toJSON=function(t){var e=v({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Sector",coordinates:[i.x,i.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},e}(as);cs.mergeOptions({numberOfShellPoints:60}),cs.registerJSONType("Sector");var us=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i._arc=function(t,e,i){for(var n=this.options.arcDegree*Math.PI/180,r=1,o=e.length;r<o;r++){var s=ji._arcBetween(t,e[r-1],e[r],n),a=[e[r-1].x+e[r].x-s[0],e[r-1].y+e[r].y-s[1]];e[r-1].nextCtrlPoint=a,e[r].prevCtrlPoint=a,ji._stroke(t,i)}},i._quadraticCurve=function(t,e){if(e.length<=2)ji._path(t,e);else{var i,n;for(i=2,n=e.length;i<n;i+=2)t.quadraticCurveTo(e[i-1].x,e[i-1].y,e[i].x,e[i].y);if((i-=1)<n)for(;i<n;i++)t.lineTo(e[i].x,e[i].y)}},i._bezierCurve=function(t,e){if(e.length<=3)ji._path(t,e);else{var i,n;for(i=1,n=e.length;i+2<n;i+=3)t.bezierCurveTo(e[i].x,e[i].y,e[i+1].x,e[i+1].y,e[i+2].x,e[i+2].y);if(i<n)for(;i<n;i++)t.lineTo(e[i].x,e[i].y)}},i._getCurveArrowPoints=function(t,e,i,n,r,o){var s,a=e.length;for(s=o;s<a;s+=o){var h=this._getArrowShape(e[s-1],e[s],i,n,r);h&&t.push(h)}if((s-=o)<a-1)for(s+=1;s<a;s++){var l=this._getArrowShape(e[s-1],e[s],i,n,r);l&&t.push(l)}},e}(Ko);us.mergeOptions({enableSimplify:!1,enableClip:!1});var ds=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},i._paintOn=function(t,e,i){t.beginPath(),this._arc(t,e,i),ji._stroke(t,i),this._paintArrow(t,e,i)},e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n},e}(us);ds.registerJSONType("ArcCurve"),ds.mergeOptions({arcDegree:90});var fs=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},i._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),ji._stroke(t,i),this._paintArrow(t,e,i)},i._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,3)},e}(us);fs.registerJSONType("CubicBezierCurve");var _s=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},i._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,i),ji._stroke(t,i),this._paintArrow(t,e,i)},i._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,2)},e}(us);_s.registerJSONType("QuadBezierCurve");var ps={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},ms={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},gs=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.getContent=function(){return this._content},i.setContent=function(t){var e=this._content;return this._content=Re(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},i.onAdd=function(){this._refresh()},i.toJSON=function(){var e=t.prototype.toJSON.call(this);return delete e.symbol,e},i.setSymbol=function(e){if(this._refreshing||!e)return t.prototype.setSymbol.call(this,e);var i=this._parseSymbol(e);if(this.setTextStyle){var n=this.getTextStyle()||{};n.symbol=i[0],this.setTextStyle(n)}else this.setTextSymbol&&this.setTextSymbol(i[0]);if(this.setBoxStyle){var r=this.getBoxStyle()||{};r.symbol=i[1],this.setBoxStyle(r)}else this.setBoxSymbol&&this.setBoxSymbol(i[1]);return this},i._parseSymbol=function(t){var e={},i={};for(var n in t)E(t,n)&&(0===n.indexOf("text")?e[n]=t[n]:i[n]=t[n]);return[e,i]},i._getTextSize=function(t){return He(this._content,t).size},i._getInternalSymbol=function(){return this._symbol},i._getDefaultTextSymbol=function(){return v({},ps)},i._getDefaultBoxSymbol=function(){return v({},ms)},i._getDefaultPadding=function(){return[12,8]},e}(Yo),vs=function(t){function e(e,i,n,r,o){var s;return void 0===o&&(o={}),(s=t.call(this,i,o)||this)._content=Re(e),s._width=y(n)?100:n,s._height=y(r)?40:r,o.boxSymbol&&s.setBoxSymbol(o.boxSymbol),o.textStyle&&s.setTextStyle(o.textStyle),s._refresh(),s}ct(e,t);var i=e.prototype;return i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this._refresh(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this._refresh(),this},i.getBoxSymbol=function(){return v({},this.options.boxSymbol)},i.setBoxSymbol=function(t){return this.options.boxSymbol=t?v({},t):t,this.getSymbol()&&this._refresh(),this},i.getTextStyle=function(){return this.options.textStyle?v({},this.options.textStyle):null},i.setTextStyle=function(t){return this.options.textStyle=t?v({},t):t,this.getSymbol()&&this._refresh(),this},e.fromJSON=function(t){var i=t.feature,n=new e(t.content,i.geometry.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n.setId(i.id),t.symbol&&n.setSymbol(t.symbol),n},i._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},i._refresh=function(){var t=this.getTextStyle()||{},e=t.padding||[12,8],i=this._width-2*e[0],n=this._height-2*e[1],r=v({},t.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:i,textMaxHeight:n});t.wrap&&!r.textWrapWidth&&(r.textWrapWidth=i);var o=t.horizontalAlignment;r.textDx=r.markerDx||0;var s=r.markerWidth/2-e[0];"left"===o?(r.textHorizontalAlignment="right",r.textDx=r.textDx-s):"right"===o&&(r.textHorizontalAlignment="left",r.textDx=r.textDx+s);var a=t.verticalAlignment;r.textDy=r.markerDy||0;var h=r.markerHeight/2-e[1];"top"===a?(r.textVerticalAlignment="bottom",r.textDy-=h):"bottom"===a&&(r.textVerticalAlignment="top",r.textDy+=h),this._refreshing=!0,this.updateSymbol(r),delete this._refreshing},e}(gs);vs.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),vs.registerJSONType("TextBox");var ys=function(t){function e(e,i,n){var r;return void 0===n&&(n={}),r=t.call(this,i,n)||this,n.textSymbol&&r.setTextSymbol(n.textSymbol),n.boxStyle&&r.setBoxStyle(n.boxStyle),r._content=Re(e),r._refresh(),r}ct(e,t);var i=e.prototype;return i.getBoxStyle=function(){return this.options.boxStyle?v({},this.options.boxStyle):null},i.setBoxStyle=function(t){return this.options.boxStyle=t?v({},t):t,this._refresh(),this},i.getTextSymbol=function(){return v({},this._getDefaultTextSymbol(),this.options.textSymbol)},i.setTextSymbol=function(t){return this.options.textSymbol=t?v({},t):t,this._refresh(),this},e.fromJSON=function(t){var i=t.feature,n=new e(t.content,i.geometry.coordinates,t.options);return n.setProperties(i.properties),n.setId(i.id),t.symbol&&n.setSymbol(t.symbol),n},i._canEdit=function(){return!1},i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},i._refresh=function(){var t=v({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){v(t,e.symbol);var i=this._getBoxSize(t),n=i[1],r=e.padding||this._getDefaultPadding(),o=i[0];t.markerWidth=o.width,t.markerHeight=o.height;var s=t.textDx||0,a=t.textDy||0,h=Ne(n,t.textHorizontalAlignment,t.textVerticalAlignment)._add(s,a),l=e.horizontalAlignment||"middle";t.markerDx=h.x,"left"===l?t.markerDx+=t.markerWidth/2-r[0]:"right"===l?t.markerDx-=t.markerWidth/2-n.width-r[0]:t.markerDx+=n.width/2;var c=e.verticalAlignment||"middle";t.markerDy=h.y,"top"===c?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===c?t.markerDy-=t.markerHeight/2-n.height-r[1]:t.markerDy+=n.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},i._getBoxSize=function(t){t.markerType||(t.markerType="square");var e,i,n=this.getBoxStyle(),r=this._getTextSize(t),o=n.padding||this._getDefaultPadding();return e=r.width+2*o[0],i=r.height+2*o[1],n.minWidth&&(!e||e<n.minWidth)&&(e=n.minWidth),n.minHeight&&(!i||i<n.minHeight)&&(i=n.minHeight),[new Me(e,i),r]},e}(gs);ys.mergeOptions({boxStyle:null,textSymbol:null}),ys.registerJSONType("Label");var xs=function(t){return function(t){function e(){return t.apply(this,arguments)||this}ct(e,t),e._hasConnectors=function(t){return!y(t.__connectors)&&t.__connectors.length>0},e._getConnectors=function(t){return t.__connectors};var i=e.prototype;return i.getConnectSource=function(){return this._connSource},i.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},i.getConnectTarget=function(){return this._connTarget},i.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},i._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e,i,n=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),o=0,s=this.getCoordinates(),a=0,h=n.length;a<h;a++)for(var l=n[a],c=0,u=r.length;c<u;c++){var d=r[c],f=t.computeLength(l,d);0===a&&0===c?(e=l,i=d,o=f):f<o&&(e=l,i=d)}kt(s)&&s[0].equals(e)&&s[1].equals(i)||this.setCoordinates([e,i])}},i.onAdd=function(){this._registerEvents(),this._updateCoordinates()},i.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&bt(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(bt(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof vo&&this._connTarget instanceof vo)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},i._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},i._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof vo&&this._connTarget instanceof vo)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},ws={showOn:"always"},bs=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,1===arguments.length&&(n=e,e=null,i=null),r._connSource=e,r._connTarget=i,r}return ct(e,t),e}(xs(Ko));bs.mergeOptions(ws),bs.registerJSONType("ConnectorLine");var As=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,1===arguments.length&&(n=e,e=null,i=null),r._connSource=e,r._connTarget=i,r}return ct(e,t),e}(xs(ds));As.mergeOptions(ws),As.registerJSONType("ArcConnectorLine");var Cs=function(t){function e(e,i,n){var r;i&&!(i instanceof vo)&&!Array.isArray(i)&&u.indexOf(i.type)<0&&(n=i,i=null),(r=t.call(this,e,n)||this)._maxZIndex=0,r._minZIndex=0,r._initCache(),i&&r.addGeometry(i);var o=r.options.style;return o&&r.setStyle(o),r}ct(e,t);var i=e.prototype;return i.getGeometryById=function(t){return y(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},i.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var i,n=[],r=0,o=this._geoList.length;r<o;r++)i=this._geoList[r],(e?t.call(e,i):t(i))&&n.push(i);return n},i.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},i.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},i.getCount=function(){return this._geoList.length},i.getExtent=function(){if(0===this.getCount())return null;var t=new pn(this.getProjection());return this.forEach(function(e){t._combine(e.getExtent())}),t},i.forEach=function(t,e){for(var i=this._geoList.slice(0),n=0,r=i.length;n<r;n++)e?t.call(e,i[n],n):t(i[n],n);return this},i.filter=function(t,e){var i=[],n=C(t),r=n?t:he(t);return this.forEach(function(t){var o=n?t:ge(t);(e?r.call(e,o):r(o))&&i.push(t)},this),i},i.isEmpty=function(){return!this._geoList.length},i.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(ss.toGeometry(t),e);if(!Array.isArray(t)){var i=arguments.length,n=arguments[i-1];return t=Array.prototype.slice.call(arguments,0,i-1),e=n,n&&b(n)&&("type"in n||n instanceof vo)&&(t.push(n),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;var r;this._initCache(),e&&(r=new pn),this._toSort=this._maxZIndex>0;for(var o=[],s=0,a=t.length;s<a;s++){var h=t[s];if(!h)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+s);if(!(h instanceof vo)&&(h=vo.fromJSON(h),Array.isArray(h)))for(var l=0,c=h.length;l<c;l++)this._add(h[l],r,s),o.push(h[l]);Array.isArray(h)||(this._add(h,r,s),o.push(h))}var u=this.getMap();if(u&&(this._getRenderer().onGeometryAdd(o),r&&!y(r.xmin))){var d=r.getCenter(),f=u.getFitZoom(r);if(b(e)){var _=C(e.step)?e.step:function(){};u.animateTo({center:d,zoom:f},v({duration:u.options.zoomAnimationDuration,easing:"out"},e),_)}else!0===e&&u.setCenterAndZoom(d,f)}return this.fire("addgeo",{geometries:t}),this},i.getGeoMinZIndex=function(){return this._minZIndex},i.getGeoMaxZIndex=function(){return this._maxZIndex},i._add=function(t,e,i){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var n=t.getId();if(!y(n)){if(!y(this._geoMap[n]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+n+", at index:"+i);this._geoMap[n]=t}var r=yt();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},i.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof vo||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},i.clear=function(){this._clearing=!0,this.forEach(function(t){t.remove()}),this._geoMap={};var t=this._geoList;this._geoList=[];var e=this._getRenderer();return e&&(e.onGeometryRemove(t),e.clearImageData&&e.clearImageData()),this._clearing=!1,this.fire("clear"),this},i.onRemoveGeometry=function(t){if(t&&!this._clearing&&(this===t.getLayer()&&!y(t._getInternalId()))){var e=t.getId();y(e)||delete this._geoMap[e];var i=this._findInList(t);i>=0&&this._geoList.splice(i,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},i.getStyle=function(){return this.options.style?this.options.style:null},i.setStyle=function(t){return this.options.style=t,t=Ke(t),this._cookedStyles=ve(t),this.forEach(function(t){this._styleGeometry(t)},this),this.fire("setstyle",{style:t}),this},i._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=ge(t),i=0,n=this._cookedStyles.length;i<n;i++)if(!0===this._cookedStyles[i].filter(e))return t._setExternSymbol(this._cookedStyles[i].symbol),!0;return!1},i.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach(function(t){t._setExternSymbol(null)},this),this.fire("removestyle"),this):this},i.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},i.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return xo.prototype.hide.call(this)},i._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},i._updateZIndex=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},i._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort(function(e,i){return t._updateZIndex(e.getZIndex(),i.getZIndex()),t._compare(e,i)}),this._toSort=!1)},i._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},i._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;this._sortGeometries();for(var i,n=0,r=e-1;n<=r;){if(i=Math.floor((n+r)/2),this._geoList[i]===t)return i;this._compare(this._geoList[i],t)>0?r=i-1:n=i+1}return-1},i._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},i._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!y(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}y(t.old)||t.new===t.old||delete this._geoMap[t.old]}},i._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},i._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},i._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},i._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},i._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},i._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},i._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},e}(xo);Cs.mergeOptions({drawImmediate:!1});var Ss=new gn,Es={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:lt.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3},Ps=function(t){function e(e,i,n){return t.call(this,e,i,n)||this}ct(e,t);var i=e.prototype;return i.onConfig=function(e){if(t.prototype.onConfig.call(this,e),e.enableAltitude||e.drawAltitude||e.altitudeProperty){var i=this.getRenderer();i&&i.setToRedraw&&i.setToRedraw()}},i.identify=function(t,e){void 0===e&&(e={});var i=this.getRenderer();t instanceof tn||(t=new tn(t));var n=this.getMap().coordToContainerPoint(t);return e.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(n,e):this._hitGeos(this._geoList,n,e)},i.identifyAtPoint=function(t,e){void 0===e&&(e={});var i=this.getRenderer();return t instanceof pt||(t=new pt(t)),e.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(t,e):this._hitGeos(this._geoList,t,e)},i._hitGeos=function(t,e,i){void 0===i&&(i={});var n=i.filter,r=i.tolerance,o=[],s=this.getMap(),a=this.getRenderer(),h=a&&a.getImageData&&a.getImageData();if(h){var l=s.getDevicePixelRatio();h.r=l;var c=Math.round(e.x*l),u=Math.round(e.y*l)*h.width*4+4*c;if(0===h.data[u+3])return o}for(var d=t.length-1;d>=0;d--){var f=t[d];if(f&&f.isVisible()&&f._getPainter()&&f.options.interactive){if(!(f instanceof Ko&&(f._getArrowStyle()||f instanceof us))){var _=f.getContainerExtent(Ss);if(r&&(_=_._expand(r)),!_||!_.contains(e))continue}if(f._containsPoint(e,r)&&(!n||n(f))&&(o.push(f),i.count&&o.length>=i.count))break}}return o},i.getAltitude=function(){return this.options.altitude||0},i.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(y(t.geometries)||t.geometries){var i;if(t.clipExtent){var n=this.getMap(),r=n?n.getProjection():null;i=new pn(t.clipExtent,r)}for(var o=[],s=this.getGeometries(),a=0,h=s.length;a<h;a++){var l=s[a],c=l.getExtent();if(c&&(!i||i.intersects(c))){var u=l.toJSON(t.geometries);o.push(u)}}e.geometries=o}return e},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var i=new e(t.id,t.options),n=t.geometries,r=[],o=0;o<n.length;o++){var s=vo.fromJSON(n[o]);s&&r.push(s)}return i.addGeometry(r),i},e.getPainterClass=function(){return co},e.getCollectionPainterClass=function(){return fo},e}(Cs);Ps.mergeOptions(Es),Ps.registerJSONType("VectorLayer");var Ms="_map_tool",Ts=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.addTo=function(t){return t?(this._map=t,t[Ms]&&t[Ms].disable(),this.onAdd&&this.onAdd(),this.enable(),t[Ms]=this,this._fireEvent("add"),this):this},i.getMap=function(){return this._map},i.enable=function(){return!this._map||this._enabled?this:(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable"),this)},i.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},i.isEnabled=function(){return!!this._enabled},i.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[Ms],delete this._map),this._fireEvent("remove"),this):this},i._registerEvents=function(){this._switchEvents("on")},i._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},i._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(Hi(Wi)),ks={},Rs=function(t){function e(e){var i;return(i=t.call(this,e)||this)._checkMode(),i._events={click:i._clickHandler,"mousemove touchmove":i._mouseMoveHandler,dblclick:i._doubleClickHandler,"mousedown touchstart":i._mouseDownHandler,"mouseup touchend":i._mouseUpHandler,mousemove:i._mouseMoveHandler,mousedown:i._mouseDownHandler,mouseup:i._mouseUpHandler},i}ct(e,t),e.registerMode=function(t,e){ks[t.toLowerCase()]=e},e.getRegisterMode=function(t){return ks[t.toLowerCase()]};var i=e.prototype;return i.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},i.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},i.getSymbol=function(){var t=this.options.symbol;return Qe(t||this.options.symbol)},i.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},i.getCurrentGeometry=function(){return this._geometry},i.onAdd=function(){this._checkMode()},i.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var t=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})),this._geometryEvents=t.options.geometryEvents,this.options.blockGeometryEvents&&t.config("geometryEvents",!1),this},i.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw(),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&t.config("geometryEvents",this._geometryEvents),this},i.undo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||!this._historyPointer)return this;var i=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),i,this._geometry),this},i.redo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||y(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var i=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),i,this._geometry),this},i._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},i._checkMode=function(){this._getRegisterMode()},i._saveMapCfg=function(){var t=this.getMap();this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom});for(var e=this._getRegisterMode().action,i=!1,n=0;n<e.length;n++)if(e[n].indexOf("mousedown")>=0||e[n].indexOf("touchstart")>=0){i=!0;break}if(i){var r=this.getMap();this._mapDraggable=r.options.draggable,r.config({draggable:!1})}},i._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),y(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},i._loadResources=function(){var t=Se(this.getSymbol());t.length>0&&this._drawToolLayer._getRenderer().loadResources(t)},i._getProjection=function(){return this._map.getProjection()},i._getRegisterMode=function(){var t=this.getMode(),i=e.getRegisterMode(t);if(!i)throw new Error(t+" is not a valid mode of DrawTool.");return i},i.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var i=0;i<t.length;i++)e[t[i]]=this._events[t[i]];return e}return null},i._mouseDownHandler=function(t){this._createGeometry(t)},i._mouseUpHandler=function(t){this.endDraw(t)},i._clickHandler=function(t){var e=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var i=this._clickCoords.length,n=this.getMap()._pointToPrj(t.point2d);if(this._clickCoords[i-1].equals(n))return}if(this._geometry){var r=this.getMap()._pointToPrj(t.point2d);y(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._clickCoords.push(r),this._historyPointer=this._clickCoords.length,t.drawTool=this,e.update(this.getMap().getProjection(),this._clickCoords,this._geometry,t),this._clickCoords.length<=1?this._fireEvent("drawstart",t):this._fireEvent("drawvertex",t),e.clickLimit&&e.clickLimit===this._historyPointer&&this.endDraw(t)}else this._createGeometry(t)},i._createGeometry=function(t){var e=this.getMode(),i=this._getRegisterMode(),n=this.getMap()._pointToPrj(t.point2d),r=this.getSymbol();this._geometry||(this._clickCoords=[n],t.drawTool=this,this._geometry=i.create(this.getMap().getProjection(),this._clickCoords,t),r&&"point"!==e?this._geometry.setSymbol(r):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t)),"point"===e&&this.endDraw(t)},i._mouseMoveHandler=function(t){var e=this.getMap();if(this._geometry&&e&&!e.isInteracting()){var i=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(i)){var n=this.getMap()._pointToPrj(t.point2d),r=e.getProjection();t.drawTool=this;var o=this._getRegisterMode();if(this._shouldRecordHistory(o.action)){var s=this._clickCoords.slice(0,this._historyPointer);if(s&&s.length>0&&n.equals(s[s.length-1]))return;o.update(r,s.concat([n]),this._geometry,t)}else o.update(r,n,this._geometry,t);this._fireEvent("mousemove",t)}}},i._doubleClickHandler=function(t){if(this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var i=this._getRegisterMode(),n=this._clickCoords;if(!(n.length<2)){var r=this.getMode();if(!(r&&r.indexOf("polygon")>-1&&n.length<3)){for(var o=this.getMap().getProjection(),s=[n[0]],a=1,h=n.length;a<h;a++)n[a].x===n[a-1].x&&n[a].y===n[a-1].y||s.push(n[a]);s.length<2||this._geometry&&this._geometry instanceof Wo&&s.length<3||(t.drawTool=this,i.update(o,s,this._geometry,t),this.endDraw(t))}}}}},i._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},i.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this},i._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},i._getMouseContainerPoint=function(t){var e=this._getRegisterMode().action;return(e[0].indexOf("mousedown")>=0||e[0].indexOf("touchstart")>=0)&&fi(t.domEvent),t.containerPoint},i._isValidContainerPoint=function(t){var e=this._map.getSize(),i=e.width,n=e.height;return!(t.x<0||t.y<0)&&!(t.x>i||t.y>n)},i._getDrawLayer=function(){var t="_maptalks__internal_layer_drawtool",e=this._map.getLayer(t);return e||(e=new Ps(t,{enableSimplify:!1}),this._map.addLayer(e)),e},i._fireEvent=function(t,e){e||(e={}),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this})),Ts.prototype._fireEvent.call(this,t,e)},e}(Ts);Rs.mergeOptions({symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1});var Ls=function(t){function e(e){var i;return(i=t.call(this,e)||this).drawTool=new Rs({mode:"boxZoom",ignoreMouseleave:!1}),i}ct(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},i.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},i._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},i._boxZoom=function(t){var e=this.target;this.drawTool.remove();var i=t.geometry,n=i.getCenter(),r=i.getSymbol(),o=r.markerWidth,s=r.markerHeight,a=new pn(n,e.locateByPoint(n,o,s),e.getProjection()),h=e.getFitZoom(a);e._animateTo({center:a.getCenter(),zoom:h})},e}(Vi);ko.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),ko.addOnLoadHook("addHandler","boxZoom",Ls);var Ds=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},i.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},i._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var i=t.containerPoint,n=e.getContainerExtent();if(n){var r,o=i.x,s=i.y,a=n.xmax,h=n.ymax;o<30&&(r=[Math.abs(o-30),0]),s<30&&(r=[0,Math.abs(s-30)]),o+30>a&&(r=[-Math.abs(o+30-a),0]),s+30>h&&(r=[0,-Math.abs(s+30-h)]),r&&e.panBy(r,{duration:1})}}},e}(Vi);function Os(t,e,i){return t*(1-i)+e*i}ko.mergeOptions({autoPanAtEdge:!1}),ko.addOnLoadHook("addHandler","autoPanAtEdge",Ds),ko.include({animateTo:function(t,e,i){var n=this;void 0===e&&(e={}),C(e)&&(i=e,e={});var r=this.getProjection(),o=this.getView(),s={},a=!0;for(var h in t)if(E(t,h)&&!y(t[h])&&("prjCenter"===h||!y(o[h])))if(a=!1,"center"===h){var l=new tn(o[h]).toFixed(7),c=new tn(t[h]).toFixed(7);l.equals(c)||(s.center=[l,c])}else if("prjCenter"===h){var u=new tn(this._getPrjCenter()),d=new tn(t[h]);u.equals(d)||(s.prjCenter=[u,d])}else o[h]!==t[h]&&"around"!==h&&(s[h]=[o[h],t[h]]);if(a)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var f=t.around||new pt(this.width/2,this.height/2),_=this._getRenderer(),p=this._animPlayer=Ho.animate(s,{easing:e.easing||"out",duration:e.duration||this.options.zoomAnimationDuration,framer:function(t){_.callInNextFrame(t)}},function(t){if(n.isRemoved())p.finish();else{if("running"===p.playState){if(t.styles.center){var o=t.styles.center;n._setPrjCenter(r.project(o)),n.onMoving(n._parseEventFromCoord(n.getCenter()))}else if(t.styles.prjCenter){var a=t.styles.prjCenter;n._setPrjCenter(a),n.onMoving(n._parseEventFromCoord(n.getCenter()))}y(t.styles.zoom)||n.onZooming(t.styles.zoom,f),y(t.styles.pitch)||n._setPitch(t.styles.pitch),y(t.styles.bearing)||n._setBearing(t.styles.bearing),n._fireEvent("animating")}else"paused"===p.playState&&p!==n._mapAnimPlayer||(p._interupted||(s.center?n._setPrjCenter(r.project(s.center[1])):s.prjCenter&&n._setPrjCenter(s.prjCenter[1]),y(s.pitch)||n._setPitch(s.pitch[1]),y(s.bearing)||n._setBearing(s.bearing[1])),n._endAnim(p,s,f,e));i&&i(t)}},this);return this._startAnim(s,f),p},_animateTo:function(t,e,i){return void 0===e&&(e={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,e,i),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(t,e,i){var n=this;void 0===e&&(e={}),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),C(e)&&(i=e,e={}),e=v({curve:1.42},e);var r=this;function o(t,e){return r.getResolution(e)/r.getResolution(t)}var s=t.around||new pt(this.width/2,this.height/2),a=this.getMinZoom(),h=this.getMaxZoom(),l=this.getProjection(),c=this.getView(),u=c.zoom,d=c.bearing,f=c.pitch,_="zoom"in t?Tt(+t.zoom,a,h):u,p="bearing"in t?+t.bearing:d,m="pitch"in t?+t.pitch:f,g=l.project(t.center&&new tn(t.center)||this.getCenter()),y=o(_,u),x=l.project(this.getCenter()),w=g.sub(x),b=e.curve,A=Math.max(this.width,this.height),S=A/y,E=w.mag();if("minZoom"in e){var P=Tt(Math.min(e.minZoom,u,_),a,h),M=A/o(P,u);b=Math.sqrt(M/E*2)}var T=b*b;function k(t){var e=(S*S-A*A+(t?-1:1)*T*T*E*E)/(2*(t?S:A)*T*E);return Math.log(Math.sqrt(e*e+1)-e)}function R(t){return(Math.exp(t)-Math.exp(-t))/2}function L(t){return(Math.exp(t)+Math.exp(-t))/2}var D=k(0),O=function(t){return L(D)/L(D+b*t)},I=function(t){return A*((L(D)*(R(e=D+b*t)/L(e))-R(D))/T)/E;var e},B=(k(1)-D)/b;if(Math.abs(E)<1e-6||!isFinite(B)){if(Math.abs(A-S)<1e-6)return this.animateTo(t,e,i);var j=S<A?-1:1;B=Math.abs(Math.log(S/A))/b,I=function(){return 0},O=function(t){return Math.exp(j*b*t)}}var z=this._getRenderer(),G=this._animPlayer=Ho.animate({k:[0,1]},{easing:e.easing||"out",duration:e.duration||8,framer:function(t){z.callInNextFrame(t)}},function(r){if(n.isRemoved())G.finish();else{var o=r.styles.k,a=o*B,h=1/O(a),l={};if(t.center){var c=1===o?g:x.add(w.multi(I(a)));l.prjCenter=[g,c]}if(u!==_){var v=1===o?_:n.getZoomForScale(h,u,!0);l.zoom=[u,v]}if(f!==m){var y=Os(f,m,o);l.pitch=[m,y]}if(d!==p){var b=Os(d,p,o);l.bearing=[p,b]}if("running"===G.playState){if(l.prjCenter){var A=l.prjCenter;n._setPrjCenter(A[1]),n.onMoving(n._parseEventFromCoord(n.getCenter()))}l.zoom&&n.onZooming(l.zoom[1],s),l.pitch&&n._setPitch(l.pitch[1]),l.bearing&&n._setBearing(l.bearing[1]),n._fireEvent("animating")}else"paused"===G.playState&&G!==n._mapAnimPlayer||(G._interupted||(l.prjCenter&&n._setPrjCenter(l.prjCenter[1]),l.pitch&&n._setPitch(l.pitch[1]),l.bearing&&n._setBearing(l.bearing[1])),n._endAnim(G,l,s,e));i&&i(r)}});return this._startAnim({center:t.center,zoom:t.zoom!==u,pitch:m!==f,bearing:p!==d},s),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,i,n){delete this._animRotating;var r,o=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,e.center)r=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(r));else if(e.prjCenter){var s;s=t._interupted?this._getPrjCenter():e.prjCenter[1];var a=this._parseEventFromCoord(this.getProjection().unproject(s));a.point2d=this._prjToPoint(s),this.onMoveEnd(a)}y(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom(),i):n.wheelZoom?this.onZooming(e.zoom[1],i):this.onZoomEnd(e.zoom[1],i)),o&&this._fireEvent(o),y(e.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),n.wheelZoom||this._resumePrev(t)},_startAnim:function(t,e){this._animPlayer&&(t.center&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&(delete this._animRotating,"finished"!==t.playState&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(t){if(this._prevAnimPlayer){var e=this._prevAnimPlayer;"paused"!==e.playState&&delete this._prevAnimPlayer,t!==e&&(this._animPlayer=e,e.play())}}});var Is="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";function Bs(t,e,i,n,r){var o=1/Math.tan(e/2),s=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*s,t[15]=0,t}function js(t,e,i){var n,r,o,s,a,h,l,c,u,d,f,_,p=i[0],m=i[1],g=i[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*g+e[12],t[13]=e[1]*p+e[5]*m+e[9]*g+e[13],t[14]=e[2]*p+e[6]*m+e[10]*g+e[14],t[15]=e[3]*p+e[7]*m+e[11]*g+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],_=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=c,t[8]=u,t[9]=d,t[10]=f,t[11]=_,t[12]=n*p+a*m+u*g+e[12],t[13]=r*p+h*m+d*g+e[13],t[14]=o*p+l*m+f*g+e[14],t[15]=s*p+c*m+_*g+e[15]),t}function zs(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Gs(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],_=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=i[0],x=i[1],w=i[2],b=i[3];return t[0]=y*n+x*a+w*u+b*p,t[1]=y*r+x*h+w*d+b*m,t[2]=y*o+x*l+w*f+b*g,t[3]=y*s+x*c+w*_+b*v,y=i[4],x=i[5],w=i[6],b=i[7],t[4]=y*n+x*a+w*u+b*p,t[5]=y*r+x*h+w*d+b*m,t[6]=y*o+x*l+w*f+b*g,t[7]=y*s+x*c+w*_+b*v,y=i[8],x=i[9],w=i[10],b=i[11],t[8]=y*n+x*a+w*u+b*p,t[9]=y*r+x*h+w*d+b*m,t[10]=y*o+x*l+w*f+b*g,t[11]=y*s+x*c+w*_+b*v,y=i[12],x=i[13],w=i[14],b=i[15],t[12]=y*n+x*a+w*u+b*p,t[13]=y*r+x*h+w*d+b*m,t[14]=y*o+x*l+w*f+b*g,t[15]=y*s+x*c+w*_+b*v,t}function Ns(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],c=e[8],u=e[9],d=e[10],f=e[11],_=e[12],p=e[13],m=e[14],g=e[15],v=i*a-n*s,y=i*h-r*s,x=i*l-o*s,w=n*h-r*a,b=n*l-o*a,A=r*l-o*h,C=c*p-u*_,S=c*m-d*_,E=c*g-f*_,P=u*m-d*p,M=u*g-f*p,T=d*g-f*m,k=v*T-y*M+x*P+w*E-b*S+A*C;return k?(k=1/k,t[0]=(a*T-h*M+l*P)*k,t[1]=(r*M-n*T-o*P)*k,t[2]=(p*A-m*b+g*w)*k,t[3]=(d*b-u*A-f*w)*k,t[4]=(h*E-s*T-l*S)*k,t[5]=(i*T-r*E+o*S)*k,t[6]=(m*x-_*A-g*y)*k,t[7]=(c*A-d*x+f*y)*k,t[8]=(s*M-a*E+l*C)*k,t[9]=(n*E-i*M-o*C)*k,t[10]=(_*b-p*x+g*v)*k,t[11]=(u*x-c*b-f*v)*k,t[12]=(a*S-s*P-h*C)*k,t[13]=(i*P-n*S+r*C)*k,t[14]=(p*y-_*w-m*v)*k,t[15]=(c*w-u*y+d*v)*k,t):null}function Fs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Us(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Hs(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function Vs(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ws(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function Zs(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function qs(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],h=i[2];return t[0]=r*h-o*a,t[1]=o*s-n*h,t[2]=n*a-r*s,t}function Ys(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.hypot?Math.hypot(i,n,r):function(){var t=0,e=arguments.length;for(;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}(i,n,r)}function Qs(t,e,i){var n=e[0],r=e[1],o=e[2],s=1/(i[3]*n+i[7]*r+i[11]*o+i[15]);return t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])*s,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])*s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])*s,t}ko.include({_registerDomEvents:function(){li(this._panels.mapWrapper||this._containerDOM,Is,this._handleDOMEvent,this)},_removeDomEvents:function(){ci(this._panels.mapWrapper||this._containerDOM,Is,this._handleDOMEvent)},_handleDOMEvent:function(t){var e=t.type,i="mousedown"===e||"touchstart"===e&&(!t.touches||1===t.touches.length);i&&(this._domMouseDownTime=g(),this._domMouseDownView=this.getView());var n="contextmenu"===e&&function(t){if(!t._domMouseDownView)return!0;var e=t.getView(),i=t._domMouseDownView;return e.bearing!==i.bearing||e.pitch!==i.pitch}(this);if("contextmenu"===e){di(t);var r=this._domMouseDownTime;g()-r<=300&&!n&&this._fireDOMEvent(this,t,"dom:"+t.type)}else this._fireDOMEvent(this,t,"dom:"+t.type);if(!this._ignoreEvent(t)){var o,s=!1;if(i)this._mouseDownTime=g();else if("click"===e||"touchend"===e||"contextmenu"===e){if(!this._mouseDownTime)return;var a=this._mouseDownTime;if(delete this._mouseDownTime,g()-a>300){if("click"===e||"contextmenu"===e)return}else if("contextmenu"===e){if(n)return}else"touchend"===e&&(s=!0)}s&&(this._clickTime&&g()-this._clickTime<=300?(delete this._clickTime,o="dblclick",this._fireDOMEvent(this,t,"dom:dblclick")):(this._clickTime=g(),o="click",this._fireDOMEvent(this,t,"dom:click"))),this._ignoreEvent(t)||(this._fireDOMEvent(this,t,e),o&&this._fireDOMEvent(this,t,o))}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;if(this._isEventOutMap(t))return!0;var e,i=t.srcElement||t.target;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&e&&!e.eventsPropagation))return!0;e=i,i=i.parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var e=gi(this._getActualEvent(t),this._containerDOM);if(!this.getContainerExtent().contains(e))return!0}return!1},_parseEvent:function(t,e){if(!t)return null;var i={domEvent:t};if("keypress"!==e){var n=this._getActualEvent(t);if(n){var r=gi(n,this._containerDOM);i=v(i,{containerPoint:r,viewPoint:this.containerPointToViewPoint(r)});var o=this.options.maxVisualPitch;(this.getPitch()<=o||r.y>=this.height-this._getVisualHeight(o))&&(i=v(i,{coordinate:this.containerPointToCoord(r),point2d:this._containerPointToPoint(r)}))}}return i},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,i){if(!this.isRemoved()){var n=this._parseEvent(e,i);this._fireEvent(i,n)}}}),ko.addOnLoadHook("_registerDomEvents"),ko.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullscreen)t.requestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}}),ko.include({panTo:function(t,e,i){if(void 0===e&&(e={}),!t)return this;if(C(e)&&(i=e,e={}),t=new tn(t),void 0===e.animation||e.animation){var n=this.getProjection().project(t);return this._panAnimation(n,e.duration,i)}return this.setCenter(t),this},_panTo:function(t,e){return void 0===e&&(e={}),void 0===e.animation||e.animation?this._panAnimation(t,e.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,e,i){if(void 0===e&&(e={}),!t)return this;if(C(e)&&(i=e,e={}),t=new pt(t),this.getContainerExtent().ymin>0&&t.y>30){var n=t.y;t.y=30,t.x=30*t.x/n,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(this.onMoveStart(),void 0===e.animation||e.animation){t=t.multi(-1);var r=this._containerPointToPrj(new pt(this.width/2+t.x,this.height/2+t.y));this._panAnimation(r,e.duration,i)}else this._offsetCenterByPixel(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(t,e,i){return this._animateTo({prjCenter:t},{duration:e||this.options.panAnimationDuration},i)}}),vo.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var r=vo.fromJSON(t[i]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}return t&&!t.feature?ss.toGeometry(t):(t.subType?(o=vo.getJSONClass(t.subType).fromJSON(t),y(t.feature.id)||o.setId(t.feature.id)):(o=ss.toGeometry(t.feature),t.options&&o.config(t.options)),t.symbol&&o.setSymbol(t.symbol),t.infoWindow&&o.setInfoWindow(t.infoWindow),o);var o},xo.fromJSON=function(t){if(!t)return null;var e=t.type,i=xo.getJSONClass(e);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+e);return i.fromJSON(t)},ko.include({JSON_VERSION:"1.0",toJSON:function(t){t||(t={});var e={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom(),e.options.bearing=this.getBearing(),e.options.pitch=this.getPitch();var i=this.getBaseLayer();(y(t.baseLayer)||t.baseLayer)&&i&&(e.baseLayer=i.toJSON(t.baseLayer));var n={};t.clipExtent&&(!0===t.clipExtent?n.clipExtent=this.getExtent():n.clipExtent=t.clipExtent);var r=[];if(y(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var o=this.getLayers(),s=0,a=o.length;s<a;s++)if(o[s].toJSON){var h=v({},b(t.layers)?t.layers:{},n);r.push(o[s].toJSON(h))}e.layers=r}else if(kt(t.layers)){for(var l=t.layers,c=0;c<l.length;c++){var u=l[c],d=this.getLayer(u.id);if(d.toJSON){var f=v({},u.options,n);r.push(d.toJSON(f))}}e.layers=r}else e.layers=[];return e}}),ko.fromJSON=function(t,e,i){if(!t||!e)return null;i||(i={});var n=new ko(t,e.options);if(y(i.baseLayer)||i.baseLayer){var r=xo.fromJSON(e.baseLayer);r&&n.setBaseLayer(r)}if(y(i.layers)||i.layers){for(var o=[],s=e.layers,a=0;a<s.length;a++){var h=xo.fromJSON(s[a]);o.push(h)}n.addLayer(o)}return n},ko.include({computeLength:function(t,e){if(!this.getProjection())return null;var i=new tn(t),n=new tn(e);return i.equals(n)?0:this.getProjection().measureLength(i,n)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,e){var i=new tn((t=t||{}).coordinate);return this._identify(t,e,function(e){return e.identify(i,t)})},identifyAtPoint:function(t,e){var i=new pt((t=t||{}).containerPoint),n=this.containerPointToCoord(i);return this._identify(t,e,function(e){return e.identifyAtPoint?e.identifyAtPoint(i,t):n?e.identify(n,t):[]})},_identify:function(t,e,i){var n=t.layers;if(!kt(n))return this;for(var r=[],o=0,s=n.length;o<s;o++)A(n[o])?r.push(this.getLayer(n[o])):r.push(n[o]);for(var a=[],h=r.length-1;h>=0&&!(t.count&&a.length>=t.count);h--){var l=r[h];if(l&&l.getMap()&&(t.includeInvisible||l.isVisible())&&(t.includeInternals||!(l.getId().indexOf("_maptalks__internal_layer_")>=0))){var c=i(l);c&&(Array.isArray(c)?wt(a,c):a.push(c))}}return e.call(this,a),this}}),ko.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,i){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,i)))},_checkZoomOrigin:function(t){return t&&!this.options.zoomInCenter||(t=new pt(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new pt(this.options.zoomOrigin)),t},_startZoomAnim:function(t,e,i){y(i)&&(i=1);var n=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(n-i)/Math.abs(n-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,i){if(this.options.zoomable&&this._frameZoom!==t){y(i)&&(i=1),this._zoomTo(t,e);var n=this.getResolution(t),r=this.getResolution(this._startZoomVal)/n/i,o=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),s=this.getViewPoint();if(!this.isRotating()&&!o.equals(e)&&1!==r){var a=this.getPitch(),h=o._sub(e)._multi(1/(1-r));a&&(h.y/=Math.cos(a*Math.PI/180)),e=e.add(h)}var l={view:[r,0,0,r,(e.x-s.x)*(1-r),(e.y-s.y)*(1-r)]},c=this.getDevicePixelRatio();1!==c&&(e=e.multi(c)),l.container=[r,0,0,r,e.x*(1-r),e.y*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:e,matrix:l}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var i=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:i,to:t}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,e){this._zoomLevel=t,this._calcMatrices(),e&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,e)},_checkZoom:function(t){var e=this.getMaxZoom(),i=this.getMinZoom();return t<i&&(t=i),t>e&&(t=e),t}});var Ks,Xs,Js,$s,ta,ea,ia,na,ra,oa=Math.PI/180,sa=new tn(0,0);function aa(){return Fs(new Array(16))}ko.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/oa},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*oa,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/oa:0},setBearing:function(t){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(t)},_setBearing:function(t){if(lt.ie9)throw new Error("map can't rotate in IE9.");var e=-Mt(t,-180,180)*oa;if(this._angle===e)return this;var i=this.getBearing();return this._fireEvent("rotatestart",{from:i,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:i,to:e}),this._fireEvent("rotateend",{from:i,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(t)},_setPitch:function(t){if(lt.ie9)throw new Error("map can't tilt in IE9.");var e=Tt(t,0,this.options.maxPitch)*oa;if(this._pitch===e)return this;var i=this.getPitch();return this._fireEvent("pitchstart",{from:i,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:i,to:e}),this._fireEvent("pitchend",{from:i,to:e}),this},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,i=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return i;e=Math.PI*e/180;var n=new pt(this.cameraPosition).distanceTo(new pt(this.cameraLookAt)),r=i*Math.tan(2*e);return i+Math.tan(e)*(n+r)},_pointToContainerPoint:function(t,e,i,n){void 0===i&&(i=0);var r=this._getResolution(e);return this._pointAtResToContainerPoint(t,r,i,n)},_pointAtResToContainerPoint:function(t,e,i,n){void 0===i&&(i=0),n||(n=new pt(0,0)),t=this._pointAtResToPoint(t,e,n);var r,o=this.isTransforming(),s=e/this._getResolution();return o||i||(r=this._prjToPoint(this._getPrjCenter(),void 0,sa)),this._toContainerPoint(n,o,s,i,r),n},_pointsAtResToContainerPoints:function(t,e,i,n){void 0===i&&(i=[]),void 0===n&&(n=[]);var r=this.getPitch(),o=this.getBearing();if(0===r&&0===o){var s=this._get2DExtent(),a=s.xmin,h=s.ymin,l=s.xmax,c=s.ymax;if(l>a&&c>h){for(var u=e/this._getResolution(),d=this.getSize(),f=d.width,_=d.height,p=(l-a)/f,m=(c-h)/_,g=0,v=t.length;g<v;g++)if(t[g]){var y=n[g];y.x=t[g].x,y.y=t[g].y,y._multi(u),y.x=(y.x-a)*p,y.y=_-(y.y-h)*m}else n[g]=null;return n}}for(var x=Array.isArray(i),w=this.isTransforming(),b=e/this._getResolution(),A=this._prjToPoint(this._getPrjCenter(),void 0,sa),C=0,S=t.length;C<S;C++)if(t[C]){var E=n[C];E.x=t[C].x,E.y=t[C].y,E._multi(b);var P=x?i[C]||0:i;this._toContainerPoint(E,w,b,P,A)}else n[C]=null;return n},_toContainerPoint:(ra=[0,0,0],function(t,e,i,n,r){var o=this.width/2,s=this.height/2;if(e||n){n*=i;var a=this._glScale;Hs(ra,t.x*a,t.y*a,n*a);var h=this._projIfBehindCamera(ra,this.cameraPosition,this.cameraForward);Qs(h,h,this.projViewMatrix),t.x=h[0]*o+o,t.y=-h[1]*s+s}else t._sub(r.x,r.y),t.set(t.x,-t.y),t._add(o,s)}),_projIfBehindCamera:(ea=new Array(3),ia=new Array(3),na=new Array(3),function(t,e,i){Vs(ea,t,e);var n,r,o=(r=ea,(n=i)[0]*r[0]+n[1]*r[1]+n[2]*r[2]);return o<=0&&(function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(ia,i,1.01*o),function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(t,e,Vs(na,ea,ia))),t}),_containerPointToPoint:function(t,e,i){var n=this._getResolution(e);return this._containerPointToPointAtRes(t,n,i)},_containerPointToPointAtRes:(Js=[0,0,0],$s=[0,0,0,1],ta=[0,0,0,1],function(t,e,i){if(this.isTransforming()){var n=this.width/2||1,r=this.height/2||1;Hs(Js,(t.x-n)/n,(r-t.y)/r,0),Hs($s,Js[0],Js[1],0),Hs(ta,Js[0],Js[1],1),$s[3]=ta[3]=1,Qs($s,$s,this.projViewMatrixInverse),Qs(ta,ta,this.projViewMatrixInverse);var o=$s[0],s=ta[0],a=$s[1],h=ta[1],l=$s[2],c=ta[2],u=l===c?0:(0-l)/(c-l),d=Pt(o,s,u),f=Pt(a,h,u);return i?(i.x=d,i.y=f):i=new pt(d,f),i._multi(1/this._glScale),this._getResolution()===e?i:this._pointToPointAtRes(i,e,i)}var _=this._prjToPointAtRes(this._getPrjCenter(),e,i),p=this._getResolution()/e,m=p*(t.x-this.width/2),g=p*(t.y-this.height/2);return _._add(m,-g)}),_calcMatrices:(Xs=aa(),function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var t=this.getSize(),e=t.width||1,i=t.height||1;this._glScale=this.getGLScale();var n=this._getCameraWorldMatrix(),r=this.getFov()*Math.PI/180,o=this._getCameraFar(r,this.getPitch());this.cameraFar=o,this.cameraNear=this.cameraCenterDistance/20;var s=this.projMatrix||aa();Bs(s,r,e/i,this.cameraNear,o),this.projMatrix=s,this.viewMatrix=Ns(this.viewMatrix||aa(),n),this.projViewMatrix=Gs(this.projViewMatrix||aa(),s,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=Gs(this.projViewMatrixInverse||aa(),n,Ns(Xs,s)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtentAtRes(this._mapGlRes)}),_getCameraFar:function(t,e){var i=this.cameraCenterDistance=Ys(this.cameraPosition,this.cameraLookAt),n=i,r=4*i;if(e>0&&(e=e*Math.PI/180,2/Math.PI-e>t/2)){var o=Math.tan(t/2),s=Math.tan(e);r=Math.max(i*o/(1/s-o),r)}return(n+=r)+1},_calcCascadeMatrixes:function(){var t=aa();function e(e,i,n){var r=this.width,o=this.height,s=this.getFov()*Math.PI/180,a=this._getCameraFar(s,i),h=this.cameraCenterDistance;a=h+(a-h)/Math.cos((90-i)*Math.PI/180)*Math.cos((90-e)*Math.PI/180),Bs(t,s,r/o,.1,a);var l=this.viewMatrix;return Gs(n,t,l)}return function(){var t=this.getPitch(),i=this.options.cascadePitches[0],n=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||aa(),o=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||aa();t>i?e.call(this,t,i,r):Us(this.cascadeFrustumMatrix0,this.projViewMatrix),t>n?e.call(this,t,n,o):Us(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var t=aa(),e=aa(),i=[1,-1,1],n=[0,0,0];return function(){var r,o,s,a,h,l,c,u,d,f,_,p,m,g=this.width||1,v=this.height||1,y=.5/Math.tan(this._fov/2)*v;return zs(t,this.projMatrix,i),js(t,t,Hs(n,0,0,-y)),this._pitch&&(r=t,o=t,s=this._pitch,a=Math.sin(s),h=Math.cos(s),l=o[4],c=o[5],u=o[6],d=o[7],f=o[8],_=o[9],p=o[10],m=o[11],o!==r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15]),r[4]=l*h+f*a,r[5]=c*h+_*a,r[6]=u*h+p*a,r[7]=d*h+m*a,r[8]=f*h-l*a,r[9]=_*h-c*a,r[10]=p*h-u*a,r[11]=m*h-d*a),this._angle&&function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],l=e[4],c=e[5],u=e[6],d=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+l*n,t[1]=s*r+c*n,t[2]=a*r+u*n,t[3]=h*r+d*n,t[4]=l*r-o*n,t[5]=c*r-s*n,t[6]=u*r-a*n,t[7]=d*r-h*n}(t,t,this._angle),Fs(e),zs(e,e,Hs(n,g/2,-v/2,1)),Gs(this.domCssMatrix||aa(),e,t)}}(),_getFovZ:function(t){var e=this.getGLScale(t),i=this._getFovRatio();return e*(this.height||1)/2/i},_getCameraWorldMatrix:(Ks={},function(){var t=this.getGLRes(),e=this._prjToPointAtRes(this._prjCenter,t);this.cameraLookAt=Hs(this.cameraLookAt||[0,0,0],e.x,e.y,0);var i=this.getPitch()*oa,n=this.getBearing()*oa,r=this._getFovZ(),o=r*Math.cos(i),s=Math.sin(i)*r,a=e.x-s*Math.sin(n),h=e.y-s*Math.cos(n);this.cameraPosition=Hs(this.cameraPosition||[0,0,0],a,h,o),this.cameraToCenterDistance=Ys(this.cameraPosition,this.cameraLookAt);var l=s||1,c=this.cameraUp=Hs(this.cameraUp||[0,0,0],Math.sin(n)*l,Math.cos(n)*l,0),u=this.cameraWorldMatrix=this.cameraWorldMatrix||aa();!function(t,e,i,n){var r=[0,0,0],o=[0,0,0],s=[0,0,0];Vs(s,e,i),0===Ws(s)&&(s[2]=1),Zs(s,s),qs(r,n,s),0===Ws(s)&&(1===Math.abs(n[2])?s[0]+=1e-4:s[2]+=1e-4,Zs(s,s),qs(r,n,s)),Zs(r,r),qs(o,s,r),t[0]=r[0],t[4]=o[0],t[8]=s[0],t[1]=r[1],t[5]=o[1],t[9]=s[1],t[2]=r[2],t[6]=o[2],t[10]=s[2]}(u,this.cameraPosition,this.cameraLookAt,c);var d,f,_,p=this.cameraForward||[0,0,0];return Vs(p,this.cameraLookAt,this.cameraPosition),this.cameraForward=Zs(p,p),function(t,e){var i,n=e[0],r=e[4],o=e[8],s=e[1],a=e[5],h=e[9],l=e[2],c=e[6],u=e[10],d=n+a+u;d>0?(i=.5/Math.sqrt(d+1),t.w=.25/i,t.x=(c-h)*i,t.y=(o-l)*i,t.z=(s-r)*i):n>a&&n>u?(i=2*Math.sqrt(1+n-a-u),t.w=(c-h)/i,t.x=.25*i,t.y=(r+s)/i,t.z=(o+l)/i):a>u?(i=2*Math.sqrt(1+a-n-u),t.w=(o-l)/i,t.x=(r+s)/i,t.y=.25*i,t.z=(h+c)/i):(i=2*Math.sqrt(1+u-n-a),t.w=(s-r)/i,t.x=(o+l)/i,t.y=(h+c)/i,t.z=.25*i)}(Ks,u),function(t,e){var i=t,n=e.x,r=e.y,o=e.z,s=e.w,a=n+n,h=r+r,l=o+o,c=n*a,u=n*h,d=n*l,f=r*h,_=r*l,p=o*l,m=s*a,g=s*h,v=s*l;i[0]=1-(f+p),i[4]=u-v,i[8]=d+g,i[1]=u+v,i[5]=1-(c+p),i[9]=_-m,i[2]=d-g,i[6]=_+m,i[10]=1-(c+f),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1}(u,Ks),d=u,f=this.cameraPosition,(_=d)[12]=f[0],_[13]=f[1],_[14]=f[2],u}),_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*oa)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach(function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}})}}),ko.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),i=this._viewHistory.length-1;i>=0;i--)if(Ft(t,this._viewHistory[i]))return this._viewHistoryPointer=i,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var n=this.options.viewHistoryCount;n>0&&this._viewHistory.length>n&&this._viewHistory.splice(0,this._viewHistory.length-n),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(t){if(void 0===t&&(t={}),!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(t){if(void 0===t&&(t={}),!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,e){var i=this,n=this.getView();e.animation?this._animateTo(t,{duration:e.duration},function(e){"finished"===e.state.playState&&i._fireViewChange(n,t)}):(this.setView(t),this._fireViewChange(n,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e})},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),ko.mergeOptions({viewHistory:!0,viewHistoryCount:10}),ko.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new Qi,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this}});var ha=function(t){function e(e){var i;return(i=t.call(this,e)||this).on("enable",i._afterEnable,ut(ut(i))).on("disable",i._afterDisable,ut(ut(i))),i._measureLayers=[],i}ct(e,t);var i=e.prototype;return i.clear=function(){if(kt(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},i.getMeasureLayers=function(){return this._measureLayers},i.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},i.undo=function(){t.prototype.undo.call(this);var e=this._historyPointer;if(e!==this._vertexes.length)for(var i=e;i<this._vertexes.length;i++)this._vertexes[i].label&&this._vertexes[i].label.remove(),this._vertexes[i].marker.remove();return this},i.redo=function(){t.prototype.redo.call(this);var e=this._historyPointer-1;return this._vertexes[e]&&(this._vertexes[e].marker.getLayer()||(this._vertexes[e].label&&this._vertexes[e].label.addTo(this._measureMarkerLayer),this._vertexes[e].marker.addTo(this._measureMarkerLayer))),this},i._measure=function(t){var e,i,n=this.getMap();t instanceof vo?e=n.computeGeometryLength(t):Array.isArray(t)&&(e=n.getProjection().measureLength(t)),this._lastMeasure=e,i="zh-CN"===this.options.language?[" 米"," 公里"," 英尺"," 英里"]:[" m"," km"," feet"," mile"];var r="";return this.options.metric&&(r+=e<1e3?e.toFixed(0)+i[0]:(e/1e3).toFixed(2)+i[1]),this.options.imperial&&(e*=3.2808399,r.length>0&&(r+="\n"),r+=e<5280?e.toFixed(0)+i[2]:(e/5280).toFixed(2)+i[3]),r},i._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},i._afterEnable=function(){this._registerMeasureEvents()},i._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},i._msOnDrawStart=function(t){var e=this.getMap(),i=e._pointToPrj(t.point2d),n=yt(),r="distancetool_"+n,o="distancetool_markers_"+n;e.getLayer(r)?(this._measureLineLayer=e.getLayer(r),this._measureMarkerLayer=e.getLayer(o)):(this._measureLineLayer=new Ps(r).addTo(e),this._measureMarkerLayer=new Ps(o).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer);var s=new Yo(t.coordinate,{symbol:this.options.vertexSymbol});s._setPrjCoordinates(i);var a="zh-CN"===this.options.language?"起点":"start",h=new ys(a,t.coordinate,this.options.labelOptions);h._setPrjCoordinates(i),this._lastVertex=h,this._addVertexMarker(s,h)},i._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var i=Qe(this.options.vertexSymbol);i.markerWidth/=2,i.markerHeight/=2,this._tailMarker=new Yo(t.coordinate,{symbol:i}).addTo(this._measureMarkerLayer),this._tailLabel=new ys(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var n=this._geometry._getPrjCoordinates(),r=n[n.length-1];this._tailMarker.setCoordinates(t.coordinate),this._tailMarker._setPrjCoordinates(r),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(t.coordinate),this._tailLabel._setPrjCoordinates(r)},i._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this._geometry._getPrjCoordinates(),i=e[e.length-1],n=t.geometry,r=new Yo(t.coordinate,{symbol:this.options.vertexSymbol}),o=this._measure(n),s=new ys(o,t.coordinate,this.options.labelOptions);this._addVertexMarker(r,s),s._setPrjCoordinates(i),r._setPrjCoordinates(i),this._lastVertex=s},i._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:e,marker:t}),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},i._msOnDrawEnd=function(t){if(this._clearTailMarker(),t.geometry._getPrjCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var e=this._lastVertex.getSize();e||(e=new Me(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var i=t.geometry.copy();i._setPrjCoordinates(t.geometry._getPrjCoordinates()),i.addTo(this._measureLineLayer),this._lastMeasure=i.getLength()},i._addClearMarker=function(t,e,i){var n=this.options.clearButtonSymbol,r={markerDx:(n.markerDx||0)+i,textDx:(n.textDx||0)+i};Array.isArray(n)&&(r=n.map(function(t){return t?{markerDx:(t.markerDx||0)+i,textDx:(t.textDx||0)+i}:null})),n=Qe(n,r);var o=new Yo(t,{symbol:n}),s=this._measureLineLayer,a=this._measureMarkerLayer;o.on("click",function(){return s.remove(),a.remove(),!1},this),o.addTo(this._measureMarkerLayer),o._setPrjCoordinates(e)},i._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},i._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},e}(Rs);ha.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var la=function(t){function e(e){var i;return(i=t.call(this,e)||this).on("enable",i._afterEnable,ut(ut(i))).on("disable",i._afterDisable,ut(ut(i))),i._measureLayers=[],i}ct(e,t);var i=e.prototype;return i._measure=function(t){var e,i,n=this.getMap();t instanceof vo?e=n.computeGeometryArea(t):Array.isArray(t)&&(e=n.getProjection().measureArea(t)),this._lastMeasure=e,i="zh-CN"===this.options.language?[" 平方米"," 平方公里"," 平方英尺"," 平方英里"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];var r="";if(this.options.metric&&(r+=e<1e6?e.toFixed(0)+i[0]:(e/1e6).toFixed(2)+i[1]),this.options.imperial){e*=3.2808399,r.length>0&&(r+="\n");r+=e<27878400?e.toFixed(0)+i[2]:(e/27878400).toFixed(2)+i[3]}return r},i._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this.getMap()._pointToPrj(t.point2d),i=new Yo(t.coordinate,{symbol:this.options.vertexSymbol});i._setPrjCoordinates(e),this._measure(t.geometry),this._lastVertex=i,this._addVertexMarker(i)},i._msOnDrawEnd=function(t){var e;if(this._clearTailMarker(),t.point2d)e=this.getMap()._pointToPrj(t.point2d);else{var i=t.geometry._getPrjCoordinates();i=i.slice(0,i.length-1),t.geometry._setPrjCoordinates(i),e=i[i.length-1]}if(t.geometry._getPrjCoordinates().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var n=this._measure(t.geometry),r=this.getMap().getProjection().unproject(e),o=new ys(n,r,this.options.labelOptions).addTo(this._measureMarkerLayer);o._setPrjCoordinates(e);var s=o.getSize();s||(s=new Me(10,10)),this._addClearMarker(r,e,s.width);var a=t.geometry.copy();a._setPrjCoordinates(t.geometry._getPrjCoordinates()),a.addTo(this._measureLineLayer),this._lastMeasure=a.getArea()},e}(ha);la.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}});var ca={create:function(t,e){var i=t.unproject(e[0]),n=new as(i,0);return n._setPrjCoordinates(e[0]),n},update:function(t,e,i){var n=i.getMap(),r=Array.isArray(e)?e[e.length-1]:e,o=t.unproject(r),s=n.computeLength(i.getCenter(),o);i.setRadius(s)},generate:function(t){return t}};Rs.registerMode("circle",v({clickLimit:2,action:["click","mousemove","click"]},ca)),Rs.registerMode("freeHandCircle",v({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},ca));var ua={create:function(t,e){var i=t.unproject(e[0]),n=new hs(i,0,0);return n._setPrjCoordinates(e[0]),n},update:function(t,e,i){var n=i.getMap(),r=i.getCenter(),o=Array.isArray(e)?e[e.length-1]:e,s=t.unproject(o),a=n.computeLength(r,new tn({x:s.x,y:r.y})),h=n.computeLength(r,new tn({x:r.x,y:s.y}));i.setWidth(2*a),i.setHeight(2*h)},generate:function(t){return t}};Rs.registerMode("ellipse",v({clickLimit:2,action:["click","mousemove","click"]},ua)),Rs.registerMode("freeHandEllipse",v({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},ua));var da={create:function(t,e){var i=new Wo([]);return i._firstClick=e[0],i},update:function(t,e,i,n){var r=i.getMap(),o=n.containerPoint,s=r._prjToContainerPoint(i._firstClick),a=[[s.x,s.y],[o.x,s.y],[o.x,o.y],[s.x,o.y]];i.setCoordinates(a.map(function(t){return r.containerPointToCoord(new pt(t))})),i._setPrjCoordinates(a.map(function(t){return r._containerPointToPrj(new pt(t))}))},generate:function(t){return t}};Rs.registerMode("rectangle",v({clickLimit:2,action:["click","mousemove","click"]},da)),Rs.registerMode("freeHandRectangle",v({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},da)),Rs.registerMode("point",{clickLimit:1,action:["click"],create:function(t,e){var i=t.unproject(e[0]),n=new Yo(i);return n._setPrjCoordinates(e[0]),n},generate:function(t){return t}});var fa={create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new Ko(i);return n._setPrjCoordinates(e),n},update:function(t,e,i){var n,r=i.getSymbol();Array.isArray(e)?n=e:(n=i._getPrjCoordinates()).push(e);var o=n.map(function(e){return t.unproject(e)});i.setCoordinates(o),i._setPrjCoordinates(n);var s=i.getLayer();if(s){var a=s.getGeometryById("polygon");if(!a&&n.length>=3){if(a=new Wo([o],{id:"polygon"}),r){var h=Qe(r,{lineOpacity:0});a.setSymbol(h)}a.addTo(s)}a&&a._setPrjCoordinates(n)}},generate:function(t){var e=new Wo(t.getCoordinates(),{symbol:t.getSymbol()});return e._setPrjCoordinates(t._getPrjCoordinates()),e._projCode=t._projCode,e}};Rs.registerMode("polygon",v({action:["click","mousemove","dblclick"]},fa)),Rs.registerMode("freeHandPolygon",v({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},fa));var _a={create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new Ko(i);return n._setPrjCoordinates(e),n},update:function(t,e,i){var n;Array.isArray(e)?n=e:(n=i._getPrjCoordinates()).push(e);var r=n.map(function(e){return t.unproject(e)});i.setCoordinates(r),i._setPrjCoordinates(n)},generate:function(t){return t}};function pa(t){for(var e=t.tileInfo,i=[e.cols,e.rows],n=[],r=e.lods,o=0,s=r.length;o<s;o++)n.push(r[o].resolution);var a=t.fullExtent,h=e.origin,l=[1,-1,h.x,h.y];return delete a.spatialReference,{spatialReference:{resolutions:n,fullExtent:a},tileSystem:l,tileSize:i}}function ma(t,e){return void 0===e&&(e=[]),e.forEach(function(e){var i=e[0],n=e[1];t=t.replace(i,n)}),t}function ga(t){var e=t.projection,i=t.isArcgis,n=t.isGeoServer,r=t.isSuperMap,o=.0002645833333333333;return(i||n||r)&&(o=28e-5),e&&e.indexOf("4326")>-1&&(o=2.3767925226029154e-9,(i||r)&&(o=2.518101729011901e-9),n&&(o=2.51528279553466e-9)),o}function va(t,e){for(var i=0;i<t.length;i++){var n=t[i];if((n=n.getElementsByTagName("ows:Identifier")[0])&&n.textContent===e)return t[i]}return null}function ya(t,e){void 0===e&&(e={});var i,n,r,o=t.getElementsByTagName("TileMatrix"),s=[],a=[],h=[],l=!1;if(!i){var c=t.getElementsByTagName("ows:SupportedCRS")[0];c&&(i=function(t){var e=t.indexOf("EPSG")>-1?t:"EPSG:"+t;return e=ma(e,[["4490","4326"],["102100","3857"],["900913","3857"]])}(i=function(t){for(var e="",i=t.split(""),n=i.length-1;n>=0&&!isNaN(i[n]);n--)e=i[n]+e;return e}(i=(i=c.textContent).split("EPSG")[1])))}n||(n=t.getElementsByTagName("ows:Identifier")[0])&&(n=n.textContent),e.projection=i;for(var u=1/0,d=0;d<o.length;d++){var f=o[d],_=f.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(_))?(r=_.substr(0,_.lastIndexOf(":")),_=(_=_.split(":"))[_.length-1],_=parseInt(_),l=!0,e.isGeoServer=!0):_=parseInt(_),u=Math.min(u,_);var p=f.getElementsByTagName("ScaleDenominator")[0].textContent,m=f.getElementsByTagName("TopLeftCorner")[0].textContent,g=f.getElementsByTagName("TileWidth")[0].textContent,v=f.getElementsByTagName("TileHeight")[0].textContent;if(0===h.length&&h.push(parseInt(g),parseInt(v)),0===a.length){var y=m.split(" ").filter(function(t){return""!==t}).map(function(t){return parseFloat(t)}),x=y[0],w=y[1];x>0?a.push(1,-1,w,x):a.push(1,-1,x,w)}var b=ga(e),A=parseFloat(p)*b;s.push(A)}if(u>0)for(var C=s[0],S=u-1;S>=0;S--)C*=2,s.splice(0,0,C);return{resolutions:s,tileSize:h,tileSystem:a,projection:i,TileMatrixSet:n,isGeoServer:l,levelStr:r}}Rs.registerMode("linestring",v({action:["click","mousemove","dblclick"]},_a)),Rs.registerMode("freeHandLinestring",v({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},_a)),Rs.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new ds(i);return n._setPrjCoordinates(e),n},update:_a.update,generate:function(t){return t}}),Rs.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new _s(i);return n._setPrjCoordinates(e),n},update:_a.update,generate:function(t){return t}}),Rs.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new fs(i);return n._setPrjCoordinates(e),n},update:_a.update,generate:function(t){return t}}),Rs.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t,e){e=e[0];var i=t.unproject(e),n=new Yo(i);return n._firstClick=e,n},update:function(t,e,i,n){var r=i.getMap(),o=r._prjToContainerPoint(i._firstClick),s=n.containerPoint;e=r._containerPointToPrj(new tn(Math.min(o.x,s.x),Math.min(o.y,s.y)));var a=t.unproject(e);i.setCoordinates(a)._setPrjCoordinates(e),i.updateSymbol({markerWidth:Math.abs(o.x-s.x),markerHeight:Math.abs(o.y-s.y)})},generate:function(t){return t}}),po.loadArcgis=function(t,e,i){if(void 0===i&&(i={jsonp:!0}),A(t)&&"{"!==t.substring(0,1))Di.getJSON(t,function(t,i){if(t)e(t);else{var n=pa(i);e(null,n)}},i);else{A(t)&&(t=xt(t));var n=pa(t);e(null,n)}return this},po.loadWMTS=function(t,e,i){return void 0===i&&(i={jsonp:!0}),A(t)&&Di.get(t,function(n,r){if(n)e(n);else{var o=function(t,e,i){null==i.isArcgis&&(i.isArcgis=t.indexOf("arcgis")>-1),null==i.isSuperMap&&(i.isSuperMap=t.indexOf("supermap")>-1);var n=(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("Contents")[0];if(!n)return[];var r=n.getElementsByTagName("Layer");if(!r.length)return[];for(var o=[],s=0,a=n.childNodes.length;s<a;s++)"TileMatrixSet"===n.childNodes[s].nodeName&&o.push(n.childNodes[s]);if(!o.length)return[];for(var h=[],l=0,c=r.length;l<c;l++){var u=r[l],d=u.querySelectorAll("Style")[0];d&&(d=d.getElementsByTagName("ows:Identifier")[0])&&(d=d.textContent);var f=u.getElementsByTagName("ows:Identifier")[0];f&&(f=f.textContent);var _=u.getElementsByTagName("TileMatrixSetLink");if(0!==_.length)for(var p=0,m=_.length;p<m;p++){var g=_[p];(g=g.getElementsByTagName("TileMatrixSet")[0])&&(g=g.textContent);var v=va(o,g);if(v){var y=u.querySelectorAll("ResourceURL")[0],x="";y&&(x=y.attributes.template.value);var w=ya(v,i),b=w.resolutions,A=w.tileSize,C=w.tileSystem,S=w.projection,E=w.TileMatrixSet,P=w.isGeoServer,M=w.levelStr;x.length||(x=e.substr(0,e.lastIndexOf("?")),x+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var T=ma(x,[["{LAYER}",f],["{Layer}",f],["{layer}",f],["{STYLE}",d],["{Style}",d],["{style}",d],["{TileMatrixSet}",E],["{TileMatrix}",P?M+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",P?"image/png":"tiles"]]);h.push({tileSize:A,tileSystem:C,spatialReference:{resolutions:b,projection:S},urlTemplate:T,info:{layerName:f,TileMatrixSet:E,style:d,tileSize:A,tileSystem:C,resolutions:b,projection:S,urlTemplate:T}})}}}return h}(r,t,i);e(null,o)}},i),this};var xa=function(t){function e(e){return t.call(this,e)||this}ct(e,t);var i=e.prototype;return i.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i.show=function(t){var e=this.getMap();if(!e)return this;this.options.visible=!0,t=t||this._coordinate||this._owner.getCenter();var i=this.isVisible();this.fire("showstart");var n=this._getUIContainer();this._coordinate=t,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var r=this.__uiDOM=this.buildOn(e);if(r.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(r),!r)return this.fire("showend"),this;this._measureSize(r),this._singleton()&&(r._uiComponent=this,e[this._uiDomKey()]=r),this._setPosition(),r.style[oi]=null,n.appendChild(r);var o=this._getAnimation();if(i&&(o.ok=!1),o.ok&&(o.fade&&(r.style.opacity=0),o.scale)){if(this.getTransformOrigin){var s=this.getTransformOrigin();r.style[ri]=s}r.style[ni]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(r.style.display=""),this.options.eventsToStop&&Mi(r,this.options.eventsToStop,fi),this.options.autoPan&&this._autoPan();var a=o.transition;return o.ok&&a&&(r.offsetHeight,a&&(r.style[oi]=a),o.fade&&(r.style.opacity=1),o.scale&&(r.style[ni]=this._toCSSTranslate(this._pos)+" scale(1)")),this.fire("showend"),this},i.hide=function(){var t=this;if(!this.getDOM())return this;this.options.visible=!1;var e=this._getAnimation(),i=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(i.offsetHeight,i.style[oi]=e.transition,setTimeout(function(){i.style.display="none",t.fire("hide")},this.options.animationDuration)):(i.style.display="none",this.fire("hide")),e.fade&&(i.style.opacity=0),e.scale&&(i.style[ni]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},i.remove=function(){return delete this._mapEventsOn,this._owner?(this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this):this},i.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},i.getOwner=function(){return this._owner},i.getDOM=function(){return this.__uiDOM},i._roundPoint=function(t){return this.options.roundPoint&&(t=t._round()),t},i.getPosition=function(){if(!this.getMap())return null;var t=this._roundPoint(this._getViewPoint());if(this.getOffset){var e=this._roundPoint(this.getOffset());e&&t._add(e)}return t},i._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],i=0;i<e.length;i++){var n=Te(e[i]);"fade"===n?t.fade=!0:"scale"===n&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=ni+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},i._getViewPoint=function(){var t=0;if(this._owner&&this._owner.getAltitude){var e=this._owner.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},i._meterToPoint=function(t,e){return this.getMap().distanceToPoint(e,0,void 0,t).x*St(e)},i._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!t.isMoving()){var i=this._getViewPoint()._round(),n=t.width,r=t.height,o=t.viewPointToContainerPoint(i),s=this.getOffset(),a=o.add(s),h=t._viewPointToPrj(i),l=parseInt(e.clientWidth),c=parseInt(e.clientHeight),u=0,d=0;if(a.x<0?u=50-a.x:a.x+l>n&&(u=-(a.x+l-n)-50),a.y<0?d=50-a.y:a.y+c>r&&(d=r-(a.y+c)-50),0!==d||0!==u){var f=o.add(u,d),_=t._containerPointToPoint(f)._sub(t._prjToPoint(t._getPrjCenter())),p=t._pointToPrj(t._prjToPoint(h).sub(_));t._panAnimation(p)}}},i._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute",t.style.left="-99999px";var i=t.style.bottom?"bottom":"top";return t.style[i]="-99999px",t.style.display="",e.appendChild(t),this._size=new Me(t.clientWidth,t.clientHeight),t.style.display="none",t.style.left="0px",t.style[i]="0px",this._size},i._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),i=this._uiDomKey();e[i]&&(t&&Ti(e[i],t,fi),hi(e[i]),e[i]._uiComponent&&!this.hideDom&&e[i]._uiComponent._switchMapEvents("off"),delete e[i]),delete this.__uiDOM}else this.__uiDOM&&(t&&Ti(this.__uiDOM,t,fi),hi(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},i._uiDomKey=function(){return"__ui_"+this._getClassName()},i._singleton=function(){return this.options.single},i._getUIContainer=function(){return this.getMap()._panels.ui},i._getClassName=function(){return"UIComponent"},i._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var i=this._getDefaultEvents();if(this.getEvents&&v(i,this.getEvents()),i)for(var n in i)i.hasOwnProperty(n)&&e[t](n,i[n],this)}},i._switchEvents=function(t){var e=this._getOwnerEvents();if(this._owner)for(var i in e)e.hasOwnProperty(i)&&this._owner[t](i,e[i],this)},i._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,resize:this.onResize}},i._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof vo&&(t.positionchange=this.onGeometryPositionChange,t.symbolchange=this.onGeometryPositionChange),this.getOwnerEvents&&v(t,this.getOwnerEvents()),t},i.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&this.show(t.target.getCenter())},i.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.onEvent=function(){this.isVisible()&&this._updatePosition()},i.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.onResize=function(){this.isVisible()&&this._setPosition()},i.onDomSizeChange=function(){this.isVisible()&&this._setPosition()},i._updatePosition=function(){this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this))},i._setPosition=function(){var t=this.getDOM();if(t){t.style[oi]=null;var e=this.getPosition();this._pos=e,t.style[ni]=this._toCSSTranslate(e)+" scale(1)"}},i._toCSSTranslate=function(t){if(!t)return"";if(lt.any3d){var e=this.getMap(),i=e?e.getBearing():0,n=e?e.getPitch():0,r="";return this.options.pitchWithMap&&n&&(r+=" rotateX("+Math.round(n)+"deg)"),this.options.rotateWithMap&&i&&(r+=" rotateZ("+Math.round(-i)+"deg)"),"translate3d("+t.x+"px,"+t.y+"px, 0px)"+r}return"translate("+t.x+"px,"+t.y+"px)"},i._observerDomSize=function(t){var e=this;return t&&lt.resizeObserver&&!this._resizeObserver?(this._resizeObserver=new ResizeObserver(function(t){t.length?e._domContentRect=t[0].contentRect:delete e._domContentRect,e.onDomSizeChange&&e.onDomSizeChange()}),this._resizeObserver.observe(t),this):this},i.isSupportZoomFilter=function(){return!1},e.isSupport=function(t){return!!(t&&C(t.on)&&C(t.off)&&C(t.getCenter))},e}(Hi(Wi));xa.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1});var wa="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",ba=function(t){function e(e,i){var n;return(n=t.call(this,i)||this)._markerCoord=new tn(e),n}ct(e,t);var i=e.prototype;return i._getClassName=function(){return"UIMarker"},i.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition()),this},i.getCoordinates=function(){return this._markerCoord},i.getCenter=function(){return this.getCoordinates()},i.getAltitude=function(){return this.options.altitude||0},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},i.getContent=function(){return this.options.content},i.onAdd=function(){this.show()},i.show=function(){return t.prototype.show.call(this,this._markerCoord)},i.flash=function(t,e,i,n){return Ht.call(this,t,e,i,n)},i.buildOn=function(){var t;return A(this.options.content)?(t=si("div")).innerHTML=this.options.content:t=this.options.content,this.options.containerClass&&(t.className=this.options.containerClass),this._registerDOMEvents(t),t},i.getOffset=function(){var t=this.getSize();return new pt(-t.width/2,-t.height/2)},i.getTransformOrigin=function(){return"center center"},i.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},i.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},i._registerDOMEvents=function(t){Mi(t,wa,this._onDomEvents,this)},i._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type);this.fire(t.type,e)},i._removeDOMEvents=function(t){Ti(t,wa,this._onDomEvents,this)},i._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),i=this.getSize(),n=i.width,r=i.height;return[t.containerPointToCoordinate(e.add(-n/2,0)),t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},i._getViewPoint=function(){var t=0;if(this._owner){var e=this.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},i._getDefaultEvents=function(){return v({},t.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},i._setPosition=function(){this.onZoomFilter(),t.prototype._setPosition.call(this)},i.onZoomFilter=function(){var t=this.getDOM();t&&(this.isVisible()||"none"===t.style.display?this.isVisible()&&"none"===t.style.display&&(t.style.display=""):t.style.display="none")},i.isVisible=function(){var t=this.getMap();if(!t)return!1;if(!this.options.visible)return!1;var e=t.getZoom(),i=this.options,n=i.minZoom,r=i.maxZoom;return!(!y(n)&&e<n||!y(r)&&e>r)&&(this.getDOM()&&!0)},i.isSupportZoomFilter=function(){return!0},e}(Ki(xa));ba.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null});var Aa=lt.touch?"touchstart mousedown":"mousedown",Ca=function(t){function e(e){return t.call(this,e)||this}ct(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on(Aa,this._startDrag,this)},i.removeHooks=function(){this.target.off(Aa,this._startDrag,this)},i._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},i._prepareDragHandler=function(){this._dragHandler=new $i(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},i._onMouseDown=function(t){fi(t.domEvent)},i._dragging=function(t){var e=this.target,i=e.getMap()._parseEvent(t.domEvent),n=i.domEvent;if(!(n.touches&&n.touches.length>1))if(this._isDragging){var r=i.coordinate,o=i.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=o);var s=r.sub(this._lastCoord),a=o.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=o,this.target.setCoordinates(this.target.getCoordinates().add(s)),i.coordOffset=s,i.pointOffset=a,e.fire("dragging",i)}else this._isDragging=!0},i._endDrag=function(t){var e=this.target,i=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,i){var n=i._parseEvent(t.domEvent);e.fire("dragend",n)}},i.isDragging=function(){return!!this._isDragging},e}(Vi);ba.addInitHook("addHandler","draggable",Ca);var Sa=/\{ *([\w_]+) *\}/g,Ea={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},Pa=new Me(0,0),Ma=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i._getClassName=function(){return"InfoWindow"},i.addTo=function(e){return e instanceof vo&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),t.prototype.addTo.call(this,e)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getContent=function(){return this.options.content},i.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getTitle=function(){return this.options.title},i.buildOn=function(){if(this.options.custom){if(A(this.options.content)){var t=si("div");return t.innerHTML=this.options.content,this._replaceTemplate(t),t}return this._replaceTemplate(this.options.content),this.options.content}var e=si("div");this.options.containerClass&&(e.className=this.options.containerClass);var i=this._getWindowWidth();e.style.width=x(i)?i+"px":"auto",e.style.bottom="0px";var n='<em class="maptalks-ico"></em>';this.options.title&&(n+="<h2>"+this.options.title+"</h2>"),n+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',e.innerHTML=n,this._replaceTemplate(e);var r=e.querySelector(".maptalks-msgContent");return A(this.options.content)?r.innerHTML=this.options.content:r.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this),li(e.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),this._replaceTemplate(r),e},i._replaceTemplate=function(t){if(this.options.enableTemplate&&this._owner&&this._owner.getProperties&&t&&t.innerHTML){var e=this._owner.getProperties()||{};if(b(e)){var i=t.innerHTML;t.innerHTML=i.replace(Sa,function(t,i){return e[i]})}}return this},i.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},i.getOffset=function(){var t=this.getSize(),e=new pt(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var i=this.getOwner();if(i instanceof Yo||i instanceof es){var n,r;if(i instanceof Yo)n=i._getPainter(),r=i.getSize();else{var o=i.getGeometries();if(!o||!o.length)return e;n=o[0]._getPainter(),r=o[0].getSize()}if(r||(r=Pa),n){var s=n.getFixedExtent();e._add(s.xmax-r.width/2,s.ymin)}else e._add(0,-r.height)}return e},i.show=function(e){return this.getMap()&&this.getMap().options.enableInfoWindow?t.prototype.show.call(this,e):this},i.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},i.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},i.onRemove=function(){this.onDomRemove()},i.onDomRemove=function(){this._onCloseBtnClick&&(ci(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},i._onAutoOpen=function(t){var e=this,i=this.getOwner();setTimeout(function(){i instanceof Yo||i instanceof xa?e.show(i.getCoordinates()):i instanceof es?e.show(i.findClosest(t.coordinate)):i instanceof Ko||i instanceof ns?(e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(i,t.coordinate)),e.show(t.coordinate)):e.show(t.coordinate)},1)},i._rectifyMouseCoordinte=function(t,e){var i=this;return t instanceof Ko?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof ns?t.getGeometries().map(function(t){return i._rectifyLineStringMouseCoordinate(t,e)}).sort(function(t,e){return t.dis-e.dis})[0].coordinate:e},i._rectifyLineStringMouseCoordinate=function(t,e){for(var i=this,n=t.getCoordinates().map(function(t){return i.getMap().coordToContainerPoint(t)}),r=this.getMap().coordToContainerPoint(e),o=1/0,s=-1,a=0,h=n.length;a<h;a++){var l=n[a],c=r.distanceTo(l);c<o&&(o=c,s=a)}var u=[];0===s?u.push(n[0],n[1]):s===n.length-1?u.push(n[s-1],n[s]):u.push(n[s-1],n[s],n[s+1]);for(var d=[],f=this.getMap().getSize(),_=f.width,p=f.height,m=0,g=u.length-1;m<g;m++){var v=u[m],y=u[m+1];if(v.x===y.x)for(var x=Math.max(0,Math.min(v.y,y.y)),w=Math.min(p,Math.max(v.y,y.y)),b=x;b<=w;b++)d.push(new pt(v.x,b));else for(var A=(y.y-v.y)/(y.x-v.x),C=Math.max(0,Math.min(v.x,y.x)),S=Math.min(_,Math.max(v.x,y.x)),E=C;E<=S;E++){var P=A*(E-v.x)+v.y;d.push(new pt(E,P))}}for(var M=1/0,T=-1,k=0,R=d.length;k<R;k++){var L=d[k],D=r.distanceTo(L);D<M&&(M=D,T=k)}return{dis:M,coordinate:T<0?e:this.getMap().containerPointToCoord(d[T])}},i._getWindowWidth=function(){var t=Ea.width,e=this.options.width;return e||(e=t),e},e}(xa);Ma.mergeOptions(Ea);var Ta="remove hide shapechange positionchange dragend animatestart",ka=function(t){ct(i,t);var e=i.prototype;function i(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,i)||this)._content=e,n}return e._getClassName=function(){return"ToolTip"},e.addTo=function(e){if(i.isSupport(e))return e.on("mousemove",this.onMouseMove,this),e.on("mouseout",this.onMouseOut,this),e.on(Ta,this.hideDom,this),t.prototype.addTo.call(this,e);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},e.setStyle=function(t){return this.options.containerClass=t,this},e.getStyle=function(){return this.options.containerClass},e.getContent=function(){return this._content},e.buildOn=function(){var t=si("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var i=e.containerClass||e.cssName;return!i&&e.height&&(t.style.lineHeight=e.height+"px"),t.innerHTML='<div class="'+i+'">'+this._content+"</div>",t},e.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},e.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var i=this.getMap();if(i){var n=i.locateByPoint(t.coordinate,-5,25);0===this.options.showTimeout?this.show(n):this._timeout=setTimeout(function(){i&&e.show(n)},this.options.showTimeout)}},e.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(Ta,this.hideDom,this))},e.hideDom=function(){return this.hide()},e.onEvent=function(){return t.prototype.onEvent.call(this),this.hideDom(),this},e._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},i}(xa);ka.mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var Ra=function(t){function e(e){return t.call(this,e)||this}ct(e,t);var i=e.prototype;return i._getClassName=function(){return"Menu"},i.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,this._owner=t,xa.prototype.addTo.apply(this,arguments)},i.setItems=function(t){return this.options.items=t,this},i.getItems=function(){return this.options.items||[]},i.buildOn=function(){if(this.options.custom){if(A(this.options.items)){var t=si("div");return t.innerHTML=this.options.items,t}return this.options.items}var e=si("div");this.options.containerClass&&xi(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var i=this._createMenuItemDom();return e.appendChild(i),Mi(e,"contextmenu",di),e},i.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),i=this.getSize(),n=0,r=0;return e.x+i.width>t.width&&(n=-i.width),e.y+i.height>t.height&&(r=-i.height),new pt(n,r)},i.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},i.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i._createMenuItemDom=function(){var t=this,e=this.getMap(),i=si("ul");xi(i,"maptalks-menu-items");var n,r,o=this.getItems();function s(i){return function(n){var r=e._parseEvent(n,"click");r.target=t,r.owner=t._owner,r.index=i,!1!==this._callback(r)&&(t.hide(),t._owner&&t._owner.fire("closemenu"))}}for(var a=0,h=o.length;a<h;a++){if("-"===(n=o[a])||"_"===n)xi(r=si("li"),"maptalks-menu-splitter");else{r=si("li");var l=n.item;C(l)&&(l=l({owner:this._owner,index:a})),r.innerHTML=l,r._callback=n.click,Mi(r,"click",s(a))}i.appendChild(r)}var c=this.options.maxHeight||0;return c>0&&vi(i,"max-height: "+c+"px; overflow-y: auto;"),i},i._getMenuWidth=function(){return this.options.width||160},e}(xa);Ra.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var La={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(t){var e=this instanceof ko?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(),this._menu.show(t)),this.fire("openmenu",{coordinate:t}),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new Ra(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.openMenu(t.coordinate),!1}};ko.include(La),vo.include(La);var Da=function(t){function e(e){return e&&e.position&&!A(e.position)&&(e.position=v({},e.position)),t.call(this,e)||this}ct(e,t);var i=e.prototype;return i.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t._panels.control;return this.__ctrlContainer=si("div"),vi(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},i.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.getMap=function(){return this._map},i.getPosition=function(){return v({},this._parse(this.options.position))},i.setPosition=function(t){return A(t)?this.options.position=t:this.options.position=v({},t),this._updatePosition(),this},i.getContainerPoint=function(){var t,e,i=this.getPosition(),n=this.getMap().getSize();return y(i.left)?y(i.right)||(t=n.width-parseInt(i.right)):t=parseInt(i.left),y(i.top)?y(i.bottom)||(e=n.height-parseInt(i.bottom)):e=parseInt(i.top),new pt(t,e)},i.getContainer=function(){return this.__ctrlContainer},i.getDOM=function(){return this._controlDom},i.show=function(){return this.__ctrlContainer.style.display="",this},i.hide=function(){return this.__ctrlContainer.style.display="none",this},i.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},i.remove=function(){return this._map?(hi(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},i._parse=function(t){var i=t;return A(t)&&(i=e.positions[i]),i},i._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)t.hasOwnProperty(e)&&(t[e]=parseInt(t[e]),this.__ctrlContainer.style[e]=t[e]+"px");this.fire("positionchange",{position:v({},t)})},e}(Hi(Wi));Da.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},ko.mergeOptions({control:!0}),ko.include({addControl:function(t){return this._containerDOM.getContext?this:(t.addTo(this),this)},removeControl:function(t){return t&&t.getMap()===this?(t.remove(),this):this}});var Oa="addlayer removelayer setbaselayer baselayerremove",Ia=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.buildOn=function(){return this._attributionContainer=si("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},i.onAdd=function(){this.getMap().on(Oa,this._update,this)},i.onRemove=function(){this.getMap().off(Oa,this._update,this)},i._update=function(){var t=this.getMap();if(t){var e=t._getLayers(function(t){return t.options.attribution}).reverse().map(function(t){return t.options.attribution}),i=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+i+"</span>"}},e}(Da);Ia.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),ko.mergeOptions({attribution:!0}),ko.addOnLoadHook(function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new Ia(t),this.addControl(this.attributionControl))});var Ba=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.buildOn=function(){var t=this.container=si("div",this.options.containerClass),e=this.panel=si("div","panel"),i=this.button=si("button");return t.appendChild(i),t.appendChild(e),t},i.onAdd=function(){Mi(this.button,"mouseover",this._show,this),Mi(this.panel,"mouseleave",this._hide,this),Mi(this.getMap(),"click",this._hide,this)},i.onRemove=function(){this.panel&&(Ti(this.button,"mouseover",this._show,this),Ti(this.panel,"mouseleave",this._hide,this),Ti(this.getMap(),"click",this._hide,this),hi(this.panel),hi(this.button),delete this.panel,delete this.button,delete this.container)},i._show=function(){yi(this.container,"shown")||(xi(this.container,"shown"),this._createPanel())},i._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||wi(this.container,this.options.containerClass)},i._createPanel=function(){this.panel.innerHTML="";var t=si("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},i._renderLayers=function(t,e){var i=t.getBaseLayer(),n=t.getLayers(),r=n.length;if(i){var o=i.layers||[i],s=si("li","group"),a=si("ul"),h=si("label");h.innerHTML=this.options.baseTitle,s.appendChild(h);for(var l=0,c=o.length;l<c;l++){var u=o[l];this._isExcluded(u)&&(a.appendChild(this._renderLayer(o[l],!0)),s.appendChild(a),e.appendChild(s))}}if(r){var d=si("li","group"),f=si("ul"),_=si("label");_.innerHTML=this.options.overlayTitle,d.appendChild(_);for(var p=0;p<r;p++){var m=n[p];this._isExcluded(m)&&f.appendChild(this._renderLayer(m))}d.appendChild(f),e.appendChild(d)}},i._isExcluded=function(t){var e=t.getId(),i=this.options.excludeLayers;return!(i.length&&i.indexOf(e)>=0)},i._renderLayer=function(t,e){var i=this,n=si("li","layer"),r=si("label"),o=si("input"),s=this.getMap(),a=t.options.visible;t.options.visible=!0;var h=t.isVisible();return t.options.visible=a,n.className="layer",e?(o.type="radio",o.name="base"):o.type="checkbox",o.checked=a&&h,h||o.setAttribute("disabled","disabled"),o.onchange=function(e){if("radio"===e.target.type){var n=s.getBaseLayer(),r=n.layers;if(r)for(var o=0,a=r.length;o<a;o++){var h=r[o];h[h===t?"show":"hide"]()}else n.isVisible()||n.show();s._fireEvent("setbaselayer")}else t[e.target.checked?"show":"hide"]();i.fire("layerchange",{target:t})},n.appendChild(o),r.innerHTML=t.getId(),n.appendChild(r),n},e}(Da);Ba.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),ko.mergeOptions({layerSwitcherControl:!1}),ko.addOnLoadHook(function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new Ba(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))});var ja=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=si("div"),i=this.mapContainer=si("div");i.style.width=t[0]+"px",i.style.height=t[1]+"px",i.className=this.options.containerClass;var n=this.button=si("div");return n.className=this.options.buttonClass,e.appendChild(i),e.appendChild(n),e},i.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),Mi(this.button,"click",this._onButtonClick,this),this._updateButtonText()},i.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),Ti(this.button,"click",this._onButtonClick,this)},i.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},i.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},i.getOverviewMap=function(){return this._overview},i._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},i._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},i._createOverview=function(){var t=this.getMap(),e=this.mapContainer,i=t.config();v(i,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new ko(e,i),this._updateBaseLayer(),this._perspective=new Wo(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new Ps("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},i._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),i=t.getMinZoom(),n=this.options.level;if(n>0){for(var r=n;r>0;r--)if(e-r>=i)return e-r}else for(var o=n;o<0;o++)if(e-o>=i)return e-o;return e},i._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},i._getPerspectiveCoords=function(){var t=this.getMap();return t.getContainerExtent().toArray().map(function(e){return t.containerPointToCoordinate(e)})},i._update=function(){if(this._overview){mi(this._overview._containerDOM);var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},i._updateSpatialReference=function(){if(this._overview){var t=this.getMap().options.spatialReference;this._overview.setSpatialReference(t)}},i._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,i=0;if(e)for(var n=0,r=e.length;n<r;n++){if(e[n].isVisible()){i=n;break}}var o=t.toJSON(),s=null;e?(s=o.layers[i].options).visible=!0:s=o.options,this._overview.setMinZoom(s.minZoom||null).setMaxZoom(s.maxZoom||null),delete s.minZoom,delete s.maxZoom,delete o.options.canvas,o.options.visible=!0,o.options.renderer="canvas";var a=xo.fromJSON(o);for(var h in t)C(t[h])&&t.hasOwnProperty(h)&&t[h]!==t.constructor.prototype[h]&&(a[h]=t[h]);this._overview.setBaseLayer(a)}else this._overview.setBaseLayer(null)}},e}(Da);ja.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),ko.mergeOptions({overviewControl:!1}),ko.addOnLoadHook(function(){this.options.overviewControl&&(this.overviewControl=new ja(this.options.overviewControl),this.addControl(this.overviewControl))});var za=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.buildOn=function(){var t;if(this.options.custom)A(this.options.content)?(t=si("div")).innerHTML=this.options.content:t=this.options.content;else{if(t=si("div","maptalks-panel"),this.options.closeButton){var e=si("a","maptalks-close");e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var i=si("div","maptalks-panel-content");i.innerHTML=this.options.content,t.appendChild(i)}return this.draggable=new $i(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},i.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),Da.prototype.update.call(this)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},i.getContent=function(){return this.options.content},i._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},i._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=v({},this.getPosition()),this.fire("dragstart",t)},i._onDragging=function(t){var e=t.mousePos.sub(this._startPos),i=this._startPosition,n=this.getPosition();y(n.top)||(n.top=parseInt(i.top)+e.y),y(n.bottom)||(n.bottom=parseInt(i.bottom)-e.y),y(n.left)||(n.left=parseInt(i.left)+e.x),y(n.right)||(n.right=parseInt(i.right)-e.x),this.setPosition(n),this.fire("dragging",t)},i._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},i._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),i=this.getDOM(),n=parseInt(i.clientWidth),r=parseInt(i.clientHeight);return[t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(n,r/2)),t.containerPointToCoordinate(e.add(n/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(Da);za.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var Ga=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.buildOn=function(t){return this._map=t,this._scaleContainer=si("div",this.options.containerClass),this._addScales(),t.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},i.onRemove=function(){this.getMap().off("zoomend",this._update,this)},i._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=ai("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=ai("div",this.options.containerClass?null:t,this._scaleContainer))},i._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},i._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},i._updateMetric=function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},i._updateImperial=function(t){var e,i,n,r=3.2808399*t;r>5280?(e=r/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mile",i/e)):(n=this._getRoundNum(r),this._updateScale(this._iScale,n+" feet",n/r))},i._updateScale=function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},i._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)},e}(Da);Ga.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),ko.mergeOptions({scaleControl:!1}),ko.addOnLoadHook(function(){this.options.scaleControl&&(this.scaleControl=new Ga(this.options.scaleControl),this.addControl(this.scaleControl))});var Na=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.buildOn=function(t){this._map=t;var e=si("div"),i=si("ul","maptalks-toolbar-hx");e.appendChild(i),this.options.vertical?xi(e,"maptalks-toolbar-vertical"):xi(e,"maptalks-toolbar-horizonal");var n=this;function r(t,e,i,r){var o=n._getItems()[e];return function(n){return fi(n),t({target:o,index:e,childIndex:i,dom:r})}}var o=this.options.items;if(kt(o))for(var s=0,a=o.length;s<a;s++){var h=o[s],l=si("li");if(28!==this.options.height&&(l.style.lineHeight=this.options.height+"px"),l.style.height=this.options.height+"px",l.style.cursor="pointer",Ci(h.item)){l.style.textAlign="center";var c=Si("div",h.item);l.innerHTML='<div style="margin-top:'+(this.options.height-c.height)/2+'px;">'+h.item+"</div>"}else l.innerHTML=h.item;if(h.click&&Mi(l,"click",r(h.click,s,null,l)),kt(h.children)){var u=this._createDropMenu(s);l.appendChild(u),l._menu=u,Mi(l,"mouseover",function(){this._menu.style.display=""}),Mi(l,"mouseout",function(){this._menu.style.display="none"})}i.appendChild(l)}return e},i._createDropMenu=function(t){var e=this;function i(t,i,n){var r=e._getItems()[i].children[n];return function(e){return fi(e),t({target:r,index:i,childIndex:n})}}var n=si("div","maptalks-dropMenu"),r=this._getItems(),o=r.length,s=si("ul"),a=r[t].children;t===o-1&&a&&(n.style.cssText="right: 0px;",s.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(s.style.bottom=0)),n.appendChild(si("em","maptalks-ico"));for(var h=0,l=0,c=a.length;l<c;l++){var u=Ie(a[l].item,"12px");u.width>h&&(h=u.width)}for(var d=0,f=a.length;d<f;d++){var _=a[d],p=si("li");p.innerHTML='<a href="javascript:;">'+_.item+"</a>",p.style.cursor="pointer",p.style.width=h+24+"px",Mi(p.childNodes[0],"click",i(_.click,t,d)),s.appendChild(p)}if(this.options.vertical){var m=h<95?95:h;this.options.reverseMenu?n.style.right=-(m+20)+"px":n.style.left=-(m+20)+"px"}else this.options.reverseMenu?n.style.bottom="28px":n.style.top="28px";return n.appendChild(s),n.style.display="none",n},i._getItems=function(){return this.options.items||[]},e}(Da);Na.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}});var Fa=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.buildOn=function(t){var e=this.options,i=si("div","maptalks-zoom");if(e.zoomLevel){var n=si("span","maptalks-zoom-zoomlevel");i.appendChild(n),this._levelDOM=n}var r=si("div","maptalks-zoom-slider"),o=si("a","maptalks-zoom-zoomin");if(o.href="javascript:;",o.innerHTML="+",r.appendChild(o),this._zoomInButton=o,e.slider){var s=si("div","maptalks-zoom-slider-box"),a=si("div","maptalks-zoom-slider-ruler"),h=si("span","maptalks-zoom-slider-reading"),l=si("span","maptalks-zoom-slider-dot");a.appendChild(h),s.appendChild(a),s.appendChild(l),r.appendChild(s),this._sliderBox=s,this._sliderRuler=a,this._sliderReading=h,this._sliderDot=l}var c=si("a","maptalks-zoom-zoomout");return c.href="javascript:;",c.innerHTML="-",r.appendChild(c),this._zoomOutButton=c,i.appendChild(r),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),i},i.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&Ti(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&Ti(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(Ti(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger.disable(),delete this.dotDragger)},i._update=function(){var t=this.getMap();if(this._sliderBox){var e=10*(t.getMaxZoom()-t.getMinZoom());this._sliderBox.style.height=e+16+"px",this._sliderRuler.style.height=e+8+"px",this._sliderRuler.style.cursor="pointer";var i=10*(t.getMaxZoom()-t.getZoom());this._sliderReading.style.height=10*(t.getZoom()-t.getMinZoom()+1)+"px",this._sliderDot.style.top=i+"px"}this._updateText()},i._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();w(t)||(t=Math.floor(10*t)/10),this._levelDOM.innerHTML=t}},i._registerDomEvents=function(){this._zoomInButton&&Mi(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&Mi(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(Mi(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new $i(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},i._onZoomInClick=function(t){di(t),this.getMap().zoomIn()},i._onZoomOutClick=function(t){di(t),this.getMap().zoomOut()},i._onClickRuler=function(t){di(t);var e=this.getMap(),i=gi(t,this._sliderRuler).y,n=e.getMaxZoom(),r=Math.floor(n-i/10);e.setZoom(r)},i._onDotDragstart=function(t){di(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5);e.onZoomStart(e.getZoom(),i)},i._onDotDrag=function(t){di(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5),n=gi(t.domEvent,this._sliderRuler),r=e.getMaxZoom(),o=e.getMinZoom(),s=n.y,a=r-s/10;r<a?(a=r,s=0):o>a&&(a=o,s=10*(r-o)),"dragging"===t.type?e.onZooming(a,i,1):"dragend"===t.type&&(this.options.seamless?e.onZoomEnd(a,i):e.onZoomEnd(Math.round(a),i)),this._sliderDot.style.top=s+"px",this._sliderReading.style.height=10*(e.getZoom()-o+1)+"px",this._updateText()},e}(Da);Fa.mergeOptions({position:"top-left",slider:!0,zoomLevel:!0,seamless:!1}),ko.mergeOptions({zoomControl:!1}),ko.addOnLoadHook(function(){this.options.zoomControl&&(this.zoomControl=new Fa(this.options.zoomControl),this.addControl(this.zoomControl))});var Ua=Object.freeze({Control:Da,Attribution:Ia,LayerSwitcher:Ba,Overview:ja,Panel:za,Scale:Ga,Toolbar:Na,Zoom:Fa}),Ha=function(){function t(t,e,i,n){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:i,y:n})}return t.getDefault=function(t){return"baidu"===t.code.toLowerCase()?"baidu":t.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":"identity"===t.code.toLowerCase()?[1,-1,0,0]:"web-mercator"},t}(),Va=6378137*Math.PI;v(Ha,{"web-mercator":new Ha([1,-1,-Va,Va]),"tms-global-mercator":new Ha([1,1,-Va,-Va]),"tms-global-geodetic":new Ha([1,1,-180,-90]),baidu:new Ha([1,1,0,0])});var Wa=function(){function t(t,e,i,n){this.map=t,this.tileSize=n,this.fullExtent=i,this.prepareTileInfo(e,i),this._xScale=i.right>=i.left?1:-1,this._yScale=i.top>=i.bottom?1:-1;var r=t.getGLRes();this._pointOrigin=t._prjToPointAtRes(new pt(this.tileSystem.origin),r),this._glRes=r}var e=t.prototype;return e.prepareTileInfo=function(t,e){if(A(t)?t=Ha[t.toLowerCase()]:Array.isArray(t)&&(t=new Ha(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t;var i=e.right>e.left?1:-1,n=e.top>e.bottom?-1:1,r=t.origin.x,o=t.origin.y;this.transformation=new vn([i,n,r,o])},e._getTileNum=function(t,e){var i=this.tileSystem,n=this.tileSize,r=Math.floor(1e-7*i.scale.x+t.x/(n.width*e)),o=Math.ceil(1e-7*i.scale.y+t.y/(n.height*e));return{x:i.scale.x*r,y:i.scale.y*o}},e.getTileIndex=function(t,e,i){var n=this.tileSystem,r=this.transformation.transform(t,1),o=this._getTileNum(r,e);return n.scale.x<0&&(o.x-=1),n.scale.y>0&&(o.y-=1),this.getNeighorTileIndex(o.x,o.y,0,0,e,i)},e.getNeighorTileIndex=function(t,e,i,n,r,o){var s=this.tileSystem,a=t+s.scale.x*i,h=e-s.scale.y*n,l=!1,c=a,u=h,d=this._getTileFullIndex(r);return o&&(!0!==o&&"x"!==o||(d.xmax===d.xmin?a=d.xmin:a<d.xmin?(a=d.xmax-(d.xmin-a)%(d.xmax-d.xmin))===d.xmax&&(a=d.xmin):a>=d.xmax&&(a=d.xmin+(a-d.xmin)%(d.xmax-d.xmin))),!0!==o&&"y"!==o||(d.ymax===d.ymin?h=d.ymin:h>=d.ymax?h=d.ymin+(h-d.ymin)%(d.ymax-d.ymin):h<d.ymin&&(h=d.ymax-(d.ymin-h)%(d.ymax-d.ymin))===d.ymax&&(h=d.ymin))),(a<d.xmin||a>d.xmax||h>d.ymax||h<d.ymin)&&(l=!0),{x:a,y:h,idx:c,idy:u,out:l}},e._getTileFullIndex=function(t){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[t])return this._tileFullIndex[t];var e=this.fullExtent,i=this.transformation,n=this._getTileNum(i.transform(new tn(e.left,e.top),1),t),r=this._getTileNum(i.transform(new tn(e.right,e.bottom),1),t),o=this.tileSystem;return o.scale.x<0&&(n.x-=1,r.x-=1),o.scale.y>0&&(n.y-=1,r.y-=1),this._tileFullIndex[t]=new pn(n,r),this._tileFullIndex[t]},e.getTilePrjNW=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+this._yScale*n.scale.y*(e+(1===n.scale.y?1:0))*i*r.height,s=n.origin.x+this._xScale*n.scale.x*(t+(1===n.scale.x?0:1))*i*r.width;return new tn(s,o)},e.getTilePointNW=function(t,e,i){var n=this._glRes/i,r=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*n+this._yScale*r.scale.y*(e+(1===r.scale.y?1:0))*o.height,a=this._pointOrigin.x*n+this._xScale*r.scale.x*(t+(1===r.scale.x?0:1))*o.width;return new pt(a,s)},e.getTilePrjSE=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+this._yScale*n.scale.y*(e+(1===n.scale.y?0:1))*i*r.height,s=n.origin.x+this._xScale*n.scale.x*(t+(1===n.scale.x?1:0))*i*r.width;return new tn(s,o)},e.getTilePointSE=function(t,e,i){var n=this._glRes/i,r=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*n+this._yScale*r.scale.y*(e+(1===r.scale.y?0:1))*o.height,a=this._pointOrigin.x*n+this._xScale*r.scale.x*(t+(1===r.scale.x?1:0))*o.width;return new pt(a,s)},e.getTilePrjExtent=function(t,e,i){var n=this.getTilePrjNW(t,e,i),r=this.getTilePrjSE(t,e,i);return new pn(n,r)},t}(),Za=new pt(0,0),qa="undefined"!=typeof Set,Ya=function(){function t(){this._table=qa?new Set:{}}var e=t.prototype;return e.add=function(t){qa?this._table.add(t):this._table[t]=!0},e.has=function(t){return qa?this._table.has(t):this._table[t]},e.reset=function(){qa?this._table.clear():this._table={}},t}(),Qa={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!k,debug:!1,spatialReference:null,maxCacheSize:256,renderer:lt.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1},Ka=/\{ *([\w_]+) *\}/g,Xa=new pt(0,0),Ja=new pt(0,0),$a=new pt(0,0),th=new pt(0,0),eh=new pt(0,0),ih=new pt(0,0),nh=[[0,0,0],[0,0,0]],rh=[0,0,0],oh=[0,0,0],sh=[],ah=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null};var i=e.prototype;return i.getTileSize=function(){if(this._tileSize)return this._tileSize;var t=this.options.tileSize;return x(t)&&(t=[t,t]),this._tileSize=new Me(t),this._tileSize},i.getTiles=function(t,e){this._coordCache={};var i=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&i&&i.isPyramid()?this._getPyramidTiles(t,e):this._getCascadeTiles(t,e)},i._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var t=this.getSpatialReference(),e=t.getFullExtent(),i=t.getResolution(0),n=this.getMap();return this._tileFullExtent=e.convertTo(function(t){return n._prjToPointAtRes(t,i,Za)}),this._tileFullExtent},i._getRootNodes=function(t){var e=this.getMap();if(this._rootNodes){var i=this._rootNodes,n=i.tiles,r=i.mapWidth,o=i.mapHeight;if(e.width!==r||e.height!==o){for(var s=this._getRootError(),a=0;a<n.length;a++)n[a].error=s;this._rootNodes.mapWidth=e.width,this._rootNodes.mapHeight=e.height}for(var h=0;h<n.length;h++)n[h].offset[0]=t[0],n[h].offset[1]=t[1];return this._rootNodes}var l=this.getSpatialReference(),c=l.getResolution(0),u=this._getTileConfig(),d=l.getFullExtent(),f=u.tileSystem,_=f.origin,p=f.scale,m=u.getTilePrjExtent(0,0,c),g=m.getWidth(),v=m.getHeight(),y=Math.abs((_.x-d.left)/g);y=Math.ceil(y-1e-5);var x=Math.abs((d.right-_.x)/g);x=Math.ceil(x-1e-5);var w=Math.ceil(Math.abs(d.top-_.y)/v);w=Math.ceil(w-1e-5);var b=Math.ceil(Math.abs(d.bottom-_.y)/v);if((x+y)*((b=Math.ceil(b-1e-5))+w)>32)return{status:0,error:"Too many root nodes"};for(var A=this._getRootError(),C=[],S=-y;S<x;S++)for(var E=-w;E<b;E++){var P=p.y<0?E:-(E+1);C.push({x:S,y:P,z:0,idx:S,idy:P,extent2d:u.getTilePrjExtent(S,P,c).convertTo(function(t){return e._prjToPointAtRes(t,c,Za)}),id:this._getTileId(S,P,0),url:this.getTileUrl(S,P,0+this.options.zoomOffset),offset:[0,0],error:A})}return this._rootNodes={status:1,tiles:C,mapWidth:e.width,mapHeight:e.height},this._getRootNodes(t)},i._getRootError=function(){var t=this.getMap(),e=M(t.getFov()),i=t.width/t.height,n=t.cameraPosition[2],r=n*Math.tan(.5*e),o=r*i,s=Math.sqrt(n*n+r*r+o*o);return t._getFovZ(0)*(s/n)*this.getSpatialReference().getResolution(0)/t.getResolution(0)},i._getPyramidTiles=function(t,e){var i=this.getMap();isNaN(+t)&&(t=this._getTileZoom(i.getZoom()));var n,r=this.getSpatialReference(),o=Math.min(t,this.getMaxZoom()),s=i.projViewMatrix,a=this._getTileFullExtent(),h=this._getTileOffset(0);if(this.options.repeatWorld){var l=i.getContainerExtent(),c=this._convertToExtent2d(l),u=r.getResolution(0)/i.getResolution();if(c.within(a.copy()._scale(u))){var d=this._getRootNodes(h);if(1!==d.status)return console.warn(d.error),this._disablePyramid=!0,this.getTiles(t,e);n=d.tiles.concat()}else{var f=i.getPitch(),_=i.options.cascadePitches[1],p=Math.floor(i._getVisualHeight(_)),m=f<=_?l:new gn(0,i.height-p,i.width,i.height);this._visitedTiles=new Ya;var g=this._getTiles(0,m,2,e&&e.getRenderer(),!0),v=this._getRootError();g.tiles.forEach(function(t){t.error=v}),n=g.tiles}}else{var y=this._getRootNodes(h);if(1!==y.status)return console.warn(y.error),this._disablePyramid=!0,this.getTiles(t,e);n=y.tiles.concat()}for(var x=i.getGLRes(),w={0:h},b=new gn,A=[];n.length>0;){var C=n.pop();C.z!==o?(w[C.z+1]||(w[C.z+1]=this._getTileOffset(C.z+1)),this._splitNode(C,s,n,A,b,o,w[C.z+1],e&&e.getRenderer(),x)):(b._combine(C.extent2d),A.push(C))}return{tileGrids:[{extent:b,count:A.length,tiles:A,offset:[0,0],zoom:t}],count:A.length}},i._splitNode=function(t,e,i,n,r,o,s,a,h){for(var l=this._getTileConfig().tileSystem.scale.y,c=t.z+1,u=this.getSpatialReference(),d=t.x,f=t.y,_=t.extent2d,p=t.idx,m=t.idy,g=_.getWidth()/2*2,v=_.getHeight()/2*2,y=2*_.xmin,x=2*_.ymax,w=2*_.ymin,b=a||this.getRenderer(),A=!1,C=[],S=u.getResolution(c)/h,E=0;E<4;E++){var P=E%2,M=E>>1,T=(d<<1)+P,k=(f<<1)+M,R=(p<<1)+P,L=(m<<1)+M,D=this._getTileId(R,L,c),O=b.isTileCachedOrLoading(D),I=void 0;if(!O)if(l<0){var B=y+P*g,j=x-M*v;I=new gn(B,j-v,B+g,j)}else{var z=y+P*g,G=w+M*v;I=new gn(z,G,z+g,G+v)}var N=O&&O.info;N||(N={x:T,y:k,idx:R,idy:L,z:c,extent2d:I,error:t.error/2,id:D,url:this.getTileUrl(T,k,c+this.options.zoomOffset),offset:s},a&&(N.layer=this.getId())),N.error=t.error/2,N.offset[0]=s[0],N.offset[1]=s[1];var F=this._isTileVisible(N,e,S,o,s);if(1===F)A=!0;else{if(-1===F)continue;if(0===F&&c!==o)return n.push(t),void r._combine(t.extent2d)}C.push(N)}c===o?A?i.push.apply(i,C):(n.push(t),r._combine(t.extent2d)):i.push.apply(i,C)},i._isTileVisible=function(t,e,i,n,r){if(0===t.z)return 1;if(!this._isTileInFrustum(t,e,i,r))return-1;var o=this.options.maxError;return y(o)&&(o=1),this._getScreenSpaceError(t,i,n,r)>=o?1:0},i._isTileInFrustum=function(t,e,i,n){var r=t.extent2d,o=r.xmin,s=r.ymin,a=r.xmax,h=r.ymax;return nh[0][0]=(o-n[0])*i,nh[0][1]=(s-n[1])*i,nh[1][0]=(a-n[0])*i,nh[1][1]=(h-n[1])*i,Object(l.a)(e,nh)},i._getScreenSpaceError=function(t,e,i,n){var r=t.error,o=this.getMap(),s=t.extent2d,a=s.xmin,h=s.ymin,l=s.xmax,c=s.ymax;rh[0]=(a-n[0])*e,rh[1]=(h-n[1])*e,oh[0]=(l-n[0])*e,oh[1]=(c-n[1])*e;var u,d,f,_,p,m,g=(u=rh,d=oh,f=o.cameraPosition,_=Math.max(u[0]-f[0],0,f[0]-d[0]),p=Math.max(u[1]-f[1],0,f[1]-d[1]),m=Math.max(u[2]-f[2],0,f[2]-d[2]),Math.sqrt(_*_+p*p+m*m)),v=Math.max(Math.abs(g),1e-7),y=Math.abs(t.z-i);return r*(o.height<1e3?1:y<=1?1:y<=2?.7:.605)/v},i._getCascadeTiles=function(t,e){var i=this.getMap(),n=i.getPitch(),r=e&&e.getRenderer(),o=i.getContainerExtent(),s=[],a=0,h=this.getMinZoom(),l=i.options.cascadePitches[0],c=i.options.cascadePitches[1],u=Math.floor(i._getVisualHeight(c)),d=y(t)?this._getTileZoom(i.getZoom()):t;if(this._visitedTiles=new Ya,!y(t)||!this.options.cascadeTiles||n<=l||!y(h)&&d<=h){var f=n<=c?o:new gn(0,i.height-u,i.width,i.height),_=this._getTiles(d,f,2,r);return _&&(a+=_.tiles.length,s.push(_)),{tileGrids:s,count:a}}var p=Math.floor(i._getVisualHeight(l)),m=new gn(0,i.height-p,i.width,i.height),g=this._getTiles(d,m,0,r);a+=g?g.tiles.length:0,s.push(g);var v,x,w=m.ymin,b=i.getSpatialReference().getZoomDirection(),A=b;if(n>c){d-A<=h&&(A=0);var C=new gn(0,i.height-u,i.width,w);a+=(v=this._getTiles(d-A,C,1,r))?v.tiles.length:0,w=C.ymin,A+=4*b}if(d-A>=h){var S=new gn(0,o.ymin,i.width,w);a+=(x=this._getTiles(d-A,S,2,r))?x.tiles.length:0,s.push(x)}return v&&x&&(s[1]=x,s[2]=v),{tileGrids:s,count:a}},i.getTileUrl=function(t,e,i){var n=this.options.urlTemplate,r="";if(this.options.subdomains){var o=this.options.subdomains;if(kt(o)){var s=(t+e)%o.length;s<0&&(s=0),r=o[s]}}if(C(n))return n(t,e,i,r);var a={x:t,y:e,z:i,s:r};return this.options.token&&(a.token=this.options.token),n.replace(Ka,function(t,e){var i=a[e];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(a)),i})},i.clear=function(){return this._renderer&&this._renderer.clear(),this.fire("clear"),this},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},i.getSpatialReference=function(){var t=this.getMap();if(t&&(!this.options.spatialReference||po.equals(this.options.spatialReference,t.options.spatialReference)))return t.getSpatialReference();if(this._sr)return this._sr;var e=this.options.spatialReference;if(A(e)&&!(e=po.getPreset(e)))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+po.getAllPresets().join());return this._sr=new po(e),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==t.getSpatialReference().toJSON().projection,this._sr},i.getMinZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(t.prototype.getMinZoom.call(this),this._srMinZoom):t.prototype.getMinZoom.call(this)},i.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(t.prototype.getMaxZoom.call(this),this._srMaxZoom):t.prototype.getMaxZoom.call(this)},i._getTileZoom=function(t){if(!this._hasOwnSR){var e=this.getMap().getResolution(t),i=this.getSpatialReference().getResolution(t);t+=Math.log(i/e)*Math.LOG2E}var n=this.options.maxAvailableZoom;return!y(n)&&t>n&&(t=n),w(t)||(t=Math.round(t)),t=Math.max(0,t)},i._getTiles=function(t,e,i,n,r){var o=this.getMap(),s=t,a=o.projViewMatrix;i<2&&(0===i&&(s-=1),a=0===i?o.cascadeFrustumMatrix0:1===i?o.cascadeFrustumMatrix1:o.projViewMatrix);var h=s+this.options.zoomOffset,l=this._getTileOffset(h),c=l[0]||l[1],u={zoom:s,extent:null,offset:l,tiles:[]};if(h<0)return u;if(!(o&&this.isVisible()&&o.width&&o.height))return u;if(!r){var d=this.getMinZoom(),f=this.getMaxZoom();if(!y(d)&&s<d||!y(f)&&s>f)return u}var _=this._getTileConfig();if(!_)return u;var p,m={zoom:l},g=this.getSpatialReference().getResolution(h);p=this._hasOwnSR?o.getGLScale(s):g/o.getGLRes();var v=!this._hasOwnSR&&this.options.repeatWorld,x=this._convertToExtent2d(e),w=this._getMask2DExtent();if(w){var b=w.intersection(x);if(!b)return u;e=b.convertTo(function(t){return o._pointToContainerPoint(t,void 0,0,Za)})}var A,C=o._containerPointToPrj(e.getCenter(),Xa),S=o._prjToPoint(C,h,Ja);A=c?this._project(o._pointToPrj(S._add(l),h,Ja),Ja):this._project(C,Ja);var E=o.getGLScale()/o.getGLScale(h);$a.x=x.xmin*E,$a.y=x.ymax*E,th.x=x.xmax*E,th.y=x.ymin*E;for(var P=this._project(o._pointToPrj($a._add(l),h,$a),$a),M=this._project(o._pointToPrj(th._add(l),h,th),th),T=_.getTileIndex(A,g,v),k=_.getTileIndex(P,g,v),R=_.getTileIndex(M,g,v),L=Math.ceil(Math.abs(T.idy-k.idy)),D=Math.ceil(Math.abs(T.idx-k.idx)),O=Math.ceil(Math.abs(T.idy-R.idy)),I=Math.ceil(Math.abs(T.idx-R.idx)),B=(L+O+1)*(D+I+1),j=this.getTileSize(),z=this.getRenderer()||n,G=this._getTileConfig().tileSystem.scale,N=[],F=new gn,U=new pt(0,0),H=-L;H<=O;H++)for(var V=-D,W=-1/0,Z=!1;V>=W&&V<=I;){var q=_.getNeighorTileIndex(T.idx,T.idy,V,H,g,v);W===-1/0?V++:V--;var Y=this._getTileId(q.idx,q.idy,s);if(!(q.out||this._visitedTiles&&this._visitedTiles.has(Y))){var Q=z&&z.isTileCachedOrLoading(Y);Q&&(Q=Q.info);var K=void 0;if(Q){var X=Q.extent2d;U.set(X.xmin,X.ymax),K=U}else if(this._hasOwnSR){var J=_.getTilePrjNW(q.x,q.y,g);K=o._prjToPoint(this._unproject(J,th),s)}else K=_.getTilePointNW(q.x,q.y,g);var $=void 0,tt=void 0;if(this._hasOwnSR){var et=void 0;if(this._hasOwnSR){var it=_.getTilePrjSE(q.x,q.y,g);et=o._prjToPoint(this._unproject(it,th),s,th)}else et=_.getTilePointSE(q.x,q.y,g);$=Math.ceil(Math.abs(et.x-K.x)),tt=Math.ceil(Math.abs(et.y-K.y))}else $=j.width,tt=j.height;var nt=G.x*(q.idx-q.x)*$,rt=G.y*(q.idy-q.y)*tt;Q||!nt&&!rt||K._add(nt,rt);var ot=Q&&Q.extent2d||new gn(K.x,K.y-tt,K.x+$,K.y);(B<=4||Z||this._isTileInExtent(a,ot,l,p))&&(this._visitedTiles&&0===i&&this._visitedTiles.add(Y),0===i?(this._splitTiles(a,N,z,q,s+1,ot,nt,rt,m,n),F._combine(ot)):(Q?(Q.offset[0]=l[0],Q.offset[1]=l[1]):(Q={z:s,x:q.x,y:q.y,idx:q.idx,idy:q.idy,extent2d:ot,offset:l,id:Y,url:this.getTileUrl(q.x,q.y,s)},n&&(Q.layer=this.getId())),N.push(Q),F._combine(ot)),W===-1/0?(W=V,V=I):Z||(Z=!0))}}if(N.length){var st=o._containerPointToPoint(e.getCenter(),s,Za)._add(l),at=new pt(0,0),ht=new pt(0,0);N.sort(function(t,e){return at.set((t.extent2d.xmin+t.extent2d.xmax)/2,(t.extent2d.ymin+t.extent2d.ymax)/2),ht.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),at.distanceTo(st)-ht.distanceTo(st)})}return{offset:l,zoom:t,extent:F,tiles:N}},i._convertToExtent2d=function(t){var e=this,i=this.getMap();return t.convertTo(function(t){if(t.y>0&&t.y<i.height){var n=(0===t.x?0:1)+t.y;e._coordCache[n]||(e._coordCache[n]=i._containerPointToPoint(t)),e._coordCache[n]}return i._containerPointToPoint(t,void 0,Za)})},i._splitTiles=function(t,e,i,n,r,o,s,a,h,l){var c=this._getTileConfig().tileSystem.scale.y,u=this.getMap().getGLScale(r),d=eh.set(2*o.xmin,c<0?2*o.ymax:2*o.ymin),f=o.getWidth(),_=o.getHeight(),p=2*n.idx,m=2*n.idy,g=2*n.x,v=2*n.y,y=this._checkAndAddTile(t,i,p,m,g,v,r,0,0,f,_,d,u,h,l);y&&e.push(y),(y=this._checkAndAddTile(t,i,p,m,g,v,r,0,1,f,_,d,u,h,l))&&e.push(y),(y=this._checkAndAddTile(t,i,p,m,g,v,r,1,0,f,_,d,u,h,l))&&e.push(y),(y=this._checkAndAddTile(t,i,p,m,g,v,r,1,1,f,_,d,u,h,l))&&e.push(y)},i._checkAndAddTile=function(t,e,i,n,r,o,s,a,h,l,c,u,d,f,_){var p=this._getTileId(i+a,n+h,s);if(this._visitedTiles&&this._visitedTiles.has(p))return null;var m=f[s];m||(m=f[s]=this._getTileOffset(s));var g=this._getTileConfig().tileSystem.scale.y,v=new gn(u.x+a*l,u.y+g*h*c,u.x+(a+1)*l,u.y+g*(h+1)*c);if(!this._isSplittedTileInExtent(t,v,m,d))return null;var y=e&&e.isTileCachedOrLoading(p);return y?y=y.info:(y={z:s,x:r+a,y:o+h,extent2d:v,id:p,offset:m,url:this.getTileUrl(r+a,o+h,s+this.options.zoomOffset)},_&&(y.layer=this.getId())),y},i._getTileOffset=function(t){var e=this.options.offset;return C(e)&&(e=e(t)),e},i._getTileId=function(t,e,i,n){return(n||this.getId())+"_"+e+"_"+t+"_"+i},i._project=function(t,e){if(this._hasOwnSR){var i=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(i.unproject(t,e),e)}return t},i._unproject=function(t,e){if(this._hasOwnSR){var i=this.getMap(),n=this.getSpatialReference(),r=i.getProjection(),o=n.getProjection();return r.project(o.unproject(t,e),e)}return t},i._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),i=this.getSpatialReference(),n=i.getProjection(),r=i.getFullExtent();this._defaultTileConfig=new Wa(t,Ha.getDefault(n),r,e),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new Wa(t,this.options.tileSystem,r,e)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},i._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},i._bindMap=function(e){var i=e.getBaseLayer();return i===this&&(i.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),this._onSpatialReferenceChange(),t.prototype._bindMap.apply(this,arguments)},i._isTileInExtent=function(t,e,i,n){var r,o,s,a,h,c,u,d,f=this.getMap();if(t!==f.projViewMatrix){var _=e.getCenter(ih)._sub(i[0],i[1])._multi(n);Hs(sh,_.x,_.y,0),r=(o=sh,s=sh,a=f.projViewMatrix,h=s[0],c=s[1],u=s[2],d=(d=a[3]*h+a[7]*c+a[11]*u+a[15])||1,o[0]=(a[0]*h+a[4]*c+a[8]*u+a[12])/d,o[1]=(a[1]*h+a[5]*c+a[9]*u+a[13])/d,o[2]=(a[2]*h+a[6]*c+a[10]*u+a[14])/d,o)[1]<0?f.projViewMatrix:t}else r=f.projViewMatrix;return nh[0][0]=(e.xmin-i[0])*n,nh[0][1]=(e.ymin-i[1])*n,nh[1][0]=(e.xmax-i[0])*n,nh[1][1]=(e.ymax-i[1])*n,Object(l.a)(r,nh)},i._isSplittedTileInExtent=function(t,e,i,n){var r=this.getMap();return nh[0][0]=(e.xmin-i[0])*n,nh[0][1]=(e.ymin-i[1])*n,nh[1][0]=(e.xmax-i[0])*n,nh[1][1]=(e.ymax-i[1])*n,Object(l.a)(r.projViewMatrix,nh)},i.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},i._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR;var t=this.getRenderer();t&&t.clear()},e}(xo);ah.registerJSONType("TileLayer"),ah.mergeOptions(Qa);var hh,lh="\nfunction (exports) {\n    exports.onmessage = function (msg, postResponse) {\n        var url = msg.data.url;\n        var fetchOptions = msg.data.fetchOptions;\n        requestImageOffscreen(url, function (err, data) {\n            var buffers = [];\n            if (data && data.data && data.data.buffer) {\n                buffers.push(data.data.buffer);\n            }\n            postResponse(err, data, buffers);\n        }, fetchOptions);\n    };\n\n    var offCanvas, offCtx;\n    function requestImageOffscreen(url, cb, fetchOptions) {\n        if (!offCanvas) {\n            offCanvas = new OffscreenCanvas(2, 2);\n            offCtx = offCanvas.getContext('2d');\n        }\n        fetch(url, fetchOptions ? fetchOptions : {})\n            .then(response => response.blob())\n            .then(blob => createImageBitmap(blob))\n            .then(bitmap => {\n                var { width, height } = bitmap;\n                offCanvas.width = width;\n                offCanvas.height = height;\n                offCtx.drawImage(bitmap, 0, 0);\n                bitmap.close();\n                var imgData = offCtx.getImageData(0, 0, width, height);\n                // debugger\n                cb(null, { width, height, data: new Uint8Array(imgData.data) });\n            }).catch(err => {\n                console.warn('error when loading tile:', url);\n                console.warn(err);\n                cb(err);\n            });\n    }\n}";lt.decodeImageInWorker&&(hh=function(){return lh},zn[Jn]=hh);var ch=new Me(256,256),uh=function(t){function e(e,i,n){var r;return(r=t.call(this,e,n)||this).layers=i||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}ct(e,t),e.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var i=t.layers.map(function(t){return xo.fromJSON(t)});return new e(t.id,i,t.options)};var i=e.prototype;return i.getLayers=function(){return this.layers},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map(function(t){return t.toJSON()}),options:this.config()}},i.getTileSize=function(t){var e=this.getLayer(t);return e?e.getTileSize():ch},i.getTiles=function(t,e){for(var i=this.layers,n=[],r=0,o=0,s=i.length;o<s;o++){var a=i[o];if(a.options.visible){var h=a.getTiles(t,e||this);h&&0!==h.count&&(r+=h.count,wt(n,h.tileGrids))}}return{count:r,tileGrids:n}},i.onAdd=function(){var e=this,i=this.getMap();this.layers.forEach(function(t){e.layerMap[t.getId()]=t,t.getChildLayer&&e._groupChildren.push(t),t._bindMap(i),t.on("show hide",e._onLayerShowHide,e)}),t.prototype.onAdd.call(this)},i.onRemove=function(){var e=this;this.layers.forEach(function(t){t._doRemove(),t.off("show hide",e._onLayerShowHide,e)}),this.layerMap={},this._groupChildren=[],t.prototype.onRemove.call(this)},i.getLayer=function(t){return this.getChildLayer(t)},i.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var i=0;i<this._groupChildren.length;i++){var n=this._groupChildren[i].getChildLayer(t);if(n)return n}return null},i._onLayerShowHide=function(){var t=this.getRenderer();t&&t.setToRedraw()},i.isVisible=function(){if(!t.prototype.isVisible.call(this))return!1;for(var e=this.layers,i=0,n=e.length;i<n;i++)if(e[i].isVisible())return!0;return!1},i._checkChildren=function(){var t=this,e={};this.layers.forEach(function(i){var n=i.getId();if(e[n])throw new Error("Duplicate child layer id ("+n+") in the GroupTileLayer ("+t.getId()+")");e[n]=1})},e}(ah);uh.registerJSONType("GroupTileLayer"),uh.mergeOptions({maxCacheSize:1024});var dh={crs:null,uppercase:!1,detectRetina:!1},fh={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},_h=function(t){function e(e,i){var n;n=t.call(this,e)||this;var r=v({},fh);for(var o in i)o in n.options||(r[o]=i[o]);n.setOptions(i),n.setZIndex(i.zIndex);var s=n.getTileSize();return r.width=s.width,r.height=s.height,n.wmsParams=r,n._wmsVersion=parseFloat(r.version),n}ct(e,t);var i=e.prototype;return i.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),i=dh.detectRetina?e:1;this.wmsParams.width*=i,this.wmsParams.height*=i;var n=this.options.crs||this.getMap().getProjection().code,r=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[r]=n,t.prototype.onAdd.call(this)},i.getTileUrl=function(e,i,n){var r=this.getSpatialReference().getResolution(n),o=this._getTileConfig().getTilePrjExtent(e,i,r),s=o.getMax(),a=o.getMin(),h=(this._wmsVersion>=1.3&&"EPSG:4326"===this.wmsParams.crs?[a.y,a.x,s.y,s.x]:[a.x,a.y,s.x,s.y]).join(","),l=t.prototype.getTileUrl.call(this,e,i,n);return l+function(t,e,i){var n=[];for(var r in t)n.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}(this.wmsParams,l,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},i.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new e(t.id,t.options):null},e}(ah);_h.registerJSONType("WMSTileLayer"),_h.mergeOptions(dh);var ph=function(t){function e(e,i){var n;return(n=t.call(this,e,i)||this).options.hasOwnProperty("forceRenderOnMoving")||(n.options.forceRenderOnMoving=!1),n}ct(e,t);var i=e.prototype;return i.drawTile=function(){},i.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new e(t.id,t.options):null},e}(ah);function mh(t,e,i){var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+r)}return n}function gh(t,e,i){var n=mh(t,t.VERTEX_SHADER,e),r=mh(t,t.FRAGMENT_SHADER,i);if(!n||!r)return null;var o=t.createProgram();return o?(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),{program:o,vertexShader:n,fragmentShader:r}):null}function vh(t,e,i){if(Array.isArray(i[0])){for(var n=Float32Array.BYTES_PER_ELEMENT,r=0,o=0;o<i.length;o++)r+=i[o][1]||0;for(var s=0,a=0;a<i.length;a++){var h=t.getAttribLocation(e,i[a][0]);if(h<0)throw new Error("Failed to get the storage location of "+i[a][0]);t.vertexAttribPointer(h,i[a][1],t[i[a][2]||"FLOAT"],!1,n*r,n*s),s+=i[a][1]||0,t.enableVertexAttribArray(h)}}else{var l=t.getAttribLocation(e,i[0]);t.vertexAttribPointer(l,i[1],t[i[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(l)}}ph.registerJSONType("CanvasTileLayer");var yh="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",xh="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n        }\n    ",wh=[0,0],bh=[0,0,0],Ah=new Array(16),Ch=new pt(20,20),Sh=function(t){var e,i=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.drawGLImage=function(t,e,i,n,r,o,s,a){this.gl.program!==this.program&&this.useProgram(this.program);var h=this.gl;this.loadTexture(t),bh[0]=e||0,bh[1]=i||0;var l=Fs(Ah);js(l,l,bh),zs(l,l,[o,o,1]),Gs(l,this.getMap().projViewMatrix,l),h.uniformMatrix4fv(this.program.u_matrix,!1,l),h.uniform1f(this.program.u_opacity,s),h.uniform1f(this.program.u_debug_line,0);var c=t.glBuffer;!c||c.width===n&&c.height===r||(this.saveImageBuffer(c),delete t.glBuffer),t.glBuffer?h.bindBuffer(h.ARRAY_BUFFER,c):t.glBuffer=this.bufferTileData(0,0,n,r),wh[0]="a_position",wh[1]=2,wh[2]=t.glBuffer.type,this.enableVertexAttrib(wh),h.drawArrays(h.TRIANGLE_STRIP,0,4),a&&this.drawDebug(l,wh,0,0,n,r,a)},i.drawDebug=function(t,e,i,n,r,o,s){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),a.bufferData(a.ARRAY_BUFFER,new Float32Array([i,n,i+r,n,i+r,n-o,i,n-o,i,n]),a.DYNAMIC_DRAW),a.uniformMatrix4fv(this.program.u_matrix,!1,t),a.uniform1f(this.program.u_debug_line,1),a.drawArrays(a.LINE_STRIP,0,5);var h=this._debugInfoCanvas;if(!h){var l=this.getMap().getDevicePixelRatio()>1?2:1;(h=this._debugInfoCanvas=document.createElement("canvas")).width=256*l,h.height=32*l;var c=h.getContext("2d");c.font="20px monospace",c.scale(l,l)}var u=h.getContext("2d");u.clearRect(0,0,h.width,h.height);var d=this.layer.options.debugOutline;ji.fillText(u,s,Ch,d),this.loadTexture(h),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,h);var f=i,_=i+(r=256),p=n,m=n-(o=32);a.bufferData(a.ARRAY_BUFFER,this.set8(f,p,f,m,_,p,_,m),a.DYNAMIC_DRAW),a.uniform1f(this.program.u_debug_line,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)},i.bufferTileData=function(t,e,i,n,r){var o,s=t,a=t+i,h=e,l=e-n;o=w(s)&&w(a)&&w(h)&&w(l)?this.set8Int(s,h,s,l,a,h,a,l):this.set8(s,h,s,l,a,h,a,l);var c=this.loadImageBuffer(o,r);return c.width=i,c.height=n,c.type=o instanceof Int16Array?"SHORT":"FLOAT",c},i.drawTinImage=function(t,e,i,n,r){var o=this.gl;this.loadTexture(t),o.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),o.uniform1f(this.program.u_opacity,r),o.bindBuffer(o.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(i),o.DYNAMIC_DRAW),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),o.DYNAMIC_DRAW),o.drawElements(o.TRIANGLES,n.length,o.UNSIGNED_SHORT,0)},i.createCanvas2=function(){this.canvas2=ji.createCanvas(this.canvas.width,this.canvas.height)},i.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=function(t,e){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},n=["webgl","experimental-webgl"],r=null,o=0;o<n.length;++o){try{r=t.getContext(n[o],e||i)}catch(t){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var t=this.gl;t.clearColor(0,0,0,0),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(yh,this.layer.options.fragmentShader||xh),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),t.bufferData(t.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},i.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},i.clearGLCanvas=function(){this.gl&&this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)},i.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},i._createTexture=function(t){var e=this.gl,i=this.getTexture()||e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),w(Et(t.width))&&w(Et(t.width))&&e.generateMipmap(e.TEXTURE_2D),i},i.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&t.length>0?t.pop():null},i.saveTexture=function(t){this._textures.push(t)},i.loadTexture=function(t){var e=this.gl,i=t.texture;return i||(i=this._createTexture(t),t.texture=i),e.bindTexture(e.TEXTURE_2D,i),i},i.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&t.length>0?t.pop():null},i.saveImageBuffer=function(t){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(t)},i.loadImageBuffer=function(t,e){var i=this.gl,n=e||this.createImageBuffer();return i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW),n},i.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},i.removeGLCanvas=function(){var t=this.gl;if(t){if(this._debugBuffer&&(t.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach(function(e){t.deleteBuffer(e)}),delete this._buffers),this._textures&&(this._textures.forEach(function(e){return t.deleteTexture(e)}),delete this._textures),this._debugInfoCanvas){var e=this._debugInfoCanvas.texture;e&&t.deleteTexture(e),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var i=t.program;t.deleteShader(i.fragmentShader),t.deleteShader(i.vertexShader),t.deleteProgram(i),delete this.gl,delete this.canvas2}},i.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},i.enableVertexAttrib=function(t){vh(this.gl,this.gl.program,t)},i.createProgram=function(t,e){for(var i=this.gl,n=gh(i,t,e),r=n.program,o=n.vertexShader,s=n.fragmentShader,a=i.getProgramParameter(r,35718),h=[],l=0;l<a;++l){var c=i.getActiveUniform(r,l);h.push(c.name)}return r.vertexShader=o,r.fragmentShader=s,this._initUniforms(r,h),r},i.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},i.enableSampler=function(t,e){var i=this.gl,n=this._getUniform(i.program,t);return e||(e=0),i.uniform1i(n,e),n},i._initUniforms=function(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=e[i],o=n.indexOf("[");o>=0&&(n=n.substring(0,o),k||(r=r.substring(0,o))),t[n]=this._getUniform(t,r)}},i._getUniform=function(t,e){var i=this.gl.getUniformLocation(t,e);if(!i)throw new Error("Failed to get the storage location of "+e);return i},e}(t);return v(i.prototype,{set8:(e=lt.ie9?null:new Float32Array(8),function(t,i,n,r,o,s,a,h){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=h,e}),set8Int:function(){var t=lt.ie9?null:new Int16Array(8);return function(e,i,n,r,o,s,a,h){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t}}()}),i},Eh={renderer:lt.webgl?"gl":"canvas",crossOrigin:null},Ph=new pt(0,0),Mh=function(t){function e(e,i,n){var r;return!i||Array.isArray(i)||i.url||(n=i,i=null),(r=t.call(this,e,n)||this)._images=i,r}ct(e,t);var i=e.prototype;return i.onAdd=function(){this._prepareImages(this._images)},i.setImages=function(t){return this._images=t,this._prepareImages(t),this},i.getImages=function(){return this._images},i._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap(),i=e.getGLRes();this._imageData=t.map(function(t){var n=new pn(t.extent);return v({},t,{extent:n,extent2d:n.convertTo(function(t){return e.coordToPointAtRes(t,i)})})}),this._images=t;var n=this.getRenderer();n&&n.refreshImages()},e}(xo);Mh.mergeOptions(Eh);var Th=[],kh=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},i.checkResources=function(){var t=this;if(this._imageLoaded)return Th;var e=this.layer._imageData.map(function(t){return[t.url,null,null]});if(this.resources){var i=[],n=new ir;e.forEach(function(e){if(t.resources.isResourceLoaded(e)){var r=t.resources.getImage(e);n.addResource(e,r)}else i.push(e)}),this.resources.forEach(function(e,i){n.isResourceLoaded(e)||t.retireImage(i.image)}),this.resources=n,e=i}return this._imageLoaded=!0,e},i.retireImage=function(t){t.close&&t.close()},i.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},i.draw=function(){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},i._drawImages=function(){var t=this.layer._imageData,e=this.getMap(),i=e._get2DExtentAtRes(e.getGLRes());if(t&&t.length)for(var n=0;n<t.length;n++){var r=t[n].extent2d,o=this.resources&&this.resources.getImage(t[n].url);o&&i.intersects(r)&&(this._painted=!0,this._drawImage(o,r,t[n].opacity||1))}},i._drawImage=function(t,e,i){var n=0,r=this.context;i<1&&(n=r.globalAlpha,r.globalAlpha=i);var o=this.getMap(),s=Ph.set(e.xmin,e.ymax),a=o._pointAtResToContainerPoint(s,o.getGLRes()),h=a.x,l=a.y,c=o.getBearing();c&&(r.save(),r.translate(h,l),c&&r.rotate(-c*Math.PI/180),h=l=0);var u=o.getGLScale();r.drawImage(t,h,l,e.getWidth()/u,e.getHeight()/u),c&&r.restore(),n&&(r.globalAlpha=n)},i.drawOnInteracting=function(){this.draw()},e}(er),Rh=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.isDrawable=function(){return!0},i._drawImage=function(t,e,i){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,i)},i.createContext=function(){this.createGLContext()},i.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.retireImage=function(t){t.close&&t.close(),this.disposeImage(t)},i.onRemove=function(){this.removeGLCanvas(),t.prototype.onRemove.call(this)},e}(Sh(kh));Mh.registerRenderer("canvas",kh),Mh.registerRenderer("gl",Rh);var Lh=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.getPrepareParams=function(){return[]},i.getDrawParams=function(){return[]},i.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=ji.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},i.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&t.prototype.needToRedraw.call(this)},i.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,arguments)},i.drawOnInteracting=function(){this._drawLayerOnInteracting.apply(this,arguments)},i.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var i=e.image;this.buffer.width===i.width&&this.buffer.height===i.height||(this.buffer.width=i.width,this.buffer.height=i.height);var n=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(n,this.context);(void 0===r||r)&&(ji.image(n,i,0,0),e.image=this.buffer)}return e},i.remove=function(){return delete this._drawContext,t.prototype.remove.call(this)},i.onZoomStart=function(e){this.layer.onZoomStart(e),t.prototype.onZoomStart.call(this,e)},i.onZooming=function(e){this.layer.onZooming(e),t.prototype.onZooming.call(this,e)},i.onZoomEnd=function(e){this.layer.onZoomEnd(e),t.prototype.onZoomEnd.call(this,e)},i.onMoveStart=function(e){this.layer.onMoveStart(e),t.prototype.onMoveStart.call(this,e)},i.onMoving=function(e){this.layer.onMoving(e),t.prototype.onMoving.call(this,e)},i.onMoveEnd=function(e){this.layer.onMoveEnd(e),t.prototype.onMoveEnd.call(this,e)},i.onResize=function(e){this.layer.onResize(e),t.prototype.onResize.call(this,e)},i.prepareDrawContext=function(){if(!this._predrawed){var t=Dh(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},i._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],i=Dh(this.getDrawParams());return e.push.apply(e,i),e.push.apply(e,this._drawContext),e},i._drawLayer=function(){var t=this._prepareDrawParams();if(t){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];this.layer.draw.apply(this.layer,t.concat(i)),this.completeRender()}},i._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var t=this._prepareDrawParams();if(t){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];this.layer.drawOnInteracting.apply(this.layer,t.concat(i)),this.completeRender()}}},e}(er);function Dh(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var Oh=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.isCanvasRender=function(){return!0},i.prepareToDraw=function(){},i.draw=function(){},i.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},i.play=function(){return this.config("animation",!0),this},i.pause=function(){return this.config("animation",!1),this},i.isPlaying=function(){return this.options.animation},i.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},i.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},i.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},i.onCanvasCreate=function(){return this},i.onZoomStart=function(){},i.onZooming=function(){},i.onZoomEnd=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){},i.onResize=function(){},i.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},e}(xo);Oh.mergeOptions({doubleBuffer:!1,animation:!1}),Oh.registerRenderer("canvas",Lh);var Ih=new pt(0,0),Bh=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.getParticles=function(){},i.draw=function(t,e){var i=this.getParticles(g());if(i&&0!==i.length){var n=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo(function(t){return n._pointToContainerPoint(t,void 0,0,Ih)});for(var o=2*Math.PI,s=0,a=i.length;s<a;s++){var h=i[s].point;if(r.contains(h)){var l=i[s].color||this.options.lineColor||"#fff",c=i[s].r;t.fillStyle!==l&&(t.fillStyle=l),c<=2?t.fillRect(h.x-c/2,h.y-c/2,c,c):(t.beginPath(),t.arc(h.x,h.y,c/2,0,o),t.fill())}}this._fillCanvas(t)}else{this._getRenderer()&&(this._getRenderer()._shouldClear=!0)}},i._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var i=this.options.trail||30;t.fillStyle="rgba(0, 0, 0, "+1/i+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}(Oh);Bh.mergeOptions({animation:!0}),Bh.registerRenderer("canvas",function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},i.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(Lh));var jh,zh,Gh=new ir,Nh=function(t){function e(e,i,n){var r;(r=t.call(this,n)||this).target=e,e.once("remove",r.delete,ut(ut(r)));var o=r.options.symbol,s=o.markerLineWidth||1;return r.w=o.markerWidth+s,r.h=o.markerHeight+s,r.dx=o.markerDx||0,r.dy=o.markerDy||0,r.opacity=y(o.opacity)?1:o.opacity,r.map=i,r.events=n.events,r._fetchImage(),r.addTo(i),r}ct(e,t);var i=e.prototype;return i.getCursor=function(){return this.options.cursor||"default"},i._fetchImage=function(){var t=this.map,e=this.options.symbol,i=e.markerFile;this.url=i||qe(e);var n=Gh.getImage(this.url);if(!n){var r=this.w,o=this.h;if(i)(n=new Image).onload=function(){var e=t.getRenderer();e&&e.setToRedraw()},n.src=this.url;else{var s=document.createElement("canvas");s.width=r,s.height=o,n=Or(s.getContext("2d"),{x:r/2,y:o/2},e,Gh)}Gh.addResource([this.url,r,o],n)}Gh.login(this.url),this._img=n},i.setContainerPoint=function(t){this._point=t,this._point._sub(this.w/2,this.h/2)},i.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},i.offset=function(t){this._point._add(t)},i.render=function(t){if(!this._img)return!1;var e=this.map,i=this._point,n=i.x,r=i.y,o=this.w,s=this.h;if(n+o>0&&n<e.width&&r+s>0&&r<e.height){var a=e.getDevicePixelRatio();return t.globalAlpha=this.opacity,t.drawImage(this._img,Math.round((n+this.dx)*a)+this.dx,Math.round((r+this.dy)*a),Math.round(o*a),Math.round(s*a)),!0}return!1},i.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}Gh.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},i.hitTest=function(t){var e=this.w,i=this.h,n=this._point.x+this.dx,r=this._point.y+this.dy;return t.x>=n&&t.x<=n+e&&t.y>=r&&t.y<=r+i},i.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},i.onEvent=function(t){this.fire(t.type,t)},i.mousedown=function(t){var e=t.target,i=this.options.cursor;i&&e.setCursor(i),this.onDragstart(t)},i.onDragstart=function(t){var e=t.containerPoint,i=t.target,n=i._panels.mapWrapper||i._containerDOM,r=this._dragger=new $i(n);r.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),r.type="handle",r.onMouseDown(t.domEvent),jh=e.x,zh=e.y,this.fire("dragstart",{containerPoint:e})},i.onDragging=function(t){if(this._dragger){var e=this.map,i=gi(t.domEvent,e._containerDOM),n={x:i.x-jh,y:i.y-zh},r=e.containerPointToCoord(new pt(jh,zh)),o=e.containerPointToCoord(i);jh=i.x,zh=i.y,this.offset(n),this.fire("dragging",{containerPoint:i,coordOffset:o._sub(r)})}},i.onDragend=function(t){if(this._dragger){var e=this.map;e.resetCursor();var i=gi(t.domEvent,e._containerDOM),n={x:i.x-jh,y:i.y-zh};this.offset(n),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:i})}},e}(Hi(Wi)),Fh=function(){function t(t,e){this.target=t,t.once("remove",this.delete,this),this.map=e,this.addTo(e)}var e=t.prototype;return e.setPoints=function(t){this.points=t;var e=t.map(function(t){return t.x}),i=t.map(function(t){return t.y});this.xmin=Math.min.apply(Math,e),this.xmax=Math.max.apply(Math,e),this.ymin=Math.min.apply(Math,i),this.ymax=Math.max.apply(Math,i)},e.hitTest=function(){return!1},e.render=function(t){var e=this.map;if(!(this.xmax<=0||this.xmin>=e.width||this.ymax<=0||this.ymin>=e.height)){var i=e.getDevicePixelRatio(),n=.5;t.lineWidth=1,t.strokeStyle="#000",t.globalAlpha=1,t.beginPath();var r=this.points;t.moveTo(s(r[0].x),s(r[0].y));for(var o=1;o<this.points.length;o++)t.lineTo(s(r[o].x),s(r[o].y));t.closePath(),t.stroke()}function s(t){return Math.round(t)*i+n}},e.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},e.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}},t}();function Uh(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}var Hh={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:Uh("ellipse",1),vertexHandleSymbol:Uh("square",1),newVertexHandleSymbol:Uh("square",.4)},Vh=function(t){function e(e,i){var n;return(n=t.call(this,i)||this)._geometry=e,n._geometry?n:ut(n)}ct(e,t);var i=e.prototype;return i.getMap=function(){return this._geometry.getMap()},i.prepare=function(){var t=this.getMap();t&&(t.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},i._prepareEditStageLayer=function(){var t=this._geometry.getLayer();if("canvas"===t.options.renderer){var e=this.getMap(),i="_maptalks__internal_layer__edit_stage_"+yt()+"_shadow";if(this._shadowLayer=e.getLayer(i),!this._shadowLayer){var n=t.constructor;this._shadowLayer=new n(i),e.addLayer(this._shadowLayer)}}},i.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var t,e=this._geometry,i="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=e.options.draggable,i?(e.config("draggable",!1),(t=e.copy()).setSymbol(e._getInternalSymbol()),t.copyEventListeners(e),e._getParent()&&t.copyEventListeners(e._getParent()),t._setEventTarget(e),t.setId(null).config({draggable:!1}),this._shadow=t,e.hide()):e instanceof Yo&&e.config("draggable",!0),this._switchGeometryEvents("on"),(e instanceof Yo||e instanceof as||e instanceof ls||e instanceof hs)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(t),e instanceof Yo?t&&(t.config("draggable",!0),t.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),e instanceof Yo&&!1!==this.options.resize?this.createMarkerEditor():e instanceof as?this.createCircleEditor():e instanceof ls?this.createEllipseOrRectEditor():e instanceof hs?this.createEllipseOrRectEditor():e instanceof cs||(e instanceof Wo||e instanceof Ko)&&this.createPolygonEditor()}},i.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},i.isEditing=function(){return!y(this.editing)&&this.editing},i._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},i._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var i in e)this._geometry[t](i,e[i],this)}},i._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},i._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},i._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;e||(this._editOutline=new Fh(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var i=this._editOutline.points;if(t instanceof Yo)this._editOutline.setPoints(t.getContainerExtent().toArray(i));else{var n=this.getMap();(i=t._getPrjExtent().toArray(i)).forEach(function(t){return n._prjToContainerPoint(t,null,t)}),this._editOutline.setPoints(i)}return e},i._createCenterHandle=function(){var t,e=this,i=this.getMap(),n=this.options.centerHandleSymbol;this._geometry instanceof Ko&&(n.markerDx=5);var r=i.coordToContainerPoint(this._geometry.getCenter()),o=this.createHandle(r,{symbol:n,cursor:"move",onDown:function(){if(e._shadow){var i=Ye((t=e._shadow.copy())._getInternalSymbol(),.5);t.setSymbol(i).addTo(e._geometry.getLayer())}},onMove:function(i){var n=i.coordOffset;t?t.translate(n):e._geometry.translate(n)},onUp:function(){var i=t||e._geometry;e._update("setCoordinates",tn.toNumberArrays(i.getCoordinates())),t&&t.remove()}});this._addRefreshHook(function(){var t=e._geometry.getCenter();o.setContainerPoint(i.coordToContainerPoint(t))})},i._createHandleInstance=function(t,e){var i=this.getMap(),n=re(e.symbol,function(){return[i.getZoom(),{"{bearing}":i.getBearing(),"{pitch}":i.getPitch(),"{zoom}":i.getZoom()}]}),r=this.options.removeVertexOn,o=new Nh(this,i,{symbol:n,cursor:e.cursor,events:r});return o.setContainerPoint(t),o},i.createHandle=function(t,e){e||(e={});var i=this._createHandleInstance(t,e),n=this;return i.on("dragstart",function(t){return this._updating=!0,e.onDown&&(this._geometry.fire("handledragstart"),e.onDown.call(n,t.containerPoint,t)),!1},this),i.on("dragging",function(t){return n._hideContext(),e.onMove&&(this._geometry.fire("handledragging"),e.onMove.call(n,t)),!1},this),i.on("dragend",function(t){return e.onUp&&(this._geometry.fire("handledragend"),e.onUp.call(n,t)),this._updating=!1,!1},this),e.onRefresh&&(i.refresh=e.onRefresh),i},i._createResizeHandles=function(t,e,i){var n=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],o=[null,"y",null,"x","x",null,"y",null],s=this._geometry,a=s instanceof Yo;t||(t=[]);var h=this,l=[],c={},u=this.getMap(),d=this.options.vertexHandleSymbol,f=function(){for(var f=function(){if(a){var t=s.getContainerExtent();return[new pt(t.xmin,t.ymin),new pt((t.xmax+t.xmin)/2,t.ymin),new pt(t.xmax,t.ymin),new pt(t.xmin,(t.ymin+t.ymax)/2),new pt(t.xmax,(t.ymin+t.ymax)/2),new pt(t.xmin,t.ymax),new pt((t.xmax+t.xmin)/2,t.ymax),new pt(t.xmax,t.ymax)]}var e=s._getPrjExtent();return[new pt(e.xmin,e.ymax),new pt((e.xmax+e.xmin)/2,e.ymax),new pt(e.xmax,e.ymax),new pt(e.xmin,(e.ymax+e.ymin)/2),new pt(e.xmax,(e.ymax+e.ymin)/2),new pt(e.xmin,e.ymin),new pt((e.xmax+e.xmin)/2,e.ymin),new pt(e.xmax,e.ymin)]}(),_=function(_){if(Array.isArray(t)&&t.some(function(t){return t===_}))return"continue";var p,m=f[_],g=a?m:u._prjToContainerPoint(m);if(l.length<f.length-t.length){var v=n.createHandle(g,{symbol:d,cursor:r[_],axis:o[_],onMove:(p=_,function(t){h._updating=!0,e(t.containerPoint,p),s.fire("resizing")}),onUp:function(){h._updating=!1,i()}});c[_]=l.length,l.push(v)}else l[c[_]].setContainerPoint(g)},p=0;p<f.length;p++)_(p)};return f(),this._addRefreshHook(f),l},i.createMarkerEditor=function(){var t=this,e=this._shadow||this._geometry,i=this.getMap();if(e._canEdit()){this._history||this._recordHistory(f());var n=e._getInternalSymbol(),r=new pt(0,0);x(n.markerDx)&&(r.x=n.markerDx),x(n.markerDy)&&(r.y=n.markerDy);var o=null,s="middle",a="middle";if(Xr.test(n)){var h=n.markerType;"pin"===h||"pie"===h||"bar"===h?(o=[5,6,7],s="bottom"):"rectangle"===h&&(o=[0,1,2,3,5],s="top",a="left")}else(Wr.test(n)||Jr.test(n))&&(s="bottom",o=[5,6,7]);var l,c=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var u=e.getSize();l=u.width/u.height}var d=this._createResizeHandles(o,function(n,h){if(o&&o.indexOf(h)>=0){var u=i.containerPointToCoordinate(n.sub(r)),f=e.getCoordinates();u.x=f.x,e.setCoordinates(u),t._updateCoordFromShadow(!0),n=d[d.length-1-h].getContainerPoint()}var _=i.coordToContainerPoint(e.getCoordinates()).add(r),p=e._getInternalSymbol(),m=n.sub(_);"bottom"===s&&n.y>_.y&&(m.y=0);var g="middle"===s?2:1,v="left"===a?1:2,y=Math.abs(m.x)*v,x=Math.abs(m.y)*g;l&&(x=(y=Math.max(y,x*l))/l);var w=c[h];e instanceof vs?((l||0===w||2===w)&&(e.setWidth(y),e!==t._geometry&&t._geometry.setWidth(y)),(l||1===w||2===w)&&(e.setHeight(x),e!==t._geometry&&t._geometry.setHeight(x))):((l||0===w||2===w)&&(p.markerWidth=Math.min(y,t._geometry.options.maxMarkerWidth||1/0)),(l||1===w||2===w)&&(p.markerHeight=Math.min(x,t._geometry.options.maxMarkerHeight||1/0)),e.setSymbol(p),e!==t._geometry&&t._geometry.setSymbol(p))},function(){t._update(f())})}else console&&console.warn("A marker can't be resized with symbol:",e.getSymbol());function f(){var t=[["setCoordinates",e.getCoordinates().toArray()]];return e instanceof vs?(t.push(["setWidth",e.getWidth()]),t.push(["setHeight",e.getHeight()])):t.push(["setSymbol",e.getSymbol()]),t}},i.createCircleEditor=function(){var t=this,e=this._shadow||this._geometry,i=this.getMap();this._history||this._recordHistory([["setCoordinates",e.getCoordinates().toArray()],["setRadius",e.getRadius()]]),this._createResizeHandles(null,function(n){var r=e.getCenter(),o=i.containerPointToCoord(n),s=new Ko([[r.x,r.y],[o.x,r.y]]),a=new Ko([[r.x,r.y],[r.x,o.y]]),h=Math.max(i.computeGeometryLength(s),i.computeGeometryLength(a));e.setRadius(h),e!==t._geometry&&t._geometry.setRadius(h)},function(){t._update("setRadius",e.getRadius())})},i.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],i=this._shadow||this._geometry;this._history||this._recordHistory(a());var n,r=this.getMap(),o=this._geometry instanceof ls;this.options.fixAspectRatio&&(n=i.getWidth()/i.getHeight());var s=this._createResizeHandles(null,function(a,h){var l,c,u,d=o?1:2,f=s[h].getContainerPoint(),_=e[h];if(o){var p=s[7-h].getContainerPoint(),m=(l=f.sub(p)).abs();c=r.pixelToDistance(m.x,0),u=r.pixelToDistance(0,m.y);var g=i.getSize(),v=i.getCoordinates(),y=i.getWidth(),x=i.getHeight(),w=r.containerPointToCoord(a),b=r.containerPointToCoord(p),A=new Ko([[b.x,b.y],[w.x,b.y]]),C=new Ko([[b.x,b.y],[b.x,w.y]]);if(c=r.computeGeometryLength(A),u=r.computeGeometryLength(C),0===_)if(n&&(m.y=m.x/n,g.height=Math.abs(m.y),u=c/n),f.y=p.y-g.height/2,w.y=v.y,4===h)w.x=Math.min(w.x,v.x);else{var S=r.locate(v,y,0);w.x=r.locate(new tn(S.x,w.y),-c,0).x}else if(1===_)n&&(m.x=m.y*n,g.width=Math.abs(m.x),c=u*n),f.x=p.x-g.width/2,w.x=v.x,w.y=Math.max(w.y,b.y);else{if(n&&(c>u*n?(u=c/n,f.y=p.y+m.x*St(l.y)/n):(c=u*n,f.x=p.x+m.y*St(l.x)*n)),0===h||5===h){var E=0===h?r.locate(v,y,0):r.locate(v,y,-x);w.x=r.locate(new tn(E.x,w.y),-c,0).x}else w.x=Math.min(w.x,b.x);w.y=Math.max(w.y,b.y)}i.setCoordinates(w),t._updateCoordFromShadow(!0)}else{var P=i.getCenter(),M=r.containerPointToCoord(f),T=new Ko([[P.x,P.y],[M.x,P.y]]),k=new Ko([[P.x,P.y],[P.x,M.y]]);c=r.computeGeometryLength(T),u=r.computeGeometryLength(k),n&&(u=(c=Math.max(c,u*n))/n)}(n||0===_||2===_)&&(i.setWidth(c*d),i!==t._geometry&&t._geometry.setWidth(c*d)),(n||1===_||2===_)&&(i.setHeight(u*d),i!==t._geometry&&t._geometry.setHeight(u*d))},function(){t._update(a())});function a(){return[["setCoordinates",i.getCoordinates().toArray()],["setWidth",i.getWidth()],["setHeight",i.getHeight()]]}},i.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow||this._geometry,i=this;this._history||this._recordHistory("setCoordinates",tn.toNumberArrays(e.getCoordinates()));var n=e instanceof Wo?3:2,r="maptalks--editor-vertex-index",o={0:[]},s={0:[]};function a(t){if(void 0===t&&(t=0),e instanceof Wo){var i=e.getCoordinates()[t]||[];return i.slice(0,i.length-1)}return e.getCoordinates()}function h(t){return void 0===t&&(t=0),0===t?e._getPrjCoordinates():e._getPrjHoles()[t-1]}function l(){for(var t in o){for(var e=o[t].length-1;e>=0;e--)o[t][e][r]=e;for(var n=s[t].length-1;n>=0;n--)s[t][n][r]=n}i._updateCoordFromShadow()}function c(t){i._updating=!0;var a=t.target,c=a[r],u=x(a._ringIndex)?a._ringIndex:0,d=h(u);if(!(d.length<=n)){var f,_=e instanceof Ko&&(0===c||c===d.length-1);d.splice(c,1),u>0?e._prjHoles[u-1]=d:e._setPrjCoordinates(d),e._updateCache(),o[u].splice(c,1)[0].delete(),c<s[u].length&&s[u].splice(c,1)[0].delete(),f=0===c?s[u].length-1:c-1,s[u].splice(f,1)[0].delete(),_||s[u].splice(f,0,m.call(i,f,u)),l(),i._updating=!1}}function u(n,r,o){void 0===o&&(o=0);var a,l=h(o),c=t._containerPointToPrj(n.sub(f())),u=l[r];u.x=c.x,u.y=c.y,e._updateCache(),e.onShapeChanged(),i._updateCoordFromShadow(!0),a=0===r?s[o].length-1:r-1,s[o][r]&&s[o][r].refresh(),s[o][a]&&s[o][a].refresh()}var d=new pt(0,0);function f(){var t=e._getCompiledSymbol();return d.x=t.lineDx||0,d.y=t.lineDy||0,d}function _(e,n){void 0===n&&(n=0);var o=a(n)[e],s=i.createHandle(t.coordToContainerPoint(o)._add(f()),{symbol:i.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){u(s.getContainerPoint(),s[r],n)},onRefresh:function(){o=a(n)[s[r]];var e=t.coordToContainerPoint(o);s.setContainerPoint(e._add(f()))},onUp:function(){i._updateCoordFromShadow()},onDown:function(t,e){!e||!e.domEvent||e.domEvent.button}});return s[r]=e,s._ringIndex=n,s.on(i.options.removeVertexOn,c),s}var p=!1;function m(n,c){void 0===c&&(c=0);var d,g=a(c);d=n+1>=g.length?g[0]:g[n+1];var v=g[n].add(d).multi(.5),y=i.createHandle(v,{symbol:i.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(n,o){if(!o||!o.domEvent||2!==o.domEvent.button){var a=h(c),l=y[r],u=y.getContainerPoint(),d=t._containerPointToPrj(u);a.splice(l+1,0,d),c>0?e._prjHoles[c-1]=a:e._setPrjCoordinates(a),e._updateCache(),y.opacity=1,s[c].splice(l,0,m.call(i,l,c),m.call(i,l+1,c)),p=!0}},onMove:function(){u(y.getContainerPoint(),y[r]+1,c)},onUp:function(t){if(t&&t.domEvent&&2===t.domEvent.button)p=!1;else{var e=y[r];bt(y,s[c]),y.delete(),o[c].splice(e+1,0,_.call(i,e+1,c)),l(),i._updateCoordFromShadow(),p=!1}},onRefresh:function(e){g=a(e);var i,n=y[r];i=n===g.length-1?0:n+1;var o=g[n].add(g[i]).multi(.5),s=t.coordToContainerPoint(o);y.setContainerPoint(s._add(f()))}});return y[r]=n,y}if(e instanceof Wo)for(var g=e.getHoles().length+1,v=0;v<g;v++){o[v]=[],s[v]=[];for(var y=a(v),w=0,b=y.length;w<b;w++)o[v].push(_.call(this,w,v)),w<b-1&&s[v].push(m.call(this,w,v));s[v].push(m.call(this,y.length-1,v))}else for(var A=0,C=a(0).length;A<C;A++)o[0].push(_.call(this,A,0)),A<C-1&&s[0].push(m.call(this,A,0));this._addRefreshHook(function(){if(!p){for(var t in s)for(var e=s[t].length-1;e>=0;e--)s[t][e].refresh(t);for(var i in o)for(var n=o[i].length-1;n>=0;n--)o[i][n].refresh(i)}})},i._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},i._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},i._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},i._update=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this._exeHistory([t,i]),this._recordHistory.apply(this,[t].concat(i))},i._updateCoordFromShadow=function(t){var e=(this._shadow||this._geometry).getCoordinates(),i=this._geometry,n=this._updating;this._updating=!0,i.setCoordinates(e),t||this._recordHistory("setCoordinates",tn.toNumberArrays(i.getCoordinates())),this._updating=n},i._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(this._history.length){var r=this._history[this._history.length-1];if(r[0]===t&&JSON.stringify(r[1])===JSON.stringify(i))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,i]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},i.cancel=function(){if(!this._history||0===this._historyPointer)return this;this._historyPointer=0;var t=this._history[0];return this._exeAndReset(t),this},i.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},i.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},i._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,i=this._historyPointer;this.stop(),this._history=e,this._historyPointer=i,this.start()}},i._onDragStart=function(){this._updating=!0},i._onDragEnd=function(){this._updating=!1},i._exeHistory=function(t){if(Array.isArray(t)){var e=this._updating;this._updating=!0;var i=this._shadow||this._geometry,n=this._geometry;Array.isArray(t[0])?t[0].forEach(function(t){var e=t[0],r=t.slice(1);i[e].apply(i,r),i!==n&&n[e].apply(n,r)}):(i[t[0]].apply(i,t[1]),i!==n&&n[t[0]].apply(n,t[1])),this._updating=e}},e}(Hi(Wi));Vh.mergeOptions(Hh);var Wh={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),Ti(this._textEditor,"mousedown dblclick",fi),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var i=this._getEditorOffset();this._editUIMarker=new ba(this.getCoordinates(),{animation:null,content:e,dx:i.dx,dy:i.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,i=0,n=t.textHorizontalAlignment;return"middle"===n||y(n)?(e=(t.textDx||0)-2,i=(t.textDy||0)-2):(e=(t.markerDx||0)-2,i=(t.markerDy||0)-2),{dx:e,dy:i}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),i=this._getInternalSymbol()||{},n=e.width,r=i.textFill||"#000000",o=i.textSize||12,s=e.height,a=i.markerLineColor||"#000",h=i.markerFill||"#3398CC",l=i.textLineSpacing||0,c=si("div");return c.contentEditable=!0,c.style.cssText="background:"+h+"; border:1px solid "+a+";\n            color:"+r+";font-size:"+o+"px;width:"+(n-2)+"px;height:"+(s-2)+"px;margin: auto;\n            line-height:"+(o+l)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",c.innerText=t,Mi(c,"mousedown dblclick",fi),c.onkeyup=function(t){var e=c.style.height||0;13===t.keyCode&&(c.style.height=parseInt(e)+o/2+"px")},c},_setCursorToLast:function(t){var e;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}};gs.include(Wh),vo.include({animate:function(t,e,i){var n=this;this._animPlayer&&this._animPlayer.finish(),C(e)&&(i=e),e||(e={});var r,o=this.getMap(),s=this._getProjection(),a=this._prepareAnimationStyles(t),h=e.focus;if(delete this._animationStarted,o){var l=o._getRenderer();e.framer=function(t){l.callInNextFrame(t)}}var c=Ho.animate(a,e,function(t){if(o&&o.isRemoved())c.finish();else{o&&!n._animationStarted&&h&&o.onMoveStart();var e=t.styles;for(var a in e)if("symbol"!==a&&"translate"!==a&&e.hasOwnProperty(a)){var l="set"+a[0].toUpperCase()+a.slice(1);n[l](e[a])}var u=e.translate;if(u){var d=u;r&&(d=u.sub(r)),r=u,n.translate(d)}var f=e.symbol;if(f){var _=n.getSymbol()||{};n.setSymbol(Qe(_,f))}if(o&&h){var p=s.project(n.getCenter());o._setPrjCenter(p);var m=o._parseEventFromCoord(s.unproject(p));"running"!==c.playState?o.onMoveEnd(m):o.onMoving(m)}n._fireAnimateEvent(c.playState),i&&i(t)}},this);return this._animPlayer=c,this._animPlayer.play()},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),i={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if("translate"!==n&&"symbol"!==n){var o=this["get"+n[0].toUpperCase()+n.substring(1)]();i[n]=[o,r]}else if("symbol"===n){var s=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");s=[];for(var a=t.symbol,h=0;h<a.length;h++)if(a[h]){var l={};for(var c in a[h])a[h].hasOwnProperty(c)&&(l[c]=[e[h][c],a[h][c]]);s.push(l)}else s.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var u in s={},r)r.hasOwnProperty(u)&&(s[u]=[e[u],r[u]])}i.symbol=s}else"translate"===n&&(i.translate=new tn(r))}return i},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var Zh=lt.touch?"touchstart mousedown":"mousedown",qh=function(t){function e(e){return t.call(this,e)||this}ct(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on(Zh,this._startDrag,this)},i.removeHooks=function(){this._endDrag(),this.target.off(Zh,this._startDrag,this),delete this.container},i._prepareDragHandler=function(){this._dragHandler=new $i(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i._prepareShadow=function(){var t=this,e=this.target;if("canvas"===e.getLayer().options.renderer){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var i=this._shadow=e.copy();if(i.getGeometries){var n=i.getGeometries(),r=e.getGeometries();n.forEach(function(e,i){t._updateShadowSymbol(e,r[i])})}else this._updateShadowSymbol(i,e);i.setId(null),this._prepareShadowConnectors()}},i._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var i=Ye(t._getInternalSymbol(),.5);t.setSymbol(i)}},i._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,i=this._dragStageLayer._getRenderer().resources,n=[];if(bs._hasConnectors(t))for(var r=bs._getConnectors(t),o=0,s=r.length;o<s;o++){var a=r[o],h=a.config(),l=a._getInternalSymbol();h.symbol=Ye(l,.5);var c=void 0;c=a.getConnectSource()===t?new a.constructor(e,a.getConnectTarget(),h):new a.constructor(a.getConnectSource(),e,h),n.push(c),a.getLayer()&&a.getLayer()._getRenderer()&&i.merge(a.getLayer()._getRenderer().resources)}this._shadowConnectors=n,n.push(e),this._dragStageLayer.bringToFront().addGeometry(n)},i._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer("_maptalks__internal_layer__drag_stage"),this._dragStageLayer||(this._dragStageLayer=new Ps("_maptalks__internal_layer__drag_stage",{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var i=new ir;i.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=i},i._startDrag=function(t){var e=this.target.getMap();if(e&&(!this.target._getParent()&&!this.isDragging())){var i=t.domEvent;i.touches&&i.touches.length>1||2===i.button||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),Mi(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}},i._dragging=function(t){var e=this.target,i=e.getMap(),n=i._parseEvent(t.domEvent),r=n.domEvent;if(!(r.touches&&r.touches.length>1)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",n)),this.target._fireEvent("dragstart",this._startParam||n),void delete this._startParam;var o=this._shadow||e,s=o.options.dragOnAxis,a=o.options.dragOnScreenAxis,h=n.containerPoint,l=n.coordinate;this._lastPoint=this._lastPoint||h,this._lastCoord=this._lastCoord||l,a?("x"===s?h.y=this._lastPoint.y:"y"===s&&(h.x=this._lastPoint.x),l=i.containerPointToCoord(h)):l=this._correctCoord(l);var c=h.sub(this._lastPoint),u=l.sub(this._lastCoord);a||("x"===s?c.y=u.y=0:"y"===s&&(c.x=u.x=0)),this._lastPoint=h,this._lastCoord=l,o.translate(u),o===e||e.options.dragShadow||e.translate(u),n.coordOffset=u,n.pointOffset=c,o._fireEvent("dragging",n),o!==e&&e._fireEvent("dragging",n)}},i._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&Ti(this.container,"mouseleave",this._endDrag,this),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var i=e.getMap();if(this.enabled()&&i){var n=i._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(n),this._moved&&e._fireEvent("dragend",n)}}},i.isDragging=function(){return!!this._isDragging},i._updateTargetAndRemoveShadow=function(t){if(this._shadow){var e=this.target,i=e.getMap();e.options.dragShadow||e.show();var n=this._shadow;if(n){if(e.options.dragShadow)if(e.getGeometries){var r=n.getGeometries(),o=e.getGeometries();r.forEach(function(t,e){o[e].setCoordinates(r[e].getCoordinates())})}else e.setCoordinates(n.getCoordinates());n._fireEvent("dragend",t),n.remove(),delete this._shadow}this._shadowConnectors&&(i.getLayer("_maptalks__internal_layer__drag_stage").removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new ir,this._dragStageLayer.remove())}},i._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var i=this.target;if(!i.getMinAltitude())return t;var n=(i.getMinAltitude()+i.getMaxAltitude())/2;return e.locateByPoint(t,0,-n)},e}(Vi);vo.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),vo.addInitHook("addHandler","draggable",qh),vo.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),vo.include({startEdit:function(t){return this.getMap()&&this.options.editable?(this.endEdit(),this._editor=new Vh(this,t),this._editor.start(),this.fire("editstart"),this):this},endEdit:function(){return this._editor&&(this._editor.stop(),delete this._editor,this.fire("editend")),this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),vo.include({_onEvent:function(t,e){if(this.getMap()){var i=e||this._getEventTypeToFire(t);"contextmenu"===i&&this.listens("contextmenu")&&(fi(t),di(t));var n=this._getEventParams(t);this._fireEvent(i,n)}},_getEventTypeToFire:function(t){return t.type},_getEventParams:function(t){var e=this.getMap(),i={domEvent:t},n=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(n){var r=gi(n,e._containerDOM);i.coordinate=e.containerPointToCoordinate(r),i.containerPoint=r,i.viewPoint=e.containerPointToViewPoint(r),i.pont2d=e._containerPointToPoint(r)}return i}}),vo.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof Ma?(this._infoWindow=t,this._infoWinOptions=v({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=v({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var t=this._infoWinOptions;return t?(this._infoWindow=new Ma(t),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var Yh=new pt(0,0),Qh=new pt(0,0),Kh=new pt(0,0),Xh=new pt(0,0),Jh=[],$h=function(t){function e(){return t.call(this,Jn)||this}ct(e,t);var i=e.prototype;return i.checkUrl=function(t){return t&&A(t)?qt(t):t},i.fetchImage=function(t,e,i,n){var r={url:t=this.checkUrl(t),fetchOptions:n};this.send(r,Jh,i,e)},e}(Xn),tl=new Image,el=function(t){function e(e){var i;return(i=t.call(this,e)||this).tilesInView={},i.tilesLoading={},i._parentTiles=[],i._childTiles=[],i.tileCache=new Li(e.options.maxCacheSize,i.deleteTile.bind(ut(ut(i)))),lt.decodeImageInWorker&&i.layer.options.decodeImageInWorker&&(i._tileImageWorkerConn=new $h),i}ct(e,t);var i=e.prototype;return i.getCurrentTileZoom=function(){return this._tileZoom},i.draw=function(){var t=this.getMap();if(this.isDrawable()){var e=this.prepareCanvas();if(!e||e.intersects(this.canvasExtent2D)){var i=this.layer.getTiles().tileGrids;if(i&&i.length){var n=i.reduce(function(t,e){return t+(e&&e.tiles&&e.tiles.length||0)},0);n>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*n+1);var r=0,o=!1,s={},a=[],h=[],l={},c=[],u={},d=[],f={},_={},p=this._markTiles(),m=this._getLoadLimit(),g=i.length;this._tileZoom=i[0].zoom;for(var v=0;v<g;v++)for(var y=i[v],x=y.tiles,w=this._generatePlaceHolder(y.zoom),b=0,A=x.length;b<A;b++){var C=x[b],S=C.id,E=!1;if(this._isLoadingTile(S))E=o=!0,this.tilesLoading[S].current=!0;else{var P=this._getCachedTile(S);if(P)P.image&&this.getTileOpacity(P.image)<1&&(E=o=!0),a.push(P);else if(E=o=!0,!(m&&r+p[0]>m)&&(!t.isInteracting()||t.isMoving()||t.isRotating()))r++,_[S]=C}if(E&&!s[S]){s[S]=1,w&&!f[S]&&(C.cache=!1,d.push({image:w,info:C}),f[S]=1);var M=this._findParentTile(C);if(M){var T=M.info.id;void 0===l[T]&&(l[T]=h.length,h.push(M))}else if(!h.length){var k=this._findChildTiles(C);k.length&&k.forEach(function(t){u[t.info.id]||(c.push(t),u[t.info.id]=1)})}}}h.length&&(c.length=0,this._childTiles.length=0),this._drawTiles(a,h,c,d),r?this.loadTileQueue(_):o||(t.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),this._retireTiles()}else this.completeRender()}else this.completeRender()}},i.isTileCachedOrLoading=function(t){return this.tileCache.get(t)||this.tilesInView[t]||this.tilesLoading[t]},i._drawTiles=function(t,e,i,n){var r=this;e.length&&(e.sort(function(t,e){return Math.abs(e.info.z-r._tileZoom)-Math.abs(t.info.z-r._tileZoom)}),this._parentTiles=e),i.length&&(this._childTiles=i);var o={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles};this.onDrawTileStart(o),this._parentTiles.forEach(function(t){return r._drawTileAndCache(t)}),this._childTiles.forEach(function(t){return r._drawTile(t.info,t.image)}),n.forEach(function(t){return r._drawTile(t.info,t.image)});var s=this.layer,a=this.getMap();if(!s.options.cascadeTiles||a.getPitch()<=a.options.cascadePitches[0])t.forEach(function(t){return r._drawTileAndCache(t)});else{this.writeZoomStencil();for(var h=!1,l=0,c=t.length;l<c;l++)t[l].info.z!==this._tileZoom?h?this.resumeZoomStencilTest():(this.startZoomStencilTest(),h=!0):h&&this.pauseZoomStencilTest(),this._drawTileAndCache(t[l]);this.endZoomStencilTest()}this.onDrawTileEnd(o)},i.writeZoomStencil=function(){},i.startZoomStencilTest=function(){},i.endZoomStencilTest=function(){},i.pauseZoomStencilTest=function(){},i.resumeZoomStencilTest=function(){},i.onDrawTileStart=function(){},i.onDrawTileEnd=function(){},i._drawTile=function(t,e){e&&this.drawTile(t,e)},i._drawTileAndCache=function(t){t.current=!0,this.tilesInView[t.info.id]=t,this._drawTile(t.info,t.image),this.tileCache.add(t.info.id,t)},i.drawOnInteracting=function(){this.draw()},i.needToRedraw=function(){var e=this.getMap();return e.getPitch()?t.prototype.needToRedraw.call(this):!(!e.isRotating()&&!e.isZooming())||(e.isMoving()?!!this.layer.options.forceRenderOnMoving:t.prototype.needToRedraw.call(this))},i.hitDetect=function(){return!1},i._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},i.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],t.prototype.clear.call(this)},i._isLoadingTile=function(t){return!!this.tilesLoading[t]},i.clipCanvas=function(e){return t.prototype.clipCanvas.call(this,e)},i._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var i=e.getContainerExtent(),n=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(i.ymin)*n,Math.ceil(i.getWidth())*n,Math.ceil(i.getHeight())*n),t.stroke(),t.clip(),!0},i.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e],n=this.loadTile(i);void 0===n.loadTime&&(this.tilesLoading[i.id]={image:n,current:!0,info:i})}},i.loadTile=function(t){var e;if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)e={},this._fetchImage(e,t);else{var i=this.layer.getTileSize(t.layer);(e=new Image).width=i.width,e.height=i.height,e.onload=this.onTileLoad.bind(this,e,t),e.onerror=this.onTileError.bind(this,e,t),this.loadTileImage(e,t.url)}return e},i._fetchImage=function(t,e){var i=this;if(t instanceof Image)t.src=e.url;else{var n=e.x,r=e.y,o=Math.abs(n+r)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(e.url,o,function(n,r){n?i.onTileError(t,e,n):Zt(r,function(t){i.onTileLoad(t,e)})},this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},i.loadTileImage=function(t,e){var i=this.layer.options.crossOrigin;return y(i)||(t.crossOrigin=i),gt(t,[e])},i.abortTileLoading=function(t){t&&(t.onload=il,t.onerror=il,t.src=Nt)},i.onTileLoad=function(t,e){if(this.layer){var i=e.id;if(this.tilesInView){var n={tile:e,tileImage:t};this.layer.fire("tileload",n),(t=n.tileImage).loadTime=g(),delete this.tilesLoading[i],this._addTileToCache(e,t),this.setToRedraw()}}},i.onTileError=function(t,e){if(this.layer){if(t.onerrorTick=t.onerrorTick||0,this.layer.options.tileRetryCount>t.onerrorTick)return t.onerrorTick++,void this._fetchImage(t,e);var i=this.layer.options.errorUrl;if(i){if(t instanceof Image&&t.src!==i)return void(t.src=i);(t=new Image).src=i}t=t instanceof Image?t:tl,this.abortTileLoading(t,e),t.loadTime=0,delete this.tilesLoading[e.id],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},i.drawTile=function(t,e){if(e&&this.getMap()){var i=t.extent2d,n=t.offset,r=Yh.set(i.xmin-n[0],i.ymax-n[1]),o=t.z,s=t.id,a=this.getMap(),h=a.getZoom(),l=this.context,c=a._pointToContainerPoint(r,o,0,Qh),u=a.getBearing(),d=u||h!==o,f=this.getTileOpacity(e),_=l.globalAlpha;f<1&&(l.globalAlpha=f,this.setToRedraw()),d||c._round();var p=c.x,m=c.y,g=t.extent2d.xmax-t.extent2d.xmin,v=t.extent2d.ymax-t.extent2d.ymin;if(d){if(l.save(),l.translate(p,m),u&&(l.rotate(-u*Math.PI/180),g+=.1,v+=.1),h!==o){var y=a._getResolution(o)/a._getResolution();l.scale(y,y)}p=m=0}if(ji.image(l,e,p,m,g,v),this.layer.options.debug){var x=this.layer.options.debugOutline;l.save(),l.strokeStyle=x,l.fillStyle=x,l.strokeWidth=10,l.font="20px monospace";var w=new pt(p,m);ji.rectangle(l,w,{width:g,height:v},1,0),ji.fillText(l,this.getDebugInfo(s),w._add(10,20),x),ji.drawCross(l,p+g/2,m+v/2,2,x),l.restore()}d&&l.restore(),l.globalAlpha!==_&&(l.globalAlpha=_),this.setCanvasUpdated()}},i.getDebugInfo=function(t){var e=t.split("_"),i=e.length;return"x:"+e[i-2]+", y:"+e[i-3]+", z:"+e[i-1]},i._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer);if(!e.options.background)return[];for(var i=this.getMap(),n=[],r=e.getSpatialReference().getResolution(t.z),o=t.extent2d.getMin(),s=t.extent2d.getMax(),a=e._project(i._pointToPrjAtRes(o,r,Kh),Kh),h=e._project(i._pointToPrjAtRes(s,r,Xh),Xh),l=1;l<2;l++)this._findChildTilesAt(n,a,h,e,t.z+l);return n},i._findChildTilesAt=function(t,e,i,n,r){var o=n.options.zoomOffset,s=n.getId(),a=n.getSpatialReference().getResolution(r+o);if(a)for(var h,l,c=n._getTileConfig().getTileIndex(e,a),u=n._getTileConfig().getTileIndex(i,a),d=Math.min(c.idx,u.idx),f=Math.max(c.idx,u.idx),_=Math.min(c.idy,u.idy),p=Math.max(c.idy,u.idy),m=d;m<f;m++)for(var g=_;g<p;g++)h=n._getTileId(m,g,r+o,s),this.tileCache.has(h)&&(l=this.tileCache.getAndRemove(h),t.push(l),this.tileCache.add(h,l))},i._findParentTile=function(t){var e=this.getMap(),i=this._getLayerOfTile(t.layer);if(!i.options.background)return null;for(var n=i.getSpatialReference(),r=n.getZoomDirection(),o=i.options.zoomOffset,s=i.options.backgroundZoomDiff,a=n.getResolution(t.z),h=t.extent2d.getCenter(),l=i._project(e._pointToPrjAtRes(h,a)),c=1;c<=s;c++){var u=t.z-r*c,d=n.getResolution(u+o);if(d){var f=i._getTileConfig().getTileIndex(l,d),_=i._getTileId(f.x,f.y,u+o,t.layer);if(this.tileCache.has(_)){var p=this.tileCache.getAndRemove(_);return this.tileCache.add(_,p),p}}}return null},i._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},i._getCachedTile=function(t){var e=this.tilesInView,i=this.tileCache.getAndRemove(t);if(i){e[t]=i;var n=this.tilesLoading;if(n&&n[t]){n[t].current=!1;var r=n[t],o=r.image,s=r.info;this.abortTileLoading(o,s),delete n[t]}}else i=e[t];return i},i._addTileToCache=function(t,e){this.tilesInView[t.id]={image:e,current:!0,info:t}},i.getTileOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(g()-t.loadTime)/(1e3/60*10)):1},i.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,t.prototype.onRemove.call(this)},i._markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var i in this.tilesLoading)this.tilesLoading[i].current=!1,t++;if(this.tilesInView)for(var n in this.tilesInView)this.tilesInView[n].current=!1,e++;return[t,e]},i._retireTiles=function(t){for(var e in this.tilesLoading){var i=this.tilesLoading[e];!t&&i.current||(i.image&&this.abortTileLoading(i.image,i.info),this.deleteTile(i),delete this.tilesLoading[e])}for(var n in this.tilesInView){var r=this.tilesInView[n];r.current||(delete this.tilesInView[n],this.tileCache.has(n)||this.deleteTile(r))}},i.deleteTile=function(t){t&&t.image&&(t.image.close&&t.image.close(),t.image.onload=null,t.image.onerror=null)},i._generatePlaceHolder=function(t){var e=this.getMap(),i=this.layer.options.placeholder;if(!i||e.getPitch())return null;var n=this.layer.getTileSize(),r=e._getResolution(t)/e._getResolution(),o=this._tilePlaceHolder=this._tilePlaceHolder||ji.createCanvas(1,1,e.CanvasClass);return o.width=n.width*r,o.height=n.height*r,C(i)?i(o):function(t){var e=t.getContext("2d"),i=t.width,n=t.height,r=i/16,o=n/16;e.beginPath();for(var s=0;s<16;s++)e.moveTo(0,s*o),e.lineTo(i,s*o),e.moveTo(s*r,0),e.lineTo(s*r,n);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();for(var a=[[0,0],[i,0],[0,n],[i,n],[0,0],[0,n],[i,0],[i,n],[0,n/2],[i,n/2],[i/2,0],[i/2,n]],h=1;h<a.length;h+=2)e.moveTo(a[h-1][0],a[h-1][1]),e.lineTo(a[h][0],a[h][1]);e.lineWidth=4,e.stroke()}(o),o},e}(er);function il(){return!1}ah.registerRenderer("canvas",el);var nl=new pt(0,0),rl=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.isDrawable=function(){return!0},i.needToRedraw=function(){var e=this.getMap();return!(!this._gl()||e.getPitch()||!e.isZooming()||e.isMoving()||e.isRotating())||t.prototype.needToRedraw.call(this)},i.drawTile=function(e,i){var n=this.getMap();if(e&&n&&i){var r=e._glScale=e._glScale||n.getGLScale(e.z),o=e.extent2d.xmax-e.extent2d.xmin,s=e.extent2d.ymax-e.extent2d.ymin;if(!1!==e.cache&&this._bindGLBuffer(i,o,s),this._gl()){var a=e.extent2d,h=e.offset,l=nl.set(a.xmin-h[0],e.extent2d.ymax-h[1]),c=l.x*r,u=l.y*r,d=this.getTileOpacity(i),f=null;this.layer.options.debug&&(f=this.getDebugInfo(e.id)),this.drawGLImage(i,c,u,o,s,r,d,f),d<1?this.setToRedraw():this.setCanvasUpdated()}else t.prototype.drawTile.call(this,e,i)}},i.writeZoomStencil=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE)},i.startZoomStencilTest=function(){var t=this.gl;t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilFunc(t.EQUAL,0,255)},i.endZoomStencilTest=function(){this.pauseZoomStencilTest()},i.pauseZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255)},i.resumeZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.EQUAL,0,255)},i._bindGLBuffer=function(t,e,i){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,i))},i.loadTileImage=function(t,e){var i=this.layer.options.crossOrigin;t.crossOrigin=null!==i?i:"",t.src=e},i.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},i.createContext=function(){t.prototype.createContext.call(this),this.createGLContext()},i.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return t.prototype.getCanvasImage.call(this);var e=t.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},i._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},i.deleteTile=function(e){t.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image),delete e.image},i.onRemove=function(){t.prototype.onRemove.call(this),this.removeGLCanvas()},e}(Sh(el));function ol(t){var e=this.layer.getTileSize(),i=this.canvas.constructor,n=this.getMap(),r=n.getDevicePixelRatio(),o=ji.createCanvas(e.width*r,e.height*r,i);o.layer=this.layer;var s=this,a=new pt(t.extent2d.xmin,t.extent2d.ymax),h=new pn(n.pointToCoordinate(a),n.pointToCoordinate(a.add(e.width,e.height)),n.getProjection());return this.layer.drawTile(o,{url:t.url,point:a,center:n.pointToCoordinate(a.add(e.width/2,e.height/2)),extent:h,z:t.z,x:t.x,y:t.y},function(e){e?s.onTileError(o,t):s.onTileLoad(o,t)}),o}ah.registerRenderer("gl",rl);var sl=function(t){function e(){return t.apply(this,arguments)||this}return ct(e,t),e.prototype.loadTile=function(){return ol.apply(this,arguments)},e}(el),al=function(t){function e(){return t.apply(this,arguments)||this}return ct(e,t),e.prototype.loadTile=function(){return ol.apply(this,arguments)},e}(rl);ph.registerRenderer("canvas",sl),ph.registerRenderer("gl",al);var hl="undefined"!=typeof Int8Array?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[];!function(){function t(t,e,i){this.gl=t,this.quadVertices=e||hl,this.attributes=["a_position",3,function(t){if(t instanceof Float32Array)return"FLOAT";if(t instanceof Int16Array)return"SHORT";if(t instanceof Uint16Array)return"UNSIGNED_SHORT";if(t instanceof Int8Array)return"BYTE";if(t instanceof Uint8Array||t instanceof Uint8ClampedArray)return"UNSIGNED_BYTE";return"FLOAT"}(e)],this.debug=i}var e=t.prototype;e.start=function(){var t=this.gl;t.enable(t.STENCIL_TEST),t.stencilMask(255),t.stencilOp(t.KEEP,t.REPLACE,t.REPLACE),t.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),vh(t,this.program,this.attributes),this.transformLoc||(this.transformLoc=t.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=t.getUniformLocation(this.program,"color")),this.debug||t.colorMask(!1,!1,!1,!1)},e.end=function(){var t=this.gl;t.depthMask(!0),this._restore(),this.debug||t.colorMask(!0,!0,!0,!0)},e.draw=function(t){var e=this.gl;e.uniformMatrix4fv(this.transformLoc,!1,t),e.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},e.remove=function(){var t=this.gl;return this.buffer&&t.deleteBuffer(this.buffer),this.program&&(t.deleteShader(this.program.fragmentShader),t.deleteShader(this.program.vertexShader),t.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},e.stencilMask=function(t){return this.gl.stencilMask(t),this},e.stencilFunc=function(t,e,i){return this.ref=e,this.gl.stencilFunc(t,e,i),this},e.stencilOp=function(t,e,i){return this.gl.stencilOp(t,e,i),this},e.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},e._save=function(){var t=this.gl;this._savedProgram=t.program},e._restore=function(){var t=this.gl;t.program=this._savedProgram,t.program&&t.useProgram(t.program)},e._createBuffer=function(){var t=this.gl;if(this.buffer=t.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.quadVertices,t.STATIC_DRAW)},e._createProgram=function(){var t=gh(this.gl,"\n    attribute vec3 a_position;\n    uniform mat4 transform;\n\n    void main()\n    {\n        gl_Position = transform * vec4(a_position, 1.0);\n    }\n","\n    precision mediump float;\n    uniform vec3 color;\n    void main()\n    {\n        gl_FragColor = vec4(color, 1.0);\n    }\n"),e=t.program,i=t.vertexShader,n=t.fragmentShader;e.vertexShader=i,e.fragmentShader=n,this.program=e}}();var ll=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.checkResources=function(){var t=this._geosToCheck;if(this._resourceChecked||t||(t=this.layer._geoList),!kt(t))return[];for(var e=[],i={},n=t.length-1;n>=0;n--){var r=t[n]._getExternalResources();if(r.length)if(this.resources)for(var o=0;o<r.length;o++){var s=r[o][0];this.resources.isResourceLoaded(r[o])||i[s]||(e.push(r[o]),i[s]=1)}else e.push.apply(e,r)}return this._resourceChecked=!0,delete this._geosToCheck,e},i.render=function(){return this.layer._sortGeometries(),t.prototype.render.apply(this,arguments)},i._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),wt(this._geosToCheck,t))},i.onGeometryAdd=function(t){this._addGeoToCheckRes(t),cl(this)},i.onGeometryRemove=function(){cl(this)},i.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),cl(this)},i.onGeometryShapeChange=function(){cl(this)},i.onGeometryPositionChange=function(){cl(this)},i.onGeometryZIndexChange=function(){cl(this)},i.onGeometryShow=function(){cl(this)},i.onGeometryHide=function(){cl(this)},i.onGeometryPropertiesChange=function(){cl(this)},e}(er);function cl(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var ul=new gn,dl=[],fl=new gn,_l=function(t){function e(){return t.apply(this,arguments)||this}ct(e,t);var i=e.prototype;return i.getImageData=function(){if(!this.layer.options.geometryEvents||!this._lastRenderTime||g()-this._lastRenderTime<32)return null;if(!this._imageData){var t=this.context.canvas,e=t.width,i=t.height;try{this._imageData=this.context.getImageData(0,0,e,i)}catch(t){console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t)}}return this._imageData},i.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=g()},i.checkResources=function(){var e=this,i=t.prototype.checkResources.apply(this,arguments),n=this.layer.getStyle();return n&&(Array.isArray(n)||(n=[n]),n.forEach(function(t){for(var n=Se(t.symbol,!0),r=0,o=n.length;r<o;r++)e.resources.isResourceLoaded(n[r])||i.push(n[r])})),i},i.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableAltitude)||!(e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===Ps)&&t.prototype.needToRedraw.call(this)},i.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},i.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},i.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),i=this.mapStateCache.resolution;(t.isZooming()&&t.options.seamlessZoom&&void 0!==this._drawnRes&&i>1.5*this._drawnRes&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._drawnRes=i),this._sortByDistanceToCamera(t.cameraPosition);for(var n=0,r=this._geosToDraw.length;n<r;n++){var o=this._geosToDraw[n];o._isCheck||o.isVisible()?(o._paint(this._displayExtent),this._geosToDraw[n]._cPoint=void 0,this._geosToDraw[n]._inCurrentView=void 0):(delete o._cPoint,delete o._inCurrentView)}this.clearImageData()}},i.show=function(){this.layer.forEach(function(t){t._repaint()}),t.prototype.show.apply(this,arguments)},i.forEachGeo=function(t,e){this.layer.forEach(t,e)},i.drawGeos=function(){this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._sortByDistanceToCamera(this.getMap().cameraPosition);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(),this._geosToDraw[t]._cPoint=void 0,this._geosToDraw[t]._inCurrentView=void 0;this.clearImageData()},i.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},i.checkGeo=function(t){if("Point"!==t.type||void 0===this._onlyHasPoint){if(t._isCheck=!1,t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),i=!0;if(t._inCurrentView)i=!0;else if(!1===t._inCurrentView)i=!1;else{var n=e.get2DExtent(this.resources,ul);n&&n.intersects(this._displayExtent)||(i=!1)}i&&(e.hasPoint()&&(this._hasPoint=!0),t._isCheck=!0,this._geosToDraw.push(t))}}else t._inCurrentView&&(this._hasPoint=!0,t._isCheck=!0,this._geosToDraw.push(t))},i.onZoomEnd=function(){delete this.canvasExtent2D,t.prototype.onZoomEnd.apply(this,arguments)},i.onRemove=function(){this.forEachGeo(function(t){t.onHide()}),delete this._geosToDraw},i.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},i._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},i.identifyAtPoint=function(t,e){void 0===e&&(e={});var i=this._geosToDraw;return i?this.layer._hitGeos(i,t,e):[]},i._updateMapStateCache=function(){var t=this.getMap(),e=t._pointToContainerPoint(this.southWest)._add(0,-t.height),i=t.getResolution(),n=t.getPitch(),r=t.getBearing(),o=t.getGLScale(),s=t.getGLRes(),a=t.getContainerExtent(),h=t._get2DExtent(),l=t._get2DExtentAtRes(s);return this.mapStateCache={resolution:i,pitch:n,bearing:r,glScale:o,glRes:s,_2DExtent:h,glExtent:l,containerExtent:a,offset:e},this},i._batchConversionMarkers=function(t){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var e=[],i=[],n=[],r={},o=this.layer,s=o.options,a=o.getAltitude?o.getAltitude():0,h=o.isCanvasRender();this._onlyHasPoint=!0;for(var l=0,c=0,u=this.layer._geoList.length;c<u;c++){var d=this.layer._geoList[c];if("Point"===d.getType()){var f=d._painter;f||(f=d._getPainter());var _=f.getRenderPoints("center")[0][0],p=s.enableAltitude?d.getAltitude():a;void 0===r[p]&&(r[p]=f.getAltitude()),e[l]=_,n[l]=r[p],i[l]=d,l++}else this._onlyHasPoint=!1}if(0===l)return[];var m=this.getMap(),g=Vt(e,"_pt");g=m._pointsAtResToContainerPoints(e,t,n,g);for(var v=m.getContainerExtent(),y=v.xmax,x=v.ymax,w=v.xmin,b=v.ymin,A={},C=0,S=i.length;C<S;C++){var E=i[C];if(E._cPoint=g[C],E._cPoint){var P=g[C],M=P.x,T=P.y;if(E._inCurrentView=M>=w&&T>=b&&M<=y&&T<=x,!E._inCurrentView){var k=E.getSymbolHash(),R=void 0;R=k?A[k]=A[k]||E._painter.getFixedExtent():E._painter.getFixedExtent(),fl.set(R.xmin,R.ymin,R.xmax,R.ymax),fl._add(g[C]),E._inCurrentView=fl.intersects(v)}E._inCurrentView&&(E.isVisible()&&h||(E._inCurrentView=!1),this._onlyHasPoint&&E._inCurrentView&&(this._hasPoint=!0,E._isCheck=!0,this._geosToDraw.push(E)))}else E._inCurrentView=!1}return g},i._sortByDistanceToCamera=function(t){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var e=this.getMap(),i=e.distanceToPoint(1e3,0,e.getGLScale()).x/1e3;this._geosToDraw.sort(function(e,n){var r=e.getType(),o=n.getType();if("Point"!==r||"Point"!==o)return 0;var s=e._painter,a=n._painter;if(!s||!a)return 0;var h=s.getRenderPoints("center")[0][0],l=a.getRenderPoints("center")[0][0],c=s.getAltitude()*i,u=a.getAltitude()*i;Hs(dl,h.x,h.y,c);var d=Ys(dl,t);return Hs(dl,l.x,l.y,u),Ys(dl,t)-d})}},i._constructorIsThis=function(){return this.constructor===e},e}(ll);Ps.registerRenderer("canvas",_l);var pl=function(t){function e(e){var i;return(i=t.call(this)||this).map=e,i._handlerQueue=[],i}ct(e,t);var i=e.prototype;return i.callInNextFrame=function(t){this._handlerQueue.push(t)},i.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]()},i.offsetPlatform=function(t,e){if(!this.map._panels.front)return this;if(!e&&0===t.x&&0===t.y)return this;var i=this.map._panels,n=this._frontCount=i.back.layerDOM.childElementCount,r=this._backCount=i.front.layerDOM.childElementCount,o=this._uiCount=i.front.uiDOM.childElementCount;if(n||r||o){var s=this.map.offsetPlatform();s=t?s.add(t)._round():s.round(),r&&pi(i.back,s),(n||o)&&pi(i.front,s)}return this},i.domChanged=function(){var t=this.map._panels;if(!t.front)return!1;var e=t.back.layerDOM.childElementCount;if(void 0===this._frontCount||this._frontCount!==e)return!0;var i=t.front.layerDOM.childElementCount;if(void 0===this._backCount||this._backCount!==i)return!0;var n=t.front.uiDOM.childElementCount;return void 0===this._uiCount||this._uiCount!==n},i.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new pt(0,0);pi(this.map._panels.back,t),pi(this.map._panels.front,t)}},i.onZoomEnd=function(){this.resetContainer()},i.onLoad=function(){this._frameLoop()},e}(Wi),ml=function(t){function e(e){var i;return(i=t.call(this,e)||this)._containerIsCanvas=!!e._containerDOM.getContext,i._thisVisibilitychange=i._onVisibilitychange.bind(ut(ut(i))),i._registerEvents(),i._loopTime=0,i}ct(e,t);var i=e.prototype;return i.load=function(){this.initContainer()},i.renderFrame=function(t){if(!this.map||!this.map.options.renderable)return!1;this._updateDomPosition(t),delete this._isViewChanged;var e=this.map;e._fireEvent("framestart"),this.updateMapDOM(),e.clearCollisionIndex();var i=this._getAllLayerToRender();return this.drawLayers(i,t),this.drawLayerCanvas(i)&&(this.drawTops(),this._drawCenterCross()),e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,!0},i.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},i.drawLayers=function(t,e){for(var i=this.map,n=i.isInteracting(),r=[],o=[],s=i.options.fpsOnInteracting||0,a=0===s?0:1e3/s,h=this.map.options.layerCanvasLimitOnInteracting,l=t.length,c=i.getBaseLayer(),u=0,d=0;d<l;d++){var f=t[d];if(f.isVisible()){var _=f.isCanvasRender();_&&r.push(f.getId());var p=f._getRenderer();if(p){var m=this._checkLayerRedraw(f);_&&p.isCanvasUpdated()&&(m||o.push(f.getId()),this.setLayerCanvasUpdated());var g=p.__zoomTransformMatrix;if(delete p.__zoomTransformMatrix,m){if(n&&_){if(h>0&&l-1-d>h&&f!==c){f._getRenderer().clearCanvas();continue}u+=this._drawCanvasLayerOnInteracting(f,u,a,e)}else n&&p.drawOnInteracting?(p.prepareRender&&p.prepareRender(),p.checkAndDraw?p.checkAndDraw(p.drawOnInteracting,this._eventParam,e):p.drawOnInteracting(this._eventParam,e)):(p.render(e),_&&g&&p.isLoadingResource()&&(p.__zoomTransformMatrix=g));_&&(o.push(f.getId()),this.setLayerCanvasUpdated())}else _&&n&&(i.isZooming()&&!i.getPitch()?(p.prepareRender(),p.__zoomTransformMatrix=this._zoomMatrix):(i.getPitch()||i.isRotating())&&p.clearCanvas())}}}var v=this._canvasIds||[],y=this._updatedIds||[];if(this._canvasIds=r,this._updatedIds=o,!this.isLayerCanvasUpdated()){v.join("---")===r.join("---")&&y.join("---")===o.join("---")||this.setLayerCanvasUpdated()}},i._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,i=t._getRenderer();return t.isCanvasRender()?i.testIfNeedRedraw():!(!i.needToRedraw||!i.needToRedraw())||(e.isInteracting()||this.isViewChanged())},i._drawCanvasLayerOnInteracting=function(t,e,i,n){var r=this.map,o=t._getRenderer(),s=o.getDrawTime(),a=0===i||i>0&&e+s<=i;if(o.mustRenderOnInteracting&&o.mustRenderOnInteracting())o.render(n);else{if(o.drawOnInteracting&&(t===r.getBaseLayer()||a||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return o.prepareRender(),o.prepareCanvas(),o.checkAndDraw?o.checkAndDraw(o.drawOnInteracting,this._eventParam,n):o.drawOnInteracting(this._eventParam,n),s;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&o.clearCanvas():(o.prepareRender(),o.__zoomTransformMatrix=this._zoomMatrix)}return o.drawOnInteracting&&!a&&o.onSkipDrawOnInteracting(this._eventParam,n),0},i._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach(function(e){var i=t.getLayer(e);if(i){var n=i._getRenderer();n&&n.isRenderComplete()&&i.fire("layerload")}})}},i.isLayerCanvasUpdated=function(){return this._canvasUpdated},i.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},i.drawLayerCanvas=function(t){var e=this.map;if(!e)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged())return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var i,n=e.isInteracting(),r=e.options.layerCanvasLimitOnInteracting,o=t.length,s=[],a=0;a<o;a++){if(t[a].isVisible()&&t[a].isCanvasRender())if(t[a]._getRenderer()){var h=this._getLayerImage(t[a]);h&&h.image&&(t[a]===e.getBaseLayer()?i=[t[a],h]:s.push([t[a],h]))}}var l=this.canvas.width,c=this.canvas.height;i&&(this._drawLayerCanvasImage(i[0],i[1],l,c),this._drawFog()),o=s.length;for(var u=n&&r>=0&&o>r?o-r:0;u<o;u++)this._drawLayerCanvasImage(s[u][0],s[u][1],l,c);return e._fireEvent("renderend",{context:this.context}),!0},i.setToRedraw=function(){for(var t=this._getAllLayerToRender(),e=0,i=t.length;e<i;e++){var n=t[e].getRenderer();n&&n.canvas&&n.setToRedraw&&n.setToRedraw()}},i.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",i=t.height+"px",n=this.map._panels;n.mapWrapper.style.width=e,n.mapWrapper.style.height=i,this._updateCanvasSize()}},i.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},i.toDataURL=function(t,e){return this.canvas?this.canvas.toDataURL(t,e):null},i.remove=function(){lt.webgl&&"undefined"!=typeof document&&ci(document,"visibilitychange",this._thisVisibilitychange),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},i.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){for(var i=e._getLayers(),n="default",r=e.options.hitDetectLimit||0,o=0,s=i.length-1;s>=0;s--){var a=i[s];if(!(!a.options.hitDetect||a.isEmpty&&a.isEmpty())){var h=a._getRenderer();if(h&&h.hitDetect&&(!h.isBlank||!h.isBlank())){if("default"!==a.options.cursor&&h.hitDetect(t)){n=a.options.cursor||"pointer";break}if(r>0&&++o>r)break}}}e._trySetCursor(n)}},i._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},i.initContainer=function(){var t=this.map._panels;function e(e,i,n,r){var o=si("div",i);return n&&(o.style.cssText=n),t[e]=o,r||_i(o),o}var i=this.map._containerDOM;if(!this._containerIsCanvas){i.innerHTML="";var n="position:absolute;top:0px;left:0px;",r=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),o=e("allLayers","maptalks-all-layers",n+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),s=e("backStatic","maptalks-back-static",n+"z-index:0;",!0),a=e("back","maptalks-back",n+"z-index:1;"),h=e("backLayer","maptalks-back-layer",n),l=e("canvasContainer","maptalks-canvas-layer",n+"border:none;z-index:2;"),c=e("frontStatic","maptalks-front-static",n+"z-index:3;",!0),u=e("front","maptalks-front",n+"z-index:4;",!0),d=e("frontLayer","maptalks-front-layer",n+"z-index:0;"),f=e("ui","maptalks-ui",n+"border:none;z-index:1;",!0),_=e("control","maptalks-control","z-index:1",!0);i.appendChild(r),o.appendChild(s),a.appendChild(h),a.layerDOM=h,o.appendChild(a),o.appendChild(l),u.appendChild(d),u.layerDOM=d,u.uiDOM=f,o.appendChild(c),o.appendChild(u),u.appendChild(f),r.appendChild(o),r.appendChild(_),this.createCanvas(),this.resetContainer();var p=this.map._getContainerDomSize();this.updateMapSize(p)}},i.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!Ft(t,e),this._isViewChanged},i._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||Ft(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},i.isSpatialReferenceChanged=function(){return this._spatialRefChanged},i._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},i._frameLoop=function(t){var e=this;this.map?(t=t||0,this._frameTimestamp=t,this._resizeCount=0,this.renderFrame(t),Yn().commit(),this._animationFrame=dt(function(t){e._frameLoop(t)})):this._cancelFrameLoop()},i._cancelFrameLoop=function(){this._animationFrame&&ft(this._animationFrame)},i._drawLayerCanvasImage=function(t,e,i,n){var r=this.context,o=e.point.round(),s=this.map.getDevicePixelRatio();1!==s&&o._multi(s);var a=e.image,h=a.width,l=a.height;if(!(o.x+h<=0||o.y+l<=0)){var c=t.options.opacity;if(x(c)||(c=1),!(c<=0)){var u=e.opacity;if(x(u)||(u=1),!(u<=0)){var d=r.globalAlpha;c<1&&(r.globalAlpha*=c),u<1&&(r.globalAlpha*=u),t.options.cssFilter&&(r.filter=t.options.cssFilter);var f=t.getRenderer(),_=f.__zoomTransformMatrix,p=f.clipCanvas(this.context);_&&(r.save(),r.setTransform.apply(r,_)),r.drawImage(a,0,0,h,l,o.x,o.y,i,n),_&&r.restore(),p&&r.restore(),"none"!==r.filter&&(r.filter="none"),r.globalAlpha=d}}}},i._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,i=new pt(this.canvas.width/2,this.canvas.height/2);C(t)?t(e,i):ji.drawCross(this.context,i.x,i.y,2,"#f00")}},i._drawContainerExtent=function(){var t=this.map.options.cascadePitches,e=this.map.height-this.map._getVisualHeight(t[0]),i=this.map.height-this.map._getVisualHeight(t[1]),n=this.map.getContainerExtent(),r=this.context;r.beginPath(),r.moveTo(0,n.ymin),r.lineTo(n.xmax,n.ymin),r.stroke(),r.beginPath(),r.moveTo(0,e),r.lineTo(n.xmax,e),r.stroke(),r.beginPath(),r.moveTo(0,i),r.lineTo(n.xmax,i),r.stroke()},i._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=t.getDevicePixelRatio(),i=this.context,n=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var o=n.ymin*e,s=Math.ceil(o-r),a=t.options.fogColor.join(),h=i.createLinearGradient(0,r,0,o+30),l=1-30/(s+30);h.addColorStop(0,"rgba("+a+", 0)"),h.addColorStop(.3,"rgba("+a+", 0.3)"),h.addColorStop(l,"rgba("+a+", 1)"),h.addColorStop(1,"rgba("+a+", 0)"),i.beginPath(),i.fillStyle=h,i.fillRect(0,r,Math.ceil(n.getWidth())*e,Math.ceil(s+30))}},i._getAllLayerToRender=function(){return this.map._getLayers()},i.clearCanvas=function(){this.canvas&&ji.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),i=this.canvas,n=Qt(e,t.getDevicePixelRatio()),r=n.width,o=n.height,s=n.cssWidth,a=n.cssHeight;return!i.style||i.style.width===s&&i.style.height===a||(i.style.width=s,i.style.height=a),(r!==i.width||o!==i.height)&&(i.height=o,i.width=r,this.topLayer.width=i.width,this.topLayer.height=i.height,!0)},i.createCanvas=function(){this.topLayer=si("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=si("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},i._updateDomPosition=function(t){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(t-this._checkPositionTime)>=500&&(mi(this.map._containerDOM),this._checkPositionTime=Math.min(t,this._checkPositionTime)),this},i._checkSize=function(){this.map&&this.map.checkSize()},i._setCheckSizeInterval=function(t){var e=this;lt.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver(function(t){!e.map||e.map.isRemoved()?e._resizeObserver.disconnect():t.length&&(e.map._containerDomContentRect=t[0].contentRect,e._checkSize(t[0].contentRect),e._resizeCount=e._resizeCount||0,e.renderFrame((e._frameTimestamp||0)+ ++e._resizeCount/100))}),this._resizeObserver.observe(this.map._containerDOM))):(clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval(function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()},this._checkSizeInterval))},i._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!k&&"undefined"!=typeof window&&this._setCheckSizeInterval(e.options.checkSizeInterval),lt.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",function(e){t._eventParam=e}),e.on("_zooming",function(i){e.getPitch()||(t._zoomMatrix=i.matrix.container),t._eventParam=i}),e.on("_zoomend",function(e){t._eventParam=e,delete t._zoomMatrix}),e.on("_spatialreferencechange",function(){t._spatialRefChanged=!0}),lt.webgl&&"undefined"!=typeof document&&li(document,"visibilitychange",this._thisVisibilitychange,this),lt.addDPRListening&&lt.addDPRListening(this.map)},i._onMapMouseMove=function(t){var e=this,i=this.map;!i.isInteracting()&&i.options.hitDetect&&(this._hitDetectFrame&&ft(this._hitDetectFrame),this._hitDetectFrame=dt(function(){e.hitDetect(t.containerPoint)}))},i._getCanvasLayers=function(){return this.map._getLayers(function(t){return t.isCanvasRender()})},i._onVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},i.addTopElement=function(t){this._tops||(this._tops=[]),this._tops.push(t)},i.removeTopElement=function(t){if(this._tops){var e=this._tops.indexOf(t);e>=0&&this._tops.splice(e,1)}},i.getTopElements=function(){return this._tops||[]},i.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var t=this.getTopElements(),e=!1,i=0;i<t.length;i++)t[i].render(this.topCtx)&&(e=!0);e&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},e}(pl);ko.registerRenderer("canvas",ml),ko.mergeOptions({fog:!1,fogColor:[233,233,233]});var gl={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};Yo.include(gl),hs.include(gl),as.include(gl),cs.include(gl),ls.include({_getRenderPoints:function(t){var e=this.getMap(),i=e.getGLRes();if("vertex"===t){for(var n=this._trimRing(this.getShell()),r=[],o=0,s=n.length;o<s;o++)r.push(e.coordToPointAtRes(n[o],i));return[r,null]}return[[e.coordToPointAtRes(this.getCenter(),i)],null]}});var vl={_getRenderPoints:function(t){var e,i=this.getMap(),n=i.getGLRes(),r=null;if("point"===t)(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n))&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if("vertex"===t)if(r=[],(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n))&&e.length>0&&Array.isArray(e[0])){for(var o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)0===a?r.push([e[o][a],e[o][a+1]]):r.push([e[o][a-1],e[o][a]]);e=e[0].concat(e[1])}else for(var l=0,c=e.length;l<c;l++)0===l?r.push([e[l],e[l+1]]):r.push([e[l-1],e[l]]);else if("line"===t){e=[],r=[];var u=this._getPath2DPoints(this._getPrjCoordinates(),!1,n);if(u.length>0&&Array.isArray(u[0]))for(var d,f=1,_=u.length;f<_;f++){d=u[f],this instanceof Wo&&d.length>0&&!d[0].equals(d[d.length-1])&&d.push(d[0]);for(var p=1,m=d.length;p<m;p++)e.push(d[p].add(d[p-1])._multi(.5)),r.push([d[p-1],d[p]])}else{this instanceof Wo&&u.length>0&&!u[0].equals(u[u.length-1])&&u.push(u[0]);for(var g=1,v=u.length;g<v;g++)e.push(u[g].add(u[g-1])._multi(.5)),r.push([u[g-1],u[g]])}}else if("vertex-first"===t){var y=this._getPrjCoordinates(),x=y.length,w=x?i._prjToPointAtRes(y[0],n):null;e=x?[w]:[],r=x?[[w,y[1]?i._prjToPointAtRes(y[1],n):w]]:[]}else if("vertex-last"===t){var b=this._getPrjCoordinates(),A=b.length,C=A?i._prjToPointAtRes(b[A-1],n):null;e=A?[C]:[];var S=A>1?A-2:A-1;r=A?[[b[S]?i._prjToPointAtRes(b[S],n):C,C]]:[]}else{var E=this._getProjection().project(this.getCenter());e=[i._prjToPointAtRes(E,n)]}return[e,r]}};Ko.include(vl),Wo.include(vl);var yl={within:!1,center:[0,0]};function xl(t){if(t&&t._containerBbox){yl.within=!1;var e=t._containerBbox,i=e.minx,n=e.miny,r=e.maxx,o=e.maxy,s=Math.abs(r-i),a=Math.abs(o-n);s<=1&&a<=1&&(yl.within=!0,yl.center[0]=(i+r)/2,yl.center[1]=(n+o)/2),delete t._containerBbox}else yl.within=!1;return yl}vo.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var wl={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof hs||this instanceof cs},_paintAsPath:function(){var t=this.getMap();return this.getAltitude()>0||t.getPitch()||this instanceof hs&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return Wo.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),i=t._prjToPointAtRes(e,t.getGLRes()),n=this._getRenderSize(i);return[i].concat(n)},_paintOn:function(){return this._paintAsPath()?ji.polygon.apply(ji,arguments):ji.ellipse.apply(ji,arguments)},_getRenderSize:function(t){var e=this.getMap(),i=e.getGLRes(),n=this._getPrjExtent(),r=e._prjToPointAtRes(n.getMin(),i),o=e._prjToPointAtRes(n.getMax(),i);return[Math.abs(o.x-r.x)/2,Math.abs(o.y-t.y),Math.abs(t.y-r.y)]}};hs.include(wl),as.include(wl),ls.include({_getPaintParams:function(){var t=this.getMap(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t.getGLRes())]},_paintOn:ji.polygon}),cs.include(wl,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return Wo.prototype._getPaintParams.call(this,!0);var t=this.getMap(),e=t._prjToPointAtRes(this._getPrjCoordinates(),t.getGLRes());return[e,this._getRenderSize(e)[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return ji.polygon.apply(ji,arguments);var t=this.getMap().getBearing(),e=arguments;return t&&(e[3]=e[3].slice(0),e[3][0]+=t,e[3][1]+=t),ji.sector.apply(ji,e)}}),Vo.include({_paintAsPath:function(){return!0}}),Ko.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,i,n,r){if(!t||!e||t.equals(e))return null;r||(r=0);var o,s=i*n[0],a=i*n[1]+r,h=s/2+r;(o=e.nextCtrlPoint||e.prevCtrlPoint?e.prevCtrlPoint?e.sub(new pt(e.prevCtrlPoint)):e.sub(new pt(e.nextCtrlPoint)):e.sub(t))._unit();var l=e.sub(o.multi(a));o._perp();var c=l.add(o.multi(h));return o._multi(-1),[c,e,l.add(o.multi(h)),c]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLRes())]},_paintOn:function(t,e,i,n,r){var o=xl(this._painter);o.within?ji.pixelRect(t,o.center,i,n):this.options.smoothness?ji.paintSmoothLine(t,e,i,this.options.smoothness,!1,this._animIdx,this._animTailRatio):ji.path(t,e,i,null,r),this._paintArrow(t,e,i)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,i){var n=this._getArrowStyle();if(!n||t.length<2)return[];for(var r=t.length>0&&Array.isArray(t[0])?t:[t],o=this._getArrowPlacement(),s=[],a=this.getMap(),h=a.coordToContainerPoint(this.getFirstCoordinate()),l=a.coordToContainerPoint(this.getLastCoordinate()),c=r.length-1;c>=0;c--){if("vertex-first"===o||"vertex-firstlast"===o&&r[c][0].closeTo(h,.01)){var u=this._getArrowShape(r[c][1],r[c][0],e,n,i);u&&s.push(u)}if("vertex-last"===o||"vertex-firstlast"===o&&r[c][r[c].length-1].closeTo(l,.01)){var d=this._getArrowShape(r[c][r[c].length-2],r[c][r[c].length-1],e,n,i);d&&s.push(d)}else"point"===o&&this._getArrowPoints(s,r[c],e,n,i)}return s},_getArrowPoints:function(t,e,i,n,r){for(var o=0,s=e.length-1;o<s;o++){var a=this._getArrowShape(e[o],e[o+1],i,n,r);a&&t.push(a)}},_paintArrow:function(t,e,i){var n=this._getInternalSymbol().lineWidth;(!x(n)||n<3)&&(n=3);var r=this._getArrows(e,n);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;o>=0;o--)t.fillStyle=t.strokeStyle,ji.polygon(t,r[o],i,i)}}}),Wo.include({_getPaintParams:function(t){var e=this.getMap().getGLRes(),i=this._getPrjShell(),n=this._getPath2DPoints(i,t,e),r=n.length>0&&Array.isArray(n[0]);r&&(n=[[n[0]],[n[1]]]);var o=this._getPrjHoles(),s=[];if(o&&o.length>0){for(var a=this._simplified,h=0;h<o.length;h++){var l=this._getPath2DPoints(o[h],t,e);Array.isArray(l)&&r?Array.isArray(l[0])?(n[0].push(l[0]),n[1].push(l[1])):n[0].push(l):s.push(l)}a&&(this._simplified=a)}return r||wt(n=[n],s),[n]},_paintOn:function(t,e,i,n,r){var o=xl(this._painter);o.within?ji.pixelRect(t,o.center,i,n):ji.polygon(t,e,i,n,r,this.options.smoothness)}}),ko.VERSION="1.0.0-rc.4"}).call(e,i("W2nU"))},sLCk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"CarsDialog",data:function(){return{dialogVisible1:!1,title:"选择车辆",tids:[]}},methods:{lingxcheckchange:function(t,e,i){var n=this;if(e)(t.value+"").length<10&&149!=t.value?this.callApi({apicode:1136,groupId:t.value},function(t){for(var e=0;e<t.data.length;e++)n.addTid({text:n.getText(t.data[e].text),value:t.data[e].value})}):n.addTid({text:n.getText(t.text),value:t.value});else{if(i)return;(t.value+"").length<10&&149!=t.value?this.callApi({apicode:1136,groupId:t.value},function(t){for(var e=0;e<t.data.length;e++)n.removeTid({text:n.getText(t.data[e].text),value:t.data[e].value})}):n.removeTid({text:n.getText(t.text),value:t.value})}},lingxnodeclick:function(){},getText:function(t){var e=t.indexOf(" ");return e>0&&(t=t.substring(0,e)),t},addTid:function(t){var e=t.value;if(!((e+"").length<10)){for(var i=-1,n=0;n<this.tids.length;n++)if(e==this.tids[n].value){i=n;break}-1==i&&this.tids.push(t)}},removeTid:function(t){for(var e=t.value,i=-1,n=0;n<this.tids.length;n++)if(e==this.tids[n]){i=n;break}this.tids.splice(i,1)},ok:function(){this.$emit("returntids",this.tids),this.dialogVisible1=!1},openDialog:function(){this.$refs.lingxCarTree&&this.$refs.lingxCarTree.setCheckedKeys([]),this.dialogVisible1=!0},closeDialog:function(){this.dialogVisible1=!1}},components:{LingxCarTree:i("Zwc7").a}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.title,visible:t.dialogVisible1,width:"720px",height:"480px","show-close":"","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible1=e}}},[i("div",{staticStyle:{height:"380px",overflow:"auto","background-color":"#fff"}},[i("LingxCarTree",{ref:"lingxCarTree",attrs:{isStatus:!0,isReload:!0},on:{lingxcheckchange:t.lingxcheckchange,lingxnodeclick:t.lingxnodeclick}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.ok}},[t._v("确 定")]),t._v(" "),i("el-button",{attrs:{size:"medium"},on:{click:t.closeDialog}},[t._v("关 闭")])],1)])},staticRenderFns:[]};var o=i("VU/8")(n,r,!1,function(t){i("BYUQ")},null,null);e.default=o.exports},u2KI:function(t,e,i){t.exports={default:i("O4R0"),__esModule:!0}},ue5y:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAALfklEQVR4Xu1dbawU1Rl+3lnaIoaPnb3+KLa1ws5e+oGp2hZqW9CARRr801SMpTahaYGdBTTUSiP9sAWM2BQj3J3LhyExVWvANI21xVaJApUKaW2LH8jOXqpBaFruzqKIUGTnbeZeL4V7Z3Zmd2fn486Z5Ob+mPe8532f8+xzzpw5cw5BXIlGgBKdvUgeggAJJ4EggCBAwhFIePpCAQQBEo5AwtMXCiAIkHAEEp6+UABBgIQjkPD0hQIIAiQcgYSnLxRAECDhCCQ8faEAggAJRyDh6QsFEARIOAIJT18ogCBAwhFIePqJUgB5nT4GKbqGwRMImADQhP7250MMHCLQIdR4j7FUeTspvBj2BJC79VkwzS8wSdMJuNZLwzLwHLG5E5L0ZyOv/MFLmbjaDFsCjOsqTZMkWgzgphYbZ5tpctfxxbldLfqJZPFhSQBZ0zcD+I7PiD9oqMp3ffYZurthRwBZKz8P8DXtQZb2GGr2i+3xHY7XYUUAWSsfBfjD7YWS/mWo2fHtrSM478OGALKmHwPQERB0vYaqXBJQXW2tZlgQQO4ubwJzsP0z0WYjn13Q1tYJwHnsCSBr5ZUA/zAArGyqoFWGmv1ROHX7U2usCdChla82wX/xB4rmvEigz/aq2b82Vzr8UrEmgKyVNgIUsgzzJkPNLQy/KZuLILYEiMKvfwDyOKtAbAmQ0fR7GVjeHO/9LUXAmoqq/MBfr8F4iy0BZE0vAVCCgcm1Ft1QlZyrVQQNYkmAcev1a6UUno0SnmYN1x1fojwXpZi8xBJLAqSLpVVEtMJLgkHZMPPqaiEX0uNo81nGlAB6kQhq82n7X5IZWrWgFPz33F6PsSSAXCw9CqJb2gtNg96Zf2UUct9osFTo5jElgL4dhBtCR+/8ABhPGQVldqRi8hBMLAmQ1vRnva7u8YCBLybWKqKqqlzni7MAnQgC+AS2IIBPQHpxIxTAC0rebIQCeMPJ1UoogCtE/hkIBfAPS6EAPmEpFMAnIL24EQrgBSVvNkIBvOHkaiUUwBUi/wyEAviHpVAAn7AUCuATkF7cCAXwgpI3G6EA3nBytRIK4AqRfwZCAfzDUiiAT1gKBfAJSC9uhAJ4QcmbjVAAbzi5WgkFcIXIPwOhAP5hGQkF6NAOdZpcW8iEKyWifZV8tu56/7gSQC7qawdyJJa29KoTDvrXlM15Cp0Aclfpekj06OBPuw1VcYwtjgSQNZ0HNVGvWcNNYS8lD58Amv4nAEN33WDcbxSUZXa8jhsBMt3lNcx855BcCNYmVG3azcSbIkSBAIN/GX2R1xtUxY0A9eKtp3TemrA1K0GA1vA7V7pZwgoCDO0bhQL4REovboQCeEHJg41QAA8g2ZnYjI5dFUAuxuvDEDEGqEMOWSu/DvBlNiYlQ1U6bUkTs0/DZE23nvdtPh+nNww1+/Emfzu+FItAF1DaBdCXbbI5YajKGNvHwGK8Pg6VNd3afHr00Fx4t6HmpvnSkk06CZ0AGU3/JQPftItfOlEb07t80onB9+L0eXjHmtdGm6NTtruPE/BwRVVubbLtfCkWOgHSmr6agLtsCWBKnb2LJ1o7gVxwZbpKU1iiF3xBwCcnTPSlaj77/GB3HV09OVMybad8Gbinqiqh7nMQOgFkrbwA4I127VBv1w1Z018C8Gmf2q9FN/S6oWYvt3NSfzcTWmio2U0tVt5S8fAJYO3nz3jKNgvGL4yCcof9QPDg3SDpJy1l71/htYaqfK/h8QrhhrDPIwidAB9Ze/iid0eeftehLRyfBDo26leZNewFMMK/dmzSk0SzjUVZWxLLxdIhENmqw8jUxRcfXTjeKfcmg2msWOgEsMKVNX07YL/hA5k8tbI4ZzX0kEvW9PsB3N5Yyr5bbzNUZW6j8k/AzoqqeDrBxPeIz3MYCQJkNL3AQJd9N2D+1Ch03m13b+w6fWJqBO8FKNNOkOr5Nk2e7nSaSL0BLgErKqpyT1hxD9QbCQKk1x+YTKkR++3AYMaL1Uuyn8dcqkVwLOB8ishWTqWPlfcR4Sq7uKOyu2gkCGABlNH0Fxm40g4sIr6tks+tc/q1ZDT9CQZuDPjX9EqKz0w9VvjUO3b1ZrpLS5npAYeYXjFUJRJPMJEhQP3+nA5yiqZUF058y6mRZU0/AiCwkzxSTMqxQrZsO/Lf2DOWalbXxLZT2SB6wMhnwx679IUeGQKktdeuIKSsyZ2LbFUA5oqK2lm3z5SLpQMgmtRuJWCY06pq525nRTp4F0Na7XD/FKM2tapOsu3y2h37YP+RIUBfN1AsrWGioUun+qM+IqE2o1edVHchZZufDP6Bs5hjLFXedGqosVppQgpkHTF3qS2Rme+rFHKR2OQ6UgrQR4Dug5cyS9Yjny14YOwyCsp0t1+JXLQmiawzA318OiA8njLPzHfq8wdikrv1bWB83SHGI0TmlEq+0+quInFFSgEsRNLd5TuJeY0jOoytRkG52Q29/kdEWAdHWn9NTxZZL2wAfqii5p5xqzNTLK9g4lVOdky0vJrP3ufmJ8j7kSNA/8zgf18A+Io6JFhmFBRrEsj1smYMuYa5DHytge3ldQJ+TbXa471LJnk6kkYuHrwZJD3mHBDtH3X6Q1PfXPbRU65BB2gQOQL0q0DPPGLz4Xo4MEk3VvMTn2wEK+vFDEk8E6A0gdPW//7yXGVQte+/Sc80ulY/3a3PI7aUwvlioluq+WwdgjSSiX+2kSSAlZ5cLP8MxHVP5CKi2yr5rOP8gH8wOXtKa/pDBHyrXl0ELK6oSjGIeBqtI7IE6COBVn4M4Lr9PYE3SPze990GZ40C42Y/5sHD8ogzpx9xeodxrjzRj418dqWbv7DuR5oA/STQ/wbgMy4A7WFJWl1dNPH3QQCZ3tDzVbC5kth+mvf/MdDvDDU7J4iYmq0j8gR4XwlOAjzKNUnGVjPFxeOL2nPU+7gNpWlSjQog2L79GxTfW4aqjHONOWSDWBCgjwTd+n4wJnvCi7GFRozYVFl4ue1rZE8+zjPqW4JGtACEb3sse9hQlY95tA3VLDYEsFDKaLrGQL4BxF4G0Q7zLP+m0ZF9f6PzbJBkSfjVnutk3mEUcjM924dsGCsC9ClBsXwHiH/eBG7/AfB3ACdAdIJNfocII/tnHekUCG+D2Vq6bf1Zb+oafrFEBK2Sj9e5QbEjQP+YoGc+YG5pggTtK8J8u1HIOb3+bV+9LXqOJQH6uoOu0hQQLWHCvBYxaKk4MR4B83qnZWstOQ+gcGwJMIBNWivPJvASAEEf2LSdQeuratZazxjbK/YEOEeE/ulYiwhT2twae5mwvppXrEmg2F/DhgADLZHZ0DMDNXMmE80A+HP+tBDtBuFpk3nXcVXZ6Y/PaHgZdgQ4H9ZxXa9eJkkfnAVgFsCfAGB9hew2oWSt038DwKvE9ASk2o4ovb/3mzbDmgB2YI3eeLTjA2dP/hsEaeh9Khlq1n4dn9/IR8Rf4gjQ/xipnwWQsmmDA4aqfDIibRNIGIIAF8IsCBAI7XyuJFMsWf2754sl6SUw2ynAIWL2/PZOgvSe09Jwz8GEbBhrBZC10nyANjvIeTDQMo6zxLdW87mGVicFE5x7LbElQLq7Zw6x+Vv3FIOxYKLJ1Xz25WBq86+W2BJA1kr7APLpOb91QBkoVlXFWoEcqyvGBCj/E+BQd9i6oKUZTxsF5Suxav0ofRrWKHAZTb+Xgch8YQOEv91Loxha9rFVgPEbj446XTtprdlv6AmgGZA8lPmjoSrWjGPsrtgSYADp9zeZCmUFDjHOmBI9GcX1/l6ZGHsCeE1U2NkjIAiQcGYIAggCJByBhKcvFEAQIOEIJDx9oQCCAAlHIOHpCwUQBEg4AglPXyiAIEDCEUh4+kIBBAESjkDC0xcKIAiQcAQSnr5QAEGAhCOQ8PSFAggCJByBhKcvFCDhBPgfG+36ruTbqHIAAAAASUVORK5CYII="},uqUo:function(t,e,i){var n=i("kM2E"),r=i("FeBl"),o=i("S82l");t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],s={};s[t]=e(i),n(n.S+n.F*o(function(){i(1)}),"Object",s)}},x1B4:function(t,e,i){"use strict";var n,r=i("mvHQ"),o=i.n(r),s=i("/bhr"),a=(i("TFOu"),i("ow4a")),h=i("d2xA"),l=i("88jF"),c=i.n(l),u=i("4+z/"),d=i.n(u),f=i("iTWp"),_=i.n(f),p=i("Pm2p"),m=i.n(p),g=i("Cf2s"),v=i.n(g),y=i("LHmc"),x=i.n(y),w=new s.a.HashMap,b={},A={name:"LingxCarMap",props:{carid:{type:String,default:""},carno:{type:String,default:""}},data:function(){return{websocket0x0200URL:"",websocket:null,carImgArr:[x.a,c.a,d.a,_.a,m.a,v.a,x.a],center:{lng:116.396621,lat:39.916385},zoom:13,cars:[],lastCar:{},lastTid:""}},methods:{syncCenterAndZoom:function(t){var e=t.target.getCenter(),i=e.lng,n=e.lat;this.center.lng=i,this.center.lat=n,this.zoom=t.target.getZoom()},handler:function(t){t.BMap,t.map},addCar:function(t){if("0x0200"==t.type){t.carno=this.carno;for(var e=-1,i=0;i<this.cars.length;i++)t.tid==this.cars[i].tid&&(e=i);if(-1==e)this.showCarInfo=!0,this.cars.push(t);else{var n=t;if(w.containsKey(n.tid)){var r=w.get(n.tid);r.setCoordinates([n.lng_offset-0,n.lat_offset-0]),r.setSymbol([{markerFile:this.carImgArr[n.status_jt808],markerWidth:40,markerHeight:40,markerDx:0,markerDy:20,markerOpacity:1,markerRotation:this.getRotation(n.direction)},{textName:"{name}",textSize:14,textDy:-24,textFill:"#004e98",textWeight:"bold"}])}}this.lastTid=t.tid,this.lastTid==t.tid?(this.center={lng:t.lng_offset,lat:t.lat_offset},this.lastCar=t,this.lastTid=""):this.lastCar.tid==t.tid&&(this.lastCar=t),this.$emit("updateCarInfo",this.lastCar)}},initWebsocket:function(){var t=this.websocket0x0200URL;this.websocket=new WebSocket(t),this.websocket.onmessage=this.websocketonmessage,this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onclose=this.websocketclose},websocketonopen:function(){},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function(t){var e=JSON.parse(t.data);this.addCar(e)},websocketsend:function(t){t.lingxtoken=this.$store.getters.getUser.token,this.websocket.send(o()(t))},websocketclose:function(t){console.log("断开连接",t)},getRotation:function(t){return(360-t+360)%360}},created:function(){var t=this;this.callApi({apicode:1102},function(e){t.websocket0x0200URL=e.data.websocket0x0200URL;var i=e.data.centerLatlng.split(",");t.center={lat:i[0]-0,lng:i[1]-0},i.length>2&&(t.zoom=i[2]-0),t.initWebsocket()})},destroyed:function(){this.websocket.close()},watch:{carid:function(t,e){if(t){if((""+t).length<10)return;var i={cmd:1005,tid:t};this.websocketsend(i),this.lastTid=t,this.cars=[]}if(e){var n={cmd:1006,tid:e};this.websocketsend(n)}},cars:function(t,e){for(var i=new s.a.HashMap,n=0;n<t.length;n++){var r=t[n];if(i.put(r.tid,r.tid),w.containsKey(r.tid)){(o=w.get(r.tid)).getSymbol()[0].markerFile=this.carImgArr[r.status_jt808],o.getSymbol()[0].markerRotation=this.getRotation(r.direction)}else{var o=new a.h([r.lng_offset-0,r.lat_offset-0],{properties:{name:r.carno},symbol:[{markerFile:this.carImgArr[r.status_jt808],markerWidth:40,markerHeight:40,markerDx:0,markerDy:20,markerOpacity:1,markerRotation:this.getRotation(r.direction)},{textName:"{name}",textSize:14,textDy:-24,textFill:"#004e98",textWeight:"bold"}]}).addTo(b);w.put(r.tid,o)}var h=r;this.lastTid==h.tid&&(this.center.lng=h.lng_offset,this.center.lat=h.lat_offset,this.lastCar=h,this.lastTid="")}var l=w.keySet();for(n=0;n<l.length;n++)i.containsKey(l[n])||(w.get(l[n]).remove(),w.remove(l[n]))},center:function(t,e){n.setCenter([t.lng,t.lat])}},mounted:function(){n=this.$refs.lingxMap.getMap(),b=new a.k("vector").addTo(n)},components:{LingxMap:h.a}},C={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{width:"100%",height:"100%"}},[e("LingxMap",{ref:"lingxMap",attrs:{zoom:this.zoom,center:this.center,issearch:!1,isinfowin:!1}})],1)},staticRenderFns:[]};var S=i("VU/8")(A,C,!1,function(t){i("ztCv")},null,null);e.a=S.exports},ztCv:function(t,e){}});