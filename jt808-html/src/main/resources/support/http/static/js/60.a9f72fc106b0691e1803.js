webpackJsonp([60],{VTXS:function(t,e){},rsXw:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,r=i("u2KI"),l=i.n(r),n=(i("TFOu"),i("ow4a")),o=i("d2xA"),s=i("Zwc7"),c=i("88jF"),d=i.n(c),f=i("4+z/"),h=i.n(f),m=i("iTWp"),p=i.n(m),v=i("Pm2p"),g=i.n(v),u=i("Cf2s"),_=i.n(u),x=i("LHmc"),b=i.n(x),y={},k=null,w={polygonFill:"#dfe8f6",polygonOpacity:.5,lineColor:"blue",lineWidth:5,lineOpacity:.5},I={markerType:"pin",markerFill:"#67c23a",markerFillOpacity:.5,markerLineColor:"#67c23a",markerLineWidth:3,markerLineOpacity:1,markerLineDasharray:[],markerWidth:10,markerHeight:10,markerDx:0,markerDy:0,markerOpacity:1},S={markerType:"pin",markerFill:"#f56c6c",markerFillOpacity:.5,markerLineColor:"#f56c6c",markerLineWidth:3,markerLineOpacity:1,markerLineDasharray:[],markerWidth:10,markerHeight:10,markerDx:0,markerDy:0,markerOpacity:1},W={name:"PostsitionHistory",data:function(){return{form:{car_id:"",car_no:"",check1:!0,check2:!0,check3:!1,name:"",stime:"",etime:""},carImgArr:[b.a,d.a,h.a,p.a,g.a,_.a,b.a],currentMap:"baidu",center:{lng:116.396621,lat:39.916385},zoom:13,data:[],car:{},polyLinePath:[],index:0,intervalProcess:0,value1:0,dataXcjl:[],isShowInfoWindow:!1,islbbclick:!0}},methods:{lbbclick:function(t){this.islbbclick=t},isShowInfoWindow1:function(t){this.isShowInfoWindow=t,t?k&&k.openInfoWindow():k&&k.closeInfoWindow()},createMarker:function(t,e){var i=this,a=e,r=null;"无"!=t.alarm_str?(r=new n.h([t.lng_offset,t.lat_offset],{symbol:S}),y.addGeometry(r)):(r=new n.h([t.lng_offset,t.lat_offset],{symbol:I}),y.addGeometry(r)),r.on("click",function(){i.index=a,i.value1=parseInt(i.index/i.data.length*100),i.car=i.data[i.index],i.$refs.footer.scrollTop=36*(i.index-4)})},queryHistory:function(){this.clearAll();var t=this;if(t.polyLinePath=[],this.form.car_id){var e=this.$loading({lock:!0,text:"正在加载数据，请稍候...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.callApi({apicode:8002,e:"tgps_xcjl",m:"grid",lingxparams:1,car_id:this.form.car_id,type:1,limit:100,cx_stime:this.formatDatetime2(this.form.stime).substring(0,8),cx_etime:this.formatDatetime2(this.form.etime).substring(0,8)},function(e){t.dataXcjl=e.rows}),this.callApi({apicode:1105,car_id:this.form.car_id,stime:this.formatDatetime2(this.form.stime),etime:this.formatDatetime2(this.form.etime),static:this.form.check1,invalid:this.form.check2},function(i){if(e.close(),0==i.data.length&&t.lgxInfo2("该设备在此时间段内无数据！"),i.data.length>0){t.lgxInfo("成功加载"+i.data.length+"条数据！"),t.data=l()(i.data),t.center.lng=t.data[0].lng_offset,t.center.lat=t.data[0].lat_offset;for(var r=[],o=0;o<t.data.length;o++)t.data[o].lng_offset&&(r.push([t.data[o].lng_offset-0,t.data[o].lat_offset-0]),t.createMarker(t.data[o],o));var s=new n.f(r,{symbol:w});y.addGeometry(s),a.fitExtent(s.getExtent(),0),(k=new n.h([t.data[0].lng_offset-0,t.data[0].lat_offset-0],{properties:{name:t.form.car_no},symbol:[{markerFile:h.a,markerWidth:40,markerHeight:40,markerDx:0,markerDy:20,markerOpacity:1,markerRotation:t.getRotation(t.car.direction)},{textName:"{name}",textSize:14,textDy:-24,textFill:"#004e98",textWeight:"bold"}]}).addTo(y)).setInfoWindow({content:t.getWinInfo(t.data[0]),autoPan:!0,width:430,minHeight:120,autoOpenOn:"none",autoCloseOn:"none"}),t.isShowInfoWindow&&k.openInfoWindow()}})}else this.lgxInfo2("操作失败，未选择车辆！")},startPlay:function(){var t=this;0!=this.data.length?(this.lgxInfo("开始回放！"),this.intervalProcess||(this.intervalProcess=setInterval(function(){t.play()},300))):this.lgxInfo2("操作失败，请选查询轨迹再开始回放！")},stopPlay:function(){this.intervalProcess&&(this.lgxInfo("暂停回放！"),clearInterval(this.intervalProcess),this.intervalProcess=null)},play:function(){this.index++,this.car=this.data[this.index],this.index>4&&(this.$refs.footer.scrollTop=36*(this.index-3)),this.value1=parseInt(this.index/this.data.length*100),this.index>=this.data.length&&(this.stopPlay(),this.lgxInfo("回放完成！"),this.index=0,this.$refs.footer.scrollTop=0)},changeSlider:function(t){this.index=parseInt(t/100*this.data.length),this.index>=this.data.length||(this.car=this.data[this.index],this.center.lng=this.car.lng_offset,this.center.lat=this.car.lat_offset,this.$refs.footer.scrollTop=36*(this.index-4))},tableClick:function(t,e,i){for(var a=0;a<this.data.length;a++)if(t.id==this.data[a].id){this.index=a,this.value1=parseInt(this.index/this.data.length*100);break}this.car=t,this.center.lng=this.car.lng_offset,this.center.lat=this.car.lat_offset},tableClick2:function(t,e,i){this.form.stime=t.stime,this.form.etime=t.etime,this.queryHistory()},lingxnodeclick:function(t,e,i){var a=this;t.value<99999||(this.lgxInfo("选中当前车辆："+t.text),this.form.car_id=t.value,this.form.car_no=t.text,this.clearAll(),this.callApi({apicode:8002,e:"tgps_xcjl",m:"grid",lingxparams:1,car_id:t.value,type:1,limit:100},function(t){a.dataXcjl=t.rows}))},formatOnline:function(t){return 1==t?"<span style='color:green'>在线</span>":"<span style='color:red'>离线</span>"},formatAcc:function(t){return!0&t?"<span style='color:green'>点火</span>":"<span style='color:red'>熄火</span>"},formatDatetime:function(t,e,i,a){return i?i.substring(0,4)+"-"+i.substring(4,6)+"-"+i.substring(6,8)+" "+i.substring(8,10)+":"+i.substring(10,12)+":"+i.substring(12,14):""},formatTxxh:function(t,e,i,a){if(0==i)return i;return i<10?i+"-弱":i<20?i+"-中":i+"-强"},formatDwxh:function(t,e,i,a){if(0==i)return i;return i<4?i+"-弱":i<7?i+"-中":i+"-强"},formatStime:function(t,e,i,a){return i.substring(5,16)},getCarno:function(t,e,i,a){var r=this.form.car_no;return r.indexOf(" ")>0&&(r=r.substring(0,r.indexOf(" "))),r},formatDatetime2:function(t){return t.replace(/-/g,"").replace(" ","").replace(/:/g,"")},clearAll:function(){this.data=[],this.polyLinePath=[],this.car={},this.index=0,this.value1=0,y.clear()},getRotation:function(t){return(360-t+360)%360},getWinInfo:function(t){return'<div style="width:400px;font-size:14px;line-height: 28px;margin:0px;padding:0px;"><table  width="100%" border="0" cellSpacing="0" cellPadding="0"><tr style="background-color: #f9f9f9;"><td style="color: #999999;width:64px;">车辆标识:</td><td colspan="3">'+this.form.car_no+'</td></tr><tr><td style="color: #999999;">定位时间:</td><td>'+this.formatDatetime(1,1,t.gpstime,1)+'</td><td style="color: #999999;">行驶速度:</td><td>'+t.speed+' KM/H</td></tr><tr style="background-color: #f9f9f9;"><td style="color: #999999;">车辆状态:</td><td colspan="3">'+t.status_str+'</td></tr><tr><td style="color: #999999;">当前告警:</td><td colspan="3">'+("无"==t.alarm_str?"无":'<span style="color:red">'+t.alarm_str+"</span>")+'</td></tr><tr style="background-color: #f9f9f9;"><td style="color: #999999;" valign="top">当时地址:</td><td colspan="3">'+(t.address||"无")+"</td></tr></table></div>"},downloadExcel:function(){0!=this.data.length?function(t,e,i){for(var a="",r="",l=0;l<t.length;l++)t[l].title&&(r+=t[l].title+",");r=r.slice(0,-1),a+=r+"\r\n";for(var l=0;l<e.length;l++){for(var r="",n=0;n<t.length;n++)t[n].title&&(t[n].formater||(t[n].formater=C),r+='"'+t[n].formater("","",e[l][t[n].field]?e[l][t[n].field]:"")+'"\t,');r.slice(0,r.length-1),a+=r+"\r\n"}if(""==a)return void alert("Invalid data");var i=i,o=new Blob(["\ufeff"+a],{type:"text/csv"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,i+".csv");else{var s=document.createElement("a");s.href=URL.createObjectURL(o),s.style="visibility:hidden",s.download=i+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}([{title:"设备号",field:"car_id"},{title:"定位时间",field:"gpstime",formater:this.formatDatetime},{title:"时速KM/H",field:"speed"},{title:"停留时长",field:"stopInfo"},{title:"车辆状态",field:"status_str"},{title:"车辆告警",field:"alarm_str"},{title:"总里程KM",field:"mileage"},{title:"油量L",field:"oil"},{title:"高程M",field:"height"},{title:"通信信号",field:"txxh"},{title:"定位信号",field:"wxxh"},{title:"地址信息",field:"address"},{title:"系统时间",field:"systime",formater:this.formatDatetime},{title:"lat",field:"lat"},{title:"lng",field:"lng"}],this.data,this.form.car_no+"-轨迹信息"):this.lgxInfo2("操作失败，请选查询轨迹再导出数据！")}},created:function(){var t=this,e=new Date,i=e.getFullYear(),a=e.getMonth()+1,r=e.getDate();a<10&&(a="0"+a),r<10&&(r="0"+r),this.form.stime=i+"-"+a+"-"+r+" 00:00:00",this.form.etime=i+"-"+a+"-"+r+" 23:59:59",this.callApi({apicode:1102},function(e){var i=e.data.centerLatlng.split(",");t.center={lat:i[0]-0,lng:i[1]-0},i.length>2&&(t.zoom=i[2]-0)})},mounted:function(){this.$refs.lingxMap.setIsShowInfoWindow(!1),a=this.$refs.lingxMap.getMap(),y=new n.k("vector").addTo(a)},watch:{car:function(t,e){if(this.car.lng_offset&&k){k.setCoordinates([this.car.lng_offset-0,this.car.lat_offset-0]);var i=k.getSymbol();i[0].markerRotation=this.getRotation(this.car.direction),k.setSymbol(i),k.setInfoWindow({content:this.getWinInfo(this.car),autoOpenOn:"none"}),this.isShowInfoWindow&&k.openInfoWindow(),this.intervalProcess||a.setCenter([this.car.lng_offset-0,this.car.lat_offset-0])}},center:function(t,e){null!=t&&null!=t.lng&&a.setCenter([t.lng,t.lat])}},components:{LingxCarTree:s.a,LingxMap:o.a}};function C(t,e,i){return i}var O={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",{staticStyle:{height:"100%"}},[i("el-aside",{directives:[{name:"show",rawName:"v-show",value:t.islbbclick,expression:"islbbclick"}],staticStyle:{"background-color":"#fff","border-right":"#c1c5cd 1px solid",overflow:"hidden"},attrs:{width:"260px"}},[i("div",{staticStyle:{height:"60%",overflow:"auto"}},[i("LingxCarTree",{ref:"lingxCarTree",attrs:{isChecked:!1},on:{lingxnodeclick:t.lingxnodeclick}})],1),t._v(" "),i("div",{staticStyle:{height:"40%","border-top":"#c1c5cd 1px solid",padding:"10px","background-color":"#ced9e7"}},[i("div",{staticClass:"block"},[i("el-slider",{attrs:{disabled:0==t.data.length,"input-size":"mini","show-tooltip":!1},on:{change:t.changeSlider},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}})],1),t._v(" "),i("el-form",{attrs:{"label-width":"70px",size:"mini"}},[i("el-form-item",{attrs:{label:"过滤定位"}},[i("el-checkbox",{model:{value:t.form.check1,callback:function(e){t.$set(t.form,"check1",e)},expression:"form.check1"}},[t._v("静止")]),t._v(" "),i("el-checkbox",{model:{value:t.form.check2,callback:function(e){t.$set(t.form,"check2",e)},expression:"form.check2"}},[t._v("无效")])],1),t._v(" "),i("el-form-item",{attrs:{label:"开始时间"}},[i("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:t.form.stime,callback:function(e){t.$set(t.form,"stime",e)},expression:"form.stime"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"结束时间"}},[i("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:t.form.etime,callback:function(e){t.$set(t.form,"etime",e)},expression:"form.etime"}})],1),t._v(" "),i("el-form-item",{attrs:{"label-width":"40px"}},[i("el-button",{attrs:{type:"primary",disabled:!t.form.car_id},on:{click:t.queryHistory}},[t._v("查询轨迹")]),t._v(" "),i("el-button",{attrs:{type:"warning",disabled:0==t.data.length},on:{click:t.downloadExcel}},[t._v("导出数据")])],1),t._v(" "),i("el-form-item",{attrs:{"label-width":"40px"}},[i("el-button",{attrs:{type:"success",disabled:0==t.data.length},on:{click:t.startPlay}},[t._v("开始回放")]),t._v(" "),i("el-button",{attrs:{type:"danger",disabled:0==t.data.length},on:{click:t.stopPlay}},[t._v("暂停回放")])],1)],1)],1)]),t._v(" "),i("el-container",{staticStyle:{width:"100%",height:"100%",margin:"0px",padding:"0px"}},[i("el-main",{staticStyle:{margin:"0px",padding:"0px"}},[i("LingxMap",{ref:"lingxMap",attrs:{zoom:t.zoom,center:t.center,isLeftBottmButton1:!1},on:{isShowInfoWindow:t.isShowInfoWindow1,lbbclick:t.lbbclick}})],1),t._v(" "),i("el-footer",{directives:[{name:"show",rawName:"v-show",value:t.islbbclick,expression:"islbbclick"}],staticStyle:{"background-color":"#fff",height:"300px",padding:"0px"}},[i("div",{ref:"footer",staticClass:"scrollbar",staticStyle:{width:"100%",height:"100%",overflow:"auto",padding:"0px"}},[i("table",{staticStyle:{"border-spacing":"0","border-collapse":"collapse"},attrs:{width:"100%"}},[i("thead",{staticClass:"tableHeader"},[i("tr",{staticClass:"clsf9f9f91"},[i("td"),t._v(" "),i("td",[t._v("车辆标识")]),t._v(" "),i("td",[t._v("定位时间")]),t._v(" "),i("td",[t._v("时速KM/H")]),t._v(" "),i("td",[t._v("停留时长")]),t._v(" "),i("td",[t._v("车辆状态")]),t._v(" "),i("td",[t._v("车辆告警")]),t._v(" "),i("td",[t._v("总里程KM")]),t._v(" "),i("td",[t._v("油量L")]),t._v(" "),i("td",[t._v("高程M")]),t._v(" "),i("td",[t._v("通信信号")]),t._v(" "),i("td",[t._v("定位信号")]),t._v(" "),i("td",[t._v("地址")]),t._v(" "),i("td",[t._v("经度")]),t._v(" "),i("td",[t._v("纬度")])])]),t._v(" "),t._l(t.data,function(e,a){return i("tr",{class:{clsf9f9f91:a%2==1,active1:t.index==a},on:{click:function(i){return t.tableClick(e,t.index)}}},[i("td",{attrs:{align:"center"}},[t._v(t._s(a+1))]),t._v(" "),i("td",[t._v(t._s(t.getCarno()))]),t._v(" "),i("td",[t._v(t._s(t.formatDatetime(0,0,e.gpstime)))]),t._v(" "),i("td",[t._v(t._s(e.speed))]),t._v(" "),i("td",[t._v(t._s(e.stopInfo))]),t._v(" "),i("td",[t._v(t._s(e.status_str))]),t._v(" "),i("td",[t._v(t._s(e.alarm_str))]),t._v(" "),i("td",[t._v(t._s(e.mileage))]),t._v(" "),i("td",[t._v(t._s(e.oil))]),t._v(" "),i("td",[t._v(t._s(e.height))]),t._v(" "),i("td",[t._v(t._s(t.formatTxxh(0,0,e.txxh)))]),t._v(" "),i("td",[t._v(t._s(t.formatDwxh(0,0,e.wxxh)))]),t._v(" "),i("td",[i("div",{staticStyle:{width:"100px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.address}},[t._v(t._s(e.address))])]),t._v(" "),i("td",[t._v(t._s(e.lng))]),t._v(" "),i("td",[t._v(t._s(e.lat))])])})],2)])])],1),t._v(" "),i("el-aside",{directives:[{name:"show",rawName:"v-show",value:t.islbbclick,expression:"islbbclick"}],staticStyle:{"background-color":"#fff","border-left":"#c1c5cd 1px solid",overflow:"hidden"},attrs:{width:"230px"}},[i("el-table",{ref:"tableRight",staticStyle:{width:"100%"},attrs:{size:"mini",height:"100%",stripe:"","highlight-current-row":"",data:t.dataXcjl},on:{"row-click":t.tableClick2}},[i("el-table-column",{attrs:{prop:"stime",label:"开始时间",width:"88",formatter:t.formatStime}}),t._v(" "),i("el-table-column",{attrs:{prop:"time",label:"时长",width:"80","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"lc",width:"132",label:"行驶里程KM"}})],1)],1)],1)},staticRenderFns:[]};var D=i("VU/8")(W,O,!1,function(t){i("VTXS")},"data-v-f2cffcf2",null);e.default=D.exports}});