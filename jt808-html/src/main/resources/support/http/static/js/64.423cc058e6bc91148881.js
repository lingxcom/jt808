webpackJsonp([64],{mkdB:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("u2KI"),l=a.n(i),o=a("Zwc7"),r=a("88jF"),n=a.n(r),s=a("4+z/"),c=a.n(s),d=a("iTWp"),h=a.n(d),f=a("Pm2p"),m=a.n(f),p=a("Cf2s"),u=a.n(p),g=a("LHmc"),v=a.n(g),b={name:"PostsitionHistory",data:function(){return{form:{car_id:"",car_no:"",check1:!0,check2:!0,check3:!1,name:"",stime:"",etime:""},carImgArr:[v.a,n.a,c.a,h.a,m.a,u.a,v.a],currentMap:"baidu",center:{lng:116.396621,lat:39.916385},zoom:13,data:[],car:{},polyLinePath:[],showCarInfo:!1,index:0,intervalProcess:0,value1:0}},methods:{syncCenterAndZoom:function(t){var e=t.target.getCenter(),a=e.lng,i=e.lat;this.center.lng=a,this.center.lat=i,this.zoom=t.target.getZoom()},handler:function(t){t.BMap,t.map},openInfoWindow:function(){this.showCarInfo=!0},queryHistory:function(){var t=this;if(t.polyLinePath=[],this.form.car_id){var e=this.$loading({lock:!0,text:"正在加载数据，请稍候...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.callApi({apicode:1105,car_id:this.form.car_id,stime:this.formatDatetime2(this.form.stime),etime:this.formatDatetime2(this.form.etime),static:this.form.check1,invalid:this.form.check2},function(a){if(e.close(),0==a.data.length&&t.lgxInfo2("该设备在此时间段内无数据！"),a.data.length>0){t.lgxInfo("成功加载"+a.data.length+"条数据！"),t.data=l()(a.data),t.center.lng=t.data[0].lng_baidu,t.center.lat=t.data[0].lat_baidu,t.$refs.table.setCurrentRow(t.data[0]),t.car=t.data[0];for(var i=0;i<t.data.length;i++)t.polyLinePath.push({lat:t.data[i].lat_baidu,lng:t.data[i].lng_baidu})}})}else this.lgxInfo2("操作失败，未选择车辆！")},startPlay:function(){var t=this;0!=this.data.length?(this.lgxInfo("开始回放！"),this.intervalProcess||(this.intervalProcess=setInterval(function(){t.play()},400))):this.lgxInfo2("操作失败，请选查询轨迹再开始回放！")},stopPlay:function(){this.intervalProcess&&(this.lgxInfo("暂停回放！"),clearInterval(this.intervalProcess),this.intervalProcess=null)},play:function(){this.car=this.data[this.index],this.$refs.table.setCurrentRow(this.data[this.index]),this.index++,this.index>4&&(this.$refs.table.bodyWrapper.scrollTop=36*(this.index-4)),this.value1=parseInt(this.index/this.data.length*100),this.index>=this.data.length&&(this.stopPlay(),this.lgxInfo("回放完成！"),this.index=0,this.$refs.table.bodyWrapper.scrollTop=0)},changeSlider:function(t){this.index=parseInt(t/100*this.data.length),this.index>=this.data.length||(this.car=this.data[this.index],this.center.lng=this.car.lng_baidu,this.center.lat=this.car.lat_baidu,this.$refs.table.setCurrentRow(this.data[this.index]),this.$refs.table.bodyWrapper.scrollTop=36*(this.index-4))},tableClick:function(t,e,a){for(var i=0;i<this.data.length;i++)if(t.id==this.data[i].id){this.index=i,this.value1=parseInt(this.index/this.data.length*100);break}this.car=t,this.center.lng=this.car.lng_baidu,this.center.lat=this.car.lat_baidu},infoWindowClose:function(t){this.showCarInfo=!1},infoWindowOpen:function(t){this.showCarInfo=!0},lingxnodeclick:function(t,e,a){t.value<99999?this.lgxInfo2("选择错误，必须选择车辆！"):(this.lgxInfo("选中当前车辆："+t.text),this.form.car_id=t.value,this.form.car_no=t.text,this.clearAll())},formatOnline:function(t){return 1==t?"<span style='color:green'>在线</span>":"<span style='color:red'>离线</span>"},formatAcc:function(t){return!0&t?"<span style='color:green'>点火</span>":"<span style='color:red'>熄火</span>"},formatDatetime:function(t,e,a,i){return a?a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)+" "+a.substring(8,10)+":"+a.substring(10,12)+":"+a.substring(12,14):""},formatTxxh:function(t,e,a,i){if(0==a)return a;return a<10?a+"-弱":a<20?a+"-中":a+"-强"},formatDwxh:function(t,e,a,i){if(0==a)return a;return a<4?a+"-弱":a<7?a+"-中":a+"-强"},getCarno:function(t,e,a,i){return this.form.car_no},formatDatetime2:function(t){return t.replace(/-/g,"").replace(" ","").replace(/:/g,"")},clearAll:function(){this.data=[],this.polyLinePath=[],this.car={},this.index=0,this.value1=0},downloadExcel:function(){0!=this.data.length?function(t,e,a){for(var i="",l="",o=0;o<t.length;o++)t[o].title&&(l+=t[o].title+",");l=l.slice(0,-1),i+=l+"\r\n";for(var o=0;o<e.length;o++){for(var l="",r=0;r<t.length;r++)t[r].title&&(l+='"'+(e[o][t[r].field]?e[o][t[r].field]:"")+'"\t,');l.slice(0,l.length-1),i+=l+"\r\n"}if(""==i)return void alert("Invalid data");var a=a,n=new Blob(["\ufeff"+i],{type:"text/csv"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(i,a+".csv");else{var s=document.createElement("a");s.href=URL.createObjectURL(n),s.style="visibility:hidden",s.download=a+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}([{title:"设备号",field:"car_id"},{title:"定位时间",field:"gpstime"},{title:"时速KM/H",field:"speed"},{title:"停留时长",field:"stopInfo"},{title:"车辆状态",field:"status_str"},{title:"车辆告警",field:"alarm_str"},{title:"总里程KM",field:"mileage"},{title:"油量L",field:"oil"},{title:"高程M",field:"height"},{title:"通信信号",field:"txxh"},{title:"定位信号",field:"wxxh"},{title:"地址信息",field:"address"},{title:"系统时间",field:"systime"},{title:"lat",field:"lat"},{title:"lng",field:"lng"}],this.data,this.form.car_no+"-轨迹信息"):this.lgxInfo2("操作失败，请选查询轨迹再导出数据！")}},created:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,i=t.getDate();a<10&&(a="0"+a),i<10&&(i="0"+i),this.form.stime=e+"-"+a+"-"+i+" 00:00:00",this.form.etime=e+"-"+a+"-"+i+" 23:59:59"},mounted:function(){},components:{LingxCarTree:o.a}};var _={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticStyle:{height:"100%"}},[a("el-aside",{staticStyle:{"background-color":"#fff","border-right":"#c1c5cd 1px solid",overflow:"hidden"},attrs:{width:"300px"}},[a("div",{staticStyle:{height:"70%",overflow:"auto"}},[a("LingxCarTree",{ref:"lingxCarTree",staticStyle:{height:"70%"},attrs:{isChecked:!1},on:{lingxnodeclick:t.lingxnodeclick}})],1),t._v(" "),a("div",{staticStyle:{height:"30%","border-top":"#c1c5cd 1px solid",padding:"10px","background-color":"#ced9e7"}},[a("div",{staticClass:"block"},[a("el-slider",{attrs:{disabled:0==t.data.length,"input-size":"mini"},on:{change:t.changeSlider},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}})],1),t._v(" "),a("el-form",{attrs:{"label-width":"80px",size:"mini"}},[a("el-form-item",{attrs:{label:"过滤定位"}},[a("el-checkbox",{model:{value:t.form.check1,callback:function(e){t.$set(t.form,"check1",e)},expression:"form.check1"}},[t._v("静止")]),t._v(" "),a("el-checkbox",{model:{value:t.form.check2,callback:function(e){t.$set(t.form,"check2",e)},expression:"form.check2"}},[t._v("无效")])],1),t._v(" "),a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{staticStyle:{width:"199px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:t.form.stime,callback:function(e){t.$set(t.form,"stime",e)},expression:"form.stime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束时间"}},[a("el-date-picker",{staticStyle:{width:"199px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:t.form.etime,callback:function(e){t.$set(t.form,"etime",e)},expression:"form.etime"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.queryHistory}},[t._v("查询轨迹")]),t._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:t.downloadExcel}},[t._v("导出数据")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"success"},on:{click:t.startPlay}},[t._v("开始回放")]),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:t.stopPlay}},[t._v("暂停回放")])],1)],1)],1)]),t._v(" "),a("el-container",{staticStyle:{width:"100%",height:"100%",margin:"0px",padding:"0px"}},[a("el-main",{staticStyle:{margin:"0px",padding:"0px"}},[a("baidu-map",{staticStyle:{height:"100%"},attrs:{center:t.center,zoom:t.zoom,"scroll-wheel-zoom":!0},on:{ready:t.handler,moving:t.syncCenterAndZoom,moveend:t.syncCenterAndZoom,zoomend:t.syncCenterAndZoom}},[a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t._v(" "),a("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP","BMAP_SATELLITE_MAP"],anchor:"BMAP_ANCHOR_TOP_LEFT"}}),t._v(" "),t.car.lng_baidu?a("bm-marker",{attrs:{position:{lng:t.car.lng_baidu,lat:t.car.lat_baidu},rotation:t.car.direction,icon:{url:t.carImgArr[2],size:{width:40,height:40}}},on:{click:t.openInfoWindow}},[a("bm-label",{attrs:{content:t.form.car_no,labelStyle:{color:"#fff",background:"#004e98",border:"#004e98 3px solid",fontSize:"14px"},offset:{width:-15,height:-20}}})],1):t._e(),t._v(" "),a("bm-polyline",{attrs:{path:t.polyLinePath,"stroke-color":"blue","stroke-opacity":.5,"stroke-weight":5}}),t._v(" "),a("bm-info-window",{attrs:{position:{lng:t.car.lng_baidu,lat:t.car.lat_baidu},title:"",show:t.showCarInfo},on:{close:t.infoWindowClose,open:t.infoWindowOpen}},[a("div",{staticStyle:{width:"400px","font-size":"14px","line-height":"28px"}},[a("table",{attrs:{width:"100%",border:"0",cellSpacing:"0",cellPadding:"0"}},[a("tr",{staticStyle:{"background-color":"#f9f9f9"}},[a("td",{staticStyle:{color:"#999999",width:"64px"}},[t._v("车辆标识:")]),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.form.car_no))])]),t._v(" "),a("tr",[a("td",{staticStyle:{color:"#999999"}},[t._v("行驶速度:")]),a("td",[t._v(t._s(t.car.speed)+" KM/H")]),a("td",{staticStyle:{color:"#999999"}},[t._v("定位时间:")]),a("td",[t._v(t._s(t.formatDatetime(1,1,t.car.gpstime,1)))])]),t._v(" "),a("tr",{staticStyle:{"background-color":"#f9f9f9"}},[a("td",{staticStyle:{color:"#999999"}},[t._v("车辆状态:")]),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.car.status_str))])]),t._v(" "),a("tr",[a("td",{staticStyle:{color:"#999999"}},[t._v("当前告警:")]),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.car.alarm_str))])]),t._v(" "),a("tr",{staticStyle:{"background-color":"#f9f9f9"}},[a("td",{staticStyle:{color:"#999999"},attrs:{valign:"top"}},[t._v("当前地址:")]),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.car.address))])])])])])],1)],1),t._v(" "),a("el-footer",{staticStyle:{"background-color":"#fff",height:"300px",padding:"0px"}},[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"mini",height:"300",stripe:"","highlight-current-row":"",data:t.data},on:{"row-click":t.tableClick}},[a("el-table-column",{attrs:{label:"",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(e.$index+1)+"\n                    ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"carno",label:"车辆标识",width:"120","show-overflow-tooltip":"",formatter:t.getCarno}}),t._v(" "),a("el-table-column",{attrs:{prop:"gpstime",sortable:"",label:"定位时间",width:"160",formatter:t.formatDatetime}}),t._v(" "),a("el-table-column",{attrs:{prop:"speed",sortable:"",label:"时速KM/H",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"stopInfo",label:"停留时长",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"status_str",label:"车辆状态",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"alarm_str",label:"车辆告警",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"mileage",label:"总里程KM",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"oil",sortable:"",label:"油量L",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"height",sortable:"",label:"高程M",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"txxh",label:"通信信号",width:"70",formatter:t.formatTxxh}}),t._v(" "),a("el-table-column",{attrs:{prop:"wxxh",label:"定位信号",width:"70",formatter:t.formatDwxh}}),t._v(" "),a("el-table-column",{attrs:{prop:"address","show-overflow-tooltip":"",label:"地址"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lng","show-overflow-tooltip":"",label:"经度"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lat","show-overflow-tooltip":"",label:"纬度"}})],1)],1)],1)],1)},staticRenderFns:[]};var x=a("VU/8")(b,_,!1,function(t){a("uNMo")},null,null);e.default=x.exports},uNMo:function(t,e){}});