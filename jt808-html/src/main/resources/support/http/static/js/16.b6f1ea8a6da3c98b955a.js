webpackJsonp([16],{"Hcl/":function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1_maptalks_dist_maptalks_css__=__webpack_require__("TFOu"),__WEBPACK_IMPORTED_MODULE_1_maptalks_dist_maptalks_css___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_maptalks_dist_maptalks_css__),__WEBPACK_IMPORTED_MODULE_2_maptalks__=__webpack_require__("ow4a"),__WEBPACK_IMPORTED_MODULE_3__components_LingxMap_vue__=__webpack_require__("d2xA");__webpack_exports__.a={name:"Pls",data:function(){return{maxHeight:800,plstype:1,center:{lng:116.396621,lat:39.916385},zoom:13,listData:[],searchText:"",isEdit:!1,currentData:null,menuTableVisible:!1,dialogVisible:!1,fanceForm:{id:"",name:"",speed:"",stop_time:"",color:"",radius:""},fanceTitle:"",fanceType:1,predefineColors:["#f56c6c","#e6a23c","#67c23a"],symbol:{markerType:"x",markerWidth:20,markerHeight:20,markerLineWidth:3,markerLineColor:"#F00",polygonFill:"#dfe8f6",polygonOpacity:.5,lineColor:"#3c537e",lineWidth:3}}},created:function(){this.maxHeight=$(window).height()-90;var e=this;this.callApi({apicode:1102},function(t){var a=t.data.centerLatlng.split(",");e.center={lat:a[0]-0,lng:a[1]-0},a.length>2&&(e.zoom=a[2]-0)})},methods:{reload:function(){var e=this;this.callApi({apicode:1118,ecode:"tgps_pls",mcode:"grid",type:this.plstype,cx_name:this.searchText,limit:2e3,page:1,orderField:"id",orderType:"desc",lingxparams:1},function(t){e.listData=t.rows})},addPls:function(){switch(this.layer.clear(),this.isEdit=!0,this.currentData=null,this.plstype-0){case 3:this.lgxInfo("新增关键点，请在地图上单击绘制"),this.drawTool.setMode("Point").enable();break;case 2:this.lgxInfo("新增路线，请在地图上单击绘制，双击结束"),this.drawTool.setMode("LineString").enable();break;case 1:this.lgxInfo("新增区域，请在地图上单击绘制，双击结束"),this.drawTool.setMode("Polygon").enable()}},editPls:function(){this.pls.startEdit(),this.isEdit=!0},delPls:function(){this.isEdit=!1,this.layer.clear()},save:function(){var e=this,t="";this.currentData&&(t=this.currentData.name);var a=prompt("请输入名称:",t),i=null,s=0;if(a){if(this.pls.endEdit(),this.isEdit=!1,3==this.plstype){var l=__WEBPACK_IMPORTED_MODULE_2_maptalks__.c.toNumberArrays(this.pls.getCoordinates());i=this.getLatlngs(l),s=1}else if(2==this.plstype){l=__WEBPACK_IMPORTED_MODULE_2_maptalks__.c.toNumberArrays(this.pls.getCoordinates());i=this.getLatlngs(l),s=l.length}else{l=__WEBPACK_IMPORTED_MODULE_2_maptalks__.c.toNumberArrays(this.pls.getCoordinates())[0];i=this.getLatlngs(l),s=l.length}var n="";this.currentData&&(n=this.currentData.id),this.callApi({apicode:1116,name:a,num:s,type:this.plstype,latlngs:i,id:n},function(t){e.lgxInfo(t.message),e.reload()})}else this.lgxInfo2("未输入名称，取消保存！")},delData:function(){var e=this;confirm("确认从数据库中删除吗？")&&this.callApi({apicode:8002,ecode:"tgps_pls",mcode:"del",id:this.currentData.id},function(t){e.lgxInfo(t.message),e.reload(),e.currentData=null,e.layer.clear()})},getLatlngs:function(e){return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(e)},searchModel:function(){this.reload()},handleCurrentChange:function handleCurrentChange(data){if(!this.isEdit&&data){this.currentData=data;var geometry=null,latlngs=eval("("+data.latlngs+")");switch(this.layer.clear(),data.type-0){case 3:geometry=new __WEBPACK_IMPORTED_MODULE_2_maptalks__.h(latlngs,{symbol:this.symbol}),this.map.setCenter(latlngs);break;case 2:geometry=new __WEBPACK_IMPORTED_MODULE_2_maptalks__.f(latlngs,{symbol:this.symbol}),this.map.fitExtent(geometry.getExtent(),0);break;case 1:geometry=new __WEBPACK_IMPORTED_MODULE_2_maptalks__.i([latlngs],{symbol:this.symbol}),this.map.fitExtent(geometry.getExtent(),0)}this.layer.addGeometry(geometry),this.pls=geometry}},contextmenuTable:function(e,t,a){if(a.preventDefault(),!this.isEdit){this.$refs.leftTable.setCurrentRow(e),this.menuTableVisible=!0;var i=document.querySelector("#menuTable");i.style.left=a.clientX+"px",i.style.top=a.clientY+"px",document.addEventListener("click",this.menuTableClose)}},menuTableClose:function(){this.menuTableVisible=!1,document.removeEventListener("click",this.menuTableClose)},setParams:function(){var e=this;this.fanceTitle="参数设置",this.callApi({apicode:8002,e:"tgps_pls",m:"get",id:this.currentData.id},function(t){e.fanceForm=t.data,e.fanceForm.is_map="1"==e.fanceForm.is_map,e.dialogVisible=!0})},saveParams:function(){var e=this,t={};for(var a in this.fanceForm)t[a]=this.fanceForm[a];t.apicode=8002,t.e="tgps_pls",t.m="edit",t.is_map=this.fanceForm.is_map?"1":"0",this.callApi(t,function(t){e.lgxInfo(t.message),e.dialogVisible=!1})}},watch:{plstype:function(){this.reload()},center:function(e,t){null!=e&&null!=e.lng&&this.map.setCenter([e.lng,e.lat])}},mounted:function(){var e=this;this.map=this.$refs.lingxMap.getMap(),this.layer=new __WEBPACK_IMPORTED_MODULE_2_maptalks__.k("vector_pls_1").addTo(this.map),this.drawTool=new __WEBPACK_IMPORTED_MODULE_2_maptalks__.e({mode:"Polygon",symbol:this.symbol}).addTo(this.map).disable(),this.drawTool.on("drawend",function(t){e.layer.addGeometry(t.geometry),"Point"!=t.geometry.type&&t.geometry.startEdit(),e.pls=t.geometry,e.drawTool.disable()}),this.reload()},components:{LingxMap:__WEBPACK_IMPORTED_MODULE_3__components_LingxMap_vue__.a}}},"m/aV":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Hcl/"),s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticStyle:{height:"100%"}},[a("el-header",{staticStyle:{"background-color":"#e8eaed","border-bottom":"#d6d6d6 1px solid"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{spellcheck:"false",size:"mini",placeholder:"搜索名称"},nativeOn:{keyup:function(t){return t.type.indexOf("key")||13===t.keyCode?e.searchModel():null}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),e._v(" "),a("el-button",{attrs:{size:"mini",icon:"el-icon-search",circle:""},on:{click:e.searchModel}}),e._v(" "),a("div",{staticClass:"noselect",staticStyle:{"margin-left":"20px","margin-right":"20px",display:"inline-block"}},[a("el-radio-group",{attrs:{size:"mini",disabled:e.isEdit},model:{value:e.plstype,callback:function(t){e.plstype=t},expression:"plstype"}},[a("el-radio-button",{attrs:{label:"1"}},[a("span",[e._v("面")])]),e._v(" "),a("el-radio-button",{attrs:{label:"2"}},[a("span",[e._v("线")])]),e._v(" "),a("el-radio-button",{attrs:{label:"3"}},[a("span",[e._v("点")])])],1)],1),e._v(" "),a("el-button-group",[a("el-button",{attrs:{size:"mini",disabled:e.isEdit},on:{click:e.addPls}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{size:"mini",disabled:!this.currentData||e.isEdit},on:{click:e.editPls}},[e._v("修改")]),e._v(" "),a("el-button",{attrs:{size:"mini",disabled:!e.isEdit},on:{click:e.delPls}},[e._v("取消")])],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary",disabled:!e.isEdit},on:{click:e.save}},[e._v("保存")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"danger",disabled:!this.currentData||e.isEdit},on:{click:e.delData}},[e._v("删除记录")])],1),e._v(" "),a("el-container",[a("el-aside",{staticClass:"noselect",staticStyle:{"border-right":"1px #f1f1f1 solid"},attrs:{width:"250px"}},[a("el-table",{ref:"leftTable",staticStyle:{width:"100%"},attrs:{data:e.listData,size:"small",stripe:"",border:"","highlight-current-row":"",height:"100%","max-height":e.maxHeight},on:{"current-change":e.handleCurrentChange,"row-contextmenu":e.contextmenuTable}},[a("el-table-column",{attrs:{prop:"id",label:"编码",sortable:"",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称",sortable:"","show-overflow-tooltip":"",width:"148"}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.menuTableVisible,expression:"menuTableVisible"}],staticClass:"menu-div",staticStyle:{"z-index":"2000"},attrs:{id:"menuTable"}},[a("el-menu",{attrs:{id:"menuTable1231","text-color":"#000"}},[a("el-menu-item",{staticClass:"menuItem",attrs:{index:"1"},on:{click:function(t){return e.setParams()}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("参数设置")])])],1)],1)],1),e._v(" "),a("el-main",{staticClass:"noselect",staticStyle:{"background-color":"#dfe9f6",padding:"0px",height:"100%",width:"100%"}},[a("LingxMap",{ref:"lingxMap",attrs:{zoom:e.zoom,center:e.center,isinfowin:!1}})],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.fanceTitle,visible:e.dialogVisible,width:"720px",height:"480px","show-close":"","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticStyle:{height:"380px",overflow:"auto"}},[a("el-row",[a("el-col",{staticStyle:{"padding-top":"15px"},attrs:{span:20}},[a("el-form",{ref:"ruleForm",staticStyle:{padding:"0px",margin:"0px"},attrs:{model:e.fanceForm,"label-width":"160px",size:"mini"}},[a("el-form-item",{attrs:{label:"围栏名称",prop:"name",required:!0}},[a("el-input",{model:{value:e.fanceForm.name,callback:function(t){e.$set(e.fanceForm,"name",t)},expression:"fanceForm.name"}})],1),e._v(" "),1!=e.fanceForm.type?a("el-form-item",{attrs:{label:"作用范围阈值(米)",prop:"radius",required:!0}},[a("el-input",{model:{value:e.fanceForm.radius,callback:function(t){e.$set(e.fanceForm,"radius",t)},expression:"fanceForm.radius"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"地图显示"}},[a("el-switch",{model:{value:e.fanceForm.is_map,callback:function(t){e.$set(e.fanceForm,"is_map",t)},expression:"fanceForm.is_map"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.fanceForm.is_map,expression:"fanceForm.is_map"}],attrs:{label:"显示颜色"}},[a("el-color-picker",{attrs:{predefine:e.predefineColors},model:{value:e.fanceForm.color,callback:function(t){e.$set(e.fanceForm,"color",t)},expression:"fanceForm.color"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.saveParams}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)])],1)},staticRenderFns:[]};var l=function(e){a("o2kw")},n=a("VU/8")(i.a,s,!1,l,"data-v-2d083d56",null);t.default=n.exports},o2kw:function(e,t){}});