webpackJsonp([69],{"0Hl4":function(t,e){},dMru:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("mvHQ"),s=o.n(n),i=(o("/bhr"),o("TFOu"),o("ow4a"),o("d2xA")),a=o("88jF"),r=o.n(a),l=o("4+z/"),c=o.n(l),d=o("iTWp"),h=o.n(d),g=o("Pm2p"),f=o.n(g),u=o("Cf2s"),b=o.n(u),p=o("LHmc"),_=o.n(p),w={},m={name:"RealtimeSingle",data:function(){return{dialogVisible:!1,id:"",websocket0x0200URL:"",websocket:null,carImgArr:[_.a,r.a,c.a,h.a,f.a,b.a,_.a],polyLinePath:[],conheight:{height:""},center:{lng:116.396621,lat:39.916385},zoom:13,cars:[],lastTid:"",lastCar:{},showCarInfo:!0}},methods:{syncCenterAndZoom:function(t){var e=t.target.getCenter(),o=e.lng,n=e.lat;this.center.lng=o,this.center.lat=n,this.zoom=t.target.getZoom()},handler:function(t){t.BMap,t.map},openInfoWindow:function(t){this.showCarInfo=!0},getClickInfo:function(t){this.center.lng=t.point.lng,this.center.lat=t.point.lat},infoWindowClose:function(t){this.showCarInfo=!1},infoWindowOpen:function(t){this.showCarInfo=!0},open:function(t,e){var o=this;w[t]=e,this.id=t,this.dialogVisible=!0,this.callApi({apicode:1102},function(t){o.websocket0x0200URL=t.data.websocket0x0200URL;var e=t.data.centerLatlng.split(",");o.center={lat:e[0]-0,lng:e[1]-0},o.initWebsocket()})},handleClose:function(t){this.dialogVisible=!1,this.cars=[],this.websocket.close()},getHeight:function(){this.conheight.height=window.innerHeight-126+"px"},initWebsocket:function(){var t=this.websocket0x0200URL;this.websocket=new WebSocket(t),this.websocket.onmessage=this.websocketonmessage,this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onclose=this.websocketclose},addCar:function(t){if("0x0200"==t.type){t.carno=w[t.tid];for(var e=-1,o=0;o<this.cars.length;o++)t.tid==this.cars[o].tid&&(e=o);-1==e?(this.showCarInfo=!0,this.cars.push(t),this.center.lng=t.lng_baidu,this.center.lat=t.lat_baidu):this.$set(this.cars,e,t),this.polyLinePath.push({lat:t.lat_baidu,lng:t.lng_baidu}),this.lastCar=t}},websocketonopen:function(){console.log("连接成功");var t={cmd:1005,tid:this.id};this.websocketsend(t)},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function(t){var e=JSON.parse(t.data);this.addCar(e)},websocketsend:function(t){t.lingxtoken=this.$store.getters.getUser.token,this.websocket.send(s()(t))},websocketclose:function(t){console.log("断开连接",t)},formatOnline:function(t){return 1==t?"<span style='color:green'>在线</span>":"<span style='color:red'>离线</span>"},formatAcc:function(t){return!0&t?"<span style='color:green'>点火</span>":"<span style='color:red'>熄火</span>"},formatDatetime:function(t,e,o,n){return o?o.substring(0,4)+"-"+o.substring(4,6)+"-"+o.substring(6,8)+" "+o.substring(8,10)+":"+o.substring(10,12)+":"+o.substring(12,14):""}},created:function(){window.addEventListener("resize",this.getHeight),this.getHeight()},components:{LingxMap:i.a}},v={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.dialogVisible?o("el-dialog",{attrs:{title:"实时跟踪",visible:t.dialogVisible,fullscreen:!0,"show-close":"","append-to-body":"","before-close":t.handleClose}},[o("div",{style:t.conheight},[o("baidu-map",{staticStyle:{height:"100%"},attrs:{center:t.center,zoom:t.zoom,"scroll-wheel-zoom":!0},on:{ready:t.handler,moving:t.syncCenterAndZoom,moveend:t.syncCenterAndZoom,zoomend:t.syncCenterAndZoom}},[o("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t._v(" "),o("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP","BMAP_SATELLITE_MAP"],anchor:"BMAP_ANCHOR_TOP_LEFT"}}),t._v(" "),t._l(t.cars,function(e,n){return o("bm-marker",{key:n,attrs:{position:{lng:e.lng_baidu,lat:e.lat_baidu},rotation:e.direction,icon:{url:t.carImgArr[e.status_jt808],size:{width:40,height:40}}},on:{click:function(o){return t.openInfoWindow(e.tid)}}},[o("bm-label",{attrs:{content:e.carno,labelStyle:{color:"#fff",background:"#004e98",border:"#004e98 3px solid",fontSize:"14px"},offset:{width:-15,height:-20}}})],1)}),t._v(" "),o("bm-polyline",{attrs:{path:t.polyLinePath,"stroke-color":"blue","stroke-opacity":.5,"stroke-weight":5}}),t._v(" "),o("bm-info-window",{attrs:{position:{lng:t.lastCar.lng_baidu,lat:t.lastCar.lat_baidu},title:"",show:t.showCarInfo},on:{close:t.infoWindowClose,open:t.infoWindowOpen}},[o("div",{staticStyle:{width:"400px","font-size":"14px","line-height":"28px"}},[o("table",{attrs:{width:"100%",border:"0",cellSpacing:"0",cellPadding:"0"}},[o("tr",{staticStyle:{"background-color":"#f9f9f9"}},[o("td",{staticStyle:{color:"#999999",width:"64px"}},[t._v("车牌号码:")]),o("td",[t._v(t._s(t.lastCar.carno))]),o("td",{staticStyle:{color:"#999999",width:"64px"}},[t._v("当前状态:")]),o("td",[t._v(t._s(t.lastCar.comment))])]),t._v(" "),o("tr",[o("td",{staticStyle:{color:"#999999"}},[t._v("行驶速度:")]),o("td",[t._v(t._s(t.lastCar.speed)+" KM/H")]),o("td",{staticStyle:{color:"#999999"}},[t._v("定位时间:")]),o("td",[t._v(t._s(t.formatDatetime(1,1,t.lastCar.gpstime,1)))])]),t._v(" "),o("tr",{staticStyle:{"background-color":"#f9f9f9"}},[o("td",{staticStyle:{color:"#999999"}},[t._v("车辆状态:")]),o("td",{attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.status_str))])]),t._v(" "),o("tr",[o("td",{staticStyle:{color:"#999999"}},[t._v("当前告警:")]),"无"==t.lastCar.alarm_str?o("td",{attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.alarm_str))]):t._e(),"无"!=t.lastCar.alarm_str?o("td",{staticStyle:{color:"red"},attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.alarm_str))]):t._e()]),t._v(" "),o("tr",{staticStyle:{"background-color":"#f9f9f9"}},[o("td",{staticStyle:{color:"#999999"},attrs:{valign:"top"}},[t._v("当前地址:")]),o("td",{attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.address))])])])])])],2)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.handleClose}},[t._v("关 闭")])],1)]):t._e()],1)},staticRenderFns:[]};var k=o("VU/8")(m,v,!1,function(t){o("0Hl4")},null,null);e.default=k.exports}});