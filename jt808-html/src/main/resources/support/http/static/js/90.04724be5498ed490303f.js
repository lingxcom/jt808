webpackJsonp([90],{C46n:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),n=a.n(o),i=a("3t5t"),s=a("YwP3"),l=a("B5xV"),r=a("Zwc7"),c=a("88jF"),d=a.n(c),h=a("4+z/"),p=a.n(h),u=a("iTWp"),f=a.n(u),g=a("Pm2p"),m=a.n(g),b=a("Cf2s"),_=a.n(b),v=a("LHmc"),w=a.n(v),C={},k={name:"PostsitionRealtime",data:function(){return{websocket0x0200URL:"",websocket:null,carImgArr:[w.a,d.a,p.a,f.a,m.a,_.a,w.a],center:{lng:116.396621,lat:39.916385},zoom:13,cars:[],lastTid:"",lastCar:{},showCarInfo:!0}},methods:{syncCenterAndZoom:function(t){var e=t.target.getCenter(),a=e.lng,o=e.lat;this.center.lng=a,this.center.lat=o,this.zoom=t.target.getZoom()},handler:function(t){t.BMap,t.map},openInfoWindow:function(t){this.showCarInfo=!0,this.setCarCenter(t)},getClickInfo:function(t){this.center.lng=t.point.lng,this.center.lat=t.point.lat},infoWindowClose:function(t){this.showCarInfo=!1},infoWindowOpen:function(t){this.showCarInfo=!0},lingxnodeclick:function(t,e,a){this.setCarCenter(t.value)},lingxcheckchange:function(t,e,a){if(e){C[t.value]=t.text,this.lastTid=t.value;var o={cmd:1005,tid:t.value};this.websocketsend(o)}else{o={cmd:1006,tid:t.value};this.websocketsend(o),this.delCar(t.value)}},addCar:function(t){if("0x0200"==t.type){t.carno=C[t.tid];for(var e=-1,a=0;a<this.cars.length;a++)t.tid==this.cars[a].tid&&(e=a);-1==e?(this.showCarInfo=!0,this.cars.push(t)):this.$set(this.cars,e,t),this.lastTid==t.tid?(this.center.lng=t.lng_baidu,this.center.lat=t.lat_baidu,this.lastCar=t,this.lastTid=""):this.lastCar.tid==t.tid&&(this.lastCar=t)}},delCar:function(t){for(var e=-1,a=0;a<this.cars.length;a++)t==this.cars[a].tid&&(e=a);e>-1&&this.cars.splice(e,1),this.lastCar.tid==t&&(this.lastCar={})},tableclickHandler:function(t,e,a){this.setCarCenter(t.tid)},setCarCenter:function(t){for(var e=0;e<this.cars.length;e++)t==this.cars[e].tid&&(this.lastCar=this.cars[e],this.center.lng=this.cars[e].lng_baidu,this.center.lat=this.cars[e].lat_baidu)},formatOnline:function(t){return 1==t?"<span style='color:green'>在线</span>":"<span style='color:red'>离线</span>"},formatAcc:function(t){return!0&t?"<span style='color:green'>点火</span>":"<span style='color:red'>熄火</span>"},formatDatetime:function(t,e,a,o){return a?a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)+" "+a.substring(8,10)+":"+a.substring(10,12)+":"+a.substring(12,14):""},initWebsocket:function(){var t=this.websocket0x0200URL;this.websocket=new WebSocket(t),this.websocket.onmessage=this.websocketonmessage,this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onclose=this.websocketclose},websocketonopen:function(){},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function(t){var e=JSON.parse(t.data);this.addCar(e),this.$refs.lingxCarTree.updateTreeNode(e)},websocketsend:function(t){t.lingxtoken=this.$store.getters.getUser.token,this.websocket.send(n()(t))},websocketclose:function(t){console.log("断开连接",t)},formatTxxh:function(t,e,a,o){if(a){return a<10?a+"-弱":a<20?a+"-中":a+"-强"}return 0},formatDwxh:function(t,e,a,o){if(a){return a<4?a+"-弱":a<7?a+"-中":a+"-强"}return 0},openRealtimeSingleDialog:function(t){this.$refs.realtimeSingle.open(t,C[t])},openXcjlGridDialog:function(t){this.$refs.xcjlGridDialog.openDialog(t,C[t])},openCmdListDialog:function(t){this.$refs.cmdListDialog.openDialog(t,C[t]+"-指令下发",1)},openParListDialog:function(t){this.$refs.cmdListDialog.openDialog(t,C[t]+"-参数设置",2)},copyFun:function(){var t=document.createElement("textarea");t.style.position="absolute",t.style.left="-100%",t.value="车辆标识："+this.lastCar.carno+"\n当前状态："+this.lastCar.comment+"\n行驶速度："+this.lastCar.speed+" KM/H\n定位时间："+this.formatDatetime(1,1,this.lastCar.gpstime,1)+"\n车辆状态："+this.lastCar.status_str+"\n当前告警："+this.lastCar.alarm_str+"\n当前地址："+this.lastCar.address,document.body.appendChild(t),t.select(),document.execCommand("copy")?this.lgxInfo("复制成功"):this.lgxInfo2("复制失败"),document.body.removeChild(t)}},created:function(){var t=this;this.callApi({apicode:1102},function(e){t.websocket0x0200URL=e.data.websocket0x0200URL;var a=e.data.centerLatlng.split(",");t.center={lat:a[0]-0,lng:a[1]-0},t.initWebsocket()})},mounted:function(){},destroyed:function(){this.websocket.close()},components:{LingxCarTree:r.a,RealtimeSingle:l.default,XcjlGridDialog:s.default,CmdListDialog:i.default}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticStyle:{height:"100%"}},[a("el-aside",{staticStyle:{"background-color":"#fff","border-right":"#c1c5cd 1px solid"},attrs:{width:"300px"}},[a("LingxCarTree",{ref:"lingxCarTree",on:{lingxcheckchange:t.lingxcheckchange,lingxnodeclick:t.lingxnodeclick}})],1),t._v(" "),a("el-container",{staticStyle:{width:"100%",height:"100%",margin:"0px",padding:"0px"}},[a("el-main",{staticStyle:{margin:"0px",padding:"0px"}},[a("baidu-map",{staticStyle:{height:"100%"},attrs:{center:t.center,zoom:t.zoom,"scroll-wheel-zoom":!0},on:{ready:t.handler,moving:t.syncCenterAndZoom,moveend:t.syncCenterAndZoom,zoomend:t.syncCenterAndZoom}},[a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t._v(" "),a("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP","BMAP_SATELLITE_MAP"],anchor:"BMAP_ANCHOR_TOP_LEFT"}}),t._v(" "),t._l(t.cars,function(e,o){return a("bm-marker",{key:o,attrs:{position:{lng:e.lng_baidu,lat:e.lat_baidu},rotation:e.direction,icon:{url:t.carImgArr[e.status_jt808],size:{width:40,height:40}}},on:{click:function(a){return t.openInfoWindow(e.tid)}}},[a("bm-label",{attrs:{content:e.carno,labelStyle:{color:"#fff",background:"#004e98",border:"#004e98 3px solid",fontSize:"14px"},offset:{width:-15,height:-20}}})],1)}),t._v(" "),a("bm-info-window",{attrs:{position:{lng:t.lastCar.lng_baidu,lat:t.lastCar.lat_baidu},title:"",show:t.showCarInfo},on:{close:t.infoWindowClose,open:t.infoWindowOpen}},[a("div",{staticStyle:{width:"400px","font-size":"14px","line-height":"28px"}},[a("table",{attrs:{width:"100%",border:"0",cellSpacing:"0",cellPadding:"0"}},[a("tr",{staticStyle:{"background-color":"#f9f9f9"}},[a("td",{staticStyle:{color:"#999999",width:"64px"}},[t._v("车辆标识:")]),a("td",[t._v(t._s(t.lastCar.carno))]),a("td",{staticStyle:{color:"#999999",width:"64px"}},[t._v("当前状态:")]),a("td",[t._v(t._s(t.lastCar.comment))])]),t._v(" "),a("tr",[a("td",{staticStyle:{color:"#999999"}},[t._v("行驶速度:")]),a("td",[t._v(t._s(t.lastCar.speed)+" KM/H")]),a("td",{staticStyle:{color:"#999999"}},[t._v("定位时间:")]),a("td",[t._v(t._s(t.formatDatetime(1,1,t.lastCar.gpstime,1)))])]),t._v(" "),a("tr",{staticStyle:{"background-color":"#f9f9f9"}},[a("td",{staticStyle:{color:"#999999"}},[t._v("车辆状态:")]),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.status_str))])]),t._v(" "),a("tr",[a("td",{staticStyle:{color:"#999999"}},[t._v("当前告警:")]),"无"==t.lastCar.alarm_str?a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.alarm_str))]):t._e(),"无"!=t.lastCar.alarm_str?a("td",{staticStyle:{color:"red"},attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.alarm_str))]):t._e()]),t._v(" "),a("tr",{staticStyle:{"background-color":"#f9f9f9"}},[a("td",{staticStyle:{color:"#999999"},attrs:{valign:"top"}},[t._v("当前地址:")]),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.lastCar.address))])]),t._v(" "),a("tr",[a("td",{attrs:{colspan:"4"}},[a("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.openRealtimeSingleDialog(t.lastCar.tid)}}},[t._v("实时跟踪")]),t._v(" |\n          "),a("el-link",{attrs:{type:"success"},on:{click:function(e){return t.openXcjlGridDialog(t.lastCar.tid)}}},[t._v("行程记录")]),t._v(" |\n          "),a("el-link",{attrs:{type:"warning"},on:{click:function(e){return t.openCmdListDialog(t.lastCar.tid)}}},[t._v("下发指令")]),t._v(" |\n          "),a("el-link",{attrs:{type:"danger"},on:{click:function(e){return t.openParListDialog(t.lastCar.tid)}}},[t._v("设置参数")]),t._v(" |\n          "),a("el-link",{attrs:{type:"info"},on:{click:t.copyFun}},[t._v("复制信息")])],1)])])])])],2)],1),t._v(" "),a("el-footer",{staticStyle:{"background-color":"#fff",height:"300px",padding:"0px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini",height:"300",stripe:"","highlight-current-row":"",data:t.cars},on:{"row-click":t.tableclickHandler}},[a("el-table-column",{attrs:{label:"",width:"36px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(e.$index+1)+"\n                    ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"carno",sortable:"",label:"车辆标识",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"online",sortable:"",label:"在线",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{domProps:{innerHTML:t._s(t.formatOnline(e.row.online))}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status_str",label:"车辆状态",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"alarm_str",label:"当前告警",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"speed",label:"时速KM/H",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"gpstime",sortable:"",label:"定位时间",width:"160",formatter:t.formatDatetime}}),t._v(" "),a("el-table-column",{attrs:{prop:"A01",sortable:"",label:"总里程KM",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"height",sortable:"",label:"高程M",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"A30",sortable:"",label:"通信信号",width:"100",formatter:t.formatTxxh}}),t._v(" "),a("el-table-column",{attrs:{prop:"A31",sortable:"",label:"定位信号",width:"100",formatter:t.formatDwxh}}),t._v(" "),a("el-table-column",{attrs:{prop:"tid","show-overflow-tooltip":"",label:"SIM卡号",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address","show-overflow-tooltip":"",label:"地址"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lng","show-overflow-tooltip":"",label:"经度"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lat","show-overflow-tooltip":"",label:"纬度"}})],1),t._v(" "),a("RealtimeSingle",{ref:"realtimeSingle"}),t._v(" "),a("XcjlGridDialog",{ref:"xcjlGridDialog"}),t._v(" "),a("CmdListDialog",{ref:"cmdListDialog"})],1)],1)],1)},staticRenderFns:[]};var x=a("VU/8")(k,y,!1,function(t){a("lAjE")},null,null);e.default=x.exports},lAjE:function(t,e){}});