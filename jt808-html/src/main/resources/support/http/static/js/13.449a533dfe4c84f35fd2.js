webpackJsonp([13],{HLES:function(t,e){},KEIG:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("mvHQ"),n=i.n(s),o=i("sLCk"),a=i("QzrF"),r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"100%",height:"100%",display:"flex","flex-direction":"column"}},[i("div",{staticStyle:{"text-align":"right",height:"24px","background-color":"#ced9e7",color:"#0466b0",border:"#99bbe8 solid 1px",margin:"1px 1px 0px 1px","border-bottom":"none 0px"}},[i("div",{staticStyle:{float:"left","font-size":"12px",color:"#0466b0","margin-left":"10px","line-height":"24px"}},[t._v("监控数量:"+t._s(t.tids.length))]),t._v(" "),i("a",{staticStyle:{"font-size":"12px",color:"#0466b0","margin-right":"10px","line-height":"24px"},attrs:{href:"javascript:;"},on:{click:t.closeWinInfo}},[t._v("关闭消息框")]),t._v(" "),i("a",{staticStyle:{"font-size":"12px",color:"#0466b0","margin-right":"10px","line-height":"24px"},attrs:{href:"javascript:;"},on:{click:t.closeWin}},[t._v("关闭")])]),t._v(" "),i("div",{staticStyle:{flex:"1","flex-grow":"1",overflow:"hidden",border:"#99bbe8 solid 1px",margin:"0px 1px 1px 1px","border-top":"none 0px"}},[i("LingxMap",{ref:"lingxMap",attrs:{mapid:t.mapid,zoom:t.zoom,center:t.center,issearch:!1,isinfowin:!1,ispls:!1},on:{isShowInfoWindow:t.isShowInfoWindow1}})],1)])},staticRenderFns:[]};var l=function(t){i("HLES")},c=i("VU/8")(a.a,r,!1,l,null,null).exports,_={name:"PoststionRealtimeGroup",data:function(){return{list:[{tids:[]},{tids:[]},{tids:[]},{tids:[]}],cindex:0}},methods:{remove:function(t){this.list[t].tids=[],localStorage.setItem("LingxCarMapGroup",n()(this.list))},add:function(t){this.cindex=t,this.$refs.carsDialog.openDialog()},setTids:function(t){if(t.length>20)this.lgxInfo2("终端设备不能多于20个。");else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);this.list[this.cindex].tids=e,localStorage.setItem("LingxCarMapGroup",n()(this.list))}}},created:function(){var t=localStorage.getItem("LingxCarMapGroup");t&&(this.list=JSON.parse(t))},destroyed:function(){},components:{CarsDialog:o.default,LingxCarMapGroup:c}},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"flex","flex-direction":"row","flex-wrap":"wrap","justify-content":"center",padding:"0px",width:"100%",height:"100%"}},[t._l(t.list,function(e,s){return i("div",{staticStyle:{width:"50%"}},[e.tids.length>0?i("LingxCarMapGroup",{attrs:{mapid:"map"+s,tids:e.tids},on:{closewin:function(e){return t.remove(s)}}}):t._e(),t._v(" "),0==e.tids.length?i("div",{staticStyle:{display:"flex",position:"relative","justify-content":"center","align-items":"center",height:"100%",cursor:"pointer"},on:{click:function(e){return t.add(s)}}},[t._m(0,!0)]):t._e()],1)}),t._v(" "),i("CarsDialog",{ref:"carsDialog",on:{returntids:t.setTids}})],2)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{border:"#99bbe8 1px solid",position:"absolute",top:"1px",left:"1px",right:"1px",bottom:"1px",display:"flex","justify-content":"center","align-items":"center"}},[e("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"font-size":"86px",color:"#0077AA"}})])}]};var h=i("VU/8")(_,d,!1,function(t){i("lReK")},null,null);e.default=h.exports},QzrF:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1__assets_js_jsmap_js__=__webpack_require__("/bhr"),__WEBPACK_IMPORTED_MODULE_2_maptalks_dist_maptalks_css__=__webpack_require__("TFOu"),__WEBPACK_IMPORTED_MODULE_2_maptalks_dist_maptalks_css___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_maptalks_dist_maptalks_css__),__WEBPACK_IMPORTED_MODULE_3_maptalks__=__webpack_require__("ow4a"),__WEBPACK_IMPORTED_MODULE_4__components_LingxMap_vue__=__webpack_require__("d2xA");__webpack_exports__.a={name:"LingxCarMapGroup",props:{tids:{type:Array,default:function(){return[]}},carid:{type:String,default:""},carno:{type:String,default:""},mapid:{type:String,default:"map"}},data:function(){return{isShowInfoWindow:!1,hashMap:new __WEBPACK_IMPORTED_MODULE_1__assets_js_jsmap_js__.a.HashMap,websocket0x0200URL:"",websocket:null,carImgArr:["/car6.png","/car1.png","/car2.png","/car3.png","/car4.png","/car5.png","/car6.png"],center:{lng:116.396621,lat:39.916385},zoom:13,cars:[],lastCar:{},lastTid:"",showTid:""}},methods:{closeWin:function(){this.$emit("closewin")},closeWinInfo:function(){this.isShowInfoWindow1(!1)},isShowInfoWindow1:function(t){this.isShowInfoWindow=t,t?this.showTid&&this.hashMap.get(this.showTid).openInfoWindow():this.showTid&&this.hashMap.get(this.showTid).closeInfoWindow()},syncCenterAndZoom:function(t){var e=t.target.getCenter(),i=e.lng,s=e.lat;this.center.lng=i,this.center.lat=s,this.zoom=t.target.getZoom()},handler:function(t){t.BMap,t.map},addCar:function(t){if(t&&"0x0200"==t.type){t.carno||(t.carno=t.tid),t.carno.indexOf(" ")>0&&(t.carno=t.carno.substring(0,t.carno.indexOf(" ")));for(var e=-1,i=0;i<this.cars.length;i++)t.tid==this.cars[i].tid&&(e=i);-1==e?this.cars.push(t):this.$set(this.cars,e,t),this.lastTid==t.tid?(this.center={lng:t.lng_offset,lat:t.lat_offset},this.lastCar=t,this.lastTid=""):this.lastCar.tid==t.tid&&(this.lastCar=t)}},delCar:function(t){for(var e=-1,i=0;i<this.cars.length;i++)t==this.cars[i].tid&&(e=i);e>-1&&this.cars.splice(e,1),this.lastCar.tid==t&&(this.lastCar={})},getCarIcon:function(t){return"/static/images/"+(t.icon_type?t.icon_type:"car_icon_0")+this.carImgArr[t.status_jt808]},getWinInfo:function(t){var e='<div style="width:420px;font-size:14px;line-height: 28px;margin:0px;padding:0px;"><table  width="100%" border="0" cellSpacing="0" cellPadding="0"><tr style="background-color: #f9f9f9;"><td style="color: #999999;width:64px;">车辆标识:</td><td ><div style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;width:120px;" title="'+t.carno+'">'+t.carno+'</div></td><td style="color: #999999;width:64px;">系统时间:</td><td  width="150">'+this.formatDatetime(1,1,t.systime,1)+'</td></tr><tr><td style="color: #999999;">行驶速度:</td><td>'+t.speed+' KM/H</td><td style="color: #999999;">卫星时间:</td><td>'+this.formatDatetime(1,1,t.gpstime,1)+'</td></tr><tr style="background-color: #f9f9f9;"><td style="color: #999999;">车辆状态:</td><td colspan="1"><div style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;width:120px;" title="'+t.status_str+'">'+t.status_str+'</div></td><td style="color: #999999;width:64px;">在线状态:</td><td><div style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;width:120px;" title="'+t.comment+'">'+t.comment+'</div></td></tr><tr><td style="color: #999999;">当前告警:</td><td colspan="3">'+("无"==t.alarm_str?"无":'<span style="color:red">'+t.alarm_str+"</span>")+"</td></tr>";return t.is_address&&(e+='<tr style="background-color: #f9f9f9;"><td style="color: #999999;" valign="top">当前地址:</td><td colspan="3"><div style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;width:350px;" title="'+t.address+'">'+(t.address||"无")+"</div></td></tr>"),e},formatDatetime:function(t,e,i,s){return i?i.substring(0,4)+"-"+i.substring(4,6)+"-"+i.substring(6,8)+" "+i.substring(8,10)+":"+i.substring(10,12)+":"+i.substring(12,14):""},initWebsocket:function(){var t=this.websocket0x0200URL;this.websocket=new WebSocket(t),this.websocket.onmessage=this.websocketonmessage,this.websocket.onopen=this.websocketonopen,this.websocket.onerror=this.websocketonerror,this.websocket.onclose=this.websocketclose},websocketonopen:function(){this.tids.length>0&&(this.lastTid=this.tids[0]);for(var t=0;t<this.tids.length;t++){var e={cmd:1005,tid:this.tids[t]};this.websocketsend(e)}},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function websocketonmessage(e){var redata1=eval("("+e.data+")");this.addCar(redata1)},websocketsend:function(t){t.lingxtoken=this.$store.getters.getUser.token,this.websocket.send(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(t))},websocketclose:function(t){console.log("断开连接",t)},getRotation:function(t){return(360-t+360)%360}},created:function(){var t=this;this.callApi({apicode:1102},function(e){t.websocket0x0200URL=e.data.websocket0x0200URL;var i=e.data.centerLatlng.split(",");t.center={lat:i[0]-0,lng:i[1]-0},i.length>2&&(t.zoom=i[2]-0),t.initWebsocket()})},destroyed:function(){this.websocket.close()},watch:{cars:function(t,e){for(var i=this,s=new __WEBPACK_IMPORTED_MODULE_1__assets_js_jsmap_js__.a.HashMap,n=0;n<t.length;n++){var o=t[n];if(null!=o&&null!=o.lng_offset){var a;if(s.put(o.tid,o.tid),this.hashMap.containsKey(o.tid))(a=this.hashMap.get(o.tid)).setCoordinates([o.lng_offset-0,o.lat_offset-0]),a.setSymbol([{markerFile:i.getCarIcon(o),markerWidth:40,markerHeight:40,markerDx:0,markerDy:20,markerOpacity:1,markerRotation:i.getRotation(o.direction)},{textName:"{name}",textSize:14,textDy:-24,textFill:"#004e98",textWeight:"bold"}]),a.setProperties({name:o.carno}),a.setInfoWindow({content:i.getWinInfo(o),autoPan:!1,width:450,minHeight:120,autoOpenOn:"none",autoCloseOn:"none"});else(a=new __WEBPACK_IMPORTED_MODULE_3_maptalks__.h([o.lng_offset-0,o.lat_offset-0],{id:o.tid,properties:{name:o.carno},cursor:"pointer",symbol:[{markerFile:i.getCarIcon(o),markerWidth:40,markerHeight:40,markerDx:0,markerDy:20,markerOpacity:1,markerRotation:i.getRotation(o.direction)},{textName:"{name}",textSize:14,textDy:-24,textFill:"#004e98",textWeight:"bold"}]}).addTo(this.layer)).on("click",function(t){i.showTid=t.target._id,i.isShowInfoWindow?t.target.openInfoWindow():i.isShowInfoWindow1(!0)}),a.setInfoWindow({content:i.getWinInfo(o),autoPan:!1,width:450,minHeight:120,autoOpenOn:"none",autoCloseOn:"none"}),this.hashMap.put(o.tid,a),i.isShowInfoWindow&&a.openInfoWindow();var r=o;this.lastTid==r.tid&&(this.center.lng=r.lng_offset,this.center.lat=r.lat_offset,this.lastCar=r,this.lastTid="")}}var l=this.hashMap.keySet();for(n=0;n<l.length;n++)s.containsKey(l[n])||(this.hashMap.get(l[n]).remove(),this.hashMap.remove(l[n]));i.isShowInfoWindow&&this.hashMap.get(this.showTid)&&this.hashMap.get(this.showTid).openInfoWindow()},center:function(t,e){this.map.setCenter([t.lng,t.lat])}},mounted:function(){this.map=this.$refs.lingxMap.getMap(),this.layer=new __WEBPACK_IMPORTED_MODULE_3_maptalks__.k("vector").addTo(this.map)},components:{LingxMap:__WEBPACK_IMPORTED_MODULE_4__components_LingxMap_vue__.a}}},lReK:function(t,e){}});