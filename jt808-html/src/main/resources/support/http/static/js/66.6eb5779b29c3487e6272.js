webpackJsonp([66],{"Vb+6":function(t,e){},hwVi:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,l=a("u2KI"),r=a.n(l),o=(a("TFOu"),a("ow4a")),n=a("d2xA"),s=a("Zwc7"),c=a("88jF"),d=a.n(c),h=a("4+z/"),f=a.n(h),m=a("iTWp"),p=a.n(m),u=a("Pm2p"),b=a.n(u),g=a("Cf2s"),v=a.n(g),x=a("LHmc"),w=a.n(x),y={},k=null,_={polygonFill:"#dfe8f6",polygonOpacity:.5,lineColor:"blue",lineWidth:5,lineOpacity:.5},I={markerType:"pin",markerFill:"#67c23a",markerFillOpacity:.5,markerLineColor:"#67c23a",markerLineWidth:3,markerLineOpacity:1,markerLineDasharray:[],markerWidth:10,markerHeight:10,markerDx:0,markerDy:0,markerOpacity:1},S={markerType:"pin",markerFill:"#f56c6c",markerFillOpacity:.5,markerLineColor:"#f56c6c",markerLineWidth:3,markerLineOpacity:1,markerLineDasharray:[],markerWidth:10,markerHeight:10,markerDx:0,markerDy:0,markerOpacity:1},W={name:"PostsitionHistory",data:function(){return{form:{car_id:"",car_no:"",check1:!0,check2:!0,check3:!1,name:"",stime:"",etime:""},carImgArr:[w.a,d.a,f.a,p.a,b.a,v.a,w.a],currentMap:"baidu",center:{lng:116.396621,lat:39.916385},zoom:13,data:[],car:{},polyLinePath:[],index:0,intervalProcess:0,value1:0,dataXcjl:[],isShowInfoWindow:!0,islbbclick:!0}},methods:{lbbclick:function(t){this.islbbclick=t},isShowInfoWindow1:function(t){this.isShowInfoWindow=t,t?k&&k.openInfoWindow():k&&k.closeInfoWindow()},createMarker:function(t,e){var a=this,i=e,l=null;"无"!=t.alarm_str?(l=new o.h([t.lng_baidu,t.lat_baidu],{symbol:S}),y.addGeometry(l)):(l=new o.h([t.lng_baidu,t.lat_baidu],{symbol:I}),y.addGeometry(l)),l.on("click",function(){a.index=i,a.value1=parseInt(a.index/a.data.length*100),a.car=a.data[a.index],a.$refs.table.setCurrentRow(a.data[a.index]),a.$refs.table.bodyWrapper.scrollTop=36*(a.index-4)})},queryHistory:function(){this.clearAll();var t=this;if(t.polyLinePath=[],this.form.car_id){var e=this.$loading({lock:!0,text:"正在加载数据，请稍候...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.callApi({apicode:1105,car_id:this.form.car_id,stime:this.formatDatetime2(this.form.stime),etime:this.formatDatetime2(this.form.etime),static:this.form.check1,invalid:this.form.check2},function(a){if(e.close(),0==a.data.length&&t.lgxInfo2("该设备在此时间段内无数据！"),a.data.length>0){t.lgxInfo("成功加载"+a.data.length+"条数据！"),t.data=r()(a.data),t.center.lng=t.data[0].lng_baidu,t.center.lat=t.data[0].lat_baidu,t.$refs.table.setCurrentRow(t.data[0]);for(var l=[],n=0;n<t.data.length;n++)t.data[n].lng_baidu&&(l.push([t.data[n].lng_baidu-0,t.data[n].lat_baidu-0]),t.createMarker(t.data[n],n));var s=new o.f(l,{symbol:_});y.addGeometry(s),i.fitExtent(s.getExtent(),0),(k=new o.h([t.data[0].lng_baidu-0,t.data[0].lat_baidu-0],{properties:{name:t.form.car_no},symbol:[{markerFile:f.a,markerWidth:40,markerHeight:40,markerDx:0,markerDy:20,markerOpacity:1,markerRotation:t.getRotation(t.car.direction)},{textName:"{name}",textSize:14,textDy:-24,textFill:"#004e98",textWeight:"bold"}]}).addTo(y)).setInfoWindow({content:t.getWinInfo(t.data[0]),autoPan:!0,width:430,minHeight:120,autoOpenOn:"none",autoCloseOn:"none"}),t.isShowInfoWindow&&k.openInfoWindow()}})}else this.lgxInfo2("操作失败，未选择车辆！")},startPlay:function(){var t=this;0!=this.data.length?(this.lgxInfo("开始回放！"),this.intervalProcess||(this.intervalProcess=setInterval(function(){t.play()},400))):this.lgxInfo2("操作失败，请选查询轨迹再开始回放！")},stopPlay:function(){this.intervalProcess&&(this.lgxInfo("暂停回放！"),clearInterval(this.intervalProcess),this.intervalProcess=null)},play:function(){this.car=this.data[this.index],this.$refs.table.setCurrentRow(this.data[this.index]),this.index++,this.index>4&&(this.$refs.table.bodyWrapper.scrollTop=36*(this.index-4)),this.value1=parseInt(this.index/this.data.length*100),this.index>=this.data.length&&(this.stopPlay(),this.lgxInfo("回放完成！"),this.index=0,this.$refs.table.bodyWrapper.scrollTop=0)},changeSlider:function(t){this.index=parseInt(t/100*this.data.length),this.index>=this.data.length||(this.car=this.data[this.index],this.center.lng=this.car.lng_baidu,this.center.lat=this.car.lat_baidu,this.$refs.table.setCurrentRow(this.data[this.index]),this.$refs.table.bodyWrapper.scrollTop=36*(this.index-4))},tableClick:function(t,e,a){for(var i=0;i<this.data.length;i++)if(t.id==this.data[i].id){this.index=i,this.value1=parseInt(this.index/this.data.length*100);break}this.car=t,this.center.lng=this.car.lng_baidu,this.center.lat=this.car.lat_baidu},tableClick2:function(t,e,a){this.form.stime=t.stime,this.form.etime=t.etime,this.queryHistory()},lingxnodeclick:function(t,e,a){var i=this;t.value<99999||(this.lgxInfo("选中当前车辆："+t.text),this.form.car_id=t.value,this.form.car_no=t.text,this.clearAll(),this.callApi({apicode:8002,e:"tgps_xcjl",m:"grid",lingxparams:1,car_id:t.value,type:1,limit:100},function(t){i.dataXcjl=t.rows}))},formatOnline:function(t){return 1==t?"<span style='color:green'>在线</span>":"<span style='color:red'>离线</span>"},formatAcc:function(t){return!0&t?"<span style='color:green'>点火</span>":"<span style='color:red'>熄火</span>"},formatDatetime:function(t,e,a,i){return a?a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)+" "+a.substring(8,10)+":"+a.substring(10,12)+":"+a.substring(12,14):""},formatTxxh:function(t,e,a,i){if(0==a)return a;return a<10?a+"-弱":a<20?a+"-中":a+"-强"},formatDwxh:function(t,e,a,i){if(0==a)return a;return a<4?a+"-弱":a<7?a+"-中":a+"-强"},getCarno:function(t,e,a,i){var l=this.form.car_no;return l.indexOf(" ")>0&&(l=l.substring(0,l.indexOf(" "))),l},formatDatetime2:function(t){return t.replace(/-/g,"").replace(" ","").replace(/:/g,"")},clearAll:function(){this.data=[],this.polyLinePath=[],this.car={},this.index=0,this.value1=0,y.clear()},getRotation:function(t){return(360-t+360)%360},getWinInfo:function(t){return'<div style="width:400px;font-size:14px;line-height: 28px;margin:0px;padding:0px;"><table  width="100%" border="0" cellSpacing="0" cellPadding="0"><tr style="background-color: #f9f9f9;"><td style="color: #999999;width:64px;">车辆标识:</td><td colspan="3">'+this.form.car_no+'</td></tr><tr><td style="color: #999999;">定位时间:</td><td>'+this.formatDatetime(1,1,t.gpstime,1)+'</td><td style="color: #999999;">行驶速度:</td><td>'+t.speed+' KM/H</td></tr><tr style="background-color: #f9f9f9;"><td style="color: #999999;">车辆状态:</td><td colspan="3">'+t.status_str+'</td></tr><tr><td style="color: #999999;">当前告警:</td><td colspan="3">'+("无"==t.alarm_str?"无":'<span style="color:red">'+t.alarm_str+"</span>")+'</td></tr><tr style="background-color: #f9f9f9;"><td style="color: #999999;" valign="top">当时地址:</td><td colspan="3">'+(t.address||"无")+"</td></tr></table></div>"},downloadExcel:function(){0!=this.data.length?function(t,e,a){for(var i="",l="",r=0;r<t.length;r++)t[r].title&&(l+=t[r].title+",");l=l.slice(0,-1),i+=l+"\r\n";for(var r=0;r<e.length;r++){for(var l="",o=0;o<t.length;o++)t[o].title&&(t[o].formater||(t[o].formater=C),l+='"'+t[o].formater("","",e[r][t[o].field]?e[r][t[o].field]:"")+'"\t,');l.slice(0,l.length-1),i+=l+"\r\n"}if(""==i)return void alert("Invalid data");var a=a,n=new Blob(["\ufeff"+i],{type:"text/csv"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(i,a+".csv");else{var s=document.createElement("a");s.href=URL.createObjectURL(n),s.style="visibility:hidden",s.download=a+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}([{title:"设备号",field:"car_id"},{title:"定位时间",field:"gpstime",formater:this.formatDatetime},{title:"时速KM/H",field:"speed"},{title:"停留时长",field:"stopInfo"},{title:"车辆状态",field:"status_str"},{title:"车辆告警",field:"alarm_str"},{title:"总里程KM",field:"mileage"},{title:"油量L",field:"oil"},{title:"高程M",field:"height"},{title:"通信信号",field:"txxh"},{title:"定位信号",field:"wxxh"},{title:"地址信息",field:"address"},{title:"系统时间",field:"systime",formater:this.formatDatetime},{title:"lat",field:"lat"},{title:"lng",field:"lng"}],this.data,this.form.car_no+"-轨迹信息"):this.lgxInfo2("操作失败，请选查询轨迹再导出数据！")}},created:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,i=t.getDate();a<10&&(a="0"+a),i<10&&(i="0"+i),this.form.stime=e+"-"+a+"-"+i+" 00:00:00",this.form.etime=e+"-"+a+"-"+i+" 23:59:59"},mounted:function(){i=this.$refs.lingxMap.getMap(),y=new o.k("vector").addTo(i)},watch:{car:function(t,e){if(k){k.setCoordinates([this.car.lng_baidu-0,this.car.lat_baidu-0]);var a=k.getSymbol();a[0].markerRotation=this.getRotation(this.car.direction),k.setSymbol(a),k.setInfoWindow({content:this.getWinInfo(this.car),autoOpenOn:"none"}),this.isShowInfoWindow&&k.openInfoWindow(),this.intervalProcess||i.setCenter([this.car.lng_baidu-0,this.car.lat_baidu-0])}}},components:{LingxCarTree:s.a,LingxMap:n.a}};function C(t,e,a){return a}var O={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticStyle:{height:"100%"}},[a("el-aside",{directives:[{name:"show",rawName:"v-show",value:t.islbbclick,expression:"islbbclick"}],staticStyle:{"background-color":"#fff","border-right":"#c1c5cd 1px solid",overflow:"hidden"},attrs:{width:"300px"}},[a("div",{staticStyle:{height:"70%",overflow:"auto"}},[a("LingxCarTree",{ref:"lingxCarTree",staticStyle:{height:"70%"},attrs:{isChecked:!1},on:{lingxnodeclick:t.lingxnodeclick}})],1),t._v(" "),a("div",{staticStyle:{height:"30%","border-top":"#c1c5cd 1px solid",padding:"10px","background-color":"#ced9e7"}},[a("div",{staticClass:"block"},[a("el-slider",{attrs:{disabled:0==t.data.length,"input-size":"mini","show-tooltip":!1},on:{change:t.changeSlider},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}})],1),t._v(" "),a("el-form",{attrs:{"label-width":"80px",size:"mini"}},[a("el-form-item",{attrs:{label:"过滤定位"}},[a("el-checkbox",{model:{value:t.form.check1,callback:function(e){t.$set(t.form,"check1",e)},expression:"form.check1"}},[t._v("静止")]),t._v(" "),a("el-checkbox",{model:{value:t.form.check2,callback:function(e){t.$set(t.form,"check2",e)},expression:"form.check2"}},[t._v("无效")])],1),t._v(" "),a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{staticStyle:{width:"199px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:t.form.stime,callback:function(e){t.$set(t.form,"stime",e)},expression:"form.stime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束时间"}},[a("el-date-picker",{staticStyle:{width:"199px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:t.form.etime,callback:function(e){t.$set(t.form,"etime",e)},expression:"form.etime"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",disabled:!t.form.car_id},on:{click:t.queryHistory}},[t._v("查询轨迹")]),t._v(" "),a("el-button",{attrs:{type:"warning",disabled:0==t.data.length},on:{click:t.downloadExcel}},[t._v("导出数据")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"success",disabled:0==t.data.length},on:{click:t.startPlay}},[t._v("开始回放")]),t._v(" "),a("el-button",{attrs:{type:"danger",disabled:0==t.data.length},on:{click:t.stopPlay}},[t._v("暂停回放")])],1)],1)],1)]),t._v(" "),a("el-container",{staticStyle:{width:"100%",height:"100%",margin:"0px",padding:"0px"}},[a("el-main",{staticStyle:{margin:"0px",padding:"0px"}},[a("LingxMap",{ref:"lingxMap",attrs:{zoom:t.zoom,center:t.center,isLeftBottmButton1:!0},on:{isShowInfoWindow:t.isShowInfoWindow1,lbbclick:t.lbbclick}})],1),t._v(" "),a("el-footer",{directives:[{name:"show",rawName:"v-show",value:t.islbbclick,expression:"islbbclick"}],staticStyle:{"background-color":"#fff",height:"300px",padding:"0px"}},[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"mini",height:"300",stripe:"","highlight-current-row":"",data:t.data},on:{"row-click":t.tableClick}},[a("el-table-column",{attrs:{label:"",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(e.$index+1)+"\n                    ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"carno",label:"车辆标识","show-overflow-tooltip":"",width:"150",formatter:t.getCarno}}),t._v(" "),a("el-table-column",{attrs:{prop:"gpstime",label:"定位时间",width:"150",formatter:t.formatDatetime}}),t._v(" "),a("el-table-column",{attrs:{prop:"speed",label:"时速KM/H",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"stopInfo",label:"停留时长",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status_str",label:"车辆状态","show-overflow-tooltip":"",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"alarm_str",label:"车辆告警","show-overflow-tooltip":"",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"mileage",label:"总里程KM",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"oil",label:"油量L",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"height",label:"高程M",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"txxh",label:"通信信号",width:"70",formatter:t.formatTxxh}}),t._v(" "),a("el-table-column",{attrs:{prop:"wxxh",label:"定位信号",width:"70",formatter:t.formatDwxh}}),t._v(" "),a("el-table-column",{attrs:{prop:"address","show-overflow-tooltip":"",label:"地址"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lng","show-overflow-tooltip":"",label:"经度"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lat","show-overflow-tooltip":"",label:"纬度"}})],1)],1)],1),t._v(" "),a("el-aside",{directives:[{name:"show",rawName:"v-show",value:t.islbbclick,expression:"islbbclick"}],staticStyle:{"background-color":"#fff","border-left":"#c1c5cd 1px solid",overflow:"hidden"},attrs:{width:"300px"}},[a("el-table",{ref:"tableRight",staticStyle:{width:"100%"},attrs:{size:"mini",height:"100%",stripe:"","highlight-current-row":"",data:t.dataXcjl},on:{"row-click":t.tableClick2}},[a("el-table-column",{attrs:{prop:"stime",label:"开始时间",width:"138"}}),t._v(" "),a("el-table-column",{attrs:{prop:"time",label:"时长",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{prop:"lc",width:"132",label:"行驶里程KM"}})],1)],1)],1)},staticRenderFns:[]};var M=a("VU/8")(W,O,!1,function(t){a("Vb+6")},null,null);e.default=M.exports}});